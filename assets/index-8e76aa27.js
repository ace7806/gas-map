(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))f(_);new MutationObserver(_=>{for(const x of _)if(x.type==="childList")for(const T of x.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&f(T)}).observe(document,{childList:!0,subtree:!0});function a(_){const x={};return _.integrity&&(x.integrity=_.integrity),_.referrerpolicy&&(x.referrerPolicy=_.referrerpolicy),_.crossorigin==="use-credentials"?x.credentials="include":_.crossorigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function f(_){if(_.ep)return;_.ep=!0;const x=a(_);fetch(_.href,x)}})();var ob=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function sb(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ud={},ab={get exports(){return ud},set exports(n){ud=n}},Bd={},dr={},lb={get exports(){return dr},set exports(n){dr=n}},Pt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mc=Symbol.for("react.element"),ub=Symbol.for("react.portal"),cb=Symbol.for("react.fragment"),hb=Symbol.for("react.strict_mode"),db=Symbol.for("react.profiler"),pb=Symbol.for("react.provider"),fb=Symbol.for("react.context"),mb=Symbol.for("react.forward_ref"),gb=Symbol.for("react.suspense"),yb=Symbol.for("react.memo"),_b=Symbol.for("react.lazy"),s_=Symbol.iterator;function xb(n){return n===null||typeof n!="object"?null:(n=s_&&n[s_]||n["@@iterator"],typeof n=="function"?n:null)}var Mx={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Dx=Object.assign,Lx={};function Il(n,i,a){this.props=n,this.context=i,this.refs=Lx,this.updater=a||Mx}Il.prototype.isReactComponent={};Il.prototype.setState=function(n,i){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,i,"setState")};Il.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function Rx(){}Rx.prototype=Il.prototype;function Fm(n,i,a){this.props=n,this.context=i,this.refs=Lx,this.updater=a||Mx}var Om=Fm.prototype=new Rx;Om.constructor=Fm;Dx(Om,Il.prototype);Om.isPureReactComponent=!0;var a_=Array.isArray,Bx=Object.prototype.hasOwnProperty,Nm={current:null},Fx={key:!0,ref:!0,__self:!0,__source:!0};function Ox(n,i,a){var f,_={},x=null,T=null;if(i!=null)for(f in i.ref!==void 0&&(T=i.ref),i.key!==void 0&&(x=""+i.key),i)Bx.call(i,f)&&!Fx.hasOwnProperty(f)&&(_[f]=i[f]);var u=arguments.length-2;if(u===1)_.children=a;else if(1<u){for(var N=Array(u),Z=0;Z<u;Z++)N[Z]=arguments[Z+2];_.children=N}if(n&&n.defaultProps)for(f in u=n.defaultProps,u)_[f]===void 0&&(_[f]=u[f]);return{$$typeof:mc,type:n,key:x,ref:T,props:_,_owner:Nm.current}}function vb(n,i){return{$$typeof:mc,type:n.type,key:i,ref:n.ref,props:n.props,_owner:n._owner}}function Um(n){return typeof n=="object"&&n!==null&&n.$$typeof===mc}function wb(n){var i={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(a){return i[a]})}var l_=/\/+/g;function lf(n,i){return typeof n=="object"&&n!==null&&n.key!=null?wb(""+n.key):i.toString(36)}function Zh(n,i,a,f,_){var x=typeof n;(x==="undefined"||x==="boolean")&&(n=null);var T=!1;if(n===null)T=!0;else switch(x){case"string":case"number":T=!0;break;case"object":switch(n.$$typeof){case mc:case ub:T=!0}}if(T)return T=n,_=_(T),n=f===""?"."+lf(T,0):f,a_(_)?(a="",n!=null&&(a=n.replace(l_,"$&/")+"/"),Zh(_,i,a,"",function(Z){return Z})):_!=null&&(Um(_)&&(_=vb(_,a+(!_.key||T&&T.key===_.key?"":(""+_.key).replace(l_,"$&/")+"/")+n)),i.push(_)),1;if(T=0,f=f===""?".":f+":",a_(n))for(var u=0;u<n.length;u++){x=n[u];var N=f+lf(x,u);T+=Zh(x,i,a,N,_)}else if(N=xb(n),typeof N=="function")for(n=N.call(n),u=0;!(x=n.next()).done;)x=x.value,N=f+lf(x,u++),T+=Zh(x,i,a,N,_);else if(x==="object")throw i=String(n),Error("Objects are not valid as a React child (found: "+(i==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return T}function Ah(n,i,a){if(n==null)return n;var f=[],_=0;return Zh(n,f,"","",function(x){return i.call(a,x,_++)}),f}function bb(n){if(n._status===-1){var i=n._result;i=i(),i.then(function(a){(n._status===0||n._status===-1)&&(n._status=1,n._result=a)},function(a){(n._status===0||n._status===-1)&&(n._status=2,n._result=a)}),n._status===-1&&(n._status=0,n._result=i)}if(n._status===1)return n._result.default;throw n._result}var Pr={current:null},Wh={transition:null},Sb={ReactCurrentDispatcher:Pr,ReactCurrentBatchConfig:Wh,ReactCurrentOwner:Nm};Pt.Children={map:Ah,forEach:function(n,i,a){Ah(n,function(){i.apply(this,arguments)},a)},count:function(n){var i=0;return Ah(n,function(){i++}),i},toArray:function(n){return Ah(n,function(i){return i})||[]},only:function(n){if(!Um(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Pt.Component=Il;Pt.Fragment=cb;Pt.Profiler=db;Pt.PureComponent=Fm;Pt.StrictMode=hb;Pt.Suspense=gb;Pt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Sb;Pt.cloneElement=function(n,i,a){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var f=Dx({},n.props),_=n.key,x=n.ref,T=n._owner;if(i!=null){if(i.ref!==void 0&&(x=i.ref,T=Nm.current),i.key!==void 0&&(_=""+i.key),n.type&&n.type.defaultProps)var u=n.type.defaultProps;for(N in i)Bx.call(i,N)&&!Fx.hasOwnProperty(N)&&(f[N]=i[N]===void 0&&u!==void 0?u[N]:i[N])}var N=arguments.length-2;if(N===1)f.children=a;else if(1<N){u=Array(N);for(var Z=0;Z<N;Z++)u[Z]=arguments[Z+2];f.children=u}return{$$typeof:mc,type:n.type,key:_,ref:x,props:f,_owner:T}};Pt.createContext=function(n){return n={$$typeof:fb,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:pb,_context:n},n.Consumer=n};Pt.createElement=Ox;Pt.createFactory=function(n){var i=Ox.bind(null,n);return i.type=n,i};Pt.createRef=function(){return{current:null}};Pt.forwardRef=function(n){return{$$typeof:mb,render:n}};Pt.isValidElement=Um;Pt.lazy=function(n){return{$$typeof:_b,_payload:{_status:-1,_result:n},_init:bb}};Pt.memo=function(n,i){return{$$typeof:yb,type:n,compare:i===void 0?null:i}};Pt.startTransition=function(n){var i=Wh.transition;Wh.transition={};try{n()}finally{Wh.transition=i}};Pt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Pt.useCallback=function(n,i){return Pr.current.useCallback(n,i)};Pt.useContext=function(n){return Pr.current.useContext(n)};Pt.useDebugValue=function(){};Pt.useDeferredValue=function(n){return Pr.current.useDeferredValue(n)};Pt.useEffect=function(n,i){return Pr.current.useEffect(n,i)};Pt.useId=function(){return Pr.current.useId()};Pt.useImperativeHandle=function(n,i,a){return Pr.current.useImperativeHandle(n,i,a)};Pt.useInsertionEffect=function(n,i){return Pr.current.useInsertionEffect(n,i)};Pt.useLayoutEffect=function(n,i){return Pr.current.useLayoutEffect(n,i)};Pt.useMemo=function(n,i){return Pr.current.useMemo(n,i)};Pt.useReducer=function(n,i,a){return Pr.current.useReducer(n,i,a)};Pt.useRef=function(n){return Pr.current.useRef(n)};Pt.useState=function(n){return Pr.current.useState(n)};Pt.useSyncExternalStore=function(n,i,a){return Pr.current.useSyncExternalStore(n,i,a)};Pt.useTransition=function(){return Pr.current.useTransition()};Pt.version="18.2.0";(function(n){n.exports=Pt})(lb);const Eb=sb(dr);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tb=dr,kb=Symbol.for("react.element"),Cb=Symbol.for("react.fragment"),Ib=Object.prototype.hasOwnProperty,Ab=Tb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Pb={key:!0,ref:!0,__self:!0,__source:!0};function Nx(n,i,a){var f,_={},x=null,T=null;a!==void 0&&(x=""+a),i.key!==void 0&&(x=""+i.key),i.ref!==void 0&&(T=i.ref);for(f in i)Ib.call(i,f)&&!Pb.hasOwnProperty(f)&&(_[f]=i[f]);if(n&&n.defaultProps)for(f in i=n.defaultProps,i)_[f]===void 0&&(_[f]=i[f]);return{$$typeof:kb,type:n,key:x,ref:T,props:_,_owner:Ab.current}}Bd.Fragment=Cb;Bd.jsx=Nx;Bd.jsxs=Nx;(function(n){n.exports=Bd})(ab);const cn=ud.jsx,pa=ud.jsxs;var Ff={},Of={},zb={get exports(){return Of},set exports(n){Of=n}},ri={},Nf={},Mb={get exports(){return Nf},set exports(n){Nf=n}},Ux={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function i(Ze,lt){var ct=Ze.length;Ze.push(lt);e:for(;0<ct;){var Ut=ct-1>>>1,Kt=Ze[Ut];if(0<_(Kt,lt))Ze[Ut]=lt,Ze[ct]=Kt,ct=Ut;else break e}}function a(Ze){return Ze.length===0?null:Ze[0]}function f(Ze){if(Ze.length===0)return null;var lt=Ze[0],ct=Ze.pop();if(ct!==lt){Ze[0]=ct;e:for(var Ut=0,Kt=Ze.length,qr=Kt>>>1;Ut<qr;){var nr=2*(Ut+1)-1,rr=Ze[nr],Un=nr+1,gr=Ze[Un];if(0>_(rr,ct))Un<Kt&&0>_(gr,rr)?(Ze[Ut]=gr,Ze[Un]=ct,Ut=Un):(Ze[Ut]=rr,Ze[nr]=ct,Ut=nr);else if(Un<Kt&&0>_(gr,ct))Ze[Ut]=gr,Ze[Un]=ct,Ut=Un;else break e}}return lt}function _(Ze,lt){var ct=Ze.sortIndex-lt.sortIndex;return ct!==0?ct:Ze.id-lt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var x=performance;n.unstable_now=function(){return x.now()}}else{var T=Date,u=T.now();n.unstable_now=function(){return T.now()-u}}var N=[],Z=[],ue=1,oe=null,G=3,Te=!1,_e=!1,be=!1,bt=typeof setTimeout=="function"?setTimeout:null,se=typeof clearTimeout=="function"?clearTimeout:null,Q=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function le(Ze){for(var lt=a(Z);lt!==null;){if(lt.callback===null)f(Z);else if(lt.startTime<=Ze)f(Z),lt.sortIndex=lt.expirationTime,i(N,lt);else break;lt=a(Z)}}function Pe(Ze){if(be=!1,le(Ze),!_e)if(a(N)!==null)_e=!0,at(Be);else{var lt=a(Z);lt!==null&&mr(Pe,lt.startTime-Ze)}}function Be(Ze,lt){_e=!1,be&&(be=!1,se(et),et=-1),Te=!0;var ct=G;try{for(le(lt),oe=a(N);oe!==null&&(!(oe.expirationTime>lt)||Ze&&!wn());){var Ut=oe.callback;if(typeof Ut=="function"){oe.callback=null,G=oe.priorityLevel;var Kt=Ut(oe.expirationTime<=lt);lt=n.unstable_now(),typeof Kt=="function"?oe.callback=Kt:oe===a(N)&&f(N),le(lt)}else f(N);oe=a(N)}if(oe!==null)var qr=!0;else{var nr=a(Z);nr!==null&&mr(Pe,nr.startTime-lt),qr=!1}return qr}finally{oe=null,G=ct,Te=!1}}var Ke=!1,Qe=null,et=-1,Zt=5,mt=-1;function wn(){return!(n.unstable_now()-mt<Zt)}function Hn(){if(Qe!==null){var Ze=n.unstable_now();mt=Ze;var lt=!0;try{lt=Qe(!0,Ze)}finally{lt?Mr():(Ke=!1,Qe=null)}}else Ke=!1}var Mr;if(typeof Q=="function")Mr=function(){Q(Hn)};else if(typeof MessageChannel<"u"){var Gr=new MessageChannel,oi=Gr.port2;Gr.port1.onmessage=Hn,Mr=function(){oi.postMessage(null)}}else Mr=function(){bt(Hn,0)};function at(Ze){Qe=Ze,Ke||(Ke=!0,Mr())}function mr(Ze,lt){et=bt(function(){Ze(n.unstable_now())},lt)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Ze){Ze.callback=null},n.unstable_continueExecution=function(){_e||Te||(_e=!0,at(Be))},n.unstable_forceFrameRate=function(Ze){0>Ze||125<Ze?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Zt=0<Ze?Math.floor(1e3/Ze):5},n.unstable_getCurrentPriorityLevel=function(){return G},n.unstable_getFirstCallbackNode=function(){return a(N)},n.unstable_next=function(Ze){switch(G){case 1:case 2:case 3:var lt=3;break;default:lt=G}var ct=G;G=lt;try{return Ze()}finally{G=ct}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Ze,lt){switch(Ze){case 1:case 2:case 3:case 4:case 5:break;default:Ze=3}var ct=G;G=Ze;try{return lt()}finally{G=ct}},n.unstable_scheduleCallback=function(Ze,lt,ct){var Ut=n.unstable_now();switch(typeof ct=="object"&&ct!==null?(ct=ct.delay,ct=typeof ct=="number"&&0<ct?Ut+ct:Ut):ct=Ut,Ze){case 1:var Kt=-1;break;case 2:Kt=250;break;case 5:Kt=1073741823;break;case 4:Kt=1e4;break;default:Kt=5e3}return Kt=ct+Kt,Ze={id:ue++,callback:lt,priorityLevel:Ze,startTime:ct,expirationTime:Kt,sortIndex:-1},ct>Ut?(Ze.sortIndex=ct,i(Z,Ze),a(N)===null&&Ze===a(Z)&&(be?(se(et),et=-1):be=!0,mr(Pe,ct-Ut))):(Ze.sortIndex=Kt,i(N,Ze),_e||Te||(_e=!0,at(Be))),Ze},n.unstable_shouldYield=wn,n.unstable_wrapCallback=function(Ze){var lt=G;return function(){var ct=G;G=lt;try{return Ze.apply(this,arguments)}finally{G=ct}}}})(Ux);(function(n){n.exports=Ux})(Mb);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vx=dr,ni=Nf;function ze(n){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+n,a=1;a<arguments.length;a++)i+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+n+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var jx=new Set,Ju={};function ba(n,i){vl(n,i),vl(n+"Capture",i)}function vl(n,i){for(Ju[n]=i,n=0;n<i.length;n++)jx.add(i[n])}var zo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Uf=Object.prototype.hasOwnProperty,Db=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,u_={},c_={};function Lb(n){return Uf.call(c_,n)?!0:Uf.call(u_,n)?!1:Db.test(n)?c_[n]=!0:(u_[n]=!0,!1)}function Rb(n,i,a,f){if(a!==null&&a.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return f?!1:a!==null?!a.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Bb(n,i,a,f){if(i===null||typeof i>"u"||Rb(n,i,a,f))return!0;if(f)return!1;if(a!==null)switch(a.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function zr(n,i,a,f,_,x,T){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=f,this.attributeNamespace=_,this.mustUseProperty=a,this.propertyName=n,this.type=i,this.sanitizeURL=x,this.removeEmptyString=T}var tr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){tr[n]=new zr(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var i=n[0];tr[i]=new zr(i,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){tr[n]=new zr(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){tr[n]=new zr(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){tr[n]=new zr(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){tr[n]=new zr(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){tr[n]=new zr(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){tr[n]=new zr(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){tr[n]=new zr(n,5,!1,n.toLowerCase(),null,!1,!1)});var Vm=/[\-:]([a-z])/g;function jm(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var i=n.replace(Vm,jm);tr[i]=new zr(i,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var i=n.replace(Vm,jm);tr[i]=new zr(i,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var i=n.replace(Vm,jm);tr[i]=new zr(i,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){tr[n]=new zr(n,1,!1,n.toLowerCase(),null,!1,!1)});tr.xlinkHref=new zr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){tr[n]=new zr(n,1,!1,n.toLowerCase(),null,!0,!0)});function $m(n,i,a,f){var _=tr.hasOwnProperty(i)?tr[i]:null;(_!==null?_.type!==0:f||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(Bb(i,a,_,f)&&(a=null),f||_===null?Lb(i)&&(a===null?n.removeAttribute(i):n.setAttribute(i,""+a)):_.mustUseProperty?n[_.propertyName]=a===null?_.type===3?!1:"":a:(i=_.attributeName,f=_.attributeNamespace,a===null?n.removeAttribute(i):(_=_.type,a=_===3||_===4&&a===!0?"":""+a,f?n.setAttributeNS(f,i,a):n.setAttribute(i,a))))}var Ro=Vx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ph=Symbol.for("react.element"),tl=Symbol.for("react.portal"),nl=Symbol.for("react.fragment"),Gm=Symbol.for("react.strict_mode"),Vf=Symbol.for("react.profiler"),$x=Symbol.for("react.provider"),Gx=Symbol.for("react.context"),qm=Symbol.for("react.forward_ref"),jf=Symbol.for("react.suspense"),$f=Symbol.for("react.suspense_list"),Zm=Symbol.for("react.memo"),cs=Symbol.for("react.lazy"),qx=Symbol.for("react.offscreen"),h_=Symbol.iterator;function Au(n){return n===null||typeof n!="object"?null:(n=h_&&n[h_]||n["@@iterator"],typeof n=="function"?n:null)}var mn=Object.assign,uf;function Ou(n){if(uf===void 0)try{throw Error()}catch(a){var i=a.stack.trim().match(/\n( *(at )?)/);uf=i&&i[1]||""}return`
`+uf+n}var cf=!1;function hf(n,i){if(!n||cf)return"";cf=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(Z){var f=Z}Reflect.construct(n,[],i)}else{try{i.call()}catch(Z){f=Z}n.call(i.prototype)}else{try{throw Error()}catch(Z){f=Z}n()}}catch(Z){if(Z&&f&&typeof Z.stack=="string"){for(var _=Z.stack.split(`
`),x=f.stack.split(`
`),T=_.length-1,u=x.length-1;1<=T&&0<=u&&_[T]!==x[u];)u--;for(;1<=T&&0<=u;T--,u--)if(_[T]!==x[u]){if(T!==1||u!==1)do if(T--,u--,0>u||_[T]!==x[u]){var N=`
`+_[T].replace(" at new "," at ");return n.displayName&&N.includes("<anonymous>")&&(N=N.replace("<anonymous>",n.displayName)),N}while(1<=T&&0<=u);break}}}finally{cf=!1,Error.prepareStackTrace=a}return(n=n?n.displayName||n.name:"")?Ou(n):""}function Fb(n){switch(n.tag){case 5:return Ou(n.type);case 16:return Ou("Lazy");case 13:return Ou("Suspense");case 19:return Ou("SuspenseList");case 0:case 2:case 15:return n=hf(n.type,!1),n;case 11:return n=hf(n.type.render,!1),n;case 1:return n=hf(n.type,!0),n;default:return""}}function Gf(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case nl:return"Fragment";case tl:return"Portal";case Vf:return"Profiler";case Gm:return"StrictMode";case jf:return"Suspense";case $f:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Gx:return(n.displayName||"Context")+".Consumer";case $x:return(n._context.displayName||"Context")+".Provider";case qm:var i=n.render;return n=n.displayName,n||(n=i.displayName||i.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Zm:return i=n.displayName||null,i!==null?i:Gf(n.type)||"Memo";case cs:i=n._payload,n=n._init;try{return Gf(n(i))}catch{}}return null}function Ob(n){var i=n.type;switch(n.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=i.render,n=n.displayName||n.name||"",i.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Gf(i);case 8:return i===Gm?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function Es(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Zx(n){var i=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function Nb(n){var i=Zx(n)?"checked":"value",a=Object.getOwnPropertyDescriptor(n.constructor.prototype,i),f=""+n[i];if(!n.hasOwnProperty(i)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var _=a.get,x=a.set;return Object.defineProperty(n,i,{configurable:!0,get:function(){return _.call(this)},set:function(T){f=""+T,x.call(this,T)}}),Object.defineProperty(n,i,{enumerable:a.enumerable}),{getValue:function(){return f},setValue:function(T){f=""+T},stopTracking:function(){n._valueTracker=null,delete n[i]}}}}function zh(n){n._valueTracker||(n._valueTracker=Nb(n))}function Wx(n){if(!n)return!1;var i=n._valueTracker;if(!i)return!0;var a=i.getValue(),f="";return n&&(f=Zx(n)?n.checked?"true":"false":n.value),n=f,n!==a?(i.setValue(n),!0):!1}function cd(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function qf(n,i){var a=i.checked;return mn({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??n._wrapperState.initialChecked})}function d_(n,i){var a=i.defaultValue==null?"":i.defaultValue,f=i.checked!=null?i.checked:i.defaultChecked;a=Es(i.value!=null?i.value:a),n._wrapperState={initialChecked:f,initialValue:a,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function Hx(n,i){i=i.checked,i!=null&&$m(n,"checked",i,!1)}function Zf(n,i){Hx(n,i);var a=Es(i.value),f=i.type;if(a!=null)f==="number"?(a===0&&n.value===""||n.value!=a)&&(n.value=""+a):n.value!==""+a&&(n.value=""+a);else if(f==="submit"||f==="reset"){n.removeAttribute("value");return}i.hasOwnProperty("value")?Wf(n,i.type,a):i.hasOwnProperty("defaultValue")&&Wf(n,i.type,Es(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(n.defaultChecked=!!i.defaultChecked)}function p_(n,i,a){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var f=i.type;if(!(f!=="submit"&&f!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+n._wrapperState.initialValue,a||i===n.value||(n.value=i),n.defaultValue=i}a=n.name,a!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,a!==""&&(n.name=a)}function Wf(n,i,a){(i!=="number"||cd(n.ownerDocument)!==n)&&(a==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+a&&(n.defaultValue=""+a))}var Nu=Array.isArray;function pl(n,i,a,f){if(n=n.options,i){i={};for(var _=0;_<a.length;_++)i["$"+a[_]]=!0;for(a=0;a<n.length;a++)_=i.hasOwnProperty("$"+n[a].value),n[a].selected!==_&&(n[a].selected=_),_&&f&&(n[a].defaultSelected=!0)}else{for(a=""+Es(a),i=null,_=0;_<n.length;_++){if(n[_].value===a){n[_].selected=!0,f&&(n[_].defaultSelected=!0);return}i!==null||n[_].disabled||(i=n[_])}i!==null&&(i.selected=!0)}}function Hf(n,i){if(i.dangerouslySetInnerHTML!=null)throw Error(ze(91));return mn({},i,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function f_(n,i){var a=i.value;if(a==null){if(a=i.children,i=i.defaultValue,a!=null){if(i!=null)throw Error(ze(92));if(Nu(a)){if(1<a.length)throw Error(ze(93));a=a[0]}i=a}i==null&&(i=""),a=i}n._wrapperState={initialValue:Es(a)}}function Xx(n,i){var a=Es(i.value),f=Es(i.defaultValue);a!=null&&(a=""+a,a!==n.value&&(n.value=a),i.defaultValue==null&&n.defaultValue!==a&&(n.defaultValue=a)),f!=null&&(n.defaultValue=""+f)}function m_(n){var i=n.textContent;i===n._wrapperState.initialValue&&i!==""&&i!==null&&(n.value=i)}function Kx(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Xf(n,i){return n==null||n==="http://www.w3.org/1999/xhtml"?Kx(i):n==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Mh,Jx=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,a,f,_){MSApp.execUnsafeLocalFunction(function(){return n(i,a,f,_)})}:n}(function(n,i){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=i;else{for(Mh=Mh||document.createElement("div"),Mh.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=Mh.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;i.firstChild;)n.appendChild(i.firstChild)}});function Yu(n,i){if(i){var a=n.firstChild;if(a&&a===n.lastChild&&a.nodeType===3){a.nodeValue=i;return}}n.textContent=i}var ju={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ub=["Webkit","ms","Moz","O"];Object.keys(ju).forEach(function(n){Ub.forEach(function(i){i=i+n.charAt(0).toUpperCase()+n.substring(1),ju[i]=ju[n]})});function Yx(n,i,a){return i==null||typeof i=="boolean"||i===""?"":a||typeof i!="number"||i===0||ju.hasOwnProperty(n)&&ju[n]?(""+i).trim():i+"px"}function Qx(n,i){n=n.style;for(var a in i)if(i.hasOwnProperty(a)){var f=a.indexOf("--")===0,_=Yx(a,i[a],f);a==="float"&&(a="cssFloat"),f?n.setProperty(a,_):n[a]=_}}var Vb=mn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Kf(n,i){if(i){if(Vb[n]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(ze(137,n));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(ze(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(ze(61))}if(i.style!=null&&typeof i.style!="object")throw Error(ze(62))}}function Jf(n,i){if(n.indexOf("-")===-1)return typeof i.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Yf=null;function Wm(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Qf=null,fl=null,ml=null;function g_(n){if(n=_c(n)){if(typeof Qf!="function")throw Error(ze(280));var i=n.stateNode;i&&(i=Vd(i),Qf(n.stateNode,n.type,i))}}function e0(n){fl?ml?ml.push(n):ml=[n]:fl=n}function t0(){if(fl){var n=fl,i=ml;if(ml=fl=null,g_(n),i)for(n=0;n<i.length;n++)g_(i[n])}}function n0(n,i){return n(i)}function r0(){}var df=!1;function i0(n,i,a){if(df)return n(i,a);df=!0;try{return n0(n,i,a)}finally{df=!1,(fl!==null||ml!==null)&&(r0(),t0())}}function Qu(n,i){var a=n.stateNode;if(a===null)return null;var f=Vd(a);if(f===null)return null;a=f[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(n=n.type,f=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!f;break e;default:n=!1}if(n)return null;if(a&&typeof a!="function")throw Error(ze(231,i,typeof a));return a}var em=!1;if(zo)try{var Pu={};Object.defineProperty(Pu,"passive",{get:function(){em=!0}}),window.addEventListener("test",Pu,Pu),window.removeEventListener("test",Pu,Pu)}catch{em=!1}function jb(n,i,a,f,_,x,T,u,N){var Z=Array.prototype.slice.call(arguments,3);try{i.apply(a,Z)}catch(ue){this.onError(ue)}}var $u=!1,hd=null,dd=!1,tm=null,$b={onError:function(n){$u=!0,hd=n}};function Gb(n,i,a,f,_,x,T,u,N){$u=!1,hd=null,jb.apply($b,arguments)}function qb(n,i,a,f,_,x,T,u,N){if(Gb.apply(this,arguments),$u){if($u){var Z=hd;$u=!1,hd=null}else throw Error(ze(198));dd||(dd=!0,tm=Z)}}function Sa(n){var i=n,a=n;if(n.alternate)for(;i.return;)i=i.return;else{n=i;do i=n,i.flags&4098&&(a=i.return),n=i.return;while(n)}return i.tag===3?a:null}function o0(n){if(n.tag===13){var i=n.memoizedState;if(i===null&&(n=n.alternate,n!==null&&(i=n.memoizedState)),i!==null)return i.dehydrated}return null}function y_(n){if(Sa(n)!==n)throw Error(ze(188))}function Zb(n){var i=n.alternate;if(!i){if(i=Sa(n),i===null)throw Error(ze(188));return i!==n?null:n}for(var a=n,f=i;;){var _=a.return;if(_===null)break;var x=_.alternate;if(x===null){if(f=_.return,f!==null){a=f;continue}break}if(_.child===x.child){for(x=_.child;x;){if(x===a)return y_(_),n;if(x===f)return y_(_),i;x=x.sibling}throw Error(ze(188))}if(a.return!==f.return)a=_,f=x;else{for(var T=!1,u=_.child;u;){if(u===a){T=!0,a=_,f=x;break}if(u===f){T=!0,f=_,a=x;break}u=u.sibling}if(!T){for(u=x.child;u;){if(u===a){T=!0,a=x,f=_;break}if(u===f){T=!0,f=x,a=_;break}u=u.sibling}if(!T)throw Error(ze(189))}}if(a.alternate!==f)throw Error(ze(190))}if(a.tag!==3)throw Error(ze(188));return a.stateNode.current===a?n:i}function s0(n){return n=Zb(n),n!==null?a0(n):null}function a0(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var i=a0(n);if(i!==null)return i;n=n.sibling}return null}var l0=ni.unstable_scheduleCallback,__=ni.unstable_cancelCallback,Wb=ni.unstable_shouldYield,Hb=ni.unstable_requestPaint,Tn=ni.unstable_now,Xb=ni.unstable_getCurrentPriorityLevel,Hm=ni.unstable_ImmediatePriority,u0=ni.unstable_UserBlockingPriority,pd=ni.unstable_NormalPriority,Kb=ni.unstable_LowPriority,c0=ni.unstable_IdlePriority,Fd=null,io=null;function Jb(n){if(io&&typeof io.onCommitFiberRoot=="function")try{io.onCommitFiberRoot(Fd,n,void 0,(n.current.flags&128)===128)}catch{}}var Bi=Math.clz32?Math.clz32:e2,Yb=Math.log,Qb=Math.LN2;function e2(n){return n>>>=0,n===0?32:31-(Yb(n)/Qb|0)|0}var Dh=64,Lh=4194304;function Uu(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function fd(n,i){var a=n.pendingLanes;if(a===0)return 0;var f=0,_=n.suspendedLanes,x=n.pingedLanes,T=a&268435455;if(T!==0){var u=T&~_;u!==0?f=Uu(u):(x&=T,x!==0&&(f=Uu(x)))}else T=a&~_,T!==0?f=Uu(T):x!==0&&(f=Uu(x));if(f===0)return 0;if(i!==0&&i!==f&&!(i&_)&&(_=f&-f,x=i&-i,_>=x||_===16&&(x&4194240)!==0))return i;if(f&4&&(f|=a&16),i=n.entangledLanes,i!==0)for(n=n.entanglements,i&=f;0<i;)a=31-Bi(i),_=1<<a,f|=n[a],i&=~_;return f}function t2(n,i){switch(n){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function n2(n,i){for(var a=n.suspendedLanes,f=n.pingedLanes,_=n.expirationTimes,x=n.pendingLanes;0<x;){var T=31-Bi(x),u=1<<T,N=_[T];N===-1?(!(u&a)||u&f)&&(_[T]=t2(u,i)):N<=i&&(n.expiredLanes|=u),x&=~u}}function nm(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function h0(){var n=Dh;return Dh<<=1,!(Dh&4194240)&&(Dh=64),n}function pf(n){for(var i=[],a=0;31>a;a++)i.push(n);return i}function gc(n,i,a){n.pendingLanes|=i,i!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,i=31-Bi(i),n[i]=a}function r2(n,i){var a=n.pendingLanes&~i;n.pendingLanes=i,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=i,n.mutableReadLanes&=i,n.entangledLanes&=i,i=n.entanglements;var f=n.eventTimes;for(n=n.expirationTimes;0<a;){var _=31-Bi(a),x=1<<_;i[_]=0,f[_]=-1,n[_]=-1,a&=~x}}function Xm(n,i){var a=n.entangledLanes|=i;for(n=n.entanglements;a;){var f=31-Bi(a),_=1<<f;_&i|n[f]&i&&(n[f]|=i),a&=~_}}var qt=0;function d0(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var p0,Km,f0,m0,g0,rm=!1,Rh=[],gs=null,ys=null,_s=null,ec=new Map,tc=new Map,ds=[],i2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function x_(n,i){switch(n){case"focusin":case"focusout":gs=null;break;case"dragenter":case"dragleave":ys=null;break;case"mouseover":case"mouseout":_s=null;break;case"pointerover":case"pointerout":ec.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":tc.delete(i.pointerId)}}function zu(n,i,a,f,_,x){return n===null||n.nativeEvent!==x?(n={blockedOn:i,domEventName:a,eventSystemFlags:f,nativeEvent:x,targetContainers:[_]},i!==null&&(i=_c(i),i!==null&&Km(i)),n):(n.eventSystemFlags|=f,i=n.targetContainers,_!==null&&i.indexOf(_)===-1&&i.push(_),n)}function o2(n,i,a,f,_){switch(i){case"focusin":return gs=zu(gs,n,i,a,f,_),!0;case"dragenter":return ys=zu(ys,n,i,a,f,_),!0;case"mouseover":return _s=zu(_s,n,i,a,f,_),!0;case"pointerover":var x=_.pointerId;return ec.set(x,zu(ec.get(x)||null,n,i,a,f,_)),!0;case"gotpointercapture":return x=_.pointerId,tc.set(x,zu(tc.get(x)||null,n,i,a,f,_)),!0}return!1}function y0(n){var i=ca(n.target);if(i!==null){var a=Sa(i);if(a!==null){if(i=a.tag,i===13){if(i=o0(a),i!==null){n.blockedOn=i,g0(n.priority,function(){f0(a)});return}}else if(i===3&&a.stateNode.current.memoizedState.isDehydrated){n.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Hh(n){if(n.blockedOn!==null)return!1;for(var i=n.targetContainers;0<i.length;){var a=im(n.domEventName,n.eventSystemFlags,i[0],n.nativeEvent);if(a===null){a=n.nativeEvent;var f=new a.constructor(a.type,a);Yf=f,a.target.dispatchEvent(f),Yf=null}else return i=_c(a),i!==null&&Km(i),n.blockedOn=a,!1;i.shift()}return!0}function v_(n,i,a){Hh(n)&&a.delete(i)}function s2(){rm=!1,gs!==null&&Hh(gs)&&(gs=null),ys!==null&&Hh(ys)&&(ys=null),_s!==null&&Hh(_s)&&(_s=null),ec.forEach(v_),tc.forEach(v_)}function Mu(n,i){n.blockedOn===i&&(n.blockedOn=null,rm||(rm=!0,ni.unstable_scheduleCallback(ni.unstable_NormalPriority,s2)))}function nc(n){function i(_){return Mu(_,n)}if(0<Rh.length){Mu(Rh[0],n);for(var a=1;a<Rh.length;a++){var f=Rh[a];f.blockedOn===n&&(f.blockedOn=null)}}for(gs!==null&&Mu(gs,n),ys!==null&&Mu(ys,n),_s!==null&&Mu(_s,n),ec.forEach(i),tc.forEach(i),a=0;a<ds.length;a++)f=ds[a],f.blockedOn===n&&(f.blockedOn=null);for(;0<ds.length&&(a=ds[0],a.blockedOn===null);)y0(a),a.blockedOn===null&&ds.shift()}var gl=Ro.ReactCurrentBatchConfig,md=!0;function a2(n,i,a,f){var _=qt,x=gl.transition;gl.transition=null;try{qt=1,Jm(n,i,a,f)}finally{qt=_,gl.transition=x}}function l2(n,i,a,f){var _=qt,x=gl.transition;gl.transition=null;try{qt=4,Jm(n,i,a,f)}finally{qt=_,gl.transition=x}}function Jm(n,i,a,f){if(md){var _=im(n,i,a,f);if(_===null)Sf(n,i,f,gd,a),x_(n,f);else if(o2(_,n,i,a,f))f.stopPropagation();else if(x_(n,f),i&4&&-1<i2.indexOf(n)){for(;_!==null;){var x=_c(_);if(x!==null&&p0(x),x=im(n,i,a,f),x===null&&Sf(n,i,f,gd,a),x===_)break;_=x}_!==null&&f.stopPropagation()}else Sf(n,i,f,null,a)}}var gd=null;function im(n,i,a,f){if(gd=null,n=Wm(f),n=ca(n),n!==null)if(i=Sa(n),i===null)n=null;else if(a=i.tag,a===13){if(n=o0(i),n!==null)return n;n=null}else if(a===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;n=null}else i!==n&&(n=null);return gd=n,null}function _0(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xb()){case Hm:return 1;case u0:return 4;case pd:case Kb:return 16;case c0:return 536870912;default:return 16}default:return 16}}var fs=null,Ym=null,Xh=null;function x0(){if(Xh)return Xh;var n,i=Ym,a=i.length,f,_="value"in fs?fs.value:fs.textContent,x=_.length;for(n=0;n<a&&i[n]===_[n];n++);var T=a-n;for(f=1;f<=T&&i[a-f]===_[x-f];f++);return Xh=_.slice(n,1<f?1-f:void 0)}function Kh(n){var i=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&i===13&&(n=13)):n=i,n===10&&(n=13),32<=n||n===13?n:0}function Bh(){return!0}function w_(){return!1}function ii(n){function i(a,f,_,x,T){this._reactName=a,this._targetInst=_,this.type=f,this.nativeEvent=x,this.target=T,this.currentTarget=null;for(var u in n)n.hasOwnProperty(u)&&(a=n[u],this[u]=a?a(x):x[u]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?Bh:w_,this.isPropagationStopped=w_,this}return mn(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=Bh)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=Bh)},persist:function(){},isPersistent:Bh}),i}var Al={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qm=ii(Al),yc=mn({},Al,{view:0,detail:0}),u2=ii(yc),ff,mf,Du,Od=mn({},yc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:eg,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Du&&(Du&&n.type==="mousemove"?(ff=n.screenX-Du.screenX,mf=n.screenY-Du.screenY):mf=ff=0,Du=n),ff)},movementY:function(n){return"movementY"in n?n.movementY:mf}}),b_=ii(Od),c2=mn({},Od,{dataTransfer:0}),h2=ii(c2),d2=mn({},yc,{relatedTarget:0}),gf=ii(d2),p2=mn({},Al,{animationName:0,elapsedTime:0,pseudoElement:0}),f2=ii(p2),m2=mn({},Al,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),g2=ii(m2),y2=mn({},Al,{data:0}),S_=ii(y2),_2={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},x2={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},v2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function w2(n){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(n):(n=v2[n])?!!i[n]:!1}function eg(){return w2}var b2=mn({},yc,{key:function(n){if(n.key){var i=_2[n.key]||n.key;if(i!=="Unidentified")return i}return n.type==="keypress"?(n=Kh(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?x2[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:eg,charCode:function(n){return n.type==="keypress"?Kh(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Kh(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),S2=ii(b2),E2=mn({},Od,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),E_=ii(E2),T2=mn({},yc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:eg}),k2=ii(T2),C2=mn({},Al,{propertyName:0,elapsedTime:0,pseudoElement:0}),I2=ii(C2),A2=mn({},Od,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),P2=ii(A2),z2=[9,13,27,32],tg=zo&&"CompositionEvent"in window,Gu=null;zo&&"documentMode"in document&&(Gu=document.documentMode);var M2=zo&&"TextEvent"in window&&!Gu,v0=zo&&(!tg||Gu&&8<Gu&&11>=Gu),T_=String.fromCharCode(32),k_=!1;function w0(n,i){switch(n){case"keyup":return z2.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function b0(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var rl=!1;function D2(n,i){switch(n){case"compositionend":return b0(i);case"keypress":return i.which!==32?null:(k_=!0,T_);case"textInput":return n=i.data,n===T_&&k_?null:n;default:return null}}function L2(n,i){if(rl)return n==="compositionend"||!tg&&w0(n,i)?(n=x0(),Xh=Ym=fs=null,rl=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return v0&&i.locale!=="ko"?null:i.data;default:return null}}var R2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function C_(n){var i=n&&n.nodeName&&n.nodeName.toLowerCase();return i==="input"?!!R2[n.type]:i==="textarea"}function S0(n,i,a,f){e0(f),i=yd(i,"onChange"),0<i.length&&(a=new Qm("onChange","change",null,a,f),n.push({event:a,listeners:i}))}var qu=null,rc=null;function B2(n){L0(n,0)}function Nd(n){var i=sl(n);if(Wx(i))return n}function F2(n,i){if(n==="change")return i}var E0=!1;if(zo){var yf;if(zo){var _f="oninput"in document;if(!_f){var I_=document.createElement("div");I_.setAttribute("oninput","return;"),_f=typeof I_.oninput=="function"}yf=_f}else yf=!1;E0=yf&&(!document.documentMode||9<document.documentMode)}function A_(){qu&&(qu.detachEvent("onpropertychange",T0),rc=qu=null)}function T0(n){if(n.propertyName==="value"&&Nd(rc)){var i=[];S0(i,rc,n,Wm(n)),i0(B2,i)}}function O2(n,i,a){n==="focusin"?(A_(),qu=i,rc=a,qu.attachEvent("onpropertychange",T0)):n==="focusout"&&A_()}function N2(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Nd(rc)}function U2(n,i){if(n==="click")return Nd(i)}function V2(n,i){if(n==="input"||n==="change")return Nd(i)}function j2(n,i){return n===i&&(n!==0||1/n===1/i)||n!==n&&i!==i}var Oi=typeof Object.is=="function"?Object.is:j2;function ic(n,i){if(Oi(n,i))return!0;if(typeof n!="object"||n===null||typeof i!="object"||i===null)return!1;var a=Object.keys(n),f=Object.keys(i);if(a.length!==f.length)return!1;for(f=0;f<a.length;f++){var _=a[f];if(!Uf.call(i,_)||!Oi(n[_],i[_]))return!1}return!0}function P_(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function z_(n,i){var a=P_(n);n=0;for(var f;a;){if(a.nodeType===3){if(f=n+a.textContent.length,n<=i&&f>=i)return{node:a,offset:i-n};n=f}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=P_(a)}}function k0(n,i){return n&&i?n===i?!0:n&&n.nodeType===3?!1:i&&i.nodeType===3?k0(n,i.parentNode):"contains"in n?n.contains(i):n.compareDocumentPosition?!!(n.compareDocumentPosition(i)&16):!1:!1}function C0(){for(var n=window,i=cd();i instanceof n.HTMLIFrameElement;){try{var a=typeof i.contentWindow.location.href=="string"}catch{a=!1}if(a)n=i.contentWindow;else break;i=cd(n.document)}return i}function ng(n){var i=n&&n.nodeName&&n.nodeName.toLowerCase();return i&&(i==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||i==="textarea"||n.contentEditable==="true")}function $2(n){var i=C0(),a=n.focusedElem,f=n.selectionRange;if(i!==a&&a&&a.ownerDocument&&k0(a.ownerDocument.documentElement,a)){if(f!==null&&ng(a)){if(i=f.start,n=f.end,n===void 0&&(n=i),"selectionStart"in a)a.selectionStart=i,a.selectionEnd=Math.min(n,a.value.length);else if(n=(i=a.ownerDocument||document)&&i.defaultView||window,n.getSelection){n=n.getSelection();var _=a.textContent.length,x=Math.min(f.start,_);f=f.end===void 0?x:Math.min(f.end,_),!n.extend&&x>f&&(_=f,f=x,x=_),_=z_(a,x);var T=z_(a,f);_&&T&&(n.rangeCount!==1||n.anchorNode!==_.node||n.anchorOffset!==_.offset||n.focusNode!==T.node||n.focusOffset!==T.offset)&&(i=i.createRange(),i.setStart(_.node,_.offset),n.removeAllRanges(),x>f?(n.addRange(i),n.extend(T.node,T.offset)):(i.setEnd(T.node,T.offset),n.addRange(i)))}}for(i=[],n=a;n=n.parentNode;)n.nodeType===1&&i.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<i.length;a++)n=i[a],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var G2=zo&&"documentMode"in document&&11>=document.documentMode,il=null,om=null,Zu=null,sm=!1;function M_(n,i,a){var f=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;sm||il==null||il!==cd(f)||(f=il,"selectionStart"in f&&ng(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Zu&&ic(Zu,f)||(Zu=f,f=yd(om,"onSelect"),0<f.length&&(i=new Qm("onSelect","select",null,i,a),n.push({event:i,listeners:f}),i.target=il)))}function Fh(n,i){var a={};return a[n.toLowerCase()]=i.toLowerCase(),a["Webkit"+n]="webkit"+i,a["Moz"+n]="moz"+i,a}var ol={animationend:Fh("Animation","AnimationEnd"),animationiteration:Fh("Animation","AnimationIteration"),animationstart:Fh("Animation","AnimationStart"),transitionend:Fh("Transition","TransitionEnd")},xf={},I0={};zo&&(I0=document.createElement("div").style,"AnimationEvent"in window||(delete ol.animationend.animation,delete ol.animationiteration.animation,delete ol.animationstart.animation),"TransitionEvent"in window||delete ol.transitionend.transition);function Ud(n){if(xf[n])return xf[n];if(!ol[n])return n;var i=ol[n],a;for(a in i)if(i.hasOwnProperty(a)&&a in I0)return xf[n]=i[a];return n}var A0=Ud("animationend"),P0=Ud("animationiteration"),z0=Ud("animationstart"),M0=Ud("transitionend"),D0=new Map,D_="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ks(n,i){D0.set(n,i),ba(i,[n])}for(var vf=0;vf<D_.length;vf++){var wf=D_[vf],q2=wf.toLowerCase(),Z2=wf[0].toUpperCase()+wf.slice(1);ks(q2,"on"+Z2)}ks(A0,"onAnimationEnd");ks(P0,"onAnimationIteration");ks(z0,"onAnimationStart");ks("dblclick","onDoubleClick");ks("focusin","onFocus");ks("focusout","onBlur");ks(M0,"onTransitionEnd");vl("onMouseEnter",["mouseout","mouseover"]);vl("onMouseLeave",["mouseout","mouseover"]);vl("onPointerEnter",["pointerout","pointerover"]);vl("onPointerLeave",["pointerout","pointerover"]);ba("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ba("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ba("onBeforeInput",["compositionend","keypress","textInput","paste"]);ba("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ba("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ba("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Vu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),W2=new Set("cancel close invalid load scroll toggle".split(" ").concat(Vu));function L_(n,i,a){var f=n.type||"unknown-event";n.currentTarget=a,qb(f,i,void 0,n),n.currentTarget=null}function L0(n,i){i=(i&4)!==0;for(var a=0;a<n.length;a++){var f=n[a],_=f.event;f=f.listeners;e:{var x=void 0;if(i)for(var T=f.length-1;0<=T;T--){var u=f[T],N=u.instance,Z=u.currentTarget;if(u=u.listener,N!==x&&_.isPropagationStopped())break e;L_(_,u,Z),x=N}else for(T=0;T<f.length;T++){if(u=f[T],N=u.instance,Z=u.currentTarget,u=u.listener,N!==x&&_.isPropagationStopped())break e;L_(_,u,Z),x=N}}}if(dd)throw n=tm,dd=!1,tm=null,n}function sn(n,i){var a=i[hm];a===void 0&&(a=i[hm]=new Set);var f=n+"__bubble";a.has(f)||(R0(i,n,2,!1),a.add(f))}function bf(n,i,a){var f=0;i&&(f|=4),R0(a,n,f,i)}var Oh="_reactListening"+Math.random().toString(36).slice(2);function oc(n){if(!n[Oh]){n[Oh]=!0,jx.forEach(function(a){a!=="selectionchange"&&(W2.has(a)||bf(a,!1,n),bf(a,!0,n))});var i=n.nodeType===9?n:n.ownerDocument;i===null||i[Oh]||(i[Oh]=!0,bf("selectionchange",!1,i))}}function R0(n,i,a,f){switch(_0(i)){case 1:var _=a2;break;case 4:_=l2;break;default:_=Jm}a=_.bind(null,i,a,n),_=void 0,!em||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(_=!0),f?_!==void 0?n.addEventListener(i,a,{capture:!0,passive:_}):n.addEventListener(i,a,!0):_!==void 0?n.addEventListener(i,a,{passive:_}):n.addEventListener(i,a,!1)}function Sf(n,i,a,f,_){var x=f;if(!(i&1)&&!(i&2)&&f!==null)e:for(;;){if(f===null)return;var T=f.tag;if(T===3||T===4){var u=f.stateNode.containerInfo;if(u===_||u.nodeType===8&&u.parentNode===_)break;if(T===4)for(T=f.return;T!==null;){var N=T.tag;if((N===3||N===4)&&(N=T.stateNode.containerInfo,N===_||N.nodeType===8&&N.parentNode===_))return;T=T.return}for(;u!==null;){if(T=ca(u),T===null)return;if(N=T.tag,N===5||N===6){f=x=T;continue e}u=u.parentNode}}f=f.return}i0(function(){var Z=x,ue=Wm(a),oe=[];e:{var G=D0.get(n);if(G!==void 0){var Te=Qm,_e=n;switch(n){case"keypress":if(Kh(a)===0)break e;case"keydown":case"keyup":Te=S2;break;case"focusin":_e="focus",Te=gf;break;case"focusout":_e="blur",Te=gf;break;case"beforeblur":case"afterblur":Te=gf;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Te=b_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Te=h2;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Te=k2;break;case A0:case P0:case z0:Te=f2;break;case M0:Te=I2;break;case"scroll":Te=u2;break;case"wheel":Te=P2;break;case"copy":case"cut":case"paste":Te=g2;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Te=E_}var be=(i&4)!==0,bt=!be&&n==="scroll",se=be?G!==null?G+"Capture":null:G;be=[];for(var Q=Z,le;Q!==null;){le=Q;var Pe=le.stateNode;if(le.tag===5&&Pe!==null&&(le=Pe,se!==null&&(Pe=Qu(Q,se),Pe!=null&&be.push(sc(Q,Pe,le)))),bt)break;Q=Q.return}0<be.length&&(G=new Te(G,_e,null,a,ue),oe.push({event:G,listeners:be}))}}if(!(i&7)){e:{if(G=n==="mouseover"||n==="pointerover",Te=n==="mouseout"||n==="pointerout",G&&a!==Yf&&(_e=a.relatedTarget||a.fromElement)&&(ca(_e)||_e[Mo]))break e;if((Te||G)&&(G=ue.window===ue?ue:(G=ue.ownerDocument)?G.defaultView||G.parentWindow:window,Te?(_e=a.relatedTarget||a.toElement,Te=Z,_e=_e?ca(_e):null,_e!==null&&(bt=Sa(_e),_e!==bt||_e.tag!==5&&_e.tag!==6)&&(_e=null)):(Te=null,_e=Z),Te!==_e)){if(be=b_,Pe="onMouseLeave",se="onMouseEnter",Q="mouse",(n==="pointerout"||n==="pointerover")&&(be=E_,Pe="onPointerLeave",se="onPointerEnter",Q="pointer"),bt=Te==null?G:sl(Te),le=_e==null?G:sl(_e),G=new be(Pe,Q+"leave",Te,a,ue),G.target=bt,G.relatedTarget=le,Pe=null,ca(ue)===Z&&(be=new be(se,Q+"enter",_e,a,ue),be.target=le,be.relatedTarget=bt,Pe=be),bt=Pe,Te&&_e)t:{for(be=Te,se=_e,Q=0,le=be;le;le=el(le))Q++;for(le=0,Pe=se;Pe;Pe=el(Pe))le++;for(;0<Q-le;)be=el(be),Q--;for(;0<le-Q;)se=el(se),le--;for(;Q--;){if(be===se||se!==null&&be===se.alternate)break t;be=el(be),se=el(se)}be=null}else be=null;Te!==null&&R_(oe,G,Te,be,!1),_e!==null&&bt!==null&&R_(oe,bt,_e,be,!0)}}e:{if(G=Z?sl(Z):window,Te=G.nodeName&&G.nodeName.toLowerCase(),Te==="select"||Te==="input"&&G.type==="file")var Be=F2;else if(C_(G))if(E0)Be=V2;else{Be=N2;var Ke=O2}else(Te=G.nodeName)&&Te.toLowerCase()==="input"&&(G.type==="checkbox"||G.type==="radio")&&(Be=U2);if(Be&&(Be=Be(n,Z))){S0(oe,Be,a,ue);break e}Ke&&Ke(n,G,Z),n==="focusout"&&(Ke=G._wrapperState)&&Ke.controlled&&G.type==="number"&&Wf(G,"number",G.value)}switch(Ke=Z?sl(Z):window,n){case"focusin":(C_(Ke)||Ke.contentEditable==="true")&&(il=Ke,om=Z,Zu=null);break;case"focusout":Zu=om=il=null;break;case"mousedown":sm=!0;break;case"contextmenu":case"mouseup":case"dragend":sm=!1,M_(oe,a,ue);break;case"selectionchange":if(G2)break;case"keydown":case"keyup":M_(oe,a,ue)}var Qe;if(tg)e:{switch(n){case"compositionstart":var et="onCompositionStart";break e;case"compositionend":et="onCompositionEnd";break e;case"compositionupdate":et="onCompositionUpdate";break e}et=void 0}else rl?w0(n,a)&&(et="onCompositionEnd"):n==="keydown"&&a.keyCode===229&&(et="onCompositionStart");et&&(v0&&a.locale!=="ko"&&(rl||et!=="onCompositionStart"?et==="onCompositionEnd"&&rl&&(Qe=x0()):(fs=ue,Ym="value"in fs?fs.value:fs.textContent,rl=!0)),Ke=yd(Z,et),0<Ke.length&&(et=new S_(et,n,null,a,ue),oe.push({event:et,listeners:Ke}),Qe?et.data=Qe:(Qe=b0(a),Qe!==null&&(et.data=Qe)))),(Qe=M2?D2(n,a):L2(n,a))&&(Z=yd(Z,"onBeforeInput"),0<Z.length&&(ue=new S_("onBeforeInput","beforeinput",null,a,ue),oe.push({event:ue,listeners:Z}),ue.data=Qe))}L0(oe,i)})}function sc(n,i,a){return{instance:n,listener:i,currentTarget:a}}function yd(n,i){for(var a=i+"Capture",f=[];n!==null;){var _=n,x=_.stateNode;_.tag===5&&x!==null&&(_=x,x=Qu(n,a),x!=null&&f.unshift(sc(n,x,_)),x=Qu(n,i),x!=null&&f.push(sc(n,x,_))),n=n.return}return f}function el(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function R_(n,i,a,f,_){for(var x=i._reactName,T=[];a!==null&&a!==f;){var u=a,N=u.alternate,Z=u.stateNode;if(N!==null&&N===f)break;u.tag===5&&Z!==null&&(u=Z,_?(N=Qu(a,x),N!=null&&T.unshift(sc(a,N,u))):_||(N=Qu(a,x),N!=null&&T.push(sc(a,N,u)))),a=a.return}T.length!==0&&n.push({event:i,listeners:T})}var H2=/\r\n?/g,X2=/\u0000|\uFFFD/g;function B_(n){return(typeof n=="string"?n:""+n).replace(H2,`
`).replace(X2,"")}function Nh(n,i,a){if(i=B_(i),B_(n)!==i&&a)throw Error(ze(425))}function _d(){}var am=null,lm=null;function um(n,i){return n==="textarea"||n==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var cm=typeof setTimeout=="function"?setTimeout:void 0,K2=typeof clearTimeout=="function"?clearTimeout:void 0,F_=typeof Promise=="function"?Promise:void 0,J2=typeof queueMicrotask=="function"?queueMicrotask:typeof F_<"u"?function(n){return F_.resolve(null).then(n).catch(Y2)}:cm;function Y2(n){setTimeout(function(){throw n})}function Ef(n,i){var a=i,f=0;do{var _=a.nextSibling;if(n.removeChild(a),_&&_.nodeType===8)if(a=_.data,a==="/$"){if(f===0){n.removeChild(_),nc(i);return}f--}else a!=="$"&&a!=="$?"&&a!=="$!"||f++;a=_}while(a);nc(i)}function xs(n){for(;n!=null;n=n.nextSibling){var i=n.nodeType;if(i===1||i===3)break;if(i===8){if(i=n.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return n}function O_(n){n=n.previousSibling;for(var i=0;n;){if(n.nodeType===8){var a=n.data;if(a==="$"||a==="$!"||a==="$?"){if(i===0)return n;i--}else a==="/$"&&i++}n=n.previousSibling}return null}var Pl=Math.random().toString(36).slice(2),no="__reactFiber$"+Pl,ac="__reactProps$"+Pl,Mo="__reactContainer$"+Pl,hm="__reactEvents$"+Pl,Q2="__reactListeners$"+Pl,eS="__reactHandles$"+Pl;function ca(n){var i=n[no];if(i)return i;for(var a=n.parentNode;a;){if(i=a[Mo]||a[no]){if(a=i.alternate,i.child!==null||a!==null&&a.child!==null)for(n=O_(n);n!==null;){if(a=n[no])return a;n=O_(n)}return i}n=a,a=n.parentNode}return null}function _c(n){return n=n[no]||n[Mo],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function sl(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(ze(33))}function Vd(n){return n[ac]||null}var dm=[],al=-1;function Cs(n){return{current:n}}function an(n){0>al||(n.current=dm[al],dm[al]=null,al--)}function on(n,i){al++,dm[al]=n.current,n.current=i}var Ts={},fr=Cs(Ts),Vr=Cs(!1),ga=Ts;function wl(n,i){var a=n.type.contextTypes;if(!a)return Ts;var f=n.stateNode;if(f&&f.__reactInternalMemoizedUnmaskedChildContext===i)return f.__reactInternalMemoizedMaskedChildContext;var _={},x;for(x in a)_[x]=i[x];return f&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=_),_}function jr(n){return n=n.childContextTypes,n!=null}function xd(){an(Vr),an(fr)}function N_(n,i,a){if(fr.current!==Ts)throw Error(ze(168));on(fr,i),on(Vr,a)}function B0(n,i,a){var f=n.stateNode;if(i=i.childContextTypes,typeof f.getChildContext!="function")return a;f=f.getChildContext();for(var _ in f)if(!(_ in i))throw Error(ze(108,Ob(n)||"Unknown",_));return mn({},a,f)}function vd(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Ts,ga=fr.current,on(fr,n),on(Vr,Vr.current),!0}function U_(n,i,a){var f=n.stateNode;if(!f)throw Error(ze(169));a?(n=B0(n,i,ga),f.__reactInternalMemoizedMergedChildContext=n,an(Vr),an(fr),on(fr,n)):an(Vr),on(Vr,a)}var ko=null,jd=!1,Tf=!1;function F0(n){ko===null?ko=[n]:ko.push(n)}function tS(n){jd=!0,F0(n)}function Is(){if(!Tf&&ko!==null){Tf=!0;var n=0,i=qt;try{var a=ko;for(qt=1;n<a.length;n++){var f=a[n];do f=f(!0);while(f!==null)}ko=null,jd=!1}catch(_){throw ko!==null&&(ko=ko.slice(n+1)),l0(Hm,Is),_}finally{qt=i,Tf=!1}}return null}var ll=[],ul=0,wd=null,bd=0,fi=[],mi=0,ya=null,Co=1,Io="";function la(n,i){ll[ul++]=bd,ll[ul++]=wd,wd=n,bd=i}function O0(n,i,a){fi[mi++]=Co,fi[mi++]=Io,fi[mi++]=ya,ya=n;var f=Co;n=Io;var _=32-Bi(f)-1;f&=~(1<<_),a+=1;var x=32-Bi(i)+_;if(30<x){var T=_-_%5;x=(f&(1<<T)-1).toString(32),f>>=T,_-=T,Co=1<<32-Bi(i)+_|a<<_|f,Io=x+n}else Co=1<<x|a<<_|f,Io=n}function rg(n){n.return!==null&&(la(n,1),O0(n,1,0))}function ig(n){for(;n===wd;)wd=ll[--ul],ll[ul]=null,bd=ll[--ul],ll[ul]=null;for(;n===ya;)ya=fi[--mi],fi[mi]=null,Io=fi[--mi],fi[mi]=null,Co=fi[--mi],fi[mi]=null}var ti=null,ei=null,hn=!1,Ri=null;function N0(n,i){var a=gi(5,null,null,0);a.elementType="DELETED",a.stateNode=i,a.return=n,i=n.deletions,i===null?(n.deletions=[a],n.flags|=16):i.push(a)}function V_(n,i){switch(n.tag){case 5:var a=n.type;return i=i.nodeType!==1||a.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(n.stateNode=i,ti=n,ei=xs(i.firstChild),!0):!1;case 6:return i=n.pendingProps===""||i.nodeType!==3?null:i,i!==null?(n.stateNode=i,ti=n,ei=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(a=ya!==null?{id:Co,overflow:Io}:null,n.memoizedState={dehydrated:i,treeContext:a,retryLane:1073741824},a=gi(18,null,null,0),a.stateNode=i,a.return=n,n.child=a,ti=n,ei=null,!0):!1;default:return!1}}function pm(n){return(n.mode&1)!==0&&(n.flags&128)===0}function fm(n){if(hn){var i=ei;if(i){var a=i;if(!V_(n,i)){if(pm(n))throw Error(ze(418));i=xs(a.nextSibling);var f=ti;i&&V_(n,i)?N0(f,a):(n.flags=n.flags&-4097|2,hn=!1,ti=n)}}else{if(pm(n))throw Error(ze(418));n.flags=n.flags&-4097|2,hn=!1,ti=n}}}function j_(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;ti=n}function Uh(n){if(n!==ti)return!1;if(!hn)return j_(n),hn=!0,!1;var i;if((i=n.tag!==3)&&!(i=n.tag!==5)&&(i=n.type,i=i!=="head"&&i!=="body"&&!um(n.type,n.memoizedProps)),i&&(i=ei)){if(pm(n))throw U0(),Error(ze(418));for(;i;)N0(n,i),i=xs(i.nextSibling)}if(j_(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(ze(317));e:{for(n=n.nextSibling,i=0;n;){if(n.nodeType===8){var a=n.data;if(a==="/$"){if(i===0){ei=xs(n.nextSibling);break e}i--}else a!=="$"&&a!=="$!"&&a!=="$?"||i++}n=n.nextSibling}ei=null}}else ei=ti?xs(n.stateNode.nextSibling):null;return!0}function U0(){for(var n=ei;n;)n=xs(n.nextSibling)}function bl(){ei=ti=null,hn=!1}function og(n){Ri===null?Ri=[n]:Ri.push(n)}var nS=Ro.ReactCurrentBatchConfig;function Di(n,i){if(n&&n.defaultProps){i=mn({},i),n=n.defaultProps;for(var a in n)i[a]===void 0&&(i[a]=n[a]);return i}return i}var Sd=Cs(null),Ed=null,cl=null,sg=null;function ag(){sg=cl=Ed=null}function lg(n){var i=Sd.current;an(Sd),n._currentValue=i}function mm(n,i,a){for(;n!==null;){var f=n.alternate;if((n.childLanes&i)!==i?(n.childLanes|=i,f!==null&&(f.childLanes|=i)):f!==null&&(f.childLanes&i)!==i&&(f.childLanes|=i),n===a)break;n=n.return}}function yl(n,i){Ed=n,sg=cl=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&i&&(Ur=!0),n.firstContext=null)}function _i(n){var i=n._currentValue;if(sg!==n)if(n={context:n,memoizedValue:i,next:null},cl===null){if(Ed===null)throw Error(ze(308));cl=n,Ed.dependencies={lanes:0,firstContext:n}}else cl=cl.next=n;return i}var ha=null;function ug(n){ha===null?ha=[n]:ha.push(n)}function V0(n,i,a,f){var _=i.interleaved;return _===null?(a.next=a,ug(i)):(a.next=_.next,_.next=a),i.interleaved=a,Do(n,f)}function Do(n,i){n.lanes|=i;var a=n.alternate;for(a!==null&&(a.lanes|=i),a=n,n=n.return;n!==null;)n.childLanes|=i,a=n.alternate,a!==null&&(a.childLanes|=i),a=n,n=n.return;return a.tag===3?a.stateNode:null}var hs=!1;function cg(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function j0(n,i){n=n.updateQueue,i.updateQueue===n&&(i.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Ao(n,i){return{eventTime:n,lane:i,tag:0,payload:null,callback:null,next:null}}function vs(n,i,a){var f=n.updateQueue;if(f===null)return null;if(f=f.shared,Ft&2){var _=f.pending;return _===null?i.next=i:(i.next=_.next,_.next=i),f.pending=i,Do(n,a)}return _=f.interleaved,_===null?(i.next=i,ug(f)):(i.next=_.next,_.next=i),f.interleaved=i,Do(n,a)}function Jh(n,i,a){if(i=i.updateQueue,i!==null&&(i=i.shared,(a&4194240)!==0)){var f=i.lanes;f&=n.pendingLanes,a|=f,i.lanes=a,Xm(n,a)}}function $_(n,i){var a=n.updateQueue,f=n.alternate;if(f!==null&&(f=f.updateQueue,a===f)){var _=null,x=null;if(a=a.firstBaseUpdate,a!==null){do{var T={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};x===null?_=x=T:x=x.next=T,a=a.next}while(a!==null);x===null?_=x=i:x=x.next=i}else _=x=i;a={baseState:f.baseState,firstBaseUpdate:_,lastBaseUpdate:x,shared:f.shared,effects:f.effects},n.updateQueue=a;return}n=a.lastBaseUpdate,n===null?a.firstBaseUpdate=i:n.next=i,a.lastBaseUpdate=i}function Td(n,i,a,f){var _=n.updateQueue;hs=!1;var x=_.firstBaseUpdate,T=_.lastBaseUpdate,u=_.shared.pending;if(u!==null){_.shared.pending=null;var N=u,Z=N.next;N.next=null,T===null?x=Z:T.next=Z,T=N;var ue=n.alternate;ue!==null&&(ue=ue.updateQueue,u=ue.lastBaseUpdate,u!==T&&(u===null?ue.firstBaseUpdate=Z:u.next=Z,ue.lastBaseUpdate=N))}if(x!==null){var oe=_.baseState;T=0,ue=Z=N=null,u=x;do{var G=u.lane,Te=u.eventTime;if((f&G)===G){ue!==null&&(ue=ue.next={eventTime:Te,lane:0,tag:u.tag,payload:u.payload,callback:u.callback,next:null});e:{var _e=n,be=u;switch(G=i,Te=a,be.tag){case 1:if(_e=be.payload,typeof _e=="function"){oe=_e.call(Te,oe,G);break e}oe=_e;break e;case 3:_e.flags=_e.flags&-65537|128;case 0:if(_e=be.payload,G=typeof _e=="function"?_e.call(Te,oe,G):_e,G==null)break e;oe=mn({},oe,G);break e;case 2:hs=!0}}u.callback!==null&&u.lane!==0&&(n.flags|=64,G=_.effects,G===null?_.effects=[u]:G.push(u))}else Te={eventTime:Te,lane:G,tag:u.tag,payload:u.payload,callback:u.callback,next:null},ue===null?(Z=ue=Te,N=oe):ue=ue.next=Te,T|=G;if(u=u.next,u===null){if(u=_.shared.pending,u===null)break;G=u,u=G.next,G.next=null,_.lastBaseUpdate=G,_.shared.pending=null}}while(1);if(ue===null&&(N=oe),_.baseState=N,_.firstBaseUpdate=Z,_.lastBaseUpdate=ue,i=_.shared.interleaved,i!==null){_=i;do T|=_.lane,_=_.next;while(_!==i)}else x===null&&(_.shared.lanes=0);xa|=T,n.lanes=T,n.memoizedState=oe}}function G_(n,i,a){if(n=i.effects,i.effects=null,n!==null)for(i=0;i<n.length;i++){var f=n[i],_=f.callback;if(_!==null){if(f.callback=null,f=a,typeof _!="function")throw Error(ze(191,_));_.call(f)}}}var $0=new Vx.Component().refs;function gm(n,i,a,f){i=n.memoizedState,a=a(f,i),a=a==null?i:mn({},i,a),n.memoizedState=a,n.lanes===0&&(n.updateQueue.baseState=a)}var $d={isMounted:function(n){return(n=n._reactInternals)?Sa(n)===n:!1},enqueueSetState:function(n,i,a){n=n._reactInternals;var f=Ar(),_=bs(n),x=Ao(f,_);x.payload=i,a!=null&&(x.callback=a),i=vs(n,x,_),i!==null&&(Fi(i,n,_,f),Jh(i,n,_))},enqueueReplaceState:function(n,i,a){n=n._reactInternals;var f=Ar(),_=bs(n),x=Ao(f,_);x.tag=1,x.payload=i,a!=null&&(x.callback=a),i=vs(n,x,_),i!==null&&(Fi(i,n,_,f),Jh(i,n,_))},enqueueForceUpdate:function(n,i){n=n._reactInternals;var a=Ar(),f=bs(n),_=Ao(a,f);_.tag=2,i!=null&&(_.callback=i),i=vs(n,_,f),i!==null&&(Fi(i,n,f,a),Jh(i,n,f))}};function q_(n,i,a,f,_,x,T){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(f,x,T):i.prototype&&i.prototype.isPureReactComponent?!ic(a,f)||!ic(_,x):!0}function G0(n,i,a){var f=!1,_=Ts,x=i.contextType;return typeof x=="object"&&x!==null?x=_i(x):(_=jr(i)?ga:fr.current,f=i.contextTypes,x=(f=f!=null)?wl(n,_):Ts),i=new i(a,x),n.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=$d,n.stateNode=i,i._reactInternals=n,f&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=_,n.__reactInternalMemoizedMaskedChildContext=x),i}function Z_(n,i,a,f){n=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(a,f),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(a,f),i.state!==n&&$d.enqueueReplaceState(i,i.state,null)}function ym(n,i,a,f){var _=n.stateNode;_.props=a,_.state=n.memoizedState,_.refs=$0,cg(n);var x=i.contextType;typeof x=="object"&&x!==null?_.context=_i(x):(x=jr(i)?ga:fr.current,_.context=wl(n,x)),_.state=n.memoizedState,x=i.getDerivedStateFromProps,typeof x=="function"&&(gm(n,i,x,a),_.state=n.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(i=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),i!==_.state&&$d.enqueueReplaceState(_,_.state,null),Td(n,a,_,f),_.state=n.memoizedState),typeof _.componentDidMount=="function"&&(n.flags|=4194308)}function Lu(n,i,a){if(n=a.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(ze(309));var f=a.stateNode}if(!f)throw Error(ze(147,n));var _=f,x=""+n;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===x?i.ref:(i=function(T){var u=_.refs;u===$0&&(u=_.refs={}),T===null?delete u[x]:u[x]=T},i._stringRef=x,i)}if(typeof n!="string")throw Error(ze(284));if(!a._owner)throw Error(ze(290,n))}return n}function Vh(n,i){throw n=Object.prototype.toString.call(i),Error(ze(31,n==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":n))}function W_(n){var i=n._init;return i(n._payload)}function q0(n){function i(se,Q){if(n){var le=se.deletions;le===null?(se.deletions=[Q],se.flags|=16):le.push(Q)}}function a(se,Q){if(!n)return null;for(;Q!==null;)i(se,Q),Q=Q.sibling;return null}function f(se,Q){for(se=new Map;Q!==null;)Q.key!==null?se.set(Q.key,Q):se.set(Q.index,Q),Q=Q.sibling;return se}function _(se,Q){return se=Ss(se,Q),se.index=0,se.sibling=null,se}function x(se,Q,le){return se.index=le,n?(le=se.alternate,le!==null?(le=le.index,le<Q?(se.flags|=2,Q):le):(se.flags|=2,Q)):(se.flags|=1048576,Q)}function T(se){return n&&se.alternate===null&&(se.flags|=2),se}function u(se,Q,le,Pe){return Q===null||Q.tag!==6?(Q=Mf(le,se.mode,Pe),Q.return=se,Q):(Q=_(Q,le),Q.return=se,Q)}function N(se,Q,le,Pe){var Be=le.type;return Be===nl?ue(se,Q,le.props.children,Pe,le.key):Q!==null&&(Q.elementType===Be||typeof Be=="object"&&Be!==null&&Be.$$typeof===cs&&W_(Be)===Q.type)?(Pe=_(Q,le.props),Pe.ref=Lu(se,Q,le),Pe.return=se,Pe):(Pe=rd(le.type,le.key,le.props,null,se.mode,Pe),Pe.ref=Lu(se,Q,le),Pe.return=se,Pe)}function Z(se,Q,le,Pe){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==le.containerInfo||Q.stateNode.implementation!==le.implementation?(Q=Df(le,se.mode,Pe),Q.return=se,Q):(Q=_(Q,le.children||[]),Q.return=se,Q)}function ue(se,Q,le,Pe,Be){return Q===null||Q.tag!==7?(Q=ma(le,se.mode,Pe,Be),Q.return=se,Q):(Q=_(Q,le),Q.return=se,Q)}function oe(se,Q,le){if(typeof Q=="string"&&Q!==""||typeof Q=="number")return Q=Mf(""+Q,se.mode,le),Q.return=se,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case Ph:return le=rd(Q.type,Q.key,Q.props,null,se.mode,le),le.ref=Lu(se,null,Q),le.return=se,le;case tl:return Q=Df(Q,se.mode,le),Q.return=se,Q;case cs:var Pe=Q._init;return oe(se,Pe(Q._payload),le)}if(Nu(Q)||Au(Q))return Q=ma(Q,se.mode,le,null),Q.return=se,Q;Vh(se,Q)}return null}function G(se,Q,le,Pe){var Be=Q!==null?Q.key:null;if(typeof le=="string"&&le!==""||typeof le=="number")return Be!==null?null:u(se,Q,""+le,Pe);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case Ph:return le.key===Be?N(se,Q,le,Pe):null;case tl:return le.key===Be?Z(se,Q,le,Pe):null;case cs:return Be=le._init,G(se,Q,Be(le._payload),Pe)}if(Nu(le)||Au(le))return Be!==null?null:ue(se,Q,le,Pe,null);Vh(se,le)}return null}function Te(se,Q,le,Pe,Be){if(typeof Pe=="string"&&Pe!==""||typeof Pe=="number")return se=se.get(le)||null,u(Q,se,""+Pe,Be);if(typeof Pe=="object"&&Pe!==null){switch(Pe.$$typeof){case Ph:return se=se.get(Pe.key===null?le:Pe.key)||null,N(Q,se,Pe,Be);case tl:return se=se.get(Pe.key===null?le:Pe.key)||null,Z(Q,se,Pe,Be);case cs:var Ke=Pe._init;return Te(se,Q,le,Ke(Pe._payload),Be)}if(Nu(Pe)||Au(Pe))return se=se.get(le)||null,ue(Q,se,Pe,Be,null);Vh(Q,Pe)}return null}function _e(se,Q,le,Pe){for(var Be=null,Ke=null,Qe=Q,et=Q=0,Zt=null;Qe!==null&&et<le.length;et++){Qe.index>et?(Zt=Qe,Qe=null):Zt=Qe.sibling;var mt=G(se,Qe,le[et],Pe);if(mt===null){Qe===null&&(Qe=Zt);break}n&&Qe&&mt.alternate===null&&i(se,Qe),Q=x(mt,Q,et),Ke===null?Be=mt:Ke.sibling=mt,Ke=mt,Qe=Zt}if(et===le.length)return a(se,Qe),hn&&la(se,et),Be;if(Qe===null){for(;et<le.length;et++)Qe=oe(se,le[et],Pe),Qe!==null&&(Q=x(Qe,Q,et),Ke===null?Be=Qe:Ke.sibling=Qe,Ke=Qe);return hn&&la(se,et),Be}for(Qe=f(se,Qe);et<le.length;et++)Zt=Te(Qe,se,et,le[et],Pe),Zt!==null&&(n&&Zt.alternate!==null&&Qe.delete(Zt.key===null?et:Zt.key),Q=x(Zt,Q,et),Ke===null?Be=Zt:Ke.sibling=Zt,Ke=Zt);return n&&Qe.forEach(function(wn){return i(se,wn)}),hn&&la(se,et),Be}function be(se,Q,le,Pe){var Be=Au(le);if(typeof Be!="function")throw Error(ze(150));if(le=Be.call(le),le==null)throw Error(ze(151));for(var Ke=Be=null,Qe=Q,et=Q=0,Zt=null,mt=le.next();Qe!==null&&!mt.done;et++,mt=le.next()){Qe.index>et?(Zt=Qe,Qe=null):Zt=Qe.sibling;var wn=G(se,Qe,mt.value,Pe);if(wn===null){Qe===null&&(Qe=Zt);break}n&&Qe&&wn.alternate===null&&i(se,Qe),Q=x(wn,Q,et),Ke===null?Be=wn:Ke.sibling=wn,Ke=wn,Qe=Zt}if(mt.done)return a(se,Qe),hn&&la(se,et),Be;if(Qe===null){for(;!mt.done;et++,mt=le.next())mt=oe(se,mt.value,Pe),mt!==null&&(Q=x(mt,Q,et),Ke===null?Be=mt:Ke.sibling=mt,Ke=mt);return hn&&la(se,et),Be}for(Qe=f(se,Qe);!mt.done;et++,mt=le.next())mt=Te(Qe,se,et,mt.value,Pe),mt!==null&&(n&&mt.alternate!==null&&Qe.delete(mt.key===null?et:mt.key),Q=x(mt,Q,et),Ke===null?Be=mt:Ke.sibling=mt,Ke=mt);return n&&Qe.forEach(function(Hn){return i(se,Hn)}),hn&&la(se,et),Be}function bt(se,Q,le,Pe){if(typeof le=="object"&&le!==null&&le.type===nl&&le.key===null&&(le=le.props.children),typeof le=="object"&&le!==null){switch(le.$$typeof){case Ph:e:{for(var Be=le.key,Ke=Q;Ke!==null;){if(Ke.key===Be){if(Be=le.type,Be===nl){if(Ke.tag===7){a(se,Ke.sibling),Q=_(Ke,le.props.children),Q.return=se,se=Q;break e}}else if(Ke.elementType===Be||typeof Be=="object"&&Be!==null&&Be.$$typeof===cs&&W_(Be)===Ke.type){a(se,Ke.sibling),Q=_(Ke,le.props),Q.ref=Lu(se,Ke,le),Q.return=se,se=Q;break e}a(se,Ke);break}else i(se,Ke);Ke=Ke.sibling}le.type===nl?(Q=ma(le.props.children,se.mode,Pe,le.key),Q.return=se,se=Q):(Pe=rd(le.type,le.key,le.props,null,se.mode,Pe),Pe.ref=Lu(se,Q,le),Pe.return=se,se=Pe)}return T(se);case tl:e:{for(Ke=le.key;Q!==null;){if(Q.key===Ke)if(Q.tag===4&&Q.stateNode.containerInfo===le.containerInfo&&Q.stateNode.implementation===le.implementation){a(se,Q.sibling),Q=_(Q,le.children||[]),Q.return=se,se=Q;break e}else{a(se,Q);break}else i(se,Q);Q=Q.sibling}Q=Df(le,se.mode,Pe),Q.return=se,se=Q}return T(se);case cs:return Ke=le._init,bt(se,Q,Ke(le._payload),Pe)}if(Nu(le))return _e(se,Q,le,Pe);if(Au(le))return be(se,Q,le,Pe);Vh(se,le)}return typeof le=="string"&&le!==""||typeof le=="number"?(le=""+le,Q!==null&&Q.tag===6?(a(se,Q.sibling),Q=_(Q,le),Q.return=se,se=Q):(a(se,Q),Q=Mf(le,se.mode,Pe),Q.return=se,se=Q),T(se)):a(se,Q)}return bt}var Sl=q0(!0),Z0=q0(!1),xc={},oo=Cs(xc),lc=Cs(xc),uc=Cs(xc);function da(n){if(n===xc)throw Error(ze(174));return n}function hg(n,i){switch(on(uc,i),on(lc,n),on(oo,xc),n=i.nodeType,n){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:Xf(null,"");break;default:n=n===8?i.parentNode:i,i=n.namespaceURI||null,n=n.tagName,i=Xf(i,n)}an(oo),on(oo,i)}function El(){an(oo),an(lc),an(uc)}function W0(n){da(uc.current);var i=da(oo.current),a=Xf(i,n.type);i!==a&&(on(lc,n),on(oo,a))}function dg(n){lc.current===n&&(an(oo),an(lc))}var pn=Cs(0);function kd(n){for(var i=n;i!==null;){if(i.tag===13){var a=i.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var kf=[];function pg(){for(var n=0;n<kf.length;n++)kf[n]._workInProgressVersionPrimary=null;kf.length=0}var Yh=Ro.ReactCurrentDispatcher,Cf=Ro.ReactCurrentBatchConfig,_a=0,fn=null,Fn=null,Zn=null,Cd=!1,Wu=!1,cc=0,rS=0;function cr(){throw Error(ze(321))}function fg(n,i){if(i===null)return!1;for(var a=0;a<i.length&&a<n.length;a++)if(!Oi(n[a],i[a]))return!1;return!0}function mg(n,i,a,f,_,x){if(_a=x,fn=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,Yh.current=n===null||n.memoizedState===null?aS:lS,n=a(f,_),Wu){x=0;do{if(Wu=!1,cc=0,25<=x)throw Error(ze(301));x+=1,Zn=Fn=null,i.updateQueue=null,Yh.current=uS,n=a(f,_)}while(Wu)}if(Yh.current=Id,i=Fn!==null&&Fn.next!==null,_a=0,Zn=Fn=fn=null,Cd=!1,i)throw Error(ze(300));return n}function gg(){var n=cc!==0;return cc=0,n}function to(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Zn===null?fn.memoizedState=Zn=n:Zn=Zn.next=n,Zn}function xi(){if(Fn===null){var n=fn.alternate;n=n!==null?n.memoizedState:null}else n=Fn.next;var i=Zn===null?fn.memoizedState:Zn.next;if(i!==null)Zn=i,Fn=n;else{if(n===null)throw Error(ze(310));Fn=n,n={memoizedState:Fn.memoizedState,baseState:Fn.baseState,baseQueue:Fn.baseQueue,queue:Fn.queue,next:null},Zn===null?fn.memoizedState=Zn=n:Zn=Zn.next=n}return Zn}function hc(n,i){return typeof i=="function"?i(n):i}function If(n){var i=xi(),a=i.queue;if(a===null)throw Error(ze(311));a.lastRenderedReducer=n;var f=Fn,_=f.baseQueue,x=a.pending;if(x!==null){if(_!==null){var T=_.next;_.next=x.next,x.next=T}f.baseQueue=_=x,a.pending=null}if(_!==null){x=_.next,f=f.baseState;var u=T=null,N=null,Z=x;do{var ue=Z.lane;if((_a&ue)===ue)N!==null&&(N=N.next={lane:0,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null}),f=Z.hasEagerState?Z.eagerState:n(f,Z.action);else{var oe={lane:ue,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null};N===null?(u=N=oe,T=f):N=N.next=oe,fn.lanes|=ue,xa|=ue}Z=Z.next}while(Z!==null&&Z!==x);N===null?T=f:N.next=u,Oi(f,i.memoizedState)||(Ur=!0),i.memoizedState=f,i.baseState=T,i.baseQueue=N,a.lastRenderedState=f}if(n=a.interleaved,n!==null){_=n;do x=_.lane,fn.lanes|=x,xa|=x,_=_.next;while(_!==n)}else _===null&&(a.lanes=0);return[i.memoizedState,a.dispatch]}function Af(n){var i=xi(),a=i.queue;if(a===null)throw Error(ze(311));a.lastRenderedReducer=n;var f=a.dispatch,_=a.pending,x=i.memoizedState;if(_!==null){a.pending=null;var T=_=_.next;do x=n(x,T.action),T=T.next;while(T!==_);Oi(x,i.memoizedState)||(Ur=!0),i.memoizedState=x,i.baseQueue===null&&(i.baseState=x),a.lastRenderedState=x}return[x,f]}function H0(){}function X0(n,i){var a=fn,f=xi(),_=i(),x=!Oi(f.memoizedState,_);if(x&&(f.memoizedState=_,Ur=!0),f=f.queue,yg(Y0.bind(null,a,f,n),[n]),f.getSnapshot!==i||x||Zn!==null&&Zn.memoizedState.tag&1){if(a.flags|=2048,dc(9,J0.bind(null,a,f,_,i),void 0,null),Wn===null)throw Error(ze(349));_a&30||K0(a,i,_)}return _}function K0(n,i,a){n.flags|=16384,n={getSnapshot:i,value:a},i=fn.updateQueue,i===null?(i={lastEffect:null,stores:null},fn.updateQueue=i,i.stores=[n]):(a=i.stores,a===null?i.stores=[n]:a.push(n))}function J0(n,i,a,f){i.value=a,i.getSnapshot=f,Q0(i)&&ev(n)}function Y0(n,i,a){return a(function(){Q0(i)&&ev(n)})}function Q0(n){var i=n.getSnapshot;n=n.value;try{var a=i();return!Oi(n,a)}catch{return!0}}function ev(n){var i=Do(n,1);i!==null&&Fi(i,n,1,-1)}function H_(n){var i=to();return typeof n=="function"&&(n=n()),i.memoizedState=i.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:hc,lastRenderedState:n},i.queue=n,n=n.dispatch=sS.bind(null,fn,n),[i.memoizedState,n]}function dc(n,i,a,f){return n={tag:n,create:i,destroy:a,deps:f,next:null},i=fn.updateQueue,i===null?(i={lastEffect:null,stores:null},fn.updateQueue=i,i.lastEffect=n.next=n):(a=i.lastEffect,a===null?i.lastEffect=n.next=n:(f=a.next,a.next=n,n.next=f,i.lastEffect=n)),n}function tv(){return xi().memoizedState}function Qh(n,i,a,f){var _=to();fn.flags|=n,_.memoizedState=dc(1|i,a,void 0,f===void 0?null:f)}function Gd(n,i,a,f){var _=xi();f=f===void 0?null:f;var x=void 0;if(Fn!==null){var T=Fn.memoizedState;if(x=T.destroy,f!==null&&fg(f,T.deps)){_.memoizedState=dc(i,a,x,f);return}}fn.flags|=n,_.memoizedState=dc(1|i,a,x,f)}function X_(n,i){return Qh(8390656,8,n,i)}function yg(n,i){return Gd(2048,8,n,i)}function nv(n,i){return Gd(4,2,n,i)}function rv(n,i){return Gd(4,4,n,i)}function iv(n,i){if(typeof i=="function")return n=n(),i(n),function(){i(null)};if(i!=null)return n=n(),i.current=n,function(){i.current=null}}function ov(n,i,a){return a=a!=null?a.concat([n]):null,Gd(4,4,iv.bind(null,i,n),a)}function _g(){}function sv(n,i){var a=xi();i=i===void 0?null:i;var f=a.memoizedState;return f!==null&&i!==null&&fg(i,f[1])?f[0]:(a.memoizedState=[n,i],n)}function av(n,i){var a=xi();i=i===void 0?null:i;var f=a.memoizedState;return f!==null&&i!==null&&fg(i,f[1])?f[0]:(n=n(),a.memoizedState=[n,i],n)}function lv(n,i,a){return _a&21?(Oi(a,i)||(a=h0(),fn.lanes|=a,xa|=a,n.baseState=!0),i):(n.baseState&&(n.baseState=!1,Ur=!0),n.memoizedState=a)}function iS(n,i){var a=qt;qt=a!==0&&4>a?a:4,n(!0);var f=Cf.transition;Cf.transition={};try{n(!1),i()}finally{qt=a,Cf.transition=f}}function uv(){return xi().memoizedState}function oS(n,i,a){var f=bs(n);if(a={lane:f,action:a,hasEagerState:!1,eagerState:null,next:null},cv(n))hv(i,a);else if(a=V0(n,i,a,f),a!==null){var _=Ar();Fi(a,n,f,_),dv(a,i,f)}}function sS(n,i,a){var f=bs(n),_={lane:f,action:a,hasEagerState:!1,eagerState:null,next:null};if(cv(n))hv(i,_);else{var x=n.alternate;if(n.lanes===0&&(x===null||x.lanes===0)&&(x=i.lastRenderedReducer,x!==null))try{var T=i.lastRenderedState,u=x(T,a);if(_.hasEagerState=!0,_.eagerState=u,Oi(u,T)){var N=i.interleaved;N===null?(_.next=_,ug(i)):(_.next=N.next,N.next=_),i.interleaved=_;return}}catch{}finally{}a=V0(n,i,_,f),a!==null&&(_=Ar(),Fi(a,n,f,_),dv(a,i,f))}}function cv(n){var i=n.alternate;return n===fn||i!==null&&i===fn}function hv(n,i){Wu=Cd=!0;var a=n.pending;a===null?i.next=i:(i.next=a.next,a.next=i),n.pending=i}function dv(n,i,a){if(a&4194240){var f=i.lanes;f&=n.pendingLanes,a|=f,i.lanes=a,Xm(n,a)}}var Id={readContext:_i,useCallback:cr,useContext:cr,useEffect:cr,useImperativeHandle:cr,useInsertionEffect:cr,useLayoutEffect:cr,useMemo:cr,useReducer:cr,useRef:cr,useState:cr,useDebugValue:cr,useDeferredValue:cr,useTransition:cr,useMutableSource:cr,useSyncExternalStore:cr,useId:cr,unstable_isNewReconciler:!1},aS={readContext:_i,useCallback:function(n,i){return to().memoizedState=[n,i===void 0?null:i],n},useContext:_i,useEffect:X_,useImperativeHandle:function(n,i,a){return a=a!=null?a.concat([n]):null,Qh(4194308,4,iv.bind(null,i,n),a)},useLayoutEffect:function(n,i){return Qh(4194308,4,n,i)},useInsertionEffect:function(n,i){return Qh(4,2,n,i)},useMemo:function(n,i){var a=to();return i=i===void 0?null:i,n=n(),a.memoizedState=[n,i],n},useReducer:function(n,i,a){var f=to();return i=a!==void 0?a(i):i,f.memoizedState=f.baseState=i,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:i},f.queue=n,n=n.dispatch=oS.bind(null,fn,n),[f.memoizedState,n]},useRef:function(n){var i=to();return n={current:n},i.memoizedState=n},useState:H_,useDebugValue:_g,useDeferredValue:function(n){return to().memoizedState=n},useTransition:function(){var n=H_(!1),i=n[0];return n=iS.bind(null,n[1]),to().memoizedState=n,[i,n]},useMutableSource:function(){},useSyncExternalStore:function(n,i,a){var f=fn,_=to();if(hn){if(a===void 0)throw Error(ze(407));a=a()}else{if(a=i(),Wn===null)throw Error(ze(349));_a&30||K0(f,i,a)}_.memoizedState=a;var x={value:a,getSnapshot:i};return _.queue=x,X_(Y0.bind(null,f,x,n),[n]),f.flags|=2048,dc(9,J0.bind(null,f,x,a,i),void 0,null),a},useId:function(){var n=to(),i=Wn.identifierPrefix;if(hn){var a=Io,f=Co;a=(f&~(1<<32-Bi(f)-1)).toString(32)+a,i=":"+i+"R"+a,a=cc++,0<a&&(i+="H"+a.toString(32)),i+=":"}else a=rS++,i=":"+i+"r"+a.toString(32)+":";return n.memoizedState=i},unstable_isNewReconciler:!1},lS={readContext:_i,useCallback:sv,useContext:_i,useEffect:yg,useImperativeHandle:ov,useInsertionEffect:nv,useLayoutEffect:rv,useMemo:av,useReducer:If,useRef:tv,useState:function(){return If(hc)},useDebugValue:_g,useDeferredValue:function(n){var i=xi();return lv(i,Fn.memoizedState,n)},useTransition:function(){var n=If(hc)[0],i=xi().memoizedState;return[n,i]},useMutableSource:H0,useSyncExternalStore:X0,useId:uv,unstable_isNewReconciler:!1},uS={readContext:_i,useCallback:sv,useContext:_i,useEffect:yg,useImperativeHandle:ov,useInsertionEffect:nv,useLayoutEffect:rv,useMemo:av,useReducer:Af,useRef:tv,useState:function(){return Af(hc)},useDebugValue:_g,useDeferredValue:function(n){var i=xi();return Fn===null?i.memoizedState=n:lv(i,Fn.memoizedState,n)},useTransition:function(){var n=Af(hc)[0],i=xi().memoizedState;return[n,i]},useMutableSource:H0,useSyncExternalStore:X0,useId:uv,unstable_isNewReconciler:!1};function Tl(n,i){try{var a="",f=i;do a+=Fb(f),f=f.return;while(f);var _=a}catch(x){_=`
Error generating stack: `+x.message+`
`+x.stack}return{value:n,source:i,stack:_,digest:null}}function Pf(n,i,a){return{value:n,source:null,stack:a??null,digest:i??null}}function _m(n,i){try{console.error(i.value)}catch(a){setTimeout(function(){throw a})}}var cS=typeof WeakMap=="function"?WeakMap:Map;function pv(n,i,a){a=Ao(-1,a),a.tag=3,a.payload={element:null};var f=i.value;return a.callback=function(){Pd||(Pd=!0,Im=f),_m(n,i)},a}function fv(n,i,a){a=Ao(-1,a),a.tag=3;var f=n.type.getDerivedStateFromError;if(typeof f=="function"){var _=i.value;a.payload=function(){return f(_)},a.callback=function(){_m(n,i)}}var x=n.stateNode;return x!==null&&typeof x.componentDidCatch=="function"&&(a.callback=function(){_m(n,i),typeof f!="function"&&(ws===null?ws=new Set([this]):ws.add(this));var T=i.stack;this.componentDidCatch(i.value,{componentStack:T!==null?T:""})}),a}function K_(n,i,a){var f=n.pingCache;if(f===null){f=n.pingCache=new cS;var _=new Set;f.set(i,_)}else _=f.get(i),_===void 0&&(_=new Set,f.set(i,_));_.has(a)||(_.add(a),n=ES.bind(null,n,i,a),i.then(n,n))}function J_(n){do{var i;if((i=n.tag===13)&&(i=n.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return n;n=n.return}while(n!==null);return null}function Y_(n,i,a,f,_){return n.mode&1?(n.flags|=65536,n.lanes=_,n):(n===i?n.flags|=65536:(n.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(i=Ao(-1,1),i.tag=2,vs(a,i,1))),a.lanes|=1),n)}var hS=Ro.ReactCurrentOwner,Ur=!1;function Ir(n,i,a,f){i.child=n===null?Z0(i,null,a,f):Sl(i,n.child,a,f)}function Q_(n,i,a,f,_){a=a.render;var x=i.ref;return yl(i,_),f=mg(n,i,a,f,x,_),a=gg(),n!==null&&!Ur?(i.updateQueue=n.updateQueue,i.flags&=-2053,n.lanes&=~_,Lo(n,i,_)):(hn&&a&&rg(i),i.flags|=1,Ir(n,i,f,_),i.child)}function ex(n,i,a,f,_){if(n===null){var x=a.type;return typeof x=="function"&&!kg(x)&&x.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(i.tag=15,i.type=x,mv(n,i,x,f,_)):(n=rd(a.type,null,f,i,i.mode,_),n.ref=i.ref,n.return=i,i.child=n)}if(x=n.child,!(n.lanes&_)){var T=x.memoizedProps;if(a=a.compare,a=a!==null?a:ic,a(T,f)&&n.ref===i.ref)return Lo(n,i,_)}return i.flags|=1,n=Ss(x,f),n.ref=i.ref,n.return=i,i.child=n}function mv(n,i,a,f,_){if(n!==null){var x=n.memoizedProps;if(ic(x,f)&&n.ref===i.ref)if(Ur=!1,i.pendingProps=f=x,(n.lanes&_)!==0)n.flags&131072&&(Ur=!0);else return i.lanes=n.lanes,Lo(n,i,_)}return xm(n,i,a,f,_)}function gv(n,i,a){var f=i.pendingProps,_=f.children,x=n!==null?n.memoizedState:null;if(f.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},on(dl,Qr),Qr|=a;else{if(!(a&1073741824))return n=x!==null?x.baseLanes|a:a,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:n,cachePool:null,transitions:null},i.updateQueue=null,on(dl,Qr),Qr|=n,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},f=x!==null?x.baseLanes:a,on(dl,Qr),Qr|=f}else x!==null?(f=x.baseLanes|a,i.memoizedState=null):f=a,on(dl,Qr),Qr|=f;return Ir(n,i,_,a),i.child}function yv(n,i){var a=i.ref;(n===null&&a!==null||n!==null&&n.ref!==a)&&(i.flags|=512,i.flags|=2097152)}function xm(n,i,a,f,_){var x=jr(a)?ga:fr.current;return x=wl(i,x),yl(i,_),a=mg(n,i,a,f,x,_),f=gg(),n!==null&&!Ur?(i.updateQueue=n.updateQueue,i.flags&=-2053,n.lanes&=~_,Lo(n,i,_)):(hn&&f&&rg(i),i.flags|=1,Ir(n,i,a,_),i.child)}function tx(n,i,a,f,_){if(jr(a)){var x=!0;vd(i)}else x=!1;if(yl(i,_),i.stateNode===null)ed(n,i),G0(i,a,f),ym(i,a,f,_),f=!0;else if(n===null){var T=i.stateNode,u=i.memoizedProps;T.props=u;var N=T.context,Z=a.contextType;typeof Z=="object"&&Z!==null?Z=_i(Z):(Z=jr(a)?ga:fr.current,Z=wl(i,Z));var ue=a.getDerivedStateFromProps,oe=typeof ue=="function"||typeof T.getSnapshotBeforeUpdate=="function";oe||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(u!==f||N!==Z)&&Z_(i,T,f,Z),hs=!1;var G=i.memoizedState;T.state=G,Td(i,f,T,_),N=i.memoizedState,u!==f||G!==N||Vr.current||hs?(typeof ue=="function"&&(gm(i,a,ue,f),N=i.memoizedState),(u=hs||q_(i,a,u,f,G,N,Z))?(oe||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(i.flags|=4194308)):(typeof T.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=f,i.memoizedState=N),T.props=f,T.state=N,T.context=Z,f=u):(typeof T.componentDidMount=="function"&&(i.flags|=4194308),f=!1)}else{T=i.stateNode,j0(n,i),u=i.memoizedProps,Z=i.type===i.elementType?u:Di(i.type,u),T.props=Z,oe=i.pendingProps,G=T.context,N=a.contextType,typeof N=="object"&&N!==null?N=_i(N):(N=jr(a)?ga:fr.current,N=wl(i,N));var Te=a.getDerivedStateFromProps;(ue=typeof Te=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(u!==oe||G!==N)&&Z_(i,T,f,N),hs=!1,G=i.memoizedState,T.state=G,Td(i,f,T,_);var _e=i.memoizedState;u!==oe||G!==_e||Vr.current||hs?(typeof Te=="function"&&(gm(i,a,Te,f),_e=i.memoizedState),(Z=hs||q_(i,a,Z,f,G,_e,N)||!1)?(ue||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(f,_e,N),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(f,_e,N)),typeof T.componentDidUpdate=="function"&&(i.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof T.componentDidUpdate!="function"||u===n.memoizedProps&&G===n.memoizedState||(i.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||u===n.memoizedProps&&G===n.memoizedState||(i.flags|=1024),i.memoizedProps=f,i.memoizedState=_e),T.props=f,T.state=_e,T.context=N,f=Z):(typeof T.componentDidUpdate!="function"||u===n.memoizedProps&&G===n.memoizedState||(i.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||u===n.memoizedProps&&G===n.memoizedState||(i.flags|=1024),f=!1)}return vm(n,i,a,f,x,_)}function vm(n,i,a,f,_,x){yv(n,i);var T=(i.flags&128)!==0;if(!f&&!T)return _&&U_(i,a,!1),Lo(n,i,x);f=i.stateNode,hS.current=i;var u=T&&typeof a.getDerivedStateFromError!="function"?null:f.render();return i.flags|=1,n!==null&&T?(i.child=Sl(i,n.child,null,x),i.child=Sl(i,null,u,x)):Ir(n,i,u,x),i.memoizedState=f.state,_&&U_(i,a,!0),i.child}function _v(n){var i=n.stateNode;i.pendingContext?N_(n,i.pendingContext,i.pendingContext!==i.context):i.context&&N_(n,i.context,!1),hg(n,i.containerInfo)}function nx(n,i,a,f,_){return bl(),og(_),i.flags|=256,Ir(n,i,a,f),i.child}var wm={dehydrated:null,treeContext:null,retryLane:0};function bm(n){return{baseLanes:n,cachePool:null,transitions:null}}function xv(n,i,a){var f=i.pendingProps,_=pn.current,x=!1,T=(i.flags&128)!==0,u;if((u=T)||(u=n!==null&&n.memoizedState===null?!1:(_&2)!==0),u?(x=!0,i.flags&=-129):(n===null||n.memoizedState!==null)&&(_|=1),on(pn,_&1),n===null)return fm(i),n=i.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(i.mode&1?n.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(T=f.children,n=f.fallback,x?(f=i.mode,x=i.child,T={mode:"hidden",children:T},!(f&1)&&x!==null?(x.childLanes=0,x.pendingProps=T):x=Wd(T,f,0,null),n=ma(n,f,a,null),x.return=i,n.return=i,x.sibling=n,i.child=x,i.child.memoizedState=bm(a),i.memoizedState=wm,n):xg(i,T));if(_=n.memoizedState,_!==null&&(u=_.dehydrated,u!==null))return dS(n,i,T,f,u,_,a);if(x){x=f.fallback,T=i.mode,_=n.child,u=_.sibling;var N={mode:"hidden",children:f.children};return!(T&1)&&i.child!==_?(f=i.child,f.childLanes=0,f.pendingProps=N,i.deletions=null):(f=Ss(_,N),f.subtreeFlags=_.subtreeFlags&14680064),u!==null?x=Ss(u,x):(x=ma(x,T,a,null),x.flags|=2),x.return=i,f.return=i,f.sibling=x,i.child=f,f=x,x=i.child,T=n.child.memoizedState,T=T===null?bm(a):{baseLanes:T.baseLanes|a,cachePool:null,transitions:T.transitions},x.memoizedState=T,x.childLanes=n.childLanes&~a,i.memoizedState=wm,f}return x=n.child,n=x.sibling,f=Ss(x,{mode:"visible",children:f.children}),!(i.mode&1)&&(f.lanes=a),f.return=i,f.sibling=null,n!==null&&(a=i.deletions,a===null?(i.deletions=[n],i.flags|=16):a.push(n)),i.child=f,i.memoizedState=null,f}function xg(n,i){return i=Wd({mode:"visible",children:i},n.mode,0,null),i.return=n,n.child=i}function jh(n,i,a,f){return f!==null&&og(f),Sl(i,n.child,null,a),n=xg(i,i.pendingProps.children),n.flags|=2,i.memoizedState=null,n}function dS(n,i,a,f,_,x,T){if(a)return i.flags&256?(i.flags&=-257,f=Pf(Error(ze(422))),jh(n,i,T,f)):i.memoizedState!==null?(i.child=n.child,i.flags|=128,null):(x=f.fallback,_=i.mode,f=Wd({mode:"visible",children:f.children},_,0,null),x=ma(x,_,T,null),x.flags|=2,f.return=i,x.return=i,f.sibling=x,i.child=f,i.mode&1&&Sl(i,n.child,null,T),i.child.memoizedState=bm(T),i.memoizedState=wm,x);if(!(i.mode&1))return jh(n,i,T,null);if(_.data==="$!"){if(f=_.nextSibling&&_.nextSibling.dataset,f)var u=f.dgst;return f=u,x=Error(ze(419)),f=Pf(x,f,void 0),jh(n,i,T,f)}if(u=(T&n.childLanes)!==0,Ur||u){if(f=Wn,f!==null){switch(T&-T){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(f.suspendedLanes|T)?0:_,_!==0&&_!==x.retryLane&&(x.retryLane=_,Do(n,_),Fi(f,n,_,-1))}return Tg(),f=Pf(Error(ze(421))),jh(n,i,T,f)}return _.data==="$?"?(i.flags|=128,i.child=n.child,i=TS.bind(null,n),_._reactRetry=i,null):(n=x.treeContext,ei=xs(_.nextSibling),ti=i,hn=!0,Ri=null,n!==null&&(fi[mi++]=Co,fi[mi++]=Io,fi[mi++]=ya,Co=n.id,Io=n.overflow,ya=i),i=xg(i,f.children),i.flags|=4096,i)}function rx(n,i,a){n.lanes|=i;var f=n.alternate;f!==null&&(f.lanes|=i),mm(n.return,i,a)}function zf(n,i,a,f,_){var x=n.memoizedState;x===null?n.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:f,tail:a,tailMode:_}:(x.isBackwards=i,x.rendering=null,x.renderingStartTime=0,x.last=f,x.tail=a,x.tailMode=_)}function vv(n,i,a){var f=i.pendingProps,_=f.revealOrder,x=f.tail;if(Ir(n,i,f.children,a),f=pn.current,f&2)f=f&1|2,i.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=i.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&rx(n,a,i);else if(n.tag===19)rx(n,a,i);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break e;for(;n.sibling===null;){if(n.return===null||n.return===i)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}f&=1}if(on(pn,f),!(i.mode&1))i.memoizedState=null;else switch(_){case"forwards":for(a=i.child,_=null;a!==null;)n=a.alternate,n!==null&&kd(n)===null&&(_=a),a=a.sibling;a=_,a===null?(_=i.child,i.child=null):(_=a.sibling,a.sibling=null),zf(i,!1,_,a,x);break;case"backwards":for(a=null,_=i.child,i.child=null;_!==null;){if(n=_.alternate,n!==null&&kd(n)===null){i.child=_;break}n=_.sibling,_.sibling=a,a=_,_=n}zf(i,!0,a,null,x);break;case"together":zf(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function ed(n,i){!(i.mode&1)&&n!==null&&(n.alternate=null,i.alternate=null,i.flags|=2)}function Lo(n,i,a){if(n!==null&&(i.dependencies=n.dependencies),xa|=i.lanes,!(a&i.childLanes))return null;if(n!==null&&i.child!==n.child)throw Error(ze(153));if(i.child!==null){for(n=i.child,a=Ss(n,n.pendingProps),i.child=a,a.return=i;n.sibling!==null;)n=n.sibling,a=a.sibling=Ss(n,n.pendingProps),a.return=i;a.sibling=null}return i.child}function pS(n,i,a){switch(i.tag){case 3:_v(i),bl();break;case 5:W0(i);break;case 1:jr(i.type)&&vd(i);break;case 4:hg(i,i.stateNode.containerInfo);break;case 10:var f=i.type._context,_=i.memoizedProps.value;on(Sd,f._currentValue),f._currentValue=_;break;case 13:if(f=i.memoizedState,f!==null)return f.dehydrated!==null?(on(pn,pn.current&1),i.flags|=128,null):a&i.child.childLanes?xv(n,i,a):(on(pn,pn.current&1),n=Lo(n,i,a),n!==null?n.sibling:null);on(pn,pn.current&1);break;case 19:if(f=(a&i.childLanes)!==0,n.flags&128){if(f)return vv(n,i,a);i.flags|=128}if(_=i.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),on(pn,pn.current),f)break;return null;case 22:case 23:return i.lanes=0,gv(n,i,a)}return Lo(n,i,a)}var wv,Sm,bv,Sv;wv=function(n,i){for(var a=i.child;a!==null;){if(a.tag===5||a.tag===6)n.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};Sm=function(){};bv=function(n,i,a,f){var _=n.memoizedProps;if(_!==f){n=i.stateNode,da(oo.current);var x=null;switch(a){case"input":_=qf(n,_),f=qf(n,f),x=[];break;case"select":_=mn({},_,{value:void 0}),f=mn({},f,{value:void 0}),x=[];break;case"textarea":_=Hf(n,_),f=Hf(n,f),x=[];break;default:typeof _.onClick!="function"&&typeof f.onClick=="function"&&(n.onclick=_d)}Kf(a,f);var T;a=null;for(Z in _)if(!f.hasOwnProperty(Z)&&_.hasOwnProperty(Z)&&_[Z]!=null)if(Z==="style"){var u=_[Z];for(T in u)u.hasOwnProperty(T)&&(a||(a={}),a[T]="")}else Z!=="dangerouslySetInnerHTML"&&Z!=="children"&&Z!=="suppressContentEditableWarning"&&Z!=="suppressHydrationWarning"&&Z!=="autoFocus"&&(Ju.hasOwnProperty(Z)?x||(x=[]):(x=x||[]).push(Z,null));for(Z in f){var N=f[Z];if(u=_!=null?_[Z]:void 0,f.hasOwnProperty(Z)&&N!==u&&(N!=null||u!=null))if(Z==="style")if(u){for(T in u)!u.hasOwnProperty(T)||N&&N.hasOwnProperty(T)||(a||(a={}),a[T]="");for(T in N)N.hasOwnProperty(T)&&u[T]!==N[T]&&(a||(a={}),a[T]=N[T])}else a||(x||(x=[]),x.push(Z,a)),a=N;else Z==="dangerouslySetInnerHTML"?(N=N?N.__html:void 0,u=u?u.__html:void 0,N!=null&&u!==N&&(x=x||[]).push(Z,N)):Z==="children"?typeof N!="string"&&typeof N!="number"||(x=x||[]).push(Z,""+N):Z!=="suppressContentEditableWarning"&&Z!=="suppressHydrationWarning"&&(Ju.hasOwnProperty(Z)?(N!=null&&Z==="onScroll"&&sn("scroll",n),x||u===N||(x=[])):(x=x||[]).push(Z,N))}a&&(x=x||[]).push("style",a);var Z=x;(i.updateQueue=Z)&&(i.flags|=4)}};Sv=function(n,i,a,f){a!==f&&(i.flags|=4)};function Ru(n,i){if(!hn)switch(n.tailMode){case"hidden":i=n.tail;for(var a=null;i!==null;)i.alternate!==null&&(a=i),i=i.sibling;a===null?n.tail=null:a.sibling=null;break;case"collapsed":a=n.tail;for(var f=null;a!==null;)a.alternate!==null&&(f=a),a=a.sibling;f===null?i||n.tail===null?n.tail=null:n.tail.sibling=null:f.sibling=null}}function hr(n){var i=n.alternate!==null&&n.alternate.child===n.child,a=0,f=0;if(i)for(var _=n.child;_!==null;)a|=_.lanes|_.childLanes,f|=_.subtreeFlags&14680064,f|=_.flags&14680064,_.return=n,_=_.sibling;else for(_=n.child;_!==null;)a|=_.lanes|_.childLanes,f|=_.subtreeFlags,f|=_.flags,_.return=n,_=_.sibling;return n.subtreeFlags|=f,n.childLanes=a,i}function fS(n,i,a){var f=i.pendingProps;switch(ig(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return hr(i),null;case 1:return jr(i.type)&&xd(),hr(i),null;case 3:return f=i.stateNode,El(),an(Vr),an(fr),pg(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(n===null||n.child===null)&&(Uh(i)?i.flags|=4:n===null||n.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,Ri!==null&&(zm(Ri),Ri=null))),Sm(n,i),hr(i),null;case 5:dg(i);var _=da(uc.current);if(a=i.type,n!==null&&i.stateNode!=null)bv(n,i,a,f,_),n.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!f){if(i.stateNode===null)throw Error(ze(166));return hr(i),null}if(n=da(oo.current),Uh(i)){f=i.stateNode,a=i.type;var x=i.memoizedProps;switch(f[no]=i,f[ac]=x,n=(i.mode&1)!==0,a){case"dialog":sn("cancel",f),sn("close",f);break;case"iframe":case"object":case"embed":sn("load",f);break;case"video":case"audio":for(_=0;_<Vu.length;_++)sn(Vu[_],f);break;case"source":sn("error",f);break;case"img":case"image":case"link":sn("error",f),sn("load",f);break;case"details":sn("toggle",f);break;case"input":d_(f,x),sn("invalid",f);break;case"select":f._wrapperState={wasMultiple:!!x.multiple},sn("invalid",f);break;case"textarea":f_(f,x),sn("invalid",f)}Kf(a,x),_=null;for(var T in x)if(x.hasOwnProperty(T)){var u=x[T];T==="children"?typeof u=="string"?f.textContent!==u&&(x.suppressHydrationWarning!==!0&&Nh(f.textContent,u,n),_=["children",u]):typeof u=="number"&&f.textContent!==""+u&&(x.suppressHydrationWarning!==!0&&Nh(f.textContent,u,n),_=["children",""+u]):Ju.hasOwnProperty(T)&&u!=null&&T==="onScroll"&&sn("scroll",f)}switch(a){case"input":zh(f),p_(f,x,!0);break;case"textarea":zh(f),m_(f);break;case"select":case"option":break;default:typeof x.onClick=="function"&&(f.onclick=_d)}f=_,i.updateQueue=f,f!==null&&(i.flags|=4)}else{T=_.nodeType===9?_:_.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Kx(a)),n==="http://www.w3.org/1999/xhtml"?a==="script"?(n=T.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof f.is=="string"?n=T.createElement(a,{is:f.is}):(n=T.createElement(a),a==="select"&&(T=n,f.multiple?T.multiple=!0:f.size&&(T.size=f.size))):n=T.createElementNS(n,a),n[no]=i,n[ac]=f,wv(n,i,!1,!1),i.stateNode=n;e:{switch(T=Jf(a,f),a){case"dialog":sn("cancel",n),sn("close",n),_=f;break;case"iframe":case"object":case"embed":sn("load",n),_=f;break;case"video":case"audio":for(_=0;_<Vu.length;_++)sn(Vu[_],n);_=f;break;case"source":sn("error",n),_=f;break;case"img":case"image":case"link":sn("error",n),sn("load",n),_=f;break;case"details":sn("toggle",n),_=f;break;case"input":d_(n,f),_=qf(n,f),sn("invalid",n);break;case"option":_=f;break;case"select":n._wrapperState={wasMultiple:!!f.multiple},_=mn({},f,{value:void 0}),sn("invalid",n);break;case"textarea":f_(n,f),_=Hf(n,f),sn("invalid",n);break;default:_=f}Kf(a,_),u=_;for(x in u)if(u.hasOwnProperty(x)){var N=u[x];x==="style"?Qx(n,N):x==="dangerouslySetInnerHTML"?(N=N?N.__html:void 0,N!=null&&Jx(n,N)):x==="children"?typeof N=="string"?(a!=="textarea"||N!=="")&&Yu(n,N):typeof N=="number"&&Yu(n,""+N):x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&x!=="autoFocus"&&(Ju.hasOwnProperty(x)?N!=null&&x==="onScroll"&&sn("scroll",n):N!=null&&$m(n,x,N,T))}switch(a){case"input":zh(n),p_(n,f,!1);break;case"textarea":zh(n),m_(n);break;case"option":f.value!=null&&n.setAttribute("value",""+Es(f.value));break;case"select":n.multiple=!!f.multiple,x=f.value,x!=null?pl(n,!!f.multiple,x,!1):f.defaultValue!=null&&pl(n,!!f.multiple,f.defaultValue,!0);break;default:typeof _.onClick=="function"&&(n.onclick=_d)}switch(a){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}}f&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return hr(i),null;case 6:if(n&&i.stateNode!=null)Sv(n,i,n.memoizedProps,f);else{if(typeof f!="string"&&i.stateNode===null)throw Error(ze(166));if(a=da(uc.current),da(oo.current),Uh(i)){if(f=i.stateNode,a=i.memoizedProps,f[no]=i,(x=f.nodeValue!==a)&&(n=ti,n!==null))switch(n.tag){case 3:Nh(f.nodeValue,a,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Nh(f.nodeValue,a,(n.mode&1)!==0)}x&&(i.flags|=4)}else f=(a.nodeType===9?a:a.ownerDocument).createTextNode(f),f[no]=i,i.stateNode=f}return hr(i),null;case 13:if(an(pn),f=i.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(hn&&ei!==null&&i.mode&1&&!(i.flags&128))U0(),bl(),i.flags|=98560,x=!1;else if(x=Uh(i),f!==null&&f.dehydrated!==null){if(n===null){if(!x)throw Error(ze(318));if(x=i.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(ze(317));x[no]=i}else bl(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;hr(i),x=!1}else Ri!==null&&(zm(Ri),Ri=null),x=!0;if(!x)return i.flags&65536?i:null}return i.flags&128?(i.lanes=a,i):(f=f!==null,f!==(n!==null&&n.memoizedState!==null)&&f&&(i.child.flags|=8192,i.mode&1&&(n===null||pn.current&1?On===0&&(On=3):Tg())),i.updateQueue!==null&&(i.flags|=4),hr(i),null);case 4:return El(),Sm(n,i),n===null&&oc(i.stateNode.containerInfo),hr(i),null;case 10:return lg(i.type._context),hr(i),null;case 17:return jr(i.type)&&xd(),hr(i),null;case 19:if(an(pn),x=i.memoizedState,x===null)return hr(i),null;if(f=(i.flags&128)!==0,T=x.rendering,T===null)if(f)Ru(x,!1);else{if(On!==0||n!==null&&n.flags&128)for(n=i.child;n!==null;){if(T=kd(n),T!==null){for(i.flags|=128,Ru(x,!1),f=T.updateQueue,f!==null&&(i.updateQueue=f,i.flags|=4),i.subtreeFlags=0,f=a,a=i.child;a!==null;)x=a,n=f,x.flags&=14680066,T=x.alternate,T===null?(x.childLanes=0,x.lanes=n,x.child=null,x.subtreeFlags=0,x.memoizedProps=null,x.memoizedState=null,x.updateQueue=null,x.dependencies=null,x.stateNode=null):(x.childLanes=T.childLanes,x.lanes=T.lanes,x.child=T.child,x.subtreeFlags=0,x.deletions=null,x.memoizedProps=T.memoizedProps,x.memoizedState=T.memoizedState,x.updateQueue=T.updateQueue,x.type=T.type,n=T.dependencies,x.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),a=a.sibling;return on(pn,pn.current&1|2),i.child}n=n.sibling}x.tail!==null&&Tn()>kl&&(i.flags|=128,f=!0,Ru(x,!1),i.lanes=4194304)}else{if(!f)if(n=kd(T),n!==null){if(i.flags|=128,f=!0,a=n.updateQueue,a!==null&&(i.updateQueue=a,i.flags|=4),Ru(x,!0),x.tail===null&&x.tailMode==="hidden"&&!T.alternate&&!hn)return hr(i),null}else 2*Tn()-x.renderingStartTime>kl&&a!==1073741824&&(i.flags|=128,f=!0,Ru(x,!1),i.lanes=4194304);x.isBackwards?(T.sibling=i.child,i.child=T):(a=x.last,a!==null?a.sibling=T:i.child=T,x.last=T)}return x.tail!==null?(i=x.tail,x.rendering=i,x.tail=i.sibling,x.renderingStartTime=Tn(),i.sibling=null,a=pn.current,on(pn,f?a&1|2:a&1),i):(hr(i),null);case 22:case 23:return Eg(),f=i.memoizedState!==null,n!==null&&n.memoizedState!==null!==f&&(i.flags|=8192),f&&i.mode&1?Qr&1073741824&&(hr(i),i.subtreeFlags&6&&(i.flags|=8192)):hr(i),null;case 24:return null;case 25:return null}throw Error(ze(156,i.tag))}function mS(n,i){switch(ig(i),i.tag){case 1:return jr(i.type)&&xd(),n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 3:return El(),an(Vr),an(fr),pg(),n=i.flags,n&65536&&!(n&128)?(i.flags=n&-65537|128,i):null;case 5:return dg(i),null;case 13:if(an(pn),n=i.memoizedState,n!==null&&n.dehydrated!==null){if(i.alternate===null)throw Error(ze(340));bl()}return n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 19:return an(pn),null;case 4:return El(),null;case 10:return lg(i.type._context),null;case 22:case 23:return Eg(),null;case 24:return null;default:return null}}var $h=!1,pr=!1,gS=typeof WeakSet=="function"?WeakSet:Set,nt=null;function hl(n,i){var a=n.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(f){vn(n,i,f)}else a.current=null}function Em(n,i,a){try{a()}catch(f){vn(n,i,f)}}var ix=!1;function yS(n,i){if(am=md,n=C0(),ng(n)){if("selectionStart"in n)var a={start:n.selectionStart,end:n.selectionEnd};else e:{a=(a=n.ownerDocument)&&a.defaultView||window;var f=a.getSelection&&a.getSelection();if(f&&f.rangeCount!==0){a=f.anchorNode;var _=f.anchorOffset,x=f.focusNode;f=f.focusOffset;try{a.nodeType,x.nodeType}catch{a=null;break e}var T=0,u=-1,N=-1,Z=0,ue=0,oe=n,G=null;t:for(;;){for(var Te;oe!==a||_!==0&&oe.nodeType!==3||(u=T+_),oe!==x||f!==0&&oe.nodeType!==3||(N=T+f),oe.nodeType===3&&(T+=oe.nodeValue.length),(Te=oe.firstChild)!==null;)G=oe,oe=Te;for(;;){if(oe===n)break t;if(G===a&&++Z===_&&(u=T),G===x&&++ue===f&&(N=T),(Te=oe.nextSibling)!==null)break;oe=G,G=oe.parentNode}oe=Te}a=u===-1||N===-1?null:{start:u,end:N}}else a=null}a=a||{start:0,end:0}}else a=null;for(lm={focusedElem:n,selectionRange:a},md=!1,nt=i;nt!==null;)if(i=nt,n=i.child,(i.subtreeFlags&1028)!==0&&n!==null)n.return=i,nt=n;else for(;nt!==null;){i=nt;try{var _e=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(_e!==null){var be=_e.memoizedProps,bt=_e.memoizedState,se=i.stateNode,Q=se.getSnapshotBeforeUpdate(i.elementType===i.type?be:Di(i.type,be),bt);se.__reactInternalSnapshotBeforeUpdate=Q}break;case 3:var le=i.stateNode.containerInfo;le.nodeType===1?le.textContent="":le.nodeType===9&&le.documentElement&&le.removeChild(le.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ze(163))}}catch(Pe){vn(i,i.return,Pe)}if(n=i.sibling,n!==null){n.return=i.return,nt=n;break}nt=i.return}return _e=ix,ix=!1,_e}function Hu(n,i,a){var f=i.updateQueue;if(f=f!==null?f.lastEffect:null,f!==null){var _=f=f.next;do{if((_.tag&n)===n){var x=_.destroy;_.destroy=void 0,x!==void 0&&Em(i,a,x)}_=_.next}while(_!==f)}}function qd(n,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var a=i=i.next;do{if((a.tag&n)===n){var f=a.create;a.destroy=f()}a=a.next}while(a!==i)}}function Tm(n){var i=n.ref;if(i!==null){var a=n.stateNode;switch(n.tag){case 5:n=a;break;default:n=a}typeof i=="function"?i(n):i.current=n}}function Ev(n){var i=n.alternate;i!==null&&(n.alternate=null,Ev(i)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(i=n.stateNode,i!==null&&(delete i[no],delete i[ac],delete i[hm],delete i[Q2],delete i[eS])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Tv(n){return n.tag===5||n.tag===3||n.tag===4}function ox(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Tv(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function km(n,i,a){var f=n.tag;if(f===5||f===6)n=n.stateNode,i?a.nodeType===8?a.parentNode.insertBefore(n,i):a.insertBefore(n,i):(a.nodeType===8?(i=a.parentNode,i.insertBefore(n,a)):(i=a,i.appendChild(n)),a=a._reactRootContainer,a!=null||i.onclick!==null||(i.onclick=_d));else if(f!==4&&(n=n.child,n!==null))for(km(n,i,a),n=n.sibling;n!==null;)km(n,i,a),n=n.sibling}function Cm(n,i,a){var f=n.tag;if(f===5||f===6)n=n.stateNode,i?a.insertBefore(n,i):a.appendChild(n);else if(f!==4&&(n=n.child,n!==null))for(Cm(n,i,a),n=n.sibling;n!==null;)Cm(n,i,a),n=n.sibling}var Qn=null,Li=!1;function ls(n,i,a){for(a=a.child;a!==null;)kv(n,i,a),a=a.sibling}function kv(n,i,a){if(io&&typeof io.onCommitFiberUnmount=="function")try{io.onCommitFiberUnmount(Fd,a)}catch{}switch(a.tag){case 5:pr||hl(a,i);case 6:var f=Qn,_=Li;Qn=null,ls(n,i,a),Qn=f,Li=_,Qn!==null&&(Li?(n=Qn,a=a.stateNode,n.nodeType===8?n.parentNode.removeChild(a):n.removeChild(a)):Qn.removeChild(a.stateNode));break;case 18:Qn!==null&&(Li?(n=Qn,a=a.stateNode,n.nodeType===8?Ef(n.parentNode,a):n.nodeType===1&&Ef(n,a),nc(n)):Ef(Qn,a.stateNode));break;case 4:f=Qn,_=Li,Qn=a.stateNode.containerInfo,Li=!0,ls(n,i,a),Qn=f,Li=_;break;case 0:case 11:case 14:case 15:if(!pr&&(f=a.updateQueue,f!==null&&(f=f.lastEffect,f!==null))){_=f=f.next;do{var x=_,T=x.destroy;x=x.tag,T!==void 0&&(x&2||x&4)&&Em(a,i,T),_=_.next}while(_!==f)}ls(n,i,a);break;case 1:if(!pr&&(hl(a,i),f=a.stateNode,typeof f.componentWillUnmount=="function"))try{f.props=a.memoizedProps,f.state=a.memoizedState,f.componentWillUnmount()}catch(u){vn(a,i,u)}ls(n,i,a);break;case 21:ls(n,i,a);break;case 22:a.mode&1?(pr=(f=pr)||a.memoizedState!==null,ls(n,i,a),pr=f):ls(n,i,a);break;default:ls(n,i,a)}}function sx(n){var i=n.updateQueue;if(i!==null){n.updateQueue=null;var a=n.stateNode;a===null&&(a=n.stateNode=new gS),i.forEach(function(f){var _=kS.bind(null,n,f);a.has(f)||(a.add(f),f.then(_,_))})}}function Mi(n,i){var a=i.deletions;if(a!==null)for(var f=0;f<a.length;f++){var _=a[f];try{var x=n,T=i,u=T;e:for(;u!==null;){switch(u.tag){case 5:Qn=u.stateNode,Li=!1;break e;case 3:Qn=u.stateNode.containerInfo,Li=!0;break e;case 4:Qn=u.stateNode.containerInfo,Li=!0;break e}u=u.return}if(Qn===null)throw Error(ze(160));kv(x,T,_),Qn=null,Li=!1;var N=_.alternate;N!==null&&(N.return=null),_.return=null}catch(Z){vn(_,i,Z)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)Cv(i,n),i=i.sibling}function Cv(n,i){var a=n.alternate,f=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Mi(i,n),eo(n),f&4){try{Hu(3,n,n.return),qd(3,n)}catch(be){vn(n,n.return,be)}try{Hu(5,n,n.return)}catch(be){vn(n,n.return,be)}}break;case 1:Mi(i,n),eo(n),f&512&&a!==null&&hl(a,a.return);break;case 5:if(Mi(i,n),eo(n),f&512&&a!==null&&hl(a,a.return),n.flags&32){var _=n.stateNode;try{Yu(_,"")}catch(be){vn(n,n.return,be)}}if(f&4&&(_=n.stateNode,_!=null)){var x=n.memoizedProps,T=a!==null?a.memoizedProps:x,u=n.type,N=n.updateQueue;if(n.updateQueue=null,N!==null)try{u==="input"&&x.type==="radio"&&x.name!=null&&Hx(_,x),Jf(u,T);var Z=Jf(u,x);for(T=0;T<N.length;T+=2){var ue=N[T],oe=N[T+1];ue==="style"?Qx(_,oe):ue==="dangerouslySetInnerHTML"?Jx(_,oe):ue==="children"?Yu(_,oe):$m(_,ue,oe,Z)}switch(u){case"input":Zf(_,x);break;case"textarea":Xx(_,x);break;case"select":var G=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!x.multiple;var Te=x.value;Te!=null?pl(_,!!x.multiple,Te,!1):G!==!!x.multiple&&(x.defaultValue!=null?pl(_,!!x.multiple,x.defaultValue,!0):pl(_,!!x.multiple,x.multiple?[]:"",!1))}_[ac]=x}catch(be){vn(n,n.return,be)}}break;case 6:if(Mi(i,n),eo(n),f&4){if(n.stateNode===null)throw Error(ze(162));_=n.stateNode,x=n.memoizedProps;try{_.nodeValue=x}catch(be){vn(n,n.return,be)}}break;case 3:if(Mi(i,n),eo(n),f&4&&a!==null&&a.memoizedState.isDehydrated)try{nc(i.containerInfo)}catch(be){vn(n,n.return,be)}break;case 4:Mi(i,n),eo(n);break;case 13:Mi(i,n),eo(n),_=n.child,_.flags&8192&&(x=_.memoizedState!==null,_.stateNode.isHidden=x,!x||_.alternate!==null&&_.alternate.memoizedState!==null||(bg=Tn())),f&4&&sx(n);break;case 22:if(ue=a!==null&&a.memoizedState!==null,n.mode&1?(pr=(Z=pr)||ue,Mi(i,n),pr=Z):Mi(i,n),eo(n),f&8192){if(Z=n.memoizedState!==null,(n.stateNode.isHidden=Z)&&!ue&&n.mode&1)for(nt=n,ue=n.child;ue!==null;){for(oe=nt=ue;nt!==null;){switch(G=nt,Te=G.child,G.tag){case 0:case 11:case 14:case 15:Hu(4,G,G.return);break;case 1:hl(G,G.return);var _e=G.stateNode;if(typeof _e.componentWillUnmount=="function"){f=G,a=G.return;try{i=f,_e.props=i.memoizedProps,_e.state=i.memoizedState,_e.componentWillUnmount()}catch(be){vn(f,a,be)}}break;case 5:hl(G,G.return);break;case 22:if(G.memoizedState!==null){lx(oe);continue}}Te!==null?(Te.return=G,nt=Te):lx(oe)}ue=ue.sibling}e:for(ue=null,oe=n;;){if(oe.tag===5){if(ue===null){ue=oe;try{_=oe.stateNode,Z?(x=_.style,typeof x.setProperty=="function"?x.setProperty("display","none","important"):x.display="none"):(u=oe.stateNode,N=oe.memoizedProps.style,T=N!=null&&N.hasOwnProperty("display")?N.display:null,u.style.display=Yx("display",T))}catch(be){vn(n,n.return,be)}}}else if(oe.tag===6){if(ue===null)try{oe.stateNode.nodeValue=Z?"":oe.memoizedProps}catch(be){vn(n,n.return,be)}}else if((oe.tag!==22&&oe.tag!==23||oe.memoizedState===null||oe===n)&&oe.child!==null){oe.child.return=oe,oe=oe.child;continue}if(oe===n)break e;for(;oe.sibling===null;){if(oe.return===null||oe.return===n)break e;ue===oe&&(ue=null),oe=oe.return}ue===oe&&(ue=null),oe.sibling.return=oe.return,oe=oe.sibling}}break;case 19:Mi(i,n),eo(n),f&4&&sx(n);break;case 21:break;default:Mi(i,n),eo(n)}}function eo(n){var i=n.flags;if(i&2){try{e:{for(var a=n.return;a!==null;){if(Tv(a)){var f=a;break e}a=a.return}throw Error(ze(160))}switch(f.tag){case 5:var _=f.stateNode;f.flags&32&&(Yu(_,""),f.flags&=-33);var x=ox(n);Cm(n,x,_);break;case 3:case 4:var T=f.stateNode.containerInfo,u=ox(n);km(n,u,T);break;default:throw Error(ze(161))}}catch(N){vn(n,n.return,N)}n.flags&=-3}i&4096&&(n.flags&=-4097)}function _S(n,i,a){nt=n,Iv(n)}function Iv(n,i,a){for(var f=(n.mode&1)!==0;nt!==null;){var _=nt,x=_.child;if(_.tag===22&&f){var T=_.memoizedState!==null||$h;if(!T){var u=_.alternate,N=u!==null&&u.memoizedState!==null||pr;u=$h;var Z=pr;if($h=T,(pr=N)&&!Z)for(nt=_;nt!==null;)T=nt,N=T.child,T.tag===22&&T.memoizedState!==null?ux(_):N!==null?(N.return=T,nt=N):ux(_);for(;x!==null;)nt=x,Iv(x),x=x.sibling;nt=_,$h=u,pr=Z}ax(n)}else _.subtreeFlags&8772&&x!==null?(x.return=_,nt=x):ax(n)}}function ax(n){for(;nt!==null;){var i=nt;if(i.flags&8772){var a=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:pr||qd(5,i);break;case 1:var f=i.stateNode;if(i.flags&4&&!pr)if(a===null)f.componentDidMount();else{var _=i.elementType===i.type?a.memoizedProps:Di(i.type,a.memoizedProps);f.componentDidUpdate(_,a.memoizedState,f.__reactInternalSnapshotBeforeUpdate)}var x=i.updateQueue;x!==null&&G_(i,x,f);break;case 3:var T=i.updateQueue;if(T!==null){if(a=null,i.child!==null)switch(i.child.tag){case 5:a=i.child.stateNode;break;case 1:a=i.child.stateNode}G_(i,T,a)}break;case 5:var u=i.stateNode;if(a===null&&i.flags&4){a=u;var N=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":N.autoFocus&&a.focus();break;case"img":N.src&&(a.src=N.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var Z=i.alternate;if(Z!==null){var ue=Z.memoizedState;if(ue!==null){var oe=ue.dehydrated;oe!==null&&nc(oe)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ze(163))}pr||i.flags&512&&Tm(i)}catch(G){vn(i,i.return,G)}}if(i===n){nt=null;break}if(a=i.sibling,a!==null){a.return=i.return,nt=a;break}nt=i.return}}function lx(n){for(;nt!==null;){var i=nt;if(i===n){nt=null;break}var a=i.sibling;if(a!==null){a.return=i.return,nt=a;break}nt=i.return}}function ux(n){for(;nt!==null;){var i=nt;try{switch(i.tag){case 0:case 11:case 15:var a=i.return;try{qd(4,i)}catch(N){vn(i,a,N)}break;case 1:var f=i.stateNode;if(typeof f.componentDidMount=="function"){var _=i.return;try{f.componentDidMount()}catch(N){vn(i,_,N)}}var x=i.return;try{Tm(i)}catch(N){vn(i,x,N)}break;case 5:var T=i.return;try{Tm(i)}catch(N){vn(i,T,N)}}}catch(N){vn(i,i.return,N)}if(i===n){nt=null;break}var u=i.sibling;if(u!==null){u.return=i.return,nt=u;break}nt=i.return}}var xS=Math.ceil,Ad=Ro.ReactCurrentDispatcher,vg=Ro.ReactCurrentOwner,yi=Ro.ReactCurrentBatchConfig,Ft=0,Wn=null,Dn=null,er=0,Qr=0,dl=Cs(0),On=0,pc=null,xa=0,Zd=0,wg=0,Xu=null,Nr=null,bg=0,kl=1/0,To=null,Pd=!1,Im=null,ws=null,Gh=!1,ms=null,zd=0,Ku=0,Am=null,td=-1,nd=0;function Ar(){return Ft&6?Tn():td!==-1?td:td=Tn()}function bs(n){return n.mode&1?Ft&2&&er!==0?er&-er:nS.transition!==null?(nd===0&&(nd=h0()),nd):(n=qt,n!==0||(n=window.event,n=n===void 0?16:_0(n.type)),n):1}function Fi(n,i,a,f){if(50<Ku)throw Ku=0,Am=null,Error(ze(185));gc(n,a,f),(!(Ft&2)||n!==Wn)&&(n===Wn&&(!(Ft&2)&&(Zd|=a),On===4&&ps(n,er)),$r(n,f),a===1&&Ft===0&&!(i.mode&1)&&(kl=Tn()+500,jd&&Is()))}function $r(n,i){var a=n.callbackNode;n2(n,i);var f=fd(n,n===Wn?er:0);if(f===0)a!==null&&__(a),n.callbackNode=null,n.callbackPriority=0;else if(i=f&-f,n.callbackPriority!==i){if(a!=null&&__(a),i===1)n.tag===0?tS(cx.bind(null,n)):F0(cx.bind(null,n)),J2(function(){!(Ft&6)&&Is()}),a=null;else{switch(d0(f)){case 1:a=Hm;break;case 4:a=u0;break;case 16:a=pd;break;case 536870912:a=c0;break;default:a=pd}a=Bv(a,Av.bind(null,n))}n.callbackPriority=i,n.callbackNode=a}}function Av(n,i){if(td=-1,nd=0,Ft&6)throw Error(ze(327));var a=n.callbackNode;if(_l()&&n.callbackNode!==a)return null;var f=fd(n,n===Wn?er:0);if(f===0)return null;if(f&30||f&n.expiredLanes||i)i=Md(n,f);else{i=f;var _=Ft;Ft|=2;var x=zv();(Wn!==n||er!==i)&&(To=null,kl=Tn()+500,fa(n,i));do try{bS();break}catch(u){Pv(n,u)}while(1);ag(),Ad.current=x,Ft=_,Dn!==null?i=0:(Wn=null,er=0,i=On)}if(i!==0){if(i===2&&(_=nm(n),_!==0&&(f=_,i=Pm(n,_))),i===1)throw a=pc,fa(n,0),ps(n,f),$r(n,Tn()),a;if(i===6)ps(n,f);else{if(_=n.current.alternate,!(f&30)&&!vS(_)&&(i=Md(n,f),i===2&&(x=nm(n),x!==0&&(f=x,i=Pm(n,x))),i===1))throw a=pc,fa(n,0),ps(n,f),$r(n,Tn()),a;switch(n.finishedWork=_,n.finishedLanes=f,i){case 0:case 1:throw Error(ze(345));case 2:ua(n,Nr,To);break;case 3:if(ps(n,f),(f&130023424)===f&&(i=bg+500-Tn(),10<i)){if(fd(n,0)!==0)break;if(_=n.suspendedLanes,(_&f)!==f){Ar(),n.pingedLanes|=n.suspendedLanes&_;break}n.timeoutHandle=cm(ua.bind(null,n,Nr,To),i);break}ua(n,Nr,To);break;case 4:if(ps(n,f),(f&4194240)===f)break;for(i=n.eventTimes,_=-1;0<f;){var T=31-Bi(f);x=1<<T,T=i[T],T>_&&(_=T),f&=~x}if(f=_,f=Tn()-f,f=(120>f?120:480>f?480:1080>f?1080:1920>f?1920:3e3>f?3e3:4320>f?4320:1960*xS(f/1960))-f,10<f){n.timeoutHandle=cm(ua.bind(null,n,Nr,To),f);break}ua(n,Nr,To);break;case 5:ua(n,Nr,To);break;default:throw Error(ze(329))}}}return $r(n,Tn()),n.callbackNode===a?Av.bind(null,n):null}function Pm(n,i){var a=Xu;return n.current.memoizedState.isDehydrated&&(fa(n,i).flags|=256),n=Md(n,i),n!==2&&(i=Nr,Nr=a,i!==null&&zm(i)),n}function zm(n){Nr===null?Nr=n:Nr.push.apply(Nr,n)}function vS(n){for(var i=n;;){if(i.flags&16384){var a=i.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var f=0;f<a.length;f++){var _=a[f],x=_.getSnapshot;_=_.value;try{if(!Oi(x(),_))return!1}catch{return!1}}}if(a=i.child,i.subtreeFlags&16384&&a!==null)a.return=i,i=a;else{if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function ps(n,i){for(i&=~wg,i&=~Zd,n.suspendedLanes|=i,n.pingedLanes&=~i,n=n.expirationTimes;0<i;){var a=31-Bi(i),f=1<<a;n[a]=-1,i&=~f}}function cx(n){if(Ft&6)throw Error(ze(327));_l();var i=fd(n,0);if(!(i&1))return $r(n,Tn()),null;var a=Md(n,i);if(n.tag!==0&&a===2){var f=nm(n);f!==0&&(i=f,a=Pm(n,f))}if(a===1)throw a=pc,fa(n,0),ps(n,i),$r(n,Tn()),a;if(a===6)throw Error(ze(345));return n.finishedWork=n.current.alternate,n.finishedLanes=i,ua(n,Nr,To),$r(n,Tn()),null}function Sg(n,i){var a=Ft;Ft|=1;try{return n(i)}finally{Ft=a,Ft===0&&(kl=Tn()+500,jd&&Is())}}function va(n){ms!==null&&ms.tag===0&&!(Ft&6)&&_l();var i=Ft;Ft|=1;var a=yi.transition,f=qt;try{if(yi.transition=null,qt=1,n)return n()}finally{qt=f,yi.transition=a,Ft=i,!(Ft&6)&&Is()}}function Eg(){Qr=dl.current,an(dl)}function fa(n,i){n.finishedWork=null,n.finishedLanes=0;var a=n.timeoutHandle;if(a!==-1&&(n.timeoutHandle=-1,K2(a)),Dn!==null)for(a=Dn.return;a!==null;){var f=a;switch(ig(f),f.tag){case 1:f=f.type.childContextTypes,f!=null&&xd();break;case 3:El(),an(Vr),an(fr),pg();break;case 5:dg(f);break;case 4:El();break;case 13:an(pn);break;case 19:an(pn);break;case 10:lg(f.type._context);break;case 22:case 23:Eg()}a=a.return}if(Wn=n,Dn=n=Ss(n.current,null),er=Qr=i,On=0,pc=null,wg=Zd=xa=0,Nr=Xu=null,ha!==null){for(i=0;i<ha.length;i++)if(a=ha[i],f=a.interleaved,f!==null){a.interleaved=null;var _=f.next,x=a.pending;if(x!==null){var T=x.next;x.next=_,f.next=T}a.pending=f}ha=null}return n}function Pv(n,i){do{var a=Dn;try{if(ag(),Yh.current=Id,Cd){for(var f=fn.memoizedState;f!==null;){var _=f.queue;_!==null&&(_.pending=null),f=f.next}Cd=!1}if(_a=0,Zn=Fn=fn=null,Wu=!1,cc=0,vg.current=null,a===null||a.return===null){On=1,pc=i,Dn=null;break}e:{var x=n,T=a.return,u=a,N=i;if(i=er,u.flags|=32768,N!==null&&typeof N=="object"&&typeof N.then=="function"){var Z=N,ue=u,oe=ue.tag;if(!(ue.mode&1)&&(oe===0||oe===11||oe===15)){var G=ue.alternate;G?(ue.updateQueue=G.updateQueue,ue.memoizedState=G.memoizedState,ue.lanes=G.lanes):(ue.updateQueue=null,ue.memoizedState=null)}var Te=J_(T);if(Te!==null){Te.flags&=-257,Y_(Te,T,u,x,i),Te.mode&1&&K_(x,Z,i),i=Te,N=Z;var _e=i.updateQueue;if(_e===null){var be=new Set;be.add(N),i.updateQueue=be}else _e.add(N);break e}else{if(!(i&1)){K_(x,Z,i),Tg();break e}N=Error(ze(426))}}else if(hn&&u.mode&1){var bt=J_(T);if(bt!==null){!(bt.flags&65536)&&(bt.flags|=256),Y_(bt,T,u,x,i),og(Tl(N,u));break e}}x=N=Tl(N,u),On!==4&&(On=2),Xu===null?Xu=[x]:Xu.push(x),x=T;do{switch(x.tag){case 3:x.flags|=65536,i&=-i,x.lanes|=i;var se=pv(x,N,i);$_(x,se);break e;case 1:u=N;var Q=x.type,le=x.stateNode;if(!(x.flags&128)&&(typeof Q.getDerivedStateFromError=="function"||le!==null&&typeof le.componentDidCatch=="function"&&(ws===null||!ws.has(le)))){x.flags|=65536,i&=-i,x.lanes|=i;var Pe=fv(x,u,i);$_(x,Pe);break e}}x=x.return}while(x!==null)}Dv(a)}catch(Be){i=Be,Dn===a&&a!==null&&(Dn=a=a.return);continue}break}while(1)}function zv(){var n=Ad.current;return Ad.current=Id,n===null?Id:n}function Tg(){(On===0||On===3||On===2)&&(On=4),Wn===null||!(xa&268435455)&&!(Zd&268435455)||ps(Wn,er)}function Md(n,i){var a=Ft;Ft|=2;var f=zv();(Wn!==n||er!==i)&&(To=null,fa(n,i));do try{wS();break}catch(_){Pv(n,_)}while(1);if(ag(),Ft=a,Ad.current=f,Dn!==null)throw Error(ze(261));return Wn=null,er=0,On}function wS(){for(;Dn!==null;)Mv(Dn)}function bS(){for(;Dn!==null&&!Wb();)Mv(Dn)}function Mv(n){var i=Rv(n.alternate,n,Qr);n.memoizedProps=n.pendingProps,i===null?Dv(n):Dn=i,vg.current=null}function Dv(n){var i=n;do{var a=i.alternate;if(n=i.return,i.flags&32768){if(a=mS(a,i),a!==null){a.flags&=32767,Dn=a;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{On=6,Dn=null;return}}else if(a=fS(a,i,Qr),a!==null){Dn=a;return}if(i=i.sibling,i!==null){Dn=i;return}Dn=i=n}while(i!==null);On===0&&(On=5)}function ua(n,i,a){var f=qt,_=yi.transition;try{yi.transition=null,qt=1,SS(n,i,a,f)}finally{yi.transition=_,qt=f}return null}function SS(n,i,a,f){do _l();while(ms!==null);if(Ft&6)throw Error(ze(327));a=n.finishedWork;var _=n.finishedLanes;if(a===null)return null;if(n.finishedWork=null,n.finishedLanes=0,a===n.current)throw Error(ze(177));n.callbackNode=null,n.callbackPriority=0;var x=a.lanes|a.childLanes;if(r2(n,x),n===Wn&&(Dn=Wn=null,er=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||Gh||(Gh=!0,Bv(pd,function(){return _l(),null})),x=(a.flags&15990)!==0,a.subtreeFlags&15990||x){x=yi.transition,yi.transition=null;var T=qt;qt=1;var u=Ft;Ft|=4,vg.current=null,yS(n,a),Cv(a,n),$2(lm),md=!!am,lm=am=null,n.current=a,_S(a),Hb(),Ft=u,qt=T,yi.transition=x}else n.current=a;if(Gh&&(Gh=!1,ms=n,zd=_),x=n.pendingLanes,x===0&&(ws=null),Jb(a.stateNode),$r(n,Tn()),i!==null)for(f=n.onRecoverableError,a=0;a<i.length;a++)_=i[a],f(_.value,{componentStack:_.stack,digest:_.digest});if(Pd)throw Pd=!1,n=Im,Im=null,n;return zd&1&&n.tag!==0&&_l(),x=n.pendingLanes,x&1?n===Am?Ku++:(Ku=0,Am=n):Ku=0,Is(),null}function _l(){if(ms!==null){var n=d0(zd),i=yi.transition,a=qt;try{if(yi.transition=null,qt=16>n?16:n,ms===null)var f=!1;else{if(n=ms,ms=null,zd=0,Ft&6)throw Error(ze(331));var _=Ft;for(Ft|=4,nt=n.current;nt!==null;){var x=nt,T=x.child;if(nt.flags&16){var u=x.deletions;if(u!==null){for(var N=0;N<u.length;N++){var Z=u[N];for(nt=Z;nt!==null;){var ue=nt;switch(ue.tag){case 0:case 11:case 15:Hu(8,ue,x)}var oe=ue.child;if(oe!==null)oe.return=ue,nt=oe;else for(;nt!==null;){ue=nt;var G=ue.sibling,Te=ue.return;if(Ev(ue),ue===Z){nt=null;break}if(G!==null){G.return=Te,nt=G;break}nt=Te}}}var _e=x.alternate;if(_e!==null){var be=_e.child;if(be!==null){_e.child=null;do{var bt=be.sibling;be.sibling=null,be=bt}while(be!==null)}}nt=x}}if(x.subtreeFlags&2064&&T!==null)T.return=x,nt=T;else e:for(;nt!==null;){if(x=nt,x.flags&2048)switch(x.tag){case 0:case 11:case 15:Hu(9,x,x.return)}var se=x.sibling;if(se!==null){se.return=x.return,nt=se;break e}nt=x.return}}var Q=n.current;for(nt=Q;nt!==null;){T=nt;var le=T.child;if(T.subtreeFlags&2064&&le!==null)le.return=T,nt=le;else e:for(T=Q;nt!==null;){if(u=nt,u.flags&2048)try{switch(u.tag){case 0:case 11:case 15:qd(9,u)}}catch(Be){vn(u,u.return,Be)}if(u===T){nt=null;break e}var Pe=u.sibling;if(Pe!==null){Pe.return=u.return,nt=Pe;break e}nt=u.return}}if(Ft=_,Is(),io&&typeof io.onPostCommitFiberRoot=="function")try{io.onPostCommitFiberRoot(Fd,n)}catch{}f=!0}return f}finally{qt=a,yi.transition=i}}return!1}function hx(n,i,a){i=Tl(a,i),i=pv(n,i,1),n=vs(n,i,1),i=Ar(),n!==null&&(gc(n,1,i),$r(n,i))}function vn(n,i,a){if(n.tag===3)hx(n,n,a);else for(;i!==null;){if(i.tag===3){hx(i,n,a);break}else if(i.tag===1){var f=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(ws===null||!ws.has(f))){n=Tl(a,n),n=fv(i,n,1),i=vs(i,n,1),n=Ar(),i!==null&&(gc(i,1,n),$r(i,n));break}}i=i.return}}function ES(n,i,a){var f=n.pingCache;f!==null&&f.delete(i),i=Ar(),n.pingedLanes|=n.suspendedLanes&a,Wn===n&&(er&a)===a&&(On===4||On===3&&(er&130023424)===er&&500>Tn()-bg?fa(n,0):wg|=a),$r(n,i)}function Lv(n,i){i===0&&(n.mode&1?(i=Lh,Lh<<=1,!(Lh&130023424)&&(Lh=4194304)):i=1);var a=Ar();n=Do(n,i),n!==null&&(gc(n,i,a),$r(n,a))}function TS(n){var i=n.memoizedState,a=0;i!==null&&(a=i.retryLane),Lv(n,a)}function kS(n,i){var a=0;switch(n.tag){case 13:var f=n.stateNode,_=n.memoizedState;_!==null&&(a=_.retryLane);break;case 19:f=n.stateNode;break;default:throw Error(ze(314))}f!==null&&f.delete(i),Lv(n,a)}var Rv;Rv=function(n,i,a){if(n!==null)if(n.memoizedProps!==i.pendingProps||Vr.current)Ur=!0;else{if(!(n.lanes&a)&&!(i.flags&128))return Ur=!1,pS(n,i,a);Ur=!!(n.flags&131072)}else Ur=!1,hn&&i.flags&1048576&&O0(i,bd,i.index);switch(i.lanes=0,i.tag){case 2:var f=i.type;ed(n,i),n=i.pendingProps;var _=wl(i,fr.current);yl(i,a),_=mg(null,i,f,n,_,a);var x=gg();return i.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,jr(f)?(x=!0,vd(i)):x=!1,i.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,cg(i),_.updater=$d,i.stateNode=_,_._reactInternals=i,ym(i,f,n,a),i=vm(null,i,f,!0,x,a)):(i.tag=0,hn&&x&&rg(i),Ir(null,i,_,a),i=i.child),i;case 16:f=i.elementType;e:{switch(ed(n,i),n=i.pendingProps,_=f._init,f=_(f._payload),i.type=f,_=i.tag=IS(f),n=Di(f,n),_){case 0:i=xm(null,i,f,n,a);break e;case 1:i=tx(null,i,f,n,a);break e;case 11:i=Q_(null,i,f,n,a);break e;case 14:i=ex(null,i,f,Di(f.type,n),a);break e}throw Error(ze(306,f,""))}return i;case 0:return f=i.type,_=i.pendingProps,_=i.elementType===f?_:Di(f,_),xm(n,i,f,_,a);case 1:return f=i.type,_=i.pendingProps,_=i.elementType===f?_:Di(f,_),tx(n,i,f,_,a);case 3:e:{if(_v(i),n===null)throw Error(ze(387));f=i.pendingProps,x=i.memoizedState,_=x.element,j0(n,i),Td(i,f,null,a);var T=i.memoizedState;if(f=T.element,x.isDehydrated)if(x={element:f,isDehydrated:!1,cache:T.cache,pendingSuspenseBoundaries:T.pendingSuspenseBoundaries,transitions:T.transitions},i.updateQueue.baseState=x,i.memoizedState=x,i.flags&256){_=Tl(Error(ze(423)),i),i=nx(n,i,f,a,_);break e}else if(f!==_){_=Tl(Error(ze(424)),i),i=nx(n,i,f,a,_);break e}else for(ei=xs(i.stateNode.containerInfo.firstChild),ti=i,hn=!0,Ri=null,a=Z0(i,null,f,a),i.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(bl(),f===_){i=Lo(n,i,a);break e}Ir(n,i,f,a)}i=i.child}return i;case 5:return W0(i),n===null&&fm(i),f=i.type,_=i.pendingProps,x=n!==null?n.memoizedProps:null,T=_.children,um(f,_)?T=null:x!==null&&um(f,x)&&(i.flags|=32),yv(n,i),Ir(n,i,T,a),i.child;case 6:return n===null&&fm(i),null;case 13:return xv(n,i,a);case 4:return hg(i,i.stateNode.containerInfo),f=i.pendingProps,n===null?i.child=Sl(i,null,f,a):Ir(n,i,f,a),i.child;case 11:return f=i.type,_=i.pendingProps,_=i.elementType===f?_:Di(f,_),Q_(n,i,f,_,a);case 7:return Ir(n,i,i.pendingProps,a),i.child;case 8:return Ir(n,i,i.pendingProps.children,a),i.child;case 12:return Ir(n,i,i.pendingProps.children,a),i.child;case 10:e:{if(f=i.type._context,_=i.pendingProps,x=i.memoizedProps,T=_.value,on(Sd,f._currentValue),f._currentValue=T,x!==null)if(Oi(x.value,T)){if(x.children===_.children&&!Vr.current){i=Lo(n,i,a);break e}}else for(x=i.child,x!==null&&(x.return=i);x!==null;){var u=x.dependencies;if(u!==null){T=x.child;for(var N=u.firstContext;N!==null;){if(N.context===f){if(x.tag===1){N=Ao(-1,a&-a),N.tag=2;var Z=x.updateQueue;if(Z!==null){Z=Z.shared;var ue=Z.pending;ue===null?N.next=N:(N.next=ue.next,ue.next=N),Z.pending=N}}x.lanes|=a,N=x.alternate,N!==null&&(N.lanes|=a),mm(x.return,a,i),u.lanes|=a;break}N=N.next}}else if(x.tag===10)T=x.type===i.type?null:x.child;else if(x.tag===18){if(T=x.return,T===null)throw Error(ze(341));T.lanes|=a,u=T.alternate,u!==null&&(u.lanes|=a),mm(T,a,i),T=x.sibling}else T=x.child;if(T!==null)T.return=x;else for(T=x;T!==null;){if(T===i){T=null;break}if(x=T.sibling,x!==null){x.return=T.return,T=x;break}T=T.return}x=T}Ir(n,i,_.children,a),i=i.child}return i;case 9:return _=i.type,f=i.pendingProps.children,yl(i,a),_=_i(_),f=f(_),i.flags|=1,Ir(n,i,f,a),i.child;case 14:return f=i.type,_=Di(f,i.pendingProps),_=Di(f.type,_),ex(n,i,f,_,a);case 15:return mv(n,i,i.type,i.pendingProps,a);case 17:return f=i.type,_=i.pendingProps,_=i.elementType===f?_:Di(f,_),ed(n,i),i.tag=1,jr(f)?(n=!0,vd(i)):n=!1,yl(i,a),G0(i,f,_),ym(i,f,_,a),vm(null,i,f,!0,n,a);case 19:return vv(n,i,a);case 22:return gv(n,i,a)}throw Error(ze(156,i.tag))};function Bv(n,i){return l0(n,i)}function CS(n,i,a,f){this.tag=n,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gi(n,i,a,f){return new CS(n,i,a,f)}function kg(n){return n=n.prototype,!(!n||!n.isReactComponent)}function IS(n){if(typeof n=="function")return kg(n)?1:0;if(n!=null){if(n=n.$$typeof,n===qm)return 11;if(n===Zm)return 14}return 2}function Ss(n,i){var a=n.alternate;return a===null?(a=gi(n.tag,i,n.key,n.mode),a.elementType=n.elementType,a.type=n.type,a.stateNode=n.stateNode,a.alternate=n,n.alternate=a):(a.pendingProps=i,a.type=n.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=n.flags&14680064,a.childLanes=n.childLanes,a.lanes=n.lanes,a.child=n.child,a.memoizedProps=n.memoizedProps,a.memoizedState=n.memoizedState,a.updateQueue=n.updateQueue,i=n.dependencies,a.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},a.sibling=n.sibling,a.index=n.index,a.ref=n.ref,a}function rd(n,i,a,f,_,x){var T=2;if(f=n,typeof n=="function")kg(n)&&(T=1);else if(typeof n=="string")T=5;else e:switch(n){case nl:return ma(a.children,_,x,i);case Gm:T=8,_|=8;break;case Vf:return n=gi(12,a,i,_|2),n.elementType=Vf,n.lanes=x,n;case jf:return n=gi(13,a,i,_),n.elementType=jf,n.lanes=x,n;case $f:return n=gi(19,a,i,_),n.elementType=$f,n.lanes=x,n;case qx:return Wd(a,_,x,i);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case $x:T=10;break e;case Gx:T=9;break e;case qm:T=11;break e;case Zm:T=14;break e;case cs:T=16,f=null;break e}throw Error(ze(130,n==null?n:typeof n,""))}return i=gi(T,a,i,_),i.elementType=n,i.type=f,i.lanes=x,i}function ma(n,i,a,f){return n=gi(7,n,f,i),n.lanes=a,n}function Wd(n,i,a,f){return n=gi(22,n,f,i),n.elementType=qx,n.lanes=a,n.stateNode={isHidden:!1},n}function Mf(n,i,a){return n=gi(6,n,null,i),n.lanes=a,n}function Df(n,i,a){return i=gi(4,n.children!==null?n.children:[],n.key,i),i.lanes=a,i.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},i}function AS(n,i,a,f,_){this.tag=i,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=pf(0),this.expirationTimes=pf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=pf(0),this.identifierPrefix=f,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function Cg(n,i,a,f,_,x,T,u,N){return n=new AS(n,i,a,u,N),i===1?(i=1,x===!0&&(i|=8)):i=0,x=gi(3,null,null,i),n.current=x,x.stateNode=n,x.memoizedState={element:f,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},cg(x),n}function PS(n,i,a){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:tl,key:f==null?null:""+f,children:n,containerInfo:i,implementation:a}}function Fv(n){if(!n)return Ts;n=n._reactInternals;e:{if(Sa(n)!==n||n.tag!==1)throw Error(ze(170));var i=n;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(jr(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(ze(171))}if(n.tag===1){var a=n.type;if(jr(a))return B0(n,a,i)}return i}function Ov(n,i,a,f,_,x,T,u,N){return n=Cg(a,f,!0,n,_,x,T,u,N),n.context=Fv(null),a=n.current,f=Ar(),_=bs(a),x=Ao(f,_),x.callback=i??null,vs(a,x,_),n.current.lanes=_,gc(n,_,f),$r(n,f),n}function Hd(n,i,a,f){var _=i.current,x=Ar(),T=bs(_);return a=Fv(a),i.context===null?i.context=a:i.pendingContext=a,i=Ao(x,T),i.payload={element:n},f=f===void 0?null:f,f!==null&&(i.callback=f),n=vs(_,i,T),n!==null&&(Fi(n,_,T,x),Jh(n,_,T)),T}function Dd(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function dx(n,i){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var a=n.retryLane;n.retryLane=a!==0&&a<i?a:i}}function Ig(n,i){dx(n,i),(n=n.alternate)&&dx(n,i)}function zS(){return null}var Nv=typeof reportError=="function"?reportError:function(n){console.error(n)};function Ag(n){this._internalRoot=n}Xd.prototype.render=Ag.prototype.render=function(n){var i=this._internalRoot;if(i===null)throw Error(ze(409));Hd(n,i,null,null)};Xd.prototype.unmount=Ag.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var i=n.containerInfo;va(function(){Hd(null,n,null,null)}),i[Mo]=null}};function Xd(n){this._internalRoot=n}Xd.prototype.unstable_scheduleHydration=function(n){if(n){var i=m0();n={blockedOn:null,target:n,priority:i};for(var a=0;a<ds.length&&i!==0&&i<ds[a].priority;a++);ds.splice(a,0,n),a===0&&y0(n)}};function Pg(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Kd(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function px(){}function MS(n,i,a,f,_){if(_){if(typeof f=="function"){var x=f;f=function(){var Z=Dd(T);x.call(Z)}}var T=Ov(i,f,n,0,null,!1,!1,"",px);return n._reactRootContainer=T,n[Mo]=T.current,oc(n.nodeType===8?n.parentNode:n),va(),T}for(;_=n.lastChild;)n.removeChild(_);if(typeof f=="function"){var u=f;f=function(){var Z=Dd(N);u.call(Z)}}var N=Cg(n,0,!1,null,null,!1,!1,"",px);return n._reactRootContainer=N,n[Mo]=N.current,oc(n.nodeType===8?n.parentNode:n),va(function(){Hd(i,N,a,f)}),N}function Jd(n,i,a,f,_){var x=a._reactRootContainer;if(x){var T=x;if(typeof _=="function"){var u=_;_=function(){var N=Dd(T);u.call(N)}}Hd(i,T,n,_)}else T=MS(a,i,n,_,f);return Dd(T)}p0=function(n){switch(n.tag){case 3:var i=n.stateNode;if(i.current.memoizedState.isDehydrated){var a=Uu(i.pendingLanes);a!==0&&(Xm(i,a|1),$r(i,Tn()),!(Ft&6)&&(kl=Tn()+500,Is()))}break;case 13:va(function(){var f=Do(n,1);if(f!==null){var _=Ar();Fi(f,n,1,_)}}),Ig(n,1)}};Km=function(n){if(n.tag===13){var i=Do(n,134217728);if(i!==null){var a=Ar();Fi(i,n,134217728,a)}Ig(n,134217728)}};f0=function(n){if(n.tag===13){var i=bs(n),a=Do(n,i);if(a!==null){var f=Ar();Fi(a,n,i,f)}Ig(n,i)}};m0=function(){return qt};g0=function(n,i){var a=qt;try{return qt=n,i()}finally{qt=a}};Qf=function(n,i,a){switch(i){case"input":if(Zf(n,a),i=a.name,a.type==="radio"&&i!=null){for(a=n;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<a.length;i++){var f=a[i];if(f!==n&&f.form===n.form){var _=Vd(f);if(!_)throw Error(ze(90));Wx(f),Zf(f,_)}}}break;case"textarea":Xx(n,a);break;case"select":i=a.value,i!=null&&pl(n,!!a.multiple,i,!1)}};n0=Sg;r0=va;var DS={usingClientEntryPoint:!1,Events:[_c,sl,Vd,e0,t0,Sg]},Bu={findFiberByHostInstance:ca,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},LS={bundleType:Bu.bundleType,version:Bu.version,rendererPackageName:Bu.rendererPackageName,rendererConfig:Bu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ro.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=s0(n),n===null?null:n.stateNode},findFiberByHostInstance:Bu.findFiberByHostInstance||zS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var qh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!qh.isDisabled&&qh.supportsFiber)try{Fd=qh.inject(LS),io=qh}catch{}}ri.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=DS;ri.createPortal=function(n,i){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Pg(i))throw Error(ze(200));return PS(n,i,null,a)};ri.createRoot=function(n,i){if(!Pg(n))throw Error(ze(299));var a=!1,f="",_=Nv;return i!=null&&(i.unstable_strictMode===!0&&(a=!0),i.identifierPrefix!==void 0&&(f=i.identifierPrefix),i.onRecoverableError!==void 0&&(_=i.onRecoverableError)),i=Cg(n,1,!1,null,null,a,!1,f,_),n[Mo]=i.current,oc(n.nodeType===8?n.parentNode:n),new Ag(i)};ri.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var i=n._reactInternals;if(i===void 0)throw typeof n.render=="function"?Error(ze(188)):(n=Object.keys(n).join(","),Error(ze(268,n)));return n=s0(i),n=n===null?null:n.stateNode,n};ri.flushSync=function(n){return va(n)};ri.hydrate=function(n,i,a){if(!Kd(i))throw Error(ze(200));return Jd(null,n,i,!0,a)};ri.hydrateRoot=function(n,i,a){if(!Pg(n))throw Error(ze(405));var f=a!=null&&a.hydratedSources||null,_=!1,x="",T=Nv;if(a!=null&&(a.unstable_strictMode===!0&&(_=!0),a.identifierPrefix!==void 0&&(x=a.identifierPrefix),a.onRecoverableError!==void 0&&(T=a.onRecoverableError)),i=Ov(i,null,n,1,a??null,_,!1,x,T),n[Mo]=i.current,oc(n),f)for(n=0;n<f.length;n++)a=f[n],_=a._getVersion,_=_(a._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[a,_]:i.mutableSourceEagerHydrationData.push(a,_);return new Xd(i)};ri.render=function(n,i,a){if(!Kd(i))throw Error(ze(200));return Jd(null,n,i,!1,a)};ri.unmountComponentAtNode=function(n){if(!Kd(n))throw Error(ze(40));return n._reactRootContainer?(va(function(){Jd(null,null,n,!1,function(){n._reactRootContainer=null,n[Mo]=null})}),!0):!1};ri.unstable_batchedUpdates=Sg;ri.unstable_renderSubtreeIntoContainer=function(n,i,a,f){if(!Kd(a))throw Error(ze(200));if(n==null||n._reactInternals===void 0)throw Error(ze(38));return Jd(n,i,a,!1,f)};ri.version="18.2.0-next-9e3b772b8-20220608";(function(n){function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(a){console.error(a)}}i(),n.exports=ri})(zb);var fx=Of;Ff.createRoot=fx.createRoot,Ff.hydrateRoot=fx.hydrateRoot;var Ld={},RS={get exports(){return Ld},set exports(n){Ld=n}},xl=typeof Reflect=="object"?Reflect:null,mx=xl&&typeof xl.apply=="function"?xl.apply:function(i,a,f){return Function.prototype.apply.call(i,a,f)},id;xl&&typeof xl.ownKeys=="function"?id=xl.ownKeys:Object.getOwnPropertySymbols?id=function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:id=function(i){return Object.getOwnPropertyNames(i)};function BS(n){console&&console.warn&&console.warn(n)}var Uv=Number.isNaN||function(i){return i!==i};function Xt(){Xt.init.call(this)}RS.exports=Xt;Ld.once=US;Xt.EventEmitter=Xt;Xt.prototype._events=void 0;Xt.prototype._eventsCount=0;Xt.prototype._maxListeners=void 0;var gx=10;function Yd(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(Xt,"defaultMaxListeners",{enumerable:!0,get:function(){return gx},set:function(n){if(typeof n!="number"||n<0||Uv(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");gx=n}});Xt.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Xt.prototype.setMaxListeners=function(i){if(typeof i!="number"||i<0||Uv(i))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+i+".");return this._maxListeners=i,this};function Vv(n){return n._maxListeners===void 0?Xt.defaultMaxListeners:n._maxListeners}Xt.prototype.getMaxListeners=function(){return Vv(this)};Xt.prototype.emit=function(i){for(var a=[],f=1;f<arguments.length;f++)a.push(arguments[f]);var _=i==="error",x=this._events;if(x!==void 0)_=_&&x.error===void 0;else if(!_)return!1;if(_){var T;if(a.length>0&&(T=a[0]),T instanceof Error)throw T;var u=new Error("Unhandled error."+(T?" ("+T.message+")":""));throw u.context=T,u}var N=x[i];if(N===void 0)return!1;if(typeof N=="function")mx(N,this,a);else for(var Z=N.length,ue=Zv(N,Z),f=0;f<Z;++f)mx(ue[f],this,a);return!0};function jv(n,i,a,f){var _,x,T;if(Yd(a),x=n._events,x===void 0?(x=n._events=Object.create(null),n._eventsCount=0):(x.newListener!==void 0&&(n.emit("newListener",i,a.listener?a.listener:a),x=n._events),T=x[i]),T===void 0)T=x[i]=a,++n._eventsCount;else if(typeof T=="function"?T=x[i]=f?[a,T]:[T,a]:f?T.unshift(a):T.push(a),_=Vv(n),_>0&&T.length>_&&!T.warned){T.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+T.length+" "+String(i)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=n,u.type=i,u.count=T.length,BS(u)}return n}Xt.prototype.addListener=function(i,a){return jv(this,i,a,!1)};Xt.prototype.on=Xt.prototype.addListener;Xt.prototype.prependListener=function(i,a){return jv(this,i,a,!0)};function FS(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function $v(n,i,a){var f={fired:!1,wrapFn:void 0,target:n,type:i,listener:a},_=FS.bind(f);return _.listener=a,f.wrapFn=_,_}Xt.prototype.once=function(i,a){return Yd(a),this.on(i,$v(this,i,a)),this};Xt.prototype.prependOnceListener=function(i,a){return Yd(a),this.prependListener(i,$v(this,i,a)),this};Xt.prototype.removeListener=function(i,a){var f,_,x,T,u;if(Yd(a),_=this._events,_===void 0)return this;if(f=_[i],f===void 0)return this;if(f===a||f.listener===a)--this._eventsCount===0?this._events=Object.create(null):(delete _[i],_.removeListener&&this.emit("removeListener",i,f.listener||a));else if(typeof f!="function"){for(x=-1,T=f.length-1;T>=0;T--)if(f[T]===a||f[T].listener===a){u=f[T].listener,x=T;break}if(x<0)return this;x===0?f.shift():OS(f,x),f.length===1&&(_[i]=f[0]),_.removeListener!==void 0&&this.emit("removeListener",i,u||a)}return this};Xt.prototype.off=Xt.prototype.removeListener;Xt.prototype.removeAllListeners=function(i){var a,f,_;if(f=this._events,f===void 0)return this;if(f.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):f[i]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete f[i]),this;if(arguments.length===0){var x=Object.keys(f),T;for(_=0;_<x.length;++_)T=x[_],T!=="removeListener"&&this.removeAllListeners(T);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(a=f[i],typeof a=="function")this.removeListener(i,a);else if(a!==void 0)for(_=a.length-1;_>=0;_--)this.removeListener(i,a[_]);return this};function Gv(n,i,a){var f=n._events;if(f===void 0)return[];var _=f[i];return _===void 0?[]:typeof _=="function"?a?[_.listener||_]:[_]:a?NS(_):Zv(_,_.length)}Xt.prototype.listeners=function(i){return Gv(this,i,!0)};Xt.prototype.rawListeners=function(i){return Gv(this,i,!1)};Xt.listenerCount=function(n,i){return typeof n.listenerCount=="function"?n.listenerCount(i):qv.call(n,i)};Xt.prototype.listenerCount=qv;function qv(n){var i=this._events;if(i!==void 0){var a=i[n];if(typeof a=="function")return 1;if(a!==void 0)return a.length}return 0}Xt.prototype.eventNames=function(){return this._eventsCount>0?id(this._events):[]};function Zv(n,i){for(var a=new Array(i),f=0;f<i;++f)a[f]=n[f];return a}function OS(n,i){for(;i+1<n.length;i++)n[i]=n[i+1];n.pop()}function NS(n){for(var i=new Array(n.length),a=0;a<i.length;++a)i[a]=n[a].listener||n[a];return i}function US(n,i){return new Promise(function(a,f){function _(T){n.removeListener(i,x),f(T)}function x(){typeof n.removeListener=="function"&&n.removeListener("error",_),a([].slice.call(arguments))}Wv(n,i,x,{once:!0}),i!=="error"&&VS(n,_,{once:!0})})}function VS(n,i,a){typeof n.on=="function"&&Wv(n,"error",i,a)}function Wv(n,i,a,f){if(typeof n.on=="function")f.once?n.once(i,a):n.on(i,a);else if(typeof n.addEventListener=="function")n.addEventListener(i,function _(x){f.once&&n.removeEventListener(i,_),a(x)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}const Hv=new Ld,Xv="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAgCAYAAADud3N8AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAJoSURBVEhLtZdLiI1RHMAvKXmMGs+hPAqhJAsWSmlSVoqFssCKpOywsPNYCMVSZGVhYcdC3o+NYklIlFdolLzfafj9zj3n3q/p03z3zj2/+s3/nHPvfP/zndecqRVYhBfxB/6t6Fs8imOwZRbgZyx7cBWv43BsiTNY9rBWXIOVGBbjc5xZL9bu4l78Gmr/pweP4ORQq9UO4W7cirvwBh5Dn1fKG0w9XmFDRXZg+j3nVlwbx7EP+9FRnIYNyubhQ4xV+BhjkXu4DR257bgytq3CQMuT3wK/0Dd+jN14Htdj1qSyBJfhBjyHp3Bx7qRpcd7CTfgK9+VO+jBGF6eHzmnsLUs6KcYqTIxRfKtx9WIDk17FgzjVBkn71C2TGp34AzjYPvX7+9FFkniPG/FCqNWxM3fQz+zkTQwU92m7uh+v4Xech0UWosfsI+zp5Jy+xrXoG+2xocB9tN1t09fphfQFT6DJR9lQwNEI05lj9V5CEy4NtSau3tEWciR9gL7V/FBr4vBOsJAj6Tf8hI0tEnHOp1vIkVRMOrZebPAUZ1vIkdTF0oU/Q62J+9992p0jqYfFeHwSak1SfW6OpGHe4EWMiWcxzsqRNJ3H72JMeHP0JtHREykxMsaBc/oHPSK7ciT1EJBwEAzAfP05kr6McU6MCReYHen42SvuRw+CdaHWZHWMt/3hvnKSi3+m2vEkJrz3umi8C/fiFnRhXcHAYSx7SDtuRnEEvQf/xvSZ/3pMwfCW9sA/wDttaBOf423POVtuQ8Trywz0sPeiEPDLXkvsxWUbhoDXlBHotXNQvEIUh2gonsVBqNX+AagY3z+LGR5iAAAAAElFTkSuQmCC";function yx({highlight:n,gasStation:i}){const{name:a,price:f}=i.properties,[_,x]=i.geometry.coordinates;return pa("button",{onClick:()=>{Hv.emit("view-station-event",{lng:_,lat:x})},className:"btn btn-block btn-ghost text-base flex justify-end my-4 ",children:[cn("div",{className:n?"flex-1 text-left text-green-800":"flex-1 text-left overflow-clip",children:a.length>15?a.substring(0,15)+"...":a}),pa("div",{className:n?"flex-1 text-center text-green-800":"flex-1 text-center",children:[" ",f==-1?"dont know :(":f," "]}),cn("img",{className:" flex-1 self-end mb-4 h-6 w-6 object-contain",src:Xv})]})}var Or=63710088e-1,jS={centimeters:Or*100,centimetres:Or*100,degrees:Or/111325,feet:Or*3.28084,inches:Or*39.37,kilometers:Or/1e3,kilometres:Or/1e3,meters:Or,metres:Or,miles:Or/1609.344,millimeters:Or*1e3,millimetres:Or*1e3,nauticalmiles:Or/1852,radians:1,yards:Or*1.0936};function Kv(n,i,a){a===void 0&&(a={});var f={type:"Feature"};return(a.id===0||a.id)&&(f.id=a.id),a.bbox&&(f.bbox=a.bbox),f.properties=i||{},f.geometry=n,f}function $S(n,i,a){if(a===void 0&&(a={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!xx(n[0])||!xx(n[1]))throw new Error("coordinates must contain numbers");var f={type:"Point",coordinates:n};return Kv(f,i,a)}function GS(n,i,a){a===void 0&&(a={});for(var f=0,_=n;f<_.length;f++){var x=_[f];if(x.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var T=0;T<x[x.length-1].length;T++)if(x[x.length-1][T]!==x[0][T])throw new Error("First and last Position are not equivalent.")}var u={type:"Polygon",coordinates:n};return Kv(u,i,a)}function qS(n,i){i===void 0&&(i="kilometers");var a=jS[i];if(!a)throw new Error(i+" units is invalid");return n/a}function _x(n){var i=n%(2*Math.PI);return i*180/Math.PI}function Lf(n){var i=n%360;return i*Math.PI/180}function xx(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function ZS(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function WS(n,i,a,f){f===void 0&&(f={});var _=ZS(n),x=Lf(_[0]),T=Lf(_[1]),u=Lf(a),N=qS(i,f.units),Z=Math.asin(Math.sin(T)*Math.cos(N)+Math.cos(T)*Math.sin(N)*Math.cos(u)),ue=x+Math.atan2(Math.sin(u)*Math.sin(N)*Math.cos(T),Math.cos(N)-Math.sin(T)*Math.sin(Z)),oe=_x(ue),G=_x(Z);return $S([oe,G],f.properties)}function HS(n,i,a){a===void 0&&(a={});for(var f=a.steps||64,_=a.properties?a.properties:!Array.isArray(n)&&n.type==="Feature"&&n.properties?n.properties:{},x=[],T=0;T<f;T++)x.push(WS(n,i,T*-360/f,a).geometry.coordinates);return x.push(x[0]),GS([x],_)}const XS=n=>{const i=JSON.parse(JSON.stringify(n)),a=i.features;let f=Number.MAX_VALUE,_=[];for(let u=0;u<a.length;u++){const N=parseFloat(a[u].properties.price);N!=-1&&(N<f?(f=N,_=[u]):N===f&&_.push(u))}let x=[];for(let u=0;u<_.length;u++)x.push(a.splice(_[u]-u,1)[0]);return{bestGasStations:{type:"FeatureCollection",features:x},otherGasStations:i}},KS=n=>{n.features.sort((i,a)=>i.properties.price==-1?1:a.properties.price==-1?-1:i.properties.price-a.properties.price)},JS=(n,i,a,f)=>{const T=HS([i,a],f,{steps:64,units:"miles"}),u=n.getSource("circle-location");u?u.setData(T):n.addLayer({id:"circle-location",type:"fill",source:{type:"geojson",data:T},paint:{"fill-color":"#8CCFFF","fill-opacity":.2}})},vx=(n,i,a=!1)=>{n.hasImage("gas-station-icon")==!1&&n.loadImage(Xv,(_,x)=>{n.addImage("gas-station-icon",x)});const f=n.getSource(a?"best-gas-stations-source":"gas-stations-source");f!=null?f.setData(i):(n.addSource(a?"best-gas-stations-source":"gas-stations-source",{type:"geojson",data:i}),n.addLayer({id:a?"best-gas-stations-layer":"gas-stations-layer",type:"symbol",source:a?"best-gas-stations-source":"gas-stations-source",layout:{"icon-image":"gas-station-icon","icon-size":a?.7:.5,"text-field":["format",["get","price"],{"text-color":a?"green":"#EB5B5B","font-scale":a?1.3:1.1}," ",["get","name"]],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-offset":[0,1.25],"text-anchor":"top"}}))};function Jv(n,i){return function(){return n.apply(i,arguments)}}const{toString:Yv}=Object.prototype,{getPrototypeOf:zg}=Object,Mg=(n=>i=>{const a=Yv.call(i);return n[a]||(n[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),Bo=n=>(n=n.toLowerCase(),i=>Mg(i)===n),Qd=n=>i=>typeof i===n,{isArray:zl}=Array,fc=Qd("undefined");function YS(n){return n!==null&&!fc(n)&&n.constructor!==null&&!fc(n.constructor)&&wa(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const Qv=Bo("ArrayBuffer");function QS(n){let i;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?i=ArrayBuffer.isView(n):i=n&&n.buffer&&Qv(n.buffer),i}const eE=Qd("string"),wa=Qd("function"),e1=Qd("number"),Dg=n=>n!==null&&typeof n=="object",tE=n=>n===!0||n===!1,od=n=>{if(Mg(n)!=="object")return!1;const i=zg(n);return(i===null||i===Object.prototype||Object.getPrototypeOf(i)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},nE=Bo("Date"),rE=Bo("File"),iE=Bo("Blob"),oE=Bo("FileList"),sE=n=>Dg(n)&&wa(n.pipe),aE=n=>{const i="[object FormData]";return n&&(typeof FormData=="function"&&n instanceof FormData||Yv.call(n)===i||wa(n.toString)&&n.toString()===i)},lE=Bo("URLSearchParams"),uE=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function vc(n,i,{allOwnKeys:a=!1}={}){if(n===null||typeof n>"u")return;let f,_;if(typeof n!="object"&&(n=[n]),zl(n))for(f=0,_=n.length;f<_;f++)i.call(null,n[f],f,n);else{const x=a?Object.getOwnPropertyNames(n):Object.keys(n),T=x.length;let u;for(f=0;f<T;f++)u=x[f],i.call(null,n[u],u,n)}}function t1(n,i){i=i.toLowerCase();const a=Object.keys(n);let f=a.length,_;for(;f-- >0;)if(_=a[f],i===_.toLowerCase())return _;return null}const n1=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),r1=n=>!fc(n)&&n!==n1;function Mm(){const{caseless:n}=r1(this)&&this||{},i={},a=(f,_)=>{const x=n&&t1(i,_)||_;od(i[x])&&od(f)?i[x]=Mm(i[x],f):od(f)?i[x]=Mm({},f):zl(f)?i[x]=f.slice():i[x]=f};for(let f=0,_=arguments.length;f<_;f++)arguments[f]&&vc(arguments[f],a);return i}const cE=(n,i,a,{allOwnKeys:f}={})=>(vc(i,(_,x)=>{a&&wa(_)?n[x]=Jv(_,a):n[x]=_},{allOwnKeys:f}),n),hE=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),dE=(n,i,a,f)=>{n.prototype=Object.create(i.prototype,f),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:i.prototype}),a&&Object.assign(n.prototype,a)},pE=(n,i,a,f)=>{let _,x,T;const u={};if(i=i||{},n==null)return i;do{for(_=Object.getOwnPropertyNames(n),x=_.length;x-- >0;)T=_[x],(!f||f(T,n,i))&&!u[T]&&(i[T]=n[T],u[T]=!0);n=a!==!1&&zg(n)}while(n&&(!a||a(n,i))&&n!==Object.prototype);return i},fE=(n,i,a)=>{n=String(n),(a===void 0||a>n.length)&&(a=n.length),a-=i.length;const f=n.indexOf(i,a);return f!==-1&&f===a},mE=n=>{if(!n)return null;if(zl(n))return n;let i=n.length;if(!e1(i))return null;const a=new Array(i);for(;i-- >0;)a[i]=n[i];return a},gE=(n=>i=>n&&i instanceof n)(typeof Uint8Array<"u"&&zg(Uint8Array)),yE=(n,i)=>{const f=(n&&n[Symbol.iterator]).call(n);let _;for(;(_=f.next())&&!_.done;){const x=_.value;i.call(n,x[0],x[1])}},_E=(n,i)=>{let a;const f=[];for(;(a=n.exec(i))!==null;)f.push(a);return f},xE=Bo("HTMLFormElement"),vE=n=>n.toLowerCase().replace(/[_-\s]([a-z\d])(\w*)/g,function(a,f,_){return f.toUpperCase()+_}),wx=(({hasOwnProperty:n})=>(i,a)=>n.call(i,a))(Object.prototype),wE=Bo("RegExp"),i1=(n,i)=>{const a=Object.getOwnPropertyDescriptors(n),f={};vc(a,(_,x)=>{i(_,x,n)!==!1&&(f[x]=_)}),Object.defineProperties(n,f)},bE=n=>{i1(n,(i,a)=>{if(wa(n)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const f=n[a];if(wa(f)){if(i.enumerable=!1,"writable"in i){i.writable=!1;return}i.set||(i.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},SE=(n,i)=>{const a={},f=_=>{_.forEach(x=>{a[x]=!0})};return zl(n)?f(n):f(String(n).split(i)),a},EE=()=>{},TE=(n,i)=>(n=+n,Number.isFinite(n)?n:i),kE=n=>{const i=new Array(10),a=(f,_)=>{if(Dg(f)){if(i.indexOf(f)>=0)return;if(!("toJSON"in f)){i[_]=f;const x=zl(f)?[]:{};return vc(f,(T,u)=>{const N=a(T,_+1);!fc(N)&&(x[u]=N)}),i[_]=void 0,x}}return f};return a(n,0)},ke={isArray:zl,isArrayBuffer:Qv,isBuffer:YS,isFormData:aE,isArrayBufferView:QS,isString:eE,isNumber:e1,isBoolean:tE,isObject:Dg,isPlainObject:od,isUndefined:fc,isDate:nE,isFile:rE,isBlob:iE,isRegExp:wE,isFunction:wa,isStream:sE,isURLSearchParams:lE,isTypedArray:gE,isFileList:oE,forEach:vc,merge:Mm,extend:cE,trim:uE,stripBOM:hE,inherits:dE,toFlatObject:pE,kindOf:Mg,kindOfTest:Bo,endsWith:fE,toArray:mE,forEachEntry:yE,matchAll:_E,isHTMLForm:xE,hasOwnProperty:wx,hasOwnProp:wx,reduceDescriptors:i1,freezeMethods:bE,toObjectSet:SE,toCamelCase:vE,noop:EE,toFiniteNumber:TE,findKey:t1,global:n1,isContextDefined:r1,toJSONObject:kE};function Bt(n,i,a,f,_){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",i&&(this.code=i),a&&(this.config=a),f&&(this.request=f),_&&(this.response=_)}ke.inherits(Bt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ke.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const o1=Bt.prototype,s1={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{s1[n]={value:n}});Object.defineProperties(Bt,s1);Object.defineProperty(o1,"isAxiosError",{value:!0});Bt.from=(n,i,a,f,_,x)=>{const T=Object.create(o1);return ke.toFlatObject(n,T,function(N){return N!==Error.prototype},u=>u!=="isAxiosError"),Bt.call(T,n.message,i,a,f,_),T.cause=n,T.name=n.name,x&&Object.assign(T,x),T};var CE=typeof self=="object"?self.FormData:window.FormData;const IE=CE;function Dm(n){return ke.isPlainObject(n)||ke.isArray(n)}function a1(n){return ke.endsWith(n,"[]")?n.slice(0,-2):n}function bx(n,i,a){return n?n.concat(i).map(function(_,x){return _=a1(_),!a&&x?"["+_+"]":_}).join(a?".":""):i}function AE(n){return ke.isArray(n)&&!n.some(Dm)}const PE=ke.toFlatObject(ke,{},null,function(i){return/^is[A-Z]/.test(i)});function zE(n){return n&&ke.isFunction(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator]}function ep(n,i,a){if(!ke.isObject(n))throw new TypeError("target must be an object");i=i||new(IE||FormData),a=ke.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(be,bt){return!ke.isUndefined(bt[be])});const f=a.metaTokens,_=a.visitor||ue,x=a.dots,T=a.indexes,N=(a.Blob||typeof Blob<"u"&&Blob)&&zE(i);if(!ke.isFunction(_))throw new TypeError("visitor must be a function");function Z(_e){if(_e===null)return"";if(ke.isDate(_e))return _e.toISOString();if(!N&&ke.isBlob(_e))throw new Bt("Blob is not supported. Use a Buffer instead.");return ke.isArrayBuffer(_e)||ke.isTypedArray(_e)?N&&typeof Blob=="function"?new Blob([_e]):Buffer.from(_e):_e}function ue(_e,be,bt){let se=_e;if(_e&&!bt&&typeof _e=="object"){if(ke.endsWith(be,"{}"))be=f?be:be.slice(0,-2),_e=JSON.stringify(_e);else if(ke.isArray(_e)&&AE(_e)||ke.isFileList(_e)||ke.endsWith(be,"[]")&&(se=ke.toArray(_e)))return be=a1(be),se.forEach(function(le,Pe){!(ke.isUndefined(le)||le===null)&&i.append(T===!0?bx([be],Pe,x):T===null?be:be+"[]",Z(le))}),!1}return Dm(_e)?!0:(i.append(bx(bt,be,x),Z(_e)),!1)}const oe=[],G=Object.assign(PE,{defaultVisitor:ue,convertValue:Z,isVisitable:Dm});function Te(_e,be){if(!ke.isUndefined(_e)){if(oe.indexOf(_e)!==-1)throw Error("Circular reference detected in "+be.join("."));oe.push(_e),ke.forEach(_e,function(se,Q){(!(ke.isUndefined(se)||se===null)&&_.call(i,se,ke.isString(Q)?Q.trim():Q,be,G))===!0&&Te(se,be?be.concat(Q):[Q])}),oe.pop()}}if(!ke.isObject(n))throw new TypeError("data must be an object");return Te(n),i}function Sx(n){const i={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(f){return i[f]})}function Lg(n,i){this._pairs=[],n&&ep(n,this,i)}const l1=Lg.prototype;l1.append=function(i,a){this._pairs.push([i,a])};l1.toString=function(i){const a=i?function(f){return i.call(this,f,Sx)}:Sx;return this._pairs.map(function(_){return a(_[0])+"="+a(_[1])},"").join("&")};function ME(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function u1(n,i,a){if(!i)return n;const f=a&&a.encode||ME,_=a&&a.serialize;let x;if(_?x=_(i,a):x=ke.isURLSearchParams(i)?i.toString():new Lg(i,a).toString(f),x){const T=n.indexOf("#");T!==-1&&(n=n.slice(0,T)),n+=(n.indexOf("?")===-1?"?":"&")+x}return n}class DE{constructor(){this.handlers=[]}use(i,a,f){return this.handlers.push({fulfilled:i,rejected:a,synchronous:f?f.synchronous:!1,runWhen:f?f.runWhen:null}),this.handlers.length-1}eject(i){this.handlers[i]&&(this.handlers[i]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(i){ke.forEach(this.handlers,function(f){f!==null&&i(f)})}}const Ex=DE,c1={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},LE=typeof URLSearchParams<"u"?URLSearchParams:Lg,RE=FormData,BE=(()=>{let n;return typeof navigator<"u"&&((n=navigator.product)==="ReactNative"||n==="NativeScript"||n==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),FE=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),ro={isBrowser:!0,classes:{URLSearchParams:LE,FormData:RE,Blob},isStandardBrowserEnv:BE,isStandardBrowserWebWorkerEnv:FE,protocols:["http","https","file","blob","url","data"]};function OE(n,i){return ep(n,new ro.classes.URLSearchParams,Object.assign({visitor:function(a,f,_,x){return ro.isNode&&ke.isBuffer(a)?(this.append(f,a.toString("base64")),!1):x.defaultVisitor.apply(this,arguments)}},i))}function NE(n){return ke.matchAll(/\w+|\[(\w*)]/g,n).map(i=>i[0]==="[]"?"":i[1]||i[0])}function UE(n){const i={},a=Object.keys(n);let f;const _=a.length;let x;for(f=0;f<_;f++)x=a[f],i[x]=n[x];return i}function h1(n){function i(a,f,_,x){let T=a[x++];const u=Number.isFinite(+T),N=x>=a.length;return T=!T&&ke.isArray(_)?_.length:T,N?(ke.hasOwnProp(_,T)?_[T]=[_[T],f]:_[T]=f,!u):((!_[T]||!ke.isObject(_[T]))&&(_[T]=[]),i(a,f,_[T],x)&&ke.isArray(_[T])&&(_[T]=UE(_[T])),!u)}if(ke.isFormData(n)&&ke.isFunction(n.entries)){const a={};return ke.forEachEntry(n,(f,_)=>{i(NE(f),_,a,0)}),a}return null}const VE={"Content-Type":void 0};function jE(n,i,a){if(ke.isString(n))try{return(i||JSON.parse)(n),ke.trim(n)}catch(f){if(f.name!=="SyntaxError")throw f}return(a||JSON.stringify)(n)}const tp={transitional:c1,adapter:["xhr","http"],transformRequest:[function(i,a){const f=a.getContentType()||"",_=f.indexOf("application/json")>-1,x=ke.isObject(i);if(x&&ke.isHTMLForm(i)&&(i=new FormData(i)),ke.isFormData(i))return _&&_?JSON.stringify(h1(i)):i;if(ke.isArrayBuffer(i)||ke.isBuffer(i)||ke.isStream(i)||ke.isFile(i)||ke.isBlob(i))return i;if(ke.isArrayBufferView(i))return i.buffer;if(ke.isURLSearchParams(i))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),i.toString();let u;if(x){if(f.indexOf("application/x-www-form-urlencoded")>-1)return OE(i,this.formSerializer).toString();if((u=ke.isFileList(i))||f.indexOf("multipart/form-data")>-1){const N=this.env&&this.env.FormData;return ep(u?{"files[]":i}:i,N&&new N,this.formSerializer)}}return x||_?(a.setContentType("application/json",!1),jE(i)):i}],transformResponse:[function(i){const a=this.transitional||tp.transitional,f=a&&a.forcedJSONParsing,_=this.responseType==="json";if(i&&ke.isString(i)&&(f&&!this.responseType||_)){const T=!(a&&a.silentJSONParsing)&&_;try{return JSON.parse(i)}catch(u){if(T)throw u.name==="SyntaxError"?Bt.from(u,Bt.ERR_BAD_RESPONSE,this,null,this.response):u}}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ro.classes.FormData,Blob:ro.classes.Blob},validateStatus:function(i){return i>=200&&i<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};ke.forEach(["delete","get","head"],function(i){tp.headers[i]={}});ke.forEach(["post","put","patch"],function(i){tp.headers[i]=ke.merge(VE)});const Rg=tp,$E=ke.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),GE=n=>{const i={};let a,f,_;return n&&n.split(`
`).forEach(function(T){_=T.indexOf(":"),a=T.substring(0,_).trim().toLowerCase(),f=T.substring(_+1).trim(),!(!a||i[a]&&$E[a])&&(a==="set-cookie"?i[a]?i[a].push(f):i[a]=[f]:i[a]=i[a]?i[a]+", "+f:f)}),i},Tx=Symbol("internals");function Fu(n){return n&&String(n).trim().toLowerCase()}function sd(n){return n===!1||n==null?n:ke.isArray(n)?n.map(sd):String(n)}function qE(n){const i=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let f;for(;f=a.exec(n);)i[f[1]]=f[2];return i}function ZE(n){return/^[-_a-zA-Z]+$/.test(n.trim())}function kx(n,i,a,f){if(ke.isFunction(f))return f.call(this,i,a);if(ke.isString(i)){if(ke.isString(f))return i.indexOf(f)!==-1;if(ke.isRegExp(f))return f.test(i)}}function WE(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(i,a,f)=>a.toUpperCase()+f)}function HE(n,i){const a=ke.toCamelCase(" "+i);["get","set","has"].forEach(f=>{Object.defineProperty(n,f+a,{value:function(_,x,T){return this[f].call(this,i,_,x,T)},configurable:!0})})}class np{constructor(i){i&&this.set(i)}set(i,a,f){const _=this;function x(u,N,Z){const ue=Fu(N);if(!ue)throw new Error("header name must be a non-empty string");const oe=ke.findKey(_,ue);(!oe||_[oe]===void 0||Z===!0||Z===void 0&&_[oe]!==!1)&&(_[oe||N]=sd(u))}const T=(u,N)=>ke.forEach(u,(Z,ue)=>x(Z,ue,N));return ke.isPlainObject(i)||i instanceof this.constructor?T(i,a):ke.isString(i)&&(i=i.trim())&&!ZE(i)?T(GE(i),a):i!=null&&x(a,i,f),this}get(i,a){if(i=Fu(i),i){const f=ke.findKey(this,i);if(f){const _=this[f];if(!a)return _;if(a===!0)return qE(_);if(ke.isFunction(a))return a.call(this,_,f);if(ke.isRegExp(a))return a.exec(_);throw new TypeError("parser must be boolean|regexp|function")}}}has(i,a){if(i=Fu(i),i){const f=ke.findKey(this,i);return!!(f&&(!a||kx(this,this[f],f,a)))}return!1}delete(i,a){const f=this;let _=!1;function x(T){if(T=Fu(T),T){const u=ke.findKey(f,T);u&&(!a||kx(f,f[u],u,a))&&(delete f[u],_=!0)}}return ke.isArray(i)?i.forEach(x):x(i),_}clear(){return Object.keys(this).forEach(this.delete.bind(this))}normalize(i){const a=this,f={};return ke.forEach(this,(_,x)=>{const T=ke.findKey(f,x);if(T){a[T]=sd(_),delete a[x];return}const u=i?WE(x):String(x).trim();u!==x&&delete a[x],a[u]=sd(_),f[u]=!0}),this}concat(...i){return this.constructor.concat(this,...i)}toJSON(i){const a=Object.create(null);return ke.forEach(this,(f,_)=>{f!=null&&f!==!1&&(a[_]=i&&ke.isArray(f)?f.join(", "):f)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([i,a])=>i+": "+a).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(i){return i instanceof this?i:new this(i)}static concat(i,...a){const f=new this(i);return a.forEach(_=>f.set(_)),f}static accessor(i){const f=(this[Tx]=this[Tx]={accessors:{}}).accessors,_=this.prototype;function x(T){const u=Fu(T);f[u]||(HE(_,T),f[u]=!0)}return ke.isArray(i)?i.forEach(x):x(i),this}}np.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent"]);ke.freezeMethods(np.prototype);ke.freezeMethods(np);const Po=np;function Rf(n,i){const a=this||Rg,f=i||a,_=Po.from(f.headers);let x=f.data;return ke.forEach(n,function(u){x=u.call(a,x,_.normalize(),i?i.status:void 0)}),_.normalize(),x}function d1(n){return!!(n&&n.__CANCEL__)}function wc(n,i,a){Bt.call(this,n??"canceled",Bt.ERR_CANCELED,i,a),this.name="CanceledError"}ke.inherits(wc,Bt,{__CANCEL__:!0});const XE=null;function KE(n,i,a){const f=a.config.validateStatus;!a.status||!f||f(a.status)?n(a):i(new Bt("Request failed with status code "+a.status,[Bt.ERR_BAD_REQUEST,Bt.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}const JE=ro.isStandardBrowserEnv?function(){return{write:function(a,f,_,x,T,u){const N=[];N.push(a+"="+encodeURIComponent(f)),ke.isNumber(_)&&N.push("expires="+new Date(_).toGMTString()),ke.isString(x)&&N.push("path="+x),ke.isString(T)&&N.push("domain="+T),u===!0&&N.push("secure"),document.cookie=N.join("; ")},read:function(a){const f=document.cookie.match(new RegExp("(^|;\\s*)("+a+")=([^;]*)"));return f?decodeURIComponent(f[3]):null},remove:function(a){this.write(a,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function YE(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function QE(n,i){return i?n.replace(/\/+$/,"")+"/"+i.replace(/^\/+/,""):n}function p1(n,i){return n&&!YE(i)?QE(n,i):i}const eT=ro.isStandardBrowserEnv?function(){const i=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a");let f;function _(x){let T=x;return i&&(a.setAttribute("href",T),T=a.href),a.setAttribute("href",T),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:a.pathname.charAt(0)==="/"?a.pathname:"/"+a.pathname}}return f=_(window.location.href),function(T){const u=ke.isString(T)?_(T):T;return u.protocol===f.protocol&&u.host===f.host}}():function(){return function(){return!0}}();function tT(n){const i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return i&&i[1]||""}function nT(n,i){n=n||10;const a=new Array(n),f=new Array(n);let _=0,x=0,T;return i=i!==void 0?i:1e3,function(N){const Z=Date.now(),ue=f[x];T||(T=Z),a[_]=N,f[_]=Z;let oe=x,G=0;for(;oe!==_;)G+=a[oe++],oe=oe%n;if(_=(_+1)%n,_===x&&(x=(x+1)%n),Z-T<i)return;const Te=ue&&Z-ue;return Te?Math.round(G*1e3/Te):void 0}}function Cx(n,i){let a=0;const f=nT(50,250);return _=>{const x=_.loaded,T=_.lengthComputable?_.total:void 0,u=x-a,N=f(u),Z=x<=T;a=x;const ue={loaded:x,total:T,progress:T?x/T:void 0,bytes:u,rate:N||void 0,estimated:N&&T&&Z?(T-x)/N:void 0,event:_};ue[i?"download":"upload"]=!0,n(ue)}}const rT=typeof XMLHttpRequest<"u",iT=rT&&function(n){return new Promise(function(a,f){let _=n.data;const x=Po.from(n.headers).normalize(),T=n.responseType;let u;function N(){n.cancelToken&&n.cancelToken.unsubscribe(u),n.signal&&n.signal.removeEventListener("abort",u)}ke.isFormData(_)&&(ro.isStandardBrowserEnv||ro.isStandardBrowserWebWorkerEnv)&&x.setContentType(!1);let Z=new XMLHttpRequest;if(n.auth){const Te=n.auth.username||"",_e=n.auth.password?unescape(encodeURIComponent(n.auth.password)):"";x.set("Authorization","Basic "+btoa(Te+":"+_e))}const ue=p1(n.baseURL,n.url);Z.open(n.method.toUpperCase(),u1(ue,n.params,n.paramsSerializer),!0),Z.timeout=n.timeout;function oe(){if(!Z)return;const Te=Po.from("getAllResponseHeaders"in Z&&Z.getAllResponseHeaders()),be={data:!T||T==="text"||T==="json"?Z.responseText:Z.response,status:Z.status,statusText:Z.statusText,headers:Te,config:n,request:Z};KE(function(se){a(se),N()},function(se){f(se),N()},be),Z=null}if("onloadend"in Z?Z.onloadend=oe:Z.onreadystatechange=function(){!Z||Z.readyState!==4||Z.status===0&&!(Z.responseURL&&Z.responseURL.indexOf("file:")===0)||setTimeout(oe)},Z.onabort=function(){Z&&(f(new Bt("Request aborted",Bt.ECONNABORTED,n,Z)),Z=null)},Z.onerror=function(){f(new Bt("Network Error",Bt.ERR_NETWORK,n,Z)),Z=null},Z.ontimeout=function(){let _e=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const be=n.transitional||c1;n.timeoutErrorMessage&&(_e=n.timeoutErrorMessage),f(new Bt(_e,be.clarifyTimeoutError?Bt.ETIMEDOUT:Bt.ECONNABORTED,n,Z)),Z=null},ro.isStandardBrowserEnv){const Te=(n.withCredentials||eT(ue))&&n.xsrfCookieName&&JE.read(n.xsrfCookieName);Te&&x.set(n.xsrfHeaderName,Te)}_===void 0&&x.setContentType(null),"setRequestHeader"in Z&&ke.forEach(x.toJSON(),function(_e,be){Z.setRequestHeader(be,_e)}),ke.isUndefined(n.withCredentials)||(Z.withCredentials=!!n.withCredentials),T&&T!=="json"&&(Z.responseType=n.responseType),typeof n.onDownloadProgress=="function"&&Z.addEventListener("progress",Cx(n.onDownloadProgress,!0)),typeof n.onUploadProgress=="function"&&Z.upload&&Z.upload.addEventListener("progress",Cx(n.onUploadProgress)),(n.cancelToken||n.signal)&&(u=Te=>{Z&&(f(!Te||Te.type?new wc(null,n,Z):Te),Z.abort(),Z=null)},n.cancelToken&&n.cancelToken.subscribe(u),n.signal&&(n.signal.aborted?u():n.signal.addEventListener("abort",u)));const G=tT(ue);if(G&&ro.protocols.indexOf(G)===-1){f(new Bt("Unsupported protocol "+G+":",Bt.ERR_BAD_REQUEST,n));return}Z.send(_||null)})},ad={http:XE,xhr:iT};ke.forEach(ad,(n,i)=>{if(n){try{Object.defineProperty(n,"name",{value:i})}catch{}Object.defineProperty(n,"adapterName",{value:i})}});const oT={getAdapter:n=>{n=ke.isArray(n)?n:[n];const{length:i}=n;let a,f;for(let _=0;_<i&&(a=n[_],!(f=ke.isString(a)?ad[a.toLowerCase()]:a));_++);if(!f)throw f===!1?new Bt(`Adapter ${a} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(ke.hasOwnProp(ad,a)?`Adapter '${a}' is not available in the build`:`Unknown adapter '${a}'`);if(!ke.isFunction(f))throw new TypeError("adapter is not a function");return f},adapters:ad};function Bf(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new wc(null,n)}function Ix(n){return Bf(n),n.headers=Po.from(n.headers),n.data=Rf.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),oT.getAdapter(n.adapter||Rg.adapter)(n).then(function(f){return Bf(n),f.data=Rf.call(n,n.transformResponse,f),f.headers=Po.from(f.headers),f},function(f){return d1(f)||(Bf(n),f&&f.response&&(f.response.data=Rf.call(n,n.transformResponse,f.response),f.response.headers=Po.from(f.response.headers))),Promise.reject(f)})}const Ax=n=>n instanceof Po?n.toJSON():n;function Cl(n,i){i=i||{};const a={};function f(Z,ue,oe){return ke.isPlainObject(Z)&&ke.isPlainObject(ue)?ke.merge.call({caseless:oe},Z,ue):ke.isPlainObject(ue)?ke.merge({},ue):ke.isArray(ue)?ue.slice():ue}function _(Z,ue,oe){if(ke.isUndefined(ue)){if(!ke.isUndefined(Z))return f(void 0,Z,oe)}else return f(Z,ue,oe)}function x(Z,ue){if(!ke.isUndefined(ue))return f(void 0,ue)}function T(Z,ue){if(ke.isUndefined(ue)){if(!ke.isUndefined(Z))return f(void 0,Z)}else return f(void 0,ue)}function u(Z,ue,oe){if(oe in i)return f(Z,ue);if(oe in n)return f(void 0,Z)}const N={url:x,method:x,data:x,baseURL:T,transformRequest:T,transformResponse:T,paramsSerializer:T,timeout:T,timeoutMessage:T,withCredentials:T,adapter:T,responseType:T,xsrfCookieName:T,xsrfHeaderName:T,onUploadProgress:T,onDownloadProgress:T,decompress:T,maxContentLength:T,maxBodyLength:T,beforeRedirect:T,transport:T,httpAgent:T,httpsAgent:T,cancelToken:T,socketPath:T,responseEncoding:T,validateStatus:u,headers:(Z,ue)=>_(Ax(Z),Ax(ue),!0)};return ke.forEach(Object.keys(n).concat(Object.keys(i)),function(ue){const oe=N[ue]||_,G=oe(n[ue],i[ue],ue);ke.isUndefined(G)&&oe!==u||(a[ue]=G)}),a}const f1="1.2.3",Bg={};["object","boolean","number","function","string","symbol"].forEach((n,i)=>{Bg[n]=function(f){return typeof f===n||"a"+(i<1?"n ":" ")+n}});const Px={};Bg.transitional=function(i,a,f){function _(x,T){return"[Axios v"+f1+"] Transitional option '"+x+"'"+T+(f?". "+f:"")}return(x,T,u)=>{if(i===!1)throw new Bt(_(T," has been removed"+(a?" in "+a:"")),Bt.ERR_DEPRECATED);return a&&!Px[T]&&(Px[T]=!0,console.warn(_(T," has been deprecated since v"+a+" and will be removed in the near future"))),i?i(x,T,u):!0}};function sT(n,i,a){if(typeof n!="object")throw new Bt("options must be an object",Bt.ERR_BAD_OPTION_VALUE);const f=Object.keys(n);let _=f.length;for(;_-- >0;){const x=f[_],T=i[x];if(T){const u=n[x],N=u===void 0||T(u,x,n);if(N!==!0)throw new Bt("option "+x+" must be "+N,Bt.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new Bt("Unknown option "+x,Bt.ERR_BAD_OPTION)}}const Lm={assertOptions:sT,validators:Bg},us=Lm.validators;class Rd{constructor(i){this.defaults=i,this.interceptors={request:new Ex,response:new Ex}}request(i,a){typeof i=="string"?(a=a||{},a.url=i):a=i||{},a=Cl(this.defaults,a);const{transitional:f,paramsSerializer:_,headers:x}=a;f!==void 0&&Lm.assertOptions(f,{silentJSONParsing:us.transitional(us.boolean),forcedJSONParsing:us.transitional(us.boolean),clarifyTimeoutError:us.transitional(us.boolean)},!1),_!==void 0&&Lm.assertOptions(_,{encode:us.function,serialize:us.function},!0),a.method=(a.method||this.defaults.method||"get").toLowerCase();let T;T=x&&ke.merge(x.common,x[a.method]),T&&ke.forEach(["delete","get","head","post","put","patch","common"],_e=>{delete x[_e]}),a.headers=Po.concat(T,x);const u=[];let N=!0;this.interceptors.request.forEach(function(be){typeof be.runWhen=="function"&&be.runWhen(a)===!1||(N=N&&be.synchronous,u.unshift(be.fulfilled,be.rejected))});const Z=[];this.interceptors.response.forEach(function(be){Z.push(be.fulfilled,be.rejected)});let ue,oe=0,G;if(!N){const _e=[Ix.bind(this),void 0];for(_e.unshift.apply(_e,u),_e.push.apply(_e,Z),G=_e.length,ue=Promise.resolve(a);oe<G;)ue=ue.then(_e[oe++],_e[oe++]);return ue}G=u.length;let Te=a;for(oe=0;oe<G;){const _e=u[oe++],be=u[oe++];try{Te=_e(Te)}catch(bt){be.call(this,bt);break}}try{ue=Ix.call(this,Te)}catch(_e){return Promise.reject(_e)}for(oe=0,G=Z.length;oe<G;)ue=ue.then(Z[oe++],Z[oe++]);return ue}getUri(i){i=Cl(this.defaults,i);const a=p1(i.baseURL,i.url);return u1(a,i.params,i.paramsSerializer)}}ke.forEach(["delete","get","head","options"],function(i){Rd.prototype[i]=function(a,f){return this.request(Cl(f||{},{method:i,url:a,data:(f||{}).data}))}});ke.forEach(["post","put","patch"],function(i){function a(f){return function(x,T,u){return this.request(Cl(u||{},{method:i,headers:f?{"Content-Type":"multipart/form-data"}:{},url:x,data:T}))}}Rd.prototype[i]=a(),Rd.prototype[i+"Form"]=a(!0)});const ld=Rd;class Fg{constructor(i){if(typeof i!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(x){a=x});const f=this;this.promise.then(_=>{if(!f._listeners)return;let x=f._listeners.length;for(;x-- >0;)f._listeners[x](_);f._listeners=null}),this.promise.then=_=>{let x;const T=new Promise(u=>{f.subscribe(u),x=u}).then(_);return T.cancel=function(){f.unsubscribe(x)},T},i(function(x,T,u){f.reason||(f.reason=new wc(x,T,u),a(f.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(i){if(this.reason){i(this.reason);return}this._listeners?this._listeners.push(i):this._listeners=[i]}unsubscribe(i){if(!this._listeners)return;const a=this._listeners.indexOf(i);a!==-1&&this._listeners.splice(a,1)}static source(){let i;return{token:new Fg(function(_){i=_}),cancel:i}}}const aT=Fg;function lT(n){return function(a){return n.apply(null,a)}}function uT(n){return ke.isObject(n)&&n.isAxiosError===!0}const Rm={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Rm).forEach(([n,i])=>{Rm[i]=n});const cT=Rm;function m1(n){const i=new ld(n),a=Jv(ld.prototype.request,i);return ke.extend(a,ld.prototype,i,{allOwnKeys:!0}),ke.extend(a,i,null,{allOwnKeys:!0}),a.create=function(_){return m1(Cl(n,_))},a}const Nn=m1(Rg);Nn.Axios=ld;Nn.CanceledError=wc;Nn.CancelToken=aT;Nn.isCancel=d1;Nn.VERSION=f1;Nn.toFormData=ep;Nn.AxiosError=Bt;Nn.Cancel=Nn.CanceledError;Nn.all=function(i){return Promise.all(i)};Nn.spread=lT;Nn.isAxiosError=uT;Nn.mergeConfig=Cl;Nn.AxiosHeaders=Po;Nn.formToJSON=n=>h1(ke.isHTMLForm(n)?new FormData(n):n);Nn.HttpStatusCode=cT;Nn.default=Nn;const hT=Nn;const dT=async(n,i,a)=>{const _="https://150.230.170.110:5000/";try{return(await hT.get(_,{params:{lng:n,lat:i,rad:a}})).data}catch(x){console.error(x)}};var Bm={},pT={get exports(){return Bm},set exports(n){Bm=n}};(function(n,i){(function(a,f){n.exports=f()})(ob,function(){var a,f,_;function x(u,N){if(!a)a=N;else if(!f)f=N;else{var Z="var sharedChunk = {}; ("+a+")(sharedChunk); ("+f+")(sharedChunk);",ue={};a(ue),_=N(ue),typeof window<"u"&&(_.workerUrl=window.URL.createObjectURL(new Blob([Z],{type:"text/javascript"})))}}x(["exports"],function(u){var N=Z;function Z(r,e,o,l){this.cx=3*r,this.bx=3*(o-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(l-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=o,this.p2y=l}function ue(r,e,o,l){const d=new N(r,e,o,l);return function(m){return d.solve(m)}}Z.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var o=r,l=0;l<8;l++){var d=this.sampleCurveX(o)-r;if(Math.abs(d)<e)return o;var m=this.sampleCurveDerivativeX(o);if(Math.abs(m)<1e-6)break;o-=d/m}var y=0,w=1;for(o=r,l=0;l<20&&(d=this.sampleCurveX(o),!(Math.abs(d-r)<e));l++)r>d?y=o:w=o,o=.5*(w-y)+y;return o},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};const oe=ue(.25,.1,.25,1);function G(r,e,o){return Math.min(o,Math.max(e,r))}function Te(r,e,o){const l=o-e,d=((r-e)%l+l)%l+e;return d===e?o:d}function _e(r,...e){for(const o of e)for(const l in o)r[l]=o[l];return r}let be=1;function bt(r,e){r.forEach(o=>{e[o]&&(e[o]=e[o].bind(e))})}function se(r,e,o){const l={};for(const d in r)l[d]=e.call(o||this,r[d],d,r);return l}function Q(r,e,o){const l={};for(const d in r)e.call(o||this,r[d],d,r)&&(l[d]=r[d]);return l}function le(r){return Array.isArray(r)?r.map(le):typeof r=="object"&&r?se(r,le):r}const Pe={};function Be(r){Pe[r]||(typeof console<"u"&&console.warn(r),Pe[r]=!0)}function Ke(r,e,o){return(o.y-r.y)*(e.x-r.x)>(e.y-r.y)*(o.x-r.x)}function Qe(r){let e=0;for(let o,l,d=0,m=r.length,y=m-1;d<m;y=d++)o=r[d],l=r[y],e+=(l.x-o.x)*(o.y+l.y);return e}function et(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Zt(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,l,d,m)=>{const y=d||m;return e[l]=!y||y.toLowerCase(),""}),e["max-age"]){const o=parseInt(e["max-age"],10);isNaN(o)?delete e["max-age"]:e["max-age"]=o}return e}let mt,wn,Hn=null;function Mr(r){if(Hn==null){const e=r.navigator?r.navigator.userAgent:null;Hn=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Hn}function Gr(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const oi={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const o=window.document.createElement("canvas"),l=o.getContext("2d");if(!l)throw new Error("failed to create canvas 2d context");return o.width=r.width,o.height=r.height,l.drawImage(r,0,0,r.width,r.height),l.getImageData(-e,-e,r.width+2*e,r.height+2*e)},resolveURL:r=>(mt||(mt=document.createElement("a")),mt.href=r,mt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(wn==null&&(wn=matchMedia("(prefers-reduced-motion: reduce)")),wn.matches)}};var at=mr;function mr(r,e){this.x=r,this.y=e}mr.prototype={clone:function(){return new mr(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,o=r.y-this.y;return e*e+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),o=Math.sin(r),l=o*this.x+e*this.y;return this.x=e*this.x-o*this.y,this.y=l,this},_rotateAround:function(r,e){var o=Math.cos(r),l=Math.sin(r),d=e.y+l*(this.x-e.x)+o*(this.y-e.y);return this.x=e.x+o*(this.x-e.x)-l*(this.y-e.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},mr.convert=function(r){return r instanceof mr?r:Array.isArray(r)?new mr(r[0],r[1]):r};const Ze={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},lt="mapbox-tiles";let ct,Ut,Kt=500,qr=50;function nr(){typeof caches>"u"||ct||(ct=caches.open(lt))}let rr=1/0;const Un={supported:!1,testSupport:function(r){!ir&&Ni&&(Fo?As(r):gr=r)}};let gr,Ni,ir=!1,Fo=!1;function As(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,Ni),r.isContextLost())return;Un.supported=!0}catch{}r.deleteTexture(e),ir=!0}typeof document<"u"&&(Ni=document.createElement("img"),Ni.onload=function(){gr&&As(gr),gr=null,Fo=!0},Ni.onerror=function(){ir=!0,gr=null},Ni.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const vi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(vi);class yr extends Error{constructor(e,o,l,d){super(`AJAXError: ${o} (${e}): ${l}`),this.status=e,this.statusText=o,this.url=l,this.body=d}}const Ps=et()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function Ui(r,e){const o=new AbortController,l=new Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:Ps(),signal:o.signal});let d=!1,m=!1;return r.type==="json"&&l.headers.set("Accept","application/json"),((y,w,b)=>{if(m)return;const k=Date.now();fetch(l).then(A=>A.ok?((z,L,B)=>{(r.type==="arrayBuffer"?z.arrayBuffer():r.type==="json"?z.json():z.text()).then(F=>{m||(L&&B&&function(X,H,ae){if(nr(),!ct)return;const fe={status:H.status,statusText:H.statusText,headers:new Headers};H.headers.forEach((de,Ee)=>fe.headers.set(Ee,de));const ie=Zt(H.headers.get("Cache-Control")||"");ie["no-store"]||(ie["max-age"]&&fe.headers.set("Expires",new Date(ae+1e3*ie["max-age"]).toUTCString()),new Date(fe.headers.get("Expires")).getTime()-ae<42e4||function(de,Ee){if(Ut===void 0)try{new Response(new ReadableStream),Ut=!0}catch{Ut=!1}Ut?Ee(de.body):de.blob().then(Ee)}(H,de=>{const Ee=new Response(de,fe);nr(),ct&&ct.then(Se=>Se.put(function(qe){const Xe=qe.indexOf("?");return Xe<0?qe:qe.slice(0,Xe)}(X.url),Ee)).catch(Se=>Be(Se.message))}))}(l,L,B),d=!0,e(null,F,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(F=>{m||e(new Error(F.message))})})(A,null,k):A.blob().then(z=>e(new yr(A.status,A.statusText,r.url,z)))).catch(A=>{A.code!==20&&e(new Error(A.message))})})(),{cancel:()=>{m=!0,d||o.abort()}}}const Oo=function(r,e){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){if(et()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e);if(!et()){const l=r.url.substring(0,r.url.indexOf("://"));return(Ze.REGISTERED_PROTOCOLS[l]||Ui)(r,e)}}if(!(/^file:/.test(o=r.url)||/^file:/.test(Ps())&&!/^\w+:/.test(o))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Ui(r,e);if(et()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var o;return function(l,d){const m=new XMLHttpRequest;m.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const y in l.headers)m.setRequestHeader(y,l.headers[y]);return l.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=l.credentials==="include",m.onerror=()=>{d(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let y=m.response;if(l.type==="json")try{y=JSON.parse(m.response)}catch(w){return d(w)}d(null,y,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else{const y=new Blob([m.response],{type:m.getResponseHeader("Content-Type")});d(new yr(m.status,m.statusText,l.url,y))}},m.send(l.body),{cancel:()=>m.abort()}}(r,e)},No=function(r,e){return Oo(_e(r,{type:"arrayBuffer"}),e)};function zs(r){const e=window.document.createElement("a");return e.href=r,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}const Tt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let si,Vi;si=[],Vi=0;const ji=function(r,e){if(Un.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),Vi>=Ze.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return si.push(m),m}Vi++;let o=!1;const l=()=>{if(!o)for(o=!0,Vi--;si.length&&Vi<Ze.MAX_PARALLEL_IMAGE_REQUESTS;){const m=si.shift(),{requestParameters:y,callback:w,cancelled:b}=m;b||(m.cancel=ji(y,w).cancel)}},d=No(r,(m,y,w,b)=>{l(),m?e(m):y&&function(k,A){typeof createImageBitmap=="function"?function(z,L){const B=new Blob([new Uint8Array(z)],{type:"image/png"});createImageBitmap(B).then(F=>{L(null,F)}).catch(F=>{L(new Error(`Could not load image because of ${F.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(k,A):function(z,L){const B=new Image;B.onload=()=>{L(null,B),URL.revokeObjectURL(B.src),B.onload=null,window.requestAnimationFrame(()=>{B.src=Tt})},B.onerror=()=>L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const F=new Blob([new Uint8Array(z)],{type:"image/png"});B.src=z.byteLength?URL.createObjectURL(F):Tt}(k,A)}(y,(k,A)=>{k!=null?e(k):A!=null&&e(null,A,{cacheControl:w,expires:b})})});return{cancel:()=>{d.cancel(),l()}}};function Ms(r,e,o){o[r]&&o[r].indexOf(e)!==-1||(o[r]=o[r]||[],o[r].push(e))}function wi(r,e,o){if(o&&o[r]){const l=o[r].indexOf(e);l!==-1&&o[r].splice(l,1)}}class bi{constructor(e,o={}){_e(this,o),this.type=e}}class Uo extends bi{constructor(e,o={}){super("error",_e({error:e},o))}}class Si{on(e,o){return this._listeners=this._listeners||{},Ms(e,o,this._listeners),this}off(e,o){return wi(e,o,this._listeners),wi(e,o,this._oneTimeListeners),this}once(e,o){return this._oneTimeListeners=this._oneTimeListeners||{},Ms(e,o,this._oneTimeListeners),this}fire(e,o){typeof e=="string"&&(e=new bi(e,o||{}));const l=e.type;if(this.listens(l)){e.target=this;const d=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const w of d)w.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const w of m)wi(l,w,this._oneTimeListeners),w.call(this,e);const y=this._eventedParent;y&&(_e(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof Uo&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,o){return this._eventedParent=e,this._eventedParentData=o,this}}var we={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Fe{constructor(e,o,l,d){this.message=(e?`${e}: `:"")+l,d&&(this.identifier=d),o!=null&&o.__line__&&(this.line=o.__line__)}}function so(r){const e=r.value;return e?[new Fe(r.key,e,"constants have been deprecated as of v8")]:[]}function Zr(r,...e){for(const o of e)for(const l in o)r[l]=o[l];return r}function kt(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Dr(r){if(Array.isArray(r))return r.map(Dr);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const o in r)e[o]=Dr(r[o]);return e}return kt(r)}class _r extends Error{constructor(e,o){super(o),this.message=o,this.key=e}}class xr{constructor(e,o=[]){this.parent=e,this.bindings={};for(const[l,d]of o)this.bindings[l]=d}concat(e){return new xr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const $i={kind:"null"},De={kind:"number"},gt={kind:"string"},pt={kind:"boolean"},Ln={kind:"color"},Gi={kind:"object"},dt={kind:"value"},Ei={kind:"collator"},kn={kind:"formatted"},Vo={kind:"padding"},gn={kind:"resolvedImage"};function Xn(r,e){return{kind:"array",itemType:r,N:e}}function Ot(r){if(r.kind==="array"){const e=Ot(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const jo=[$i,De,gt,pt,Ln,kn,Gi,Xn(dt),Vo,gn];function ai(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ai(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const o of jo)if(!ai(o,e))return null}}return`Expected ${Ot(r)} but found ${Ot(e)} instead.`}function ao(r,e){return e.some(o=>o.kind===r.kind)}function lo(r,e){return e.some(o=>o==="null"?r===null:o==="array"?Array.isArray(r):o==="object"?r&&!Array.isArray(r)&&typeof r=="object":o===typeof r)}var $o,uo={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function V(r){return(r=Math.round(r))<0?0:r>255?255:r}function I(r){return V(r[r.length-1]==="%"?parseFloat(r)/100*255:parseInt(r))}function M(r){return(e=r[r.length-1]==="%"?parseFloat(r)/100:parseFloat(r))<0?0:e>1?1:e;var e}function O(r,e,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?r+(e-r)*o*6:2*o<1?e:3*o<2?r+(e-r)*(2/3-o)*6:r}try{$o={}.parseCSSColor=function(r){var e,o=r.replace(/ /g,"").toLowerCase();if(o in uo)return uo[o].slice();if(o[0]==="#")return o.length===4?(e=parseInt(o.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:o.length===7&&(e=parseInt(o.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=o.indexOf("("),d=o.indexOf(")");if(l!==-1&&d+1===o.length){var m=o.substr(0,l),y=o.substr(l+1,d-(l+1)).split(","),w=1;switch(m){case"rgba":if(y.length!==4)return null;w=M(y.pop());case"rgb":return y.length!==3?null:[I(y[0]),I(y[1]),I(y[2]),w];case"hsla":if(y.length!==4)return null;w=M(y.pop());case"hsl":if(y.length!==3)return null;var b=(parseFloat(y[0])%360+360)%360/360,k=M(y[1]),A=M(y[2]),z=A<=.5?A*(k+1):A+k-A*k,L=2*A-z;return[V(255*O(L,z,b+1/3)),V(255*O(L,z,b)),V(255*O(L,z,b-1/3)),w];default:return null}}return null}}catch{}class U{constructor(e,o,l,d=1){this.r=e,this.g=o,this.b=l,this.a=d}static parse(e){if(!e)return;if(e instanceof U)return e;if(typeof e!="string")return;const o=$o(e);return o?new U(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[e,o,l,d]=this.toArray();return`rgba(${Math.round(e)},${Math.round(o)},${Math.round(l)},${d})`}toArray(){const{r:e,g:o,b:l,a:d}=this;return d===0?[0,0,0,0]:[255*e/d,255*o/d,255*l/d,d]}}U.black=new U(0,0,0,1),U.white=new U(1,1,1,1),U.transparent=new U(0,0,0,0),U.red=new U(1,0,0,1);class K{constructor(e,o,l){this.sensitivity=e?o?"variant":"case":o?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,o){return this.collator.compare(e,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class te{constructor(e,o,l,d,m){this.text=e,this.image=o,this.scale=l,this.fontStack=d,this.textColor=m}}class Y{constructor(e){this.sections=e}static fromString(e){return new Y([new te(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Y?e:Y.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class J{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof J)return e;if(typeof e=="number")return new J([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const o of e)if(typeof o!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new J(e)}}toString(){return JSON.stringify(this.values)}}class ne{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ne({name:e,available:!1}):null}}function ge(r,e,o,l){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof o=="number"&&o>=0&&o<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[r,e,o,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[r,e,o,l]:[r,e,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ce(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof U||r instanceof K||r instanceof Y||r instanceof J||r instanceof ne)return!0;if(Array.isArray(r)){for(const e of r)if(!Ce(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Ce(r[e]))return!1;return!0}return!1}function me(r){if(r===null)return $i;if(typeof r=="string")return gt;if(typeof r=="boolean")return pt;if(typeof r=="number")return De;if(r instanceof U)return Ln;if(r instanceof K)return Ei;if(r instanceof Y)return kn;if(r instanceof J)return Vo;if(r instanceof ne)return gn;if(Array.isArray(r)){const e=r.length;let o;for(const l of r){const d=me(l);if(o){if(o===d)continue;o=dt;break}o=d}return Xn(o||dt,e)}return Gi}function He(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof U||r instanceof Y||r instanceof J||r instanceof ne?r.toString():JSON.stringify(r)}class Je{constructor(e,o){this.type=e,this.value=o}static parse(e,o){if(e.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ce(e[1]))return o.error("invalid value");const l=e[1];let d=me(l);const m=o.expectedType;return d.kind!=="array"||d.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(d=m),new Je(d,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class je{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const ot={string:gt,number:De,boolean:pt,object:Gi};class ut{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");let l,d=1;const m=e[0];if(m==="array"){let w,b;if(e.length>2){const k=e[1];if(typeof k!="string"||!(k in ot)||k==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);w=ot[k],d++}else w=dt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return o.error('The length argument to "array" must be a positive integer literal',2);b=e[2],d++}l=Xn(w,b)}else{if(!ot[m])throw new Error(`Types doesn't contain name = ${m}`);l=ot[m]}const y=[];for(;d<e.length;d++){const w=o.parse(e[d],d,dt);if(!w)return null;y.push(w)}return new ut(l,y)}evaluate(e){for(let o=0;o<this.args.length;o++){const l=this.args[o].evaluate(e);if(!ai(this.type,me(l)))return l;if(o===this.args.length-1)throw new je(`Expected value to be of type ${Ot(this.type)}, but found ${Ot(me(l))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ct={"to-boolean":pt,"to-color":Ln,"to-number":De,"to-string":gt};class ht{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");const l=e[0];if(!Ct[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&e.length!==2)return o.error("Expected one argument.");const d=Ct[l],m=[];for(let y=1;y<e.length;y++){const w=o.parse(e[y],y,dt);if(!w)return null;m.push(w)}return new ht(d,m)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let o,l;for(const d of this.args){if(o=d.evaluate(e),l=null,o instanceof U)return o;if(typeof o=="string"){const m=e.parseColor(o);if(m)return m}else if(Array.isArray(o)&&(l=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:ge(o[0],o[1],o[2],o[3]),!l))return new U(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new je(l||`Could not parse color from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}if(this.type.kind==="padding"){let o;for(const l of this.args){o=l.evaluate(e);const d=J.parse(o);if(d)return d}throw new je(`Could not parse padding from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}if(this.type.kind==="number"){let o=null;for(const l of this.args){if(o=l.evaluate(e),o===null)return 0;const d=Number(o);if(!isNaN(d))return d}throw new je(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?Y.fromString(He(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ne.fromString(He(this.args[0].evaluate(e))):He(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const yt=["Unknown","Point","LineString","Polygon"];class It{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?yt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let o=this._parseColorCache[e];return o||(o=this._parseColorCache[e]=U.parse(e)),o}}class Vt{constructor(e,o,l,d){this.name=e,this.type=o,this._evaluate=l,this.args=d}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,o){const l=e[0],d=Vt.definitions[l];if(!d)return o.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(d)?d[0]:d.type,y=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,w=y.filter(([k])=>!Array.isArray(k)||k.length===e.length-1);let b=null;for(const[k,A]of w){b=new Zo(o.registry,o.path,null,o.scope);const z=[];let L=!1;for(let B=1;B<e.length;B++){const F=e[B],X=Array.isArray(k)?k[B-1]:k.type,H=b.parse(F,1+z.length,X);if(!H){L=!0;break}z.push(H)}if(!L)if(Array.isArray(k)&&k.length!==z.length)b.error(`Expected ${k.length} arguments, but found ${z.length} instead.`);else{for(let B=0;B<z.length;B++){const F=Array.isArray(k)?k[B]:k.type,X=z[B];b.concat(B+1).checkSubtype(F,X.type)}if(b.errors.length===0)return new Vt(l,m,A,z)}}if(w.length===1)o.errors.push(...b.errors);else{const k=(w.length?w:y).map(([z])=>{return L=z,Array.isArray(L)?`(${L.map(Ot).join(", ")})`:`(${Ot(L.type)}...)`;var L}).join(" | "),A=[];for(let z=1;z<e.length;z++){const L=o.parse(e[z],1+A.length);if(!L)return null;A.push(Ot(L.type))}o.error(`Expected arguments of type ${k}, but found (${A.join(", ")}) instead.`)}return null}static register(e,o){Vt.definitions=o;for(const l in o)e[l]=Vt}}class Cn{constructor(e,o,l){this.type=Ei,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=o}static parse(e,o){if(e.length!==2)return o.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return o.error("Collator options argument must be an object.");const d=o.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,pt);if(!d)return null;const m=o.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,pt);if(!m)return null;let y=null;return l.locale&&(y=o.parse(l.locale,1,gt),!y)?null:new Cn(d,m,y)}evaluate(e){return new K(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Jt=8192;function Vn(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Go(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function Ds(r,e){const o=(180+r[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(o*d*Jt),Math.round(l*d*Jt)]}function jt(r,e,o){const l=r[0]-e[0],d=r[1]-e[1],m=r[0]-o[0],y=r[1]-o[1];return l*y-m*d==0&&l*m<=0&&d*y<=0}function Ml(r,e){let o=!1;for(let y=0,w=e.length;y<w;y++){const b=e[y];for(let k=0,A=b.length;k<A-1;k++){if(jt(r,b[k],b[k+1]))return!1;(d=b[k])[1]>(l=r)[1]!=(m=b[k+1])[1]>l[1]&&l[0]<(m[0]-d[0])*(l[1]-d[1])/(m[1]-d[1])+d[0]&&(o=!o)}}var l,d,m;return o}function Dl(r,e){for(let o=0;o<e.length;o++)if(Ml(r,e[o]))return!0;return!1}function bc(r,e,o,l){const d=l[0]-o[0],m=l[1]-o[1],y=(r[0]-o[0])*m-d*(r[1]-o[1]),w=(e[0]-o[0])*m-d*(e[1]-o[1]);return y>0&&w<0||y<0&&w>0}function Sc(r,e,o){for(const k of o)for(let A=0;A<k.length-1;++A)if((w=[(y=k[A+1])[0]-(m=k[A])[0],y[1]-m[1]])[0]*(b=[(d=e)[0]-(l=r)[0],d[1]-l[1]])[1]-w[1]*b[0]!=0&&bc(l,d,m,y)&&bc(m,y,l,d))return!0;var l,d,m,y,w,b;return!1}function Ll(r,e){for(let o=0;o<r.length;++o)if(!Ml(r[o],e))return!1;for(let o=0;o<r.length-1;++o)if(Sc(r[o],r[o+1],e))return!1;return!0}function rp(r,e){for(let o=0;o<e.length;o++)if(Ll(r,e[o]))return!0;return!1}function Ea(r,e,o){const l=[];for(let d=0;d<r.length;d++){const m=[];for(let y=0;y<r[d].length;y++){const w=Ds(r[d][y],o);Vn(e,w),m.push(w)}l.push(m)}return l}function Rl(r,e,o){const l=[];for(let d=0;d<r.length;d++){const m=Ea(r[d],e,o);l.push(m)}return l}function Ec(r,e,o,l){if(r[0]<o[0]||r[0]>o[2]){const d=.5*l;let m=r[0]-o[0]>d?-l:o[0]-r[0]>d?l:0;m===0&&(m=r[0]-o[2]>d?-l:o[2]-r[0]>d?l:0),r[0]+=m}Vn(e,r)}function Tc(r,e,o,l){const d=Math.pow(2,l.z)*Jt,m=[l.x*Jt,l.y*Jt],y=[];for(const w of r)for(const b of w){const k=[b.x+m[0],b.y+m[1]];Ec(k,e,o,d),y.push(k)}return y}function kc(r,e,o,l){const d=Math.pow(2,l.z)*Jt,m=[l.x*Jt,l.y*Jt],y=[];for(const b of r){const k=[];for(const A of b){const z=[A.x+m[0],A.y+m[1]];Vn(e,z),k.push(z)}y.push(k)}if(e[2]-e[0]<=d/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const b of y)for(const k of b)Ec(k,e,o,d)}var w;return y}class co{constructor(e,o){this.type=pt,this.geojson=e,this.geometries=o}static parse(e,o){if(e.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ce(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let d=0;d<l.features.length;++d){const m=l.features[d].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new co(l,l.features[d].geometry)}else if(l.type==="Feature"){const d=l.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new co(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new co(l,l)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(o,l){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(l.type==="Polygon"){const w=Ea(l.coordinates,m,y),b=Tc(o.geometry(),d,m,y);if(!Go(d,m))return!1;for(const k of b)if(!Ml(k,w))return!1}if(l.type==="MultiPolygon"){const w=Rl(l.coordinates,m,y),b=Tc(o.geometry(),d,m,y);if(!Go(d,m))return!1;for(const k of b)if(!Dl(k,w))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(o,l){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(l.type==="Polygon"){const w=Ea(l.coordinates,m,y),b=kc(o.geometry(),d,m,y);if(!Go(d,m))return!1;for(const k of b)if(!Ll(k,w))return!1}if(l.type==="MultiPolygon"){const w=Rl(l.coordinates,m,y),b=kc(o.geometry(),d,m,y);if(!Go(d,m))return!1;for(const k of b)if(!rp(k,w))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function Ls(r){if(r instanceof Vt&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof co)return!1;let e=!0;return r.eachChild(o=>{e&&!Ls(o)&&(e=!1)}),e}function qo(r){if(r instanceof Vt&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(o=>{e&&!qo(o)&&(e=!1)}),e}function Ta(r,e){if(r instanceof Vt&&e.indexOf(r.name)>=0)return!1;let o=!0;return r.eachChild(l=>{o&&!Ta(l,e)&&(o=!1)}),o}class ka{constructor(e,o){this.type=o.type,this.name=e,this.boundExpression=o}static parse(e,o){if(e.length!==2||typeof e[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const l=e[1];return o.scope.has(l)?new ka(l,o.scope.get(l)):o.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Zo{constructor(e,o=[],l,d=new xr,m=[]){this.registry=e,this.path=o,this.key=o.map(y=>`[${y}]`).join(""),this.scope=d,this.errors=m,this.expectedType=l}parse(e,o,l,d,m={}){return o?this.concat(o,l,d)._parse(e,m):this._parse(e,m)}_parse(e,o){function l(d,m,y){return y==="assert"?new ut(m,[d]):y==="coerce"?new ht(m,[d]):d}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=e[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[d];if(m){let y=m.parse(e,this);if(!y)return null;if(this.expectedType){const w=this.expectedType,b=y.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||b.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string")if(w.kind!=="padding"||b.kind!=="value"&&b.kind!=="number"&&b.kind!=="array"){if(this.checkSubtype(w,b))return null}else y=l(y,w,o.typeAnnotation||"coerce");else y=l(y,w,o.typeAnnotation||"coerce");else y=l(y,w,o.typeAnnotation||"assert")}if(!(y instanceof Je)&&y.type.kind!=="resolvedImage"&&Bl(y)){const w=new It;try{y=new Je(y.type,y.evaluate(w))}catch(b){return this.error(b.message),null}}return y}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,o,l){const d=typeof e=="number"?this.path.concat(e):this.path,m=l?this.scope.concat(l):this.scope;return new Zo(this.registry,d,o||null,m,this.errors)}error(e,...o){const l=`${this.key}${o.map(d=>`[${d}]`).join("")}`;this.errors.push(new _r(l,e))}checkSubtype(e,o){const l=ai(e,o);return l&&this.error(l),l}}function Bl(r){if(r instanceof ka)return Bl(r.boundExpression);if(r instanceof Vt&&r.name==="error"||r instanceof Cn||r instanceof co)return!1;const e=r instanceof ht||r instanceof ut;let o=!0;return r.eachChild(l=>{o=e?o&&Bl(l):o&&l instanceof Je}),!!o&&Ls(r)&&Ta(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ca(r,e){const o=r.length-1;let l,d,m=0,y=o,w=0;for(;m<=y;)if(w=Math.floor((m+y)/2),l=r[w],d=r[w+1],l<=e){if(w===o||e<d)return w;m=w+1}else{if(!(l>e))throw new je("Input is not a number.");y=w-1}return 0}class Rs{constructor(e,o,l){this.type=e,this.input=o,this.labels=[],this.outputs=[];for(const[d,m]of l)this.labels.push(d),this.outputs.push(m)}static parse(e,o){if(e.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return o.error("Expected an even number of arguments.");const l=o.parse(e[1],1,De);if(!l)return null;const d=[];let m=null;o.expectedType&&o.expectedType.kind!=="value"&&(m=o.expectedType);for(let y=1;y<e.length;y+=2){const w=y===1?-1/0:e[y],b=e[y+1],k=y,A=y+1;if(typeof w!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(d.length&&d[d.length-1][0]>=w)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const z=o.parse(b,A,m);if(!z)return null;m=m||z.type,d.push([w,z])}return new Rs(m,l,d)}evaluate(e){const o=this.labels,l=this.outputs;if(o.length===1)return l[0].evaluate(e);const d=this.input.evaluate(e);if(d<=o[0])return l[0].evaluate(e);const m=o.length;return d>=o[m-1]?l[m-1].evaluate(e):l[Ca(o,d)].evaluate(e)}eachChild(e){e(this.input);for(const o of this.outputs)e(o)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Yt(r,e,o){return r*(1-o)+e*o}var Bs=Object.freeze({__proto__:null,number:Yt,color:function(r,e,o){return new U(Yt(r.r,e.r,o),Yt(r.g,e.g,o),Yt(r.b,e.b,o),Yt(r.a,e.a,o))},array:function(r,e,o){return r.map((l,d)=>Yt(l,e[d],o))},padding:function(r,e,o){const l=r.values,d=e.values;return new J([Yt(l[0],d[0],o),Yt(l[1],d[1],o),Yt(l[2],d[2],o),Yt(l[3],d[3],o)])}});const Cc=.95047,Ic=1.08883,Fl=4/29,Ia=6/29,Ac=3*Ia*Ia,ip=Math.PI/180,op=180/Math.PI;function Ol(r){return r>.008856451679035631?Math.pow(r,1/3):r/Ac+Fl}function Nl(r){return r>Ia?r*r*r:Ac*(r-Fl)}function Ul(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function Vl(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function zt(r){const e=Vl(r.r),o=Vl(r.g),l=Vl(r.b),d=Ol((.4124564*e+.3575761*o+.1804375*l)/Cc),m=Ol((.2126729*e+.7151522*o+.072175*l)/1);return{l:116*m-16,a:500*(d-m),b:200*(m-Ol((.0193339*e+.119192*o+.9503041*l)/Ic)),alpha:r.a}}function Pc(r){let e=(r.l+16)/116,o=isNaN(r.a)?e:e+r.a/500,l=isNaN(r.b)?e:e-r.b/200;return e=1*Nl(e),o=Cc*Nl(o),l=Ic*Nl(l),new U(Ul(3.2404542*o-1.5371385*e-.4985314*l),Ul(-.969266*o+1.8760108*e+.041556*l),Ul(.0556434*o-.2040259*e+1.0572252*l),r.alpha)}function sp(r,e,o){const l=e-r;return r+o*(l>180||l<-180?l-360*Math.round(l/360):l)}const Fs={forward:zt,reverse:Pc,interpolate:function(r,e,o){return{l:Yt(r.l,e.l,o),a:Yt(r.a,e.a,o),b:Yt(r.b,e.b,o),alpha:Yt(r.alpha,e.alpha,o)}}},Os={forward:function(r){const{l:e,a:o,b:l}=zt(r),d=Math.atan2(l,o)*op;return{h:d<0?d+360:d,c:Math.sqrt(o*o+l*l),l:e,alpha:r.a}},reverse:function(r){const e=r.h*ip,o=r.c;return Pc({l:r.l,a:Math.cos(e)*o,b:Math.sin(e)*o,alpha:r.alpha})},interpolate:function(r,e,o){return{h:sp(r.h,e.h,o),c:Yt(r.c,e.c,o),l:Yt(r.l,e.l,o),alpha:Yt(r.alpha,e.alpha,o)}}};var zc=Object.freeze({__proto__:null,lab:Fs,hcl:Os});class vr{constructor(e,o,l,d,m){this.type=e,this.operator=o,this.interpolation=l,this.input=d,this.labels=[],this.outputs=[];for(const[y,w]of m)this.labels.push(y),this.outputs.push(w)}static interpolationFactor(e,o,l,d){let m=0;if(e.name==="exponential")m=jl(o,e.base,l,d);else if(e.name==="linear")m=jl(o,1,l,d);else if(e.name==="cubic-bezier"){const y=e.controlPoints;m=new N(y[0],y[1],y[2],y[3]).solve(jl(o,1,l,d))}return m}static parse(e,o){let[l,d,m,...y]=e;if(!Array.isArray(d)||d.length===0)return o.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const k=d[1];if(typeof k!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:k}}else{if(d[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const k=d.slice(1);if(k.length!==4||k.some(A=>typeof A!="number"||A<0||A>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:k}}}if(e.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(m=o.parse(m,2,De),!m)return null;const w=[];let b=null;l==="interpolate-hcl"||l==="interpolate-lab"?b=Ln:o.expectedType&&o.expectedType.kind!=="value"&&(b=o.expectedType);for(let k=0;k<y.length;k+=2){const A=y[k],z=y[k+1],L=k+3,B=k+4;if(typeof A!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(w.length&&w[w.length-1][0]>=A)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const F=o.parse(z,B,b);if(!F)return null;b=b||F.type,w.push([A,F])}return b.kind==="number"||b.kind==="color"||b.kind==="padding"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new vr(b,l,d,m,w):o.error(`Type ${Ot(b)} is not interpolatable.`)}evaluate(e){const o=this.labels,l=this.outputs;if(o.length===1)return l[0].evaluate(e);const d=this.input.evaluate(e);if(d<=o[0])return l[0].evaluate(e);const m=o.length;if(d>=o[m-1])return l[m-1].evaluate(e);const y=Ca(o,d),w=vr.interpolationFactor(this.interpolation,d,o[y],o[y+1]),b=l[y].evaluate(e),k=l[y+1].evaluate(e);return this.operator==="interpolate"?Bs[this.type.kind.toLowerCase()](b,k,w):this.operator==="interpolate-hcl"?Os.reverse(Os.interpolate(Os.forward(b),Os.forward(k),w)):Fs.reverse(Fs.interpolate(Fs.forward(b),Fs.forward(k),w))}eachChild(e){e(this.input);for(const o of this.outputs)e(o)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function jl(r,e,o,l){const d=l-o,m=r-o;return d===0?0:e===1?m/d:(Math.pow(e,m)-1)/(Math.pow(e,d)-1)}class Aa{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expectected at least one argument.");let l=null;const d=o.expectedType;d&&d.kind!=="value"&&(l=d);const m=[];for(const w of e.slice(1)){const b=o.parse(w,1+m.length,l,void 0,{typeAnnotation:"omit"});if(!b)return null;l=l||b.type,m.push(b)}if(!l)throw new Error("No output type");const y=d&&m.some(w=>ai(d,w.type));return new Aa(y?dt:l,m)}evaluate(e){let o,l=null,d=0;for(const m of this.args)if(d++,l=m.evaluate(e),l&&l instanceof ne&&!l.available&&(o||(o=l.name),l=null,d===this.args.length&&(l=o)),l!==null)break;return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class Pa{constructor(e,o){this.type=o.type,this.bindings=[].concat(e),this.result=o}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const o of this.bindings)e(o[1]);e(this.result)}static parse(e,o){if(e.length<4)return o.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let m=1;m<e.length-1;m+=2){const y=e[m];if(typeof y!="string")return o.error(`Expected string, but found ${typeof y} instead.`,m);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",m);const w=o.parse(e[m+1],m+1);if(!w)return null;l.push([y,w])}const d=o.parse(e[e.length-1],e.length-1,o.expectedType,l);return d?new Pa(l,d):null}outputDefined(){return this.result.outputDefined()}}class $l{constructor(e,o,l){this.type=e,this.index=o,this.input=l}static parse(e,o){if(e.length!==3)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=o.parse(e[1],1,De),d=o.parse(e[2],2,Xn(o.expectedType||dt));return l&&d?new $l(d.type.itemType,l,d):null}evaluate(e){const o=this.index.evaluate(e),l=this.input.evaluate(e);if(o<0)throw new je(`Array index out of bounds: ${o} < 0.`);if(o>=l.length)throw new je(`Array index out of bounds: ${o} > ${l.length-1}.`);if(o!==Math.floor(o))throw new je(`Array index must be an integer, but found ${o} instead.`);return l[o]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Gl{constructor(e,o){this.type=pt,this.needle=e,this.haystack=o}static parse(e,o){if(e.length!==3)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=o.parse(e[1],1,dt),d=o.parse(e[2],2,dt);return l&&d?ao(l.type,[pt,gt,De,$i,dt])?new Gl(l,d):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ot(l.type)} instead`):null}evaluate(e){const o=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!l)return!1;if(!lo(o,["boolean","string","number","null"]))throw new je(`Expected first argument to be of type boolean, string, number or null, but found ${Ot(me(o))} instead.`);if(!lo(l,["string","array"]))throw new je(`Expected second argument to be of type array or string, but found ${Ot(me(l))} instead.`);return l.indexOf(o)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class za{constructor(e,o,l){this.type=De,this.needle=e,this.haystack=o,this.fromIndex=l}static parse(e,o){if(e.length<=2||e.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=o.parse(e[1],1,dt),d=o.parse(e[2],2,dt);if(!l||!d)return null;if(!ao(l.type,[pt,gt,De,$i,dt]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ot(l.type)} instead`);if(e.length===4){const m=o.parse(e[3],3,De);return m?new za(l,d,m):null}return new za(l,d)}evaluate(e){const o=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!lo(o,["boolean","string","number","null"]))throw new je(`Expected first argument to be of type boolean, string, number or null, but found ${Ot(me(o))} instead.`);if(!lo(l,["string","array"]))throw new je(`Expected second argument to be of type array or string, but found ${Ot(me(l))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(e);return l.indexOf(o,d)}return l.indexOf(o)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class ql{constructor(e,o,l,d,m,y){this.inputType=e,this.type=o,this.input=l,this.cases=d,this.outputs=m,this.otherwise=y}static parse(e,o){if(e.length<5)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return o.error("Expected an even number of arguments.");let l,d;o.expectedType&&o.expectedType.kind!=="value"&&(d=o.expectedType);const m={},y=[];for(let k=2;k<e.length-1;k+=2){let A=e[k];const z=e[k+1];Array.isArray(A)||(A=[A]);const L=o.concat(k);if(A.length===0)return L.error("Expected at least one branch label.");for(const F of A){if(typeof F!="number"&&typeof F!="string")return L.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return L.error("Numeric branch labels must be integer values.");if(l){if(L.checkSubtype(l,me(F)))return null}else l=me(F);if(m[String(F)]!==void 0)return L.error("Branch labels must be unique.");m[String(F)]=y.length}const B=o.parse(z,k,d);if(!B)return null;d=d||B.type,y.push(B)}const w=o.parse(e[1],1,dt);if(!w)return null;const b=o.parse(e[e.length-1],e.length-1,d);return b?w.type.kind!=="value"&&o.concat(1).checkSubtype(l,w.type)?null:new ql(l,d,w,m,y,b):null}evaluate(e){const o=this.input.evaluate(e);return(me(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Zl{constructor(e,o,l){this.type=e,this.branches=o,this.otherwise=l}static parse(e,o){if(e.length<4)return o.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return o.error("Expected an odd number of arguments.");let l;o.expectedType&&o.expectedType.kind!=="value"&&(l=o.expectedType);const d=[];for(let y=1;y<e.length-1;y+=2){const w=o.parse(e[y],y,pt);if(!w)return null;const b=o.parse(e[y+1],y+1,l);if(!b)return null;d.push([w,b]),l=l||b.type}const m=o.parse(e[e.length-1],e.length-1,l);if(!m)return null;if(!l)throw new Error("Can't infer output type");return new Zl(l,d,m)}evaluate(e){for(const[o,l]of this.branches)if(o.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[o,l]of this.branches)e(o),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,o])=>o.outputDefined())&&this.otherwise.outputDefined()}}class Ma{constructor(e,o,l,d){this.type=e,this.input=o,this.beginIndex=l,this.endIndex=d}static parse(e,o){if(e.length<=2||e.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=o.parse(e[1],1,dt),d=o.parse(e[2],2,De);if(!l||!d)return null;if(!ao(l.type,[Xn(dt),gt,dt]))return o.error(`Expected first argument to be of type array or string, but found ${Ot(l.type)} instead`);if(e.length===4){const m=o.parse(e[3],3,De);return m?new Ma(l.type,l,d,m):null}return new Ma(l.type,l,d)}evaluate(e){const o=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!lo(o,["string","array"]))throw new je(`Expected first argument to be of type array or string, but found ${Ot(me(o))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(e);return o.slice(l,d)}return o.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Mc(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Dc(r,e,o,l){return l.compare(e,o)===0}function Wo(r,e,o){const l=r!=="=="&&r!=="!=";return class g1{constructor(m,y,w){this.type=pt,this.lhs=m,this.rhs=y,this.collator=w,this.hasUntypedArgument=m.type.kind==="value"||y.type.kind==="value"}static parse(m,y){if(m.length!==3&&m.length!==4)return y.error("Expected two or three arguments.");const w=m[0];let b=y.parse(m[1],1,dt);if(!b)return null;if(!Mc(w,b.type))return y.concat(1).error(`"${w}" comparisons are not supported for type '${Ot(b.type)}'.`);let k=y.parse(m[2],2,dt);if(!k)return null;if(!Mc(w,k.type))return y.concat(2).error(`"${w}" comparisons are not supported for type '${Ot(k.type)}'.`);if(b.type.kind!==k.type.kind&&b.type.kind!=="value"&&k.type.kind!=="value")return y.error(`Cannot compare types '${Ot(b.type)}' and '${Ot(k.type)}'.`);l&&(b.type.kind==="value"&&k.type.kind!=="value"?b=new ut(k.type,[b]):b.type.kind!=="value"&&k.type.kind==="value"&&(k=new ut(b.type,[k])));let A=null;if(m.length===4){if(b.type.kind!=="string"&&k.type.kind!=="string"&&b.type.kind!=="value"&&k.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(A=y.parse(m[3],3,Ei),!A)return null}return new g1(b,k,A)}evaluate(m){const y=this.lhs.evaluate(m),w=this.rhs.evaluate(m);if(l&&this.hasUntypedArgument){const b=me(y),k=me(w);if(b.kind!==k.kind||b.kind!=="string"&&b.kind!=="number")throw new je(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${b.kind}, ${k.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const b=me(y),k=me(w);if(b.kind!=="string"||k.kind!=="string")return e(m,y,w)}return this.collator?o(m,y,w,this.collator.evaluate(m)):e(m,y,w)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const ap=Wo("==",function(r,e,o){return e===o},Dc),lp=Wo("!=",function(r,e,o){return e!==o},function(r,e,o,l){return!Dc(0,e,o,l)}),up=Wo("<",function(r,e,o){return e<o},function(r,e,o,l){return l.compare(e,o)<0}),cp=Wo(">",function(r,e,o){return e>o},function(r,e,o,l){return l.compare(e,o)>0}),hp=Wo("<=",function(r,e,o){return e<=o},function(r,e,o,l){return l.compare(e,o)<=0}),dp=Wo(">=",function(r,e,o){return e>=o},function(r,e,o,l){return l.compare(e,o)>=0});class Wl{constructor(e,o,l,d,m){this.type=gt,this.number=e,this.locale=o,this.currency=l,this.minFractionDigits=d,this.maxFractionDigits=m}static parse(e,o){if(e.length!==3)return o.error("Expected two arguments.");const l=o.parse(e[1],1,De);if(!l)return null;const d=e[2];if(typeof d!="object"||Array.isArray(d))return o.error("NumberFormat options argument must be an object.");let m=null;if(d.locale&&(m=o.parse(d.locale,1,gt),!m))return null;let y=null;if(d.currency&&(y=o.parse(d.currency,1,gt),!y))return null;let w=null;if(d["min-fraction-digits"]&&(w=o.parse(d["min-fraction-digits"],1,De),!w))return null;let b=null;return d["max-fraction-digits"]&&(b=o.parse(d["max-fraction-digits"],1,De),!b)?null:new Wl(l,m,y,w,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Da{constructor(e){this.type=kn,this.sections=e}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return o.error("First argument must be an image or text section.");const d=[];let m=!1;for(let y=1;y<=e.length-1;++y){const w=e[y];if(m&&typeof w=="object"&&!Array.isArray(w)){m=!1;let b=null;if(w["font-scale"]&&(b=o.parse(w["font-scale"],1,De),!b))return null;let k=null;if(w["text-font"]&&(k=o.parse(w["text-font"],1,Xn(gt)),!k))return null;let A=null;if(w["text-color"]&&(A=o.parse(w["text-color"],1,Ln),!A))return null;const z=d[d.length-1];z.scale=b,z.font=k,z.textColor=A}else{const b=o.parse(e[y],1,dt);if(!b)return null;const k=b.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,d.push({content:b,scale:null,font:null,textColor:null})}}return new Da(d)}evaluate(e){return new Y(this.sections.map(o=>{const l=o.content.evaluate(e);return me(l)===gn?new te("",l,null,null,null):new te(He(l),null,o.scale?o.scale.evaluate(e):null,o.font?o.font.evaluate(e).join(","):null,o.textColor?o.textColor.evaluate(e):null)}))}eachChild(e){for(const o of this.sections)e(o.content),o.scale&&e(o.scale),o.font&&e(o.font),o.textColor&&e(o.textColor)}outputDefined(){return!1}}class Hl{constructor(e){this.type=gn,this.input=e}static parse(e,o){if(e.length!==2)return o.error("Expected two arguments.");const l=o.parse(e[1],1,gt);return l?new Hl(l):o.error("No image name provided.")}evaluate(e){const o=this.input.evaluate(e),l=ne.fromString(o);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(o)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}}class Xl{constructor(e){this.type=De,this.input=e}static parse(e,o){if(e.length!==2)return o.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=o.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${Ot(l.type)} instead.`):new Xl(l):null}evaluate(e){const o=this.input.evaluate(e);if(typeof o=="string"||Array.isArray(o))return o.length;throw new je(`Expected value to be of type string or array, but found ${Ot(me(o))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Ho={"==":ap,"!=":lp,">":cp,"<":up,">=":dp,"<=":hp,array:ut,at:$l,boolean:ut,case:Zl,coalesce:Aa,collator:Cn,format:Da,image:Hl,in:Gl,"index-of":za,interpolate:vr,"interpolate-hcl":vr,"interpolate-lab":vr,length:Xl,let:Pa,literal:Je,match:ql,number:ut,"number-format":Wl,object:ut,slice:Ma,step:Rs,string:ut,"to-boolean":ht,"to-color":ht,"to-number":ht,"to-string":ht,var:ka,within:co};function Lc(r,[e,o,l,d]){e=e.evaluate(r),o=o.evaluate(r),l=l.evaluate(r);const m=d?d.evaluate(r):1,y=ge(e,o,l,m);if(y)throw new je(y);return new U(e/255*m,o/255*m,l/255*m,m)}function Rc(r,e){return r in e}function La(r,e){const o=e[r];return o===void 0?null:o}function ho(r){return{type:r}}function Bc(r){return{result:"success",value:r}}function Xo(r){return{result:"error",value:r}}function Wt(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function Fc(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function St(r){return!!r.expression&&r.expression.interpolated}function Mt(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Gt(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Qt(r){return r}function Ns(r,e){const o=e.type==="color",l=r.stops&&typeof r.stops[0][0]=="object",d=l||!(l||r.property!==void 0),m=r.type||(St(e)?"exponential":"interval");if(o||e.type==="padding"){const k=o?U.parse:J.parse;(r=Zr({},r)).stops&&(r.stops=r.stops.map(A=>[A[0],k(A[1])])),r.default=k(r.default?r.default:e.default)}if(r.colorSpace&&r.colorSpace!=="rgb"&&!zc[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let y,w,b;if(m==="exponential")y=Oc;else if(m==="interval")y=fp;else if(m==="categorical"){y=pp,w=Object.create(null);for(const k of r.stops)w[k[0]]=k[1];b=typeof r.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);y=mp}if(l){const k={},A=[];for(let B=0;B<r.stops.length;B++){const F=r.stops[B],X=F[0].zoom;k[X]===void 0&&(k[X]={zoom:X,type:r.type,property:r.property,default:r.default,stops:[]},A.push(X)),k[X].stops.push([F[0].value,F[1]])}const z=[];for(const B of A)z.push([k[B].zoom,Ns(k[B],e)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:vr.interpolationFactor.bind(void 0,L),zoomStops:z.map(B=>B[0]),evaluate:({zoom:B},F)=>Oc({stops:z,base:r.base},e,B).evaluate(B,F)}}if(d){const k=m==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:vr.interpolationFactor.bind(void 0,k),zoomStops:r.stops.map(A=>A[0]),evaluate:({zoom:A})=>y(r,e,A,w,b)}}return{kind:"source",evaluate(k,A){const z=A&&A.properties?A.properties[r.property]:void 0;return z===void 0?Ko(r.default,e.default):y(r,e,z,w,b)}}}function Ko(r,e,o){return r!==void 0?r:e!==void 0?e:o!==void 0?o:void 0}function pp(r,e,o,l,d){return Ko(typeof o===d?l[o]:void 0,r.default,e.default)}function fp(r,e,o){if(Mt(o)!=="number")return Ko(r.default,e.default);const l=r.stops.length;if(l===1||o<=r.stops[0][0])return r.stops[0][1];if(o>=r.stops[l-1][0])return r.stops[l-1][1];const d=Ca(r.stops.map(m=>m[0]),o);return r.stops[d][1]}function Oc(r,e,o){const l=r.base!==void 0?r.base:1;if(Mt(o)!=="number")return Ko(r.default,e.default);const d=r.stops.length;if(d===1||o<=r.stops[0][0])return r.stops[0][1];if(o>=r.stops[d-1][0])return r.stops[d-1][1];const m=Ca(r.stops.map(A=>A[0]),o),y=function(A,z,L,B){const F=B-L,X=A-L;return F===0?0:z===1?X/F:(Math.pow(z,X)-1)/(Math.pow(z,F)-1)}(o,l,r.stops[m][0],r.stops[m+1][0]),w=r.stops[m][1],b=r.stops[m+1][1];let k=Bs[e.type]||Qt;if(r.colorSpace&&r.colorSpace!=="rgb"){const A=zc[r.colorSpace];k=(z,L)=>A.reverse(A.interpolate(A.forward(z),A.forward(L),y))}return typeof w.evaluate=="function"?{evaluate(...A){const z=w.evaluate.apply(void 0,A),L=b.evaluate.apply(void 0,A);if(z!==void 0&&L!==void 0)return k(z,L,y)}}:k(w,b,y)}function mp(r,e,o){switch(e.type){case"color":o=U.parse(o);break;case"formatted":o=Y.fromString(o.toString());break;case"resolvedImage":o=ne.fromString(o.toString());break;case"padding":o=J.parse(o);break;default:Mt(o)===e.type||e.type==="enum"&&e.values[o]||(o=void 0)}return Ko(o,r.default,e.default)}Vt.register(Ho,{error:[{kind:"error"},[gt],(r,[e])=>{throw new je(e.evaluate(r))}],typeof:[gt,[dt],(r,[e])=>Ot(me(e.evaluate(r)))],"to-rgba":[Xn(De,4),[Ln],(r,[e])=>e.evaluate(r).toArray()],rgb:[Ln,[De,De,De],Lc],rgba:[Ln,[De,De,De,De],Lc],has:{type:pt,overloads:[[[gt],(r,[e])=>Rc(e.evaluate(r),r.properties())],[[gt,Gi],(r,[e,o])=>Rc(e.evaluate(r),o.evaluate(r))]]},get:{type:dt,overloads:[[[gt],(r,[e])=>La(e.evaluate(r),r.properties())],[[gt,Gi],(r,[e,o])=>La(e.evaluate(r),o.evaluate(r))]]},"feature-state":[dt,[gt],(r,[e])=>La(e.evaluate(r),r.featureState||{})],properties:[Gi,[],r=>r.properties()],"geometry-type":[gt,[],r=>r.geometryType()],id:[dt,[],r=>r.id()],zoom:[De,[],r=>r.globals.zoom],"heatmap-density":[De,[],r=>r.globals.heatmapDensity||0],"line-progress":[De,[],r=>r.globals.lineProgress||0],accumulated:[dt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[De,ho(De),(r,e)=>{let o=0;for(const l of e)o+=l.evaluate(r);return o}],"*":[De,ho(De),(r,e)=>{let o=1;for(const l of e)o*=l.evaluate(r);return o}],"-":{type:De,overloads:[[[De,De],(r,[e,o])=>e.evaluate(r)-o.evaluate(r)],[[De],(r,[e])=>-e.evaluate(r)]]},"/":[De,[De,De],(r,[e,o])=>e.evaluate(r)/o.evaluate(r)],"%":[De,[De,De],(r,[e,o])=>e.evaluate(r)%o.evaluate(r)],ln2:[De,[],()=>Math.LN2],pi:[De,[],()=>Math.PI],e:[De,[],()=>Math.E],"^":[De,[De,De],(r,[e,o])=>Math.pow(e.evaluate(r),o.evaluate(r))],sqrt:[De,[De],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[De,[De],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[De,[De],(r,[e])=>Math.log(e.evaluate(r))],log2:[De,[De],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[De,[De],(r,[e])=>Math.sin(e.evaluate(r))],cos:[De,[De],(r,[e])=>Math.cos(e.evaluate(r))],tan:[De,[De],(r,[e])=>Math.tan(e.evaluate(r))],asin:[De,[De],(r,[e])=>Math.asin(e.evaluate(r))],acos:[De,[De],(r,[e])=>Math.acos(e.evaluate(r))],atan:[De,[De],(r,[e])=>Math.atan(e.evaluate(r))],min:[De,ho(De),(r,e)=>Math.min(...e.map(o=>o.evaluate(r)))],max:[De,ho(De),(r,e)=>Math.max(...e.map(o=>o.evaluate(r)))],abs:[De,[De],(r,[e])=>Math.abs(e.evaluate(r))],round:[De,[De],(r,[e])=>{const o=e.evaluate(r);return o<0?-Math.round(-o):Math.round(o)}],floor:[De,[De],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[De,[De],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[pt,[gt,dt],(r,[e,o])=>r.properties()[e.value]===o.value],"filter-id-==":[pt,[dt],(r,[e])=>r.id()===e.value],"filter-type-==":[pt,[gt],(r,[e])=>r.geometryType()===e.value],"filter-<":[pt,[gt,dt],(r,[e,o])=>{const l=r.properties()[e.value],d=o.value;return typeof l==typeof d&&l<d}],"filter-id-<":[pt,[dt],(r,[e])=>{const o=r.id(),l=e.value;return typeof o==typeof l&&o<l}],"filter->":[pt,[gt,dt],(r,[e,o])=>{const l=r.properties()[e.value],d=o.value;return typeof l==typeof d&&l>d}],"filter-id->":[pt,[dt],(r,[e])=>{const o=r.id(),l=e.value;return typeof o==typeof l&&o>l}],"filter-<=":[pt,[gt,dt],(r,[e,o])=>{const l=r.properties()[e.value],d=o.value;return typeof l==typeof d&&l<=d}],"filter-id-<=":[pt,[dt],(r,[e])=>{const o=r.id(),l=e.value;return typeof o==typeof l&&o<=l}],"filter->=":[pt,[gt,dt],(r,[e,o])=>{const l=r.properties()[e.value],d=o.value;return typeof l==typeof d&&l>=d}],"filter-id->=":[pt,[dt],(r,[e])=>{const o=r.id(),l=e.value;return typeof o==typeof l&&o>=l}],"filter-has":[pt,[dt],(r,[e])=>e.value in r.properties()],"filter-has-id":[pt,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[pt,[Xn(gt)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[pt,[Xn(dt)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[pt,[gt,Xn(dt)],(r,[e,o])=>o.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[pt,[gt,Xn(dt)],(r,[e,o])=>function(l,d,m,y){for(;m<=y;){const w=m+y>>1;if(d[w]===l)return!0;d[w]>l?y=w-1:m=w+1}return!1}(r.properties()[e.value],o.value,0,o.value.length-1)],all:{type:pt,overloads:[[[pt,pt],(r,[e,o])=>e.evaluate(r)&&o.evaluate(r)],[ho(pt),(r,e)=>{for(const o of e)if(!o.evaluate(r))return!1;return!0}]]},any:{type:pt,overloads:[[[pt,pt],(r,[e,o])=>e.evaluate(r)||o.evaluate(r)],[ho(pt),(r,e)=>{for(const o of e)if(o.evaluate(r))return!0;return!1}]]},"!":[pt,[pt],(r,[e])=>!e.evaluate(r)],"is-supported-script":[pt,[gt],(r,[e])=>{const o=r.globals&&r.globals.isSupportedScript;return!o||o(e.evaluate(r))}],upcase:[gt,[gt],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[gt,[gt],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[gt,ho(dt),(r,e)=>e.map(o=>He(o.evaluate(r))).join("")],"resolved-locale":[gt,[Ei],(r,[e])=>e.evaluate(r).resolvedLocale()]});class Ra{constructor(e,o){this.expression=e,this._warningHistory={},this._evaluator=new It,this._defaultValue=o?function(l){return l.type==="color"&&Gt(l.default)?new U(0,0,0,0):l.type==="color"?U.parse(l.default)||null:l.type==="padding"?J.parse(l.default)||null:l.default===void 0?null:l.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(e,o,l,d,m,y){return this._evaluator.globals=e,this._evaluator.feature=o,this._evaluator.featureState=l,this._evaluator.canonical=d,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(e,o,l,d,m,y){this._evaluator.globals=e,this._evaluator.feature=o||null,this._evaluator.featureState=l||null,this._evaluator.canonical=d,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new je(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Us(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Ho}function Vs(r,e){const o=new Zo(Ho,[],e?function(d){const m={color:Ln,string:gt,number:De,enum:gt,boolean:pt,formatted:kn,padding:Vo,resolvedImage:gn};return d.type==="array"?Xn(m[d.value]||dt,d.length):m[d.type]}(e):void 0),l=o.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?Bc(new Ra(l,e)):Xo(o.errors)}class js{constructor(e,o){this.kind=e,this._styleExpression=o,this.isStateDependent=e!=="constant"&&!qo(o.expression)}evaluateWithoutErrorHandling(e,o,l,d,m,y){return this._styleExpression.evaluateWithoutErrorHandling(e,o,l,d,m,y)}evaluate(e,o,l,d,m,y){return this._styleExpression.evaluate(e,o,l,d,m,y)}}class Kl{constructor(e,o,l,d){this.kind=e,this.zoomStops=l,this._styleExpression=o,this.isStateDependent=e!=="camera"&&!qo(o.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,o,l,d,m,y){return this._styleExpression.evaluateWithoutErrorHandling(e,o,l,d,m,y)}evaluate(e,o,l,d,m,y){return this._styleExpression.evaluate(e,o,l,d,m,y)}interpolationFactor(e,o,l){return this.interpolationType?vr.interpolationFactor(this.interpolationType,e,o,l):0}}function Nc(r,e){const o=Vs(r,e);if(o.result==="error")return o;const l=o.value.expression,d=Ls(l);if(!d&&!Wt(e))return Xo([new _r("","data expressions not supported")]);const m=Ta(l,["zoom"]);if(!m&&!Fc(e))return Xo([new _r("","zoom expressions not supported")]);const y=Fa(l);return y||m?y instanceof _r?Xo([y]):y instanceof vr&&!St(e)?Xo([new _r("",'"interpolate" expressions cannot be used with this property')]):Bc(y?new Kl(d?"camera":"composite",o.value,y.labels,y instanceof vr?y.interpolation:void 0):new js(d?"constant":"source",o.value)):Xo([new _r("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ba{constructor(e,o){this._parameters=e,this._specification=o,Zr(this,Ns(this._parameters,this._specification))}static deserialize(e){return new Ba(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Fa(r){let e=null;if(r instanceof Pa)e=Fa(r.result);else if(r instanceof Aa){for(const o of r.args)if(e=Fa(o),e)break}else(r instanceof Rs||r instanceof vr)&&r.input instanceof Vt&&r.input.name==="zoom"&&(e=r);return e instanceof _r||r.eachChild(o=>{const l=Fa(o);l instanceof _r?e=l:!e&&l?e=new _r("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new _r("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Wr(r){const e=r.key,o=r.value,l=r.valueSpec||{},d=r.objectElementValidators||{},m=r.style,y=r.styleSpec;let w=[];const b=Mt(o);if(b!=="object")return[new Fe(e,o,`object expected, ${b} found`)];for(const k in o){const A=k.split(".")[0],z=l[A]||l["*"];let L;if(d[A])L=d[A];else if(l[A])L=br;else if(d["*"])L=d["*"];else{if(!l["*"]){w.push(new Fe(e,o[k],`unknown property "${k}"`));continue}L=br}w=w.concat(L({key:(e&&`${e}.`)+k,value:o[k],valueSpec:z,style:m,styleSpec:y,object:o,objectKey:k},o))}for(const k in l)d[k]||l[k].required&&l[k].default===void 0&&o[k]===void 0&&w.push(new Fe(e,o,`missing required property "${k}"`));return w}function Uc(r){const e=r.value,o=r.valueSpec,l=r.style,d=r.styleSpec,m=r.key,y=r.arrayElementValidator||br;if(Mt(e)!=="array")return[new Fe(m,e,`array expected, ${Mt(e)} found`)];if(o.length&&e.length!==o.length)return[new Fe(m,e,`array length ${o.length} expected, length ${e.length} found`)];if(o["min-length"]&&e.length<o["min-length"])return[new Fe(m,e,`array length at least ${o["min-length"]} expected, length ${e.length} found`)];let w={type:o.value,values:o.values};d.$version<7&&(w.function=o.function),Mt(o.value)==="object"&&(w=o.value);let b=[];for(let k=0;k<e.length;k++)b=b.concat(y({array:e,arrayIndex:k,value:e[k],valueSpec:w,style:l,styleSpec:d,key:`${m}[${k}]`}));return b}function Jl(r){const e=r.key,o=r.value,l=r.valueSpec;let d=Mt(o);return d==="number"&&o!=o&&(d="NaN"),d!=="number"?[new Fe(e,o,`number expected, ${d} found`)]:"minimum"in l&&o<l.minimum?[new Fe(e,o,`${o} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&o>l.maximum?[new Fe(e,o,`${o} is greater than the maximum value ${l.maximum}`)]:[]}function Vc(r){const e=r.valueSpec,o=kt(r.value.type);let l,d,m,y={};const w=o!=="categorical"&&r.value.property===void 0,b=!w,k=Mt(r.value.stops)==="array"&&Mt(r.value.stops[0])==="array"&&Mt(r.value.stops[0][0])==="object",A=Wr({key:r.key,value:r.value,valueSpec:r.styleSpec.function,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(B){if(o==="identity")return[new Fe(B.key,B.value,'identity function may not have a "stops" property')];let F=[];const X=B.value;return F=F.concat(Uc({key:B.key,value:X,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:z})),Mt(X)==="array"&&X.length===0&&F.push(new Fe(B.key,X,"array must have at least one stop")),F},default:function(B){return br({key:B.key,value:B.value,valueSpec:e,style:B.style,styleSpec:B.styleSpec})}}});return o==="identity"&&w&&A.push(new Fe(r.key,r.value,'missing required property "property"')),o==="identity"||r.value.stops||A.push(new Fe(r.key,r.value,'missing required property "stops"')),o==="exponential"&&r.valueSpec.expression&&!St(r.valueSpec)&&A.push(new Fe(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(b&&!Wt(r.valueSpec)?A.push(new Fe(r.key,r.value,"property functions not supported")):w&&!Fc(r.valueSpec)&&A.push(new Fe(r.key,r.value,"zoom functions not supported"))),o!=="categorical"&&!k||r.value.property!==void 0||A.push(new Fe(r.key,r.value,'"property" property is required')),A;function z(B){let F=[];const X=B.value,H=B.key;if(Mt(X)!=="array")return[new Fe(H,X,`array expected, ${Mt(X)} found`)];if(X.length!==2)return[new Fe(H,X,`array length 2 expected, length ${X.length} found`)];if(k){if(Mt(X[0])!=="object")return[new Fe(H,X,`object expected, ${Mt(X[0])} found`)];if(X[0].zoom===void 0)return[new Fe(H,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new Fe(H,X,"object stop key must have value")];if(m&&m>kt(X[0].zoom))return[new Fe(H,X[0].zoom,"stop zoom values must appear in ascending order")];kt(X[0].zoom)!==m&&(m=kt(X[0].zoom),d=void 0,y={}),F=F.concat(Wr({key:`${H}[0]`,value:X[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:Jl,value:L}}))}else F=F.concat(L({key:`${H}[0]`,value:X[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},X));return Us(Dr(X[1]))?F.concat([new Fe(`${H}[1]`,X[1],"expressions are not allowed in function stops.")]):F.concat(br({key:`${H}[1]`,value:X[1],valueSpec:e,style:B.style,styleSpec:B.styleSpec}))}function L(B,F){const X=Mt(B.value),H=kt(B.value),ae=B.value!==null?B.value:F;if(l){if(X!==l)return[new Fe(B.key,ae,`${X} stop domain type must match previous stop domain type ${l}`)]}else l=X;if(X!=="number"&&X!=="string"&&X!=="boolean")return[new Fe(B.key,ae,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&o!=="categorical"){let fe=`number expected, ${X} found`;return Wt(e)&&o===void 0&&(fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Fe(B.key,ae,fe)]}return o!=="categorical"||X!=="number"||isFinite(H)&&Math.floor(H)===H?o!=="categorical"&&X==="number"&&d!==void 0&&H<d?[new Fe(B.key,ae,"stop domain values must appear in ascending order")]:(d=H,o==="categorical"&&H in y?[new Fe(B.key,ae,"stop domain values must be unique")]:(y[H]=!0,[])):[new Fe(B.key,ae,`integer expected, found ${H}`)]}}function po(r){const e=(r.expressionContext==="property"?Nc:Vs)(Dr(r.value),r.valueSpec);if(e.result==="error")return e.value.map(l=>new Fe(`${r.key}${l.key}`,r.value,l.message));const o=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!o.outputDefined())return[new Fe(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!qo(o))return[new Fe(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!qo(o))return[new Fe(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Ta(o,["zoom","feature-state"]))return[new Fe(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Ls(o))return[new Fe(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $s(r){const e=r.key,o=r.value,l=r.valueSpec,d=[];return Array.isArray(l.values)?l.values.indexOf(kt(o))===-1&&d.push(new Fe(e,o,`expected one of [${l.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(l.values).indexOf(kt(o))===-1&&d.push(new Fe(e,o,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(o)} found`)),d}function Jo(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Jo(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const gp={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Oa(r){if(r==null)return{filter:()=>!0,needGeometry:!1};Jo(r)||(r=Gs(r));const e=Vs(r,gp);if(e.result==="error")throw new Error(e.value.map(o=>`${o.key}: ${o.message}`).join(", "));return{filter:(o,l,d)=>e.value.evaluate(o,l,{},d),needGeometry:$c(r)}}function jc(r,e){return r<e?-1:r>e?1:0}function $c(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let e=1;e<r.length;e++)if($c(r[e]))return!0;return!1}function Gs(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Yl(r[1],r[2],"=="):e==="!="?Yo(Yl(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Yl(r[1],r[2],e):e==="any"?(o=r.slice(1),["any"].concat(o.map(Gs))):e==="all"?["all"].concat(r.slice(1).map(Gs)):e==="none"?["all"].concat(r.slice(1).map(Gs).map(Yo)):e==="in"?Na(r[1],r.slice(2)):e==="!in"?Yo(Na(r[1],r.slice(2))):e==="has"?qs(r[1]):e==="!has"?Yo(qs(r[1])):e!=="within"||r;var o}function Yl(r,e,o){switch(r){case"$type":return[`filter-type-${o}`,e];case"$id":return[`filter-id-${o}`,e];default:return[`filter-${o}`,r,e]}}function Na(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(o=>typeof o!=typeof e[0])?["filter-in-large",r,["literal",e.sort(jc)]]:["filter-in-small",r,["literal",e]]}}function qs(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Yo(r){return["!",r]}function Zs(r){return Jo(Dr(r.value))?po(Zr({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Gc(r)}function Gc(r){const e=r.value,o=r.key;if(Mt(e)!=="array")return[new Fe(o,e,`array expected, ${Mt(e)} found`)];const l=r.styleSpec;let d,m=[];if(e.length<1)return[new Fe(o,e,"filter array must have at least 1 element")];switch(m=m.concat($s({key:`${o}[0]`,value:e[0],valueSpec:l.filter_operator,style:r.style,styleSpec:r.styleSpec})),kt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&kt(e[1])==="$type"&&m.push(new Fe(o,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&m.push(new Fe(o,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(d=Mt(e[1]),d!=="string"&&m.push(new Fe(`${o}[1]`,e[1],`string expected, ${d} found`)));for(let y=2;y<e.length;y++)d=Mt(e[y]),kt(e[1])==="$type"?m=m.concat($s({key:`${o}[${y}]`,value:e[y],valueSpec:l.geometry_type,style:r.style,styleSpec:r.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&m.push(new Fe(`${o}[${y}]`,e[y],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)m=m.concat(Gc({key:`${o}[${y}]`,value:e[y],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":d=Mt(e[1]),e.length!==2?m.push(new Fe(o,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="string"&&m.push(new Fe(`${o}[1]`,e[1],`string expected, ${d} found`));break;case"within":d=Mt(e[1]),e.length!==2?m.push(new Fe(o,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="object"&&m.push(new Fe(`${o}[1]`,e[1],`object expected, ${d} found`))}return m}function Ws(r,e){const o=r.key,l=r.style,d=r.styleSpec,m=r.value,y=r.objectKey,w=d[`${e}_${r.layerType}`];if(!w)return[];const b=y.match(/^(.*)-transition$/);if(e==="paint"&&b&&w[b[1]]&&w[b[1]].transition)return br({key:o,value:m,valueSpec:d.transition,style:l,styleSpec:d});const k=r.valueSpec||w[y];if(!k)return[new Fe(o,m,`unknown property "${y}"`)];let A;if(Mt(m)==="string"&&Wt(k)&&!k.tokens&&(A=/^{([^}]+)}$/.exec(m)))return[new Fe(o,m,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const z=[];return r.layerType==="symbol"&&(y==="text-field"&&l&&!l.glyphs&&z.push(new Fe(o,m,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&Gt(Dr(m))&&kt(m.type)==="identity"&&z.push(new Fe(o,m,'"text-font" does not support identity functions'))),z.concat(br({key:r.key,value:m,valueSpec:k,style:l,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:y}))}function qc(r){return Ws(r,"paint")}function Zc(r){return Ws(r,"layout")}function Wc(r){let e=[];const o=r.value,l=r.key,d=r.style,m=r.styleSpec;o.type||o.ref||e.push(new Fe(l,o,'either "type" or "ref" is required'));let y=kt(o.type);const w=kt(o.ref);if(o.id){const b=kt(o.id);for(let k=0;k<r.arrayIndex;k++){const A=d.layers[k];kt(A.id)===b&&e.push(new Fe(l,o.id,`duplicate layer id "${o.id}", previously used at line ${A.id.__line__}`))}}if("ref"in o){let b;["type","source","source-layer","filter","layout"].forEach(k=>{k in o&&e.push(new Fe(l,o[k],`"${k}" is prohibited for ref layers`))}),d.layers.forEach(k=>{kt(k.id)===w&&(b=k)}),b?b.ref?e.push(new Fe(l,o.ref,"ref cannot reference another ref layer")):y=kt(b.type):e.push(new Fe(l,o.ref,`ref layer "${w}" not found`))}else if(y!=="background")if(o.source){const b=d.sources&&d.sources[o.source],k=b&&kt(b.type);b?k==="vector"&&y==="raster"?e.push(new Fe(l,o.source,`layer "${o.id}" requires a raster source`)):k==="raster"&&y!=="raster"?e.push(new Fe(l,o.source,`layer "${o.id}" requires a vector source`)):k!=="vector"||o["source-layer"]?k==="raster-dem"&&y!=="hillshade"?e.push(new Fe(l,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!o.paint||!o.paint["line-gradient"]||k==="geojson"&&b.lineMetrics||e.push(new Fe(l,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Fe(l,o,`layer "${o.id}" must specify a "source-layer"`)):e.push(new Fe(l,o.source,`source "${o.source}" not found`))}else e.push(new Fe(l,o,'missing required property "source"'));return e=e.concat(Wr({key:l,value:o,valueSpec:m.layer,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{"*":()=>[],type:()=>br({key:`${l}.type`,value:o.type,valueSpec:m.layer.type,style:r.style,styleSpec:r.styleSpec,object:o,objectKey:"type"}),filter:Zs,layout:b=>Wr({layer:o,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":k=>Zc(Zr({layerType:y},k))}}),paint:b=>Wr({layer:o,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":k=>qc(Zr({layerType:y},k))}})}})),e}function Qo(r){const e=r.value,o=r.key,l=Mt(e);return l!=="string"?[new Fe(o,e,`string expected, ${l} found`)]:[]}const Hc={promoteId:function({key:r,value:e}){if(Mt(e)==="string")return Qo({key:r,value:e});{const o=[];for(const l in e)o.push(...Qo({key:`${r}.${l}`,value:e[l]}));return o}}};function Hs(r){const e=r.value,o=r.key,l=r.styleSpec,d=r.style;if(!e.type)return[new Fe(o,e,'"type" is required')];const m=kt(e.type);let y;switch(m){case"vector":case"raster":case"raster-dem":return y=Wr({key:o,value:e,valueSpec:l[`source_${m.replace("-","_")}`],style:r.style,styleSpec:l,objectElementValidators:Hc}),y;case"geojson":if(y=Wr({key:o,value:e,valueSpec:l.source_geojson,style:d,styleSpec:l,objectElementValidators:Hc}),e.cluster)for(const w in e.clusterProperties){const[b,k]=e.clusterProperties[w],A=typeof b=="string"?[b,["accumulated"],["get",w]]:b;y.push(...po({key:`${o}.${w}.map`,value:k,expressionContext:"cluster-map"})),y.push(...po({key:`${o}.${w}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return y;case"video":return Wr({key:o,value:e,valueSpec:l.source_video,style:d,styleSpec:l});case"image":return Wr({key:o,value:e,valueSpec:l.source_image,style:d,styleSpec:l});case"canvas":return[new Fe(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $s({key:`${o}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,styleSpec:l})}}function Xs(r){const e=r.value,o=r.styleSpec,l=o.light,d=r.style;let m=[];const y=Mt(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new Fe("light",e,`object expected, ${y} found`)]),m;for(const w in e){const b=w.match(/^(.*)-transition$/);m=m.concat(b&&l[b[1]]&&l[b[1]].transition?br({key:w,value:e[w],valueSpec:o.transition,style:d,styleSpec:o}):l[w]?br({key:w,value:e[w],valueSpec:l[w],style:d,styleSpec:o}):[new Fe(w,e[w],`unknown property "${w}"`)])}return m}function wr(r){const e=r.value,o=r.styleSpec,l=o.terrain,d=r.style;let m=[];const y=Mt(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new Fe("terrain",e,`object expected, ${y} found`)]),m;for(const w in e)m=m.concat(l[w]?br({key:w,value:e[w],valueSpec:l[w],style:d,styleSpec:o}):[new Fe(w,e[w],`unknown property "${w}"`)]);return m}const Ks={"*":()=>[],array:Uc,boolean:function(r){const e=r.value,o=r.key,l=Mt(e);return l!=="boolean"?[new Fe(o,e,`boolean expected, ${l} found`)]:[]},number:Jl,color:function(r){const e=r.key,o=r.value,l=Mt(o);return l!=="string"?[new Fe(e,o,`color expected, ${l} found`)]:$o(o)===null?[new Fe(e,o,`color expected, "${o}" found`)]:[]},constants:so,enum:$s,filter:Zs,function:Vc,layer:Wc,object:Wr,source:Hs,light:Xs,terrain:wr,string:Qo,formatted:function(r){return Qo(r).length===0?[]:po(r)},resolvedImage:function(r){return Qo(r).length===0?[]:po(r)},padding:function(r){const e=r.key,o=r.value;if(Mt(o)==="array"){if(o.length<1||o.length>4)return[new Fe(e,o,`padding requires 1 to 4 values; ${o.length} values found`)];const l={type:"number"};let d=[];for(let m=0;m<o.length;m++)d=d.concat(br({key:`${e}[${m}]`,value:o[m],valueSpec:l}));return d}return Jl({key:e,value:o,valueSpec:{}})}};function br(r){const e=r.value,o=r.valueSpec,l=r.styleSpec;return o.expression&&Gt(kt(e))?Vc(r):o.expression&&Us(Dr(e))?po(r):o.type&&Ks[o.type]?Ks[o.type](r):Wr(Zr({},r,{valueSpec:o.type?l[o.type]:o}))}function yp(r){const e=r.value,o=r.key,l=Qo(r);return l.length||(e.indexOf("{fontstack}")===-1&&l.push(new Fe(o,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&l.push(new Fe(o,e,'"glyphs" url must include a "{range}" token'))),l}function qi(r,e=we){let o=[];return o=o.concat(br({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,objectElementValidators:{glyphs:yp,"*":()=>[]}})),r.constants&&(o=o.concat(so({key:"constants",value:r.constants,style:r,styleSpec:e}))),Xc(o)}function Xc(r){return[].concat(r).sort((e,o)=>e.line-o.line)}function Ti(r){return function(...e){return Xc(r.apply(this,e))}}qi.source=Ti(Hs),qi.light=Ti(Xs),qi.terrain=Ti(wr),qi.layer=Ti(Wc),qi.filter=Ti(Zs),qi.paintProperty=Ti(qc),qi.layoutProperty=Ti(Zc);const Js=qi,Ql=Js.light,_p=Js.paintProperty,xp=Js.layoutProperty;function Ua(r,e){let o=!1;if(e&&e.length)for(const l of e)r.fire(new Uo(new Error(l.message))),o=!0;return o}class Ys{constructor(e,o,l){const d=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const y=new Int32Array(this.arrayBuffer);e=y[0],this.d=(o=y[1])+2*(l=y[2]);for(let b=0;b<this.d*this.d;b++){const k=y[3+b],A=y[3+b+1];d.push(k===A?null:y.subarray(k,A))}const w=y[3+d.length+1];this.keys=y.subarray(y[3+d.length],w),this.bboxes=y.subarray(w),this.insert=this._insertReadonly}else{this.d=o+2*l;for(let y=0;y<this.d*this.d;y++)d.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=e,this.padding=l,this.scale=o/e,this.uid=0;const m=l/o*e;this.min=-m,this.max=e+m}insert(e,o,l,d,m){this._forEachCell(o,l,d,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,o,l,d,m,y){this.cells[m].push(y)}query(e,o,l,d,m){const y=this.min,w=this.max;if(e<=y&&o<=y&&w<=l&&w<=d&&!m)return Array.prototype.slice.call(this.keys);{const b=[];return this._forEachCell(e,o,l,d,this._queryCell,b,{},m),b}}_queryCell(e,o,l,d,m,y,w,b){const k=this.cells[m];if(k!==null){const A=this.keys,z=this.bboxes;for(let L=0;L<k.length;L++){const B=k[L];if(w[B]===void 0){const F=4*B;(b?b(z[F+0],z[F+1],z[F+2],z[F+3]):e<=z[F+2]&&o<=z[F+3]&&l>=z[F+0]&&d>=z[F+1])?(w[B]=!0,y.push(A[B])):w[B]=!1}}}}_forEachCell(e,o,l,d,m,y,w,b){const k=this._convertToCellCoord(e),A=this._convertToCellCoord(o),z=this._convertToCellCoord(l),L=this._convertToCellCoord(d);for(let B=k;B<=z;B++)for(let F=A;F<=L;F++){const X=this.d*F+B;if((!b||b(this._convertFromCellCoord(B),this._convertFromCellCoord(F),this._convertFromCellCoord(B+1),this._convertFromCellCoord(F+1)))&&m.call(this,e,o,l,d,X,y,w,b))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,o=3+this.cells.length+1+1;let l=0;for(let y=0;y<this.cells.length;y++)l+=this.cells[y].length;const d=new Int32Array(o+l+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let m=o;for(let y=0;y<e.length;y++){const w=e[y];d[3+y]=m,d.set(w,m),m+=w.length}return d[3+e.length]=m,d.set(this.keys,m),m+=this.keys.length,d[3+e.length+1]=m,d.set(this.bboxes,m),m+=this.bboxes.length,d.buffer}static serialize(e,o){const l=e.toArrayBuffer();return o&&o.push(l),{buffer:l}}static deserialize(e){return new Ys(e.buffer)}}const ki={};function We(r,e,o={}){if(ki[r])throw new Error(`${r} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),ki[r]={klass:e,omit:o.omit||[],shallow:o.shallow||[]}}We("Object",Object),We("TransferableGridIndex",Ys),We("Color",U),We("Error",Error),We("AJAXError",yr),We("ResolvedImage",ne),We("StylePropertyFunction",Ba),We("StyleExpression",Ra,{omit:["_evaluator"]}),We("ZoomDependentExpression",Kl),We("ZoomConstantExpression",js),We("CompoundExpression",Vt,{omit:["_evaluate"]});for(const r in Ho)Ho[r]._classRegistryKey||We(`Expression_${r}`,Ho[r]);function Kc(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function fo(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob)return r;if(Kc(r)||Gr(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const o=r;return e&&e.push(o.buffer),o}if(r instanceof ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const o=[];for(const l of r)o.push(fo(l,e));return o}if(typeof r=="object"){const o=r.constructor,l=o._classRegistryKey;if(!l)throw new Error("can't serialize object of unregistered class");if(!ki[l])throw new Error(`${l} is not registered.`);const d=o.serialize?o.serialize(r,e):{};if(o.serialize){if(e&&d===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in r){if(!r.hasOwnProperty(m)||ki[l].omit.indexOf(m)>=0)continue;const y=r[m];d[m]=ki[l].shallow.indexOf(m)>=0?y:fo(y,e)}r instanceof Error&&(d.message=r.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(d.$name=l),d}throw new Error("can't serialize object of type "+typeof r)}function Zi(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||Kc(r)||Gr(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Zi);if(typeof r=="object"){const e=r.$name||"Object";if(!ki[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:o}=ki[e];if(!o)throw new Error(`can't deserialize unregistered class ${e}`);if(o.deserialize)return o.deserialize(r);const l=Object.create(o.prototype);for(const d of Object.keys(r)){if(d==="$name")continue;const m=r[d];l[d]=ki[e].shallow.indexOf(d)>=0?m:Zi(m)}return l}throw new Error("can't deserialize object of type "+typeof r)}class eu{constructor(){this.first=!0}update(e,o){const l=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=o),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=l,!0))}}const Ne={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function Va(r){for(const e of r)if(nu(e.charCodeAt(0)))return!0;return!1}function vp(r){for(const e of r)if(!tu(e.charCodeAt(0)))return!1;return!0}function tu(r){return!(Ne.Arabic(r)||Ne["Arabic Supplement"](r)||Ne["Arabic Extended-A"](r)||Ne["Arabic Presentation Forms-A"](r)||Ne["Arabic Presentation Forms-B"](r))}function nu(r){return!(r!==746&&r!==747&&(r<4352||!(Ne["Bopomofo Extended"](r)||Ne.Bopomofo(r)||Ne["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Ne["CJK Compatibility Ideographs"](r)||Ne["CJK Compatibility"](r)||Ne["CJK Radicals Supplement"](r)||Ne["CJK Strokes"](r)||!(!Ne["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Ne["CJK Unified Ideographs Extension A"](r)||Ne["CJK Unified Ideographs"](r)||Ne["Enclosed CJK Letters and Months"](r)||Ne["Hangul Compatibility Jamo"](r)||Ne["Hangul Jamo Extended-A"](r)||Ne["Hangul Jamo Extended-B"](r)||Ne["Hangul Jamo"](r)||Ne["Hangul Syllables"](r)||Ne.Hiragana(r)||Ne["Ideographic Description Characters"](r)||Ne.Kanbun(r)||Ne["Kangxi Radicals"](r)||Ne["Katakana Phonetic Extensions"](r)||Ne.Katakana(r)&&r!==12540||!(!Ne["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Ne["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Ne["Unified Canadian Aboriginal Syllabics"](r)||Ne["Unified Canadian Aboriginal Syllabics Extended"](r)||Ne["Vertical Forms"](r)||Ne["Yijing Hexagram Symbols"](r)||Ne["Yi Syllables"](r)||Ne["Yi Radicals"](r))))}function Jc(r){return!(nu(r)||function(e){return!!(Ne["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ne["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ne["Letterlike Symbols"](e)||Ne["Number Forms"](e)||Ne["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ne["Control Pictures"](e)&&e!==9251||Ne["Optical Character Recognition"](e)||Ne["Enclosed Alphanumerics"](e)||Ne["Geometric Shapes"](e)||Ne["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ne["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ne["CJK Symbols and Punctuation"](e)||Ne.Katakana(e)||Ne["Private Use Area"](e)||Ne["CJK Compatibility Forms"](e)||Ne["Small Form Variants"](e)||Ne["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function Yc(r){return r>=1424&&r<=2303||Ne["Arabic Presentation Forms-A"](r)||Ne["Arabic Presentation Forms-B"](r)}function wp(r,e){return!(!e&&Yc(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Ne.Khmer(r))}function Qc(r){for(const e of r)if(Yc(e.charCodeAt(0)))return!0;return!1}const ru="deferred",iu="loading",ou="loaded";let su=null,or="unavailable",Wi=null;const eh=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(or="error"),su&&su(r)};function es(){au.fire(new bi("pluginStateChange",{pluginStatus:or,pluginURL:Wi}))}const au=new Si,Qs=function(){return or},th=function(){if(or!==ru||!Wi)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");or=iu,es(),Wi&&No({url:Wi},r=>{r?eh(r):(or=ou,es())})},Lr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>or===ou||Lr.applyArabicShaping!=null,isLoading:()=>or===iu,setState(r){if(!et())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");or=r.pluginStatus,Wi=r.pluginURL},isParsed(){if(!et())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Lr.applyArabicShaping!=null&&Lr.processBidirectionalText!=null&&Lr.processStyledBidirectionalText!=null},getPluginURL(){if(!et())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Wi}};class en{constructor(e,o){this.zoom=e,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new eu,this.transition={})}isSupportedScript(e){return function(o,l){for(const d of o)if(!wp(d.charCodeAt(0),l))return!1;return!0}(e,Lr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,o=e-Math.floor(e),l=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*o}}}class ea{constructor(e,o){this.property=e,this.value=o,this.expression=function(l,d){if(Gt(l))return new Ba(l,d);if(Us(l)){const m=Nc(l,d);if(m.result==="error")throw new Error(m.value.map(y=>`${y.key}: ${y.message}`).join(", "));return m.value}{let m=l;return d.type==="color"&&typeof l=="string"?m=U.parse(l):d.type!=="padding"||typeof l!="number"&&!Array.isArray(l)||(m=J.parse(l)),{kind:"constant",evaluate:()=>m}}}(o===void 0?e.specification.default:o,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,o,l){return this.property.possiblyEvaluate(this,e,o,l)}}class ja{constructor(e){this.property=e,this.value=new ea(e,void 0)}transitioned(e,o){return new rh(this.property,this.value,o,_e({},e.transition,this.transition),e.now)}untransitioned(){return new rh(this.property,this.value,null,{},0)}}class nh{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return le(this._values[e].value.value)}setValue(e,o){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ja(this._values[e].property)),this._values[e].value=new ea(this._values[e].property,o===null?void 0:le(o))}getTransition(e){return le(this._values[e].transition)}setTransition(e,o){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new ja(this._values[e].property)),this._values[e].transition=le(o)||void 0}serialize(){const e={};for(const o of Object.keys(this._values)){const l=this.getValue(o);l!==void 0&&(e[o]=l);const d=this.getTransition(o);d!==void 0&&(e[`${o}-transition`]=d)}return e}transitioned(e,o){const l=new ih(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].transitioned(e,o._values[d]);return l}untransitioned(){const e=new ih(this._properties);for(const o of Object.keys(this._values))e._values[o]=this._values[o].untransitioned();return e}}class rh{constructor(e,o,l,d,m){this.property=e,this.value=o,this.begin=m+d.delay||0,this.end=this.begin+d.duration||0,e.specification.transition&&(d.delay||d.duration)&&(this.prior=l)}possiblyEvaluate(e,o,l){const d=e.now||0,m=this.value.possiblyEvaluate(e,o,l),y=this.prior;if(y){if(d>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(d<this.begin)return y.possiblyEvaluate(e,o,l);{const w=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,o,l),m,function(b){if(b<=0)return 0;if(b>=1)return 1;const k=b*b,A=k*b;return 4*(b<.5?A:3*(b-k)+A-.75)}(w))}}return m}}class ih{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,o,l){const d=new ta(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(e,o,l);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class bp{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return le(this._values[e].value)}setValue(e,o){this._values[e]=new ea(this._values[e].property,o===null?void 0:le(o))}serialize(){const e={};for(const o of Object.keys(this._values)){const l=this.getValue(o);l!==void 0&&(e[o]=l)}return e}possiblyEvaluate(e,o,l){const d=new ta(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(e,o,l);return d}}class li{constructor(e,o,l){this.property=e,this.value=o,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,o,l,d){return this.property.evaluate(this.value,this.parameters,e,o,l,d)}}class ta{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ye{constructor(e){this.specification=e}possiblyEvaluate(e,o){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(o)}interpolate(e,o,l){const d=Bs[this.specification.type];return d?d(e,o,l):e}}class st{constructor(e,o){this.specification=e,this.overrides=o}possiblyEvaluate(e,o,l,d){return new li(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(o,null,{},l,d)}:e.expression,o)}interpolate(e,o,l){if(e.value.kind!=="constant"||o.value.kind!=="constant")return e;if(e.value.value===void 0||o.value.value===void 0)return new li(this,{kind:"constant",value:void 0},e.parameters);const d=Bs[this.specification.type];return d?new li(this,{kind:"constant",value:d(e.value.value,o.value.value,l)},e.parameters):e}evaluate(e,o,l,d,m,y){return e.kind==="constant"?e.value:e.evaluate(o,l,d,m,y)}}class ts extends st{possiblyEvaluate(e,o,l,d){if(e.value===void 0)return new li(this,{kind:"constant",value:void 0},o);if(e.expression.kind==="constant"){const m=e.expression.evaluate(o,null,{},l,d),y=e.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,w=this._calculate(y,y,y,o);return new li(this,{kind:"constant",value:w},o)}if(e.expression.kind==="camera"){const m=this._calculate(e.expression.evaluate({zoom:o.zoom-1}),e.expression.evaluate({zoom:o.zoom}),e.expression.evaluate({zoom:o.zoom+1}),o);return new li(this,{kind:"constant",value:m},o)}return new li(this,e.expression,o)}evaluate(e,o,l,d,m,y){if(e.kind==="source"){const w=e.evaluate(o,l,d,m,y);return this._calculate(w,w,w,o)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(o.zoom)-1},l,d),e.evaluate({zoom:Math.floor(o.zoom)},l,d),e.evaluate({zoom:Math.floor(o.zoom)+1},l,d),o):e.value}_calculate(e,o,l,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:o}:{from:l,to:o}}interpolate(e){return e}}class lu{constructor(e){this.specification=e}possiblyEvaluate(e,o,l,d){if(e.value!==void 0){if(e.expression.kind==="constant"){const m=e.expression.evaluate(o,null,{},l,d);return this._calculate(m,m,m,o)}return this._calculate(e.expression.evaluate(new en(Math.floor(o.zoom-1),o)),e.expression.evaluate(new en(Math.floor(o.zoom),o)),e.expression.evaluate(new en(Math.floor(o.zoom+1),o)),o)}}_calculate(e,o,l,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:o}:{from:l,to:o}}interpolate(e){return e}}class Hi{constructor(e){this.specification=e}possiblyEvaluate(e,o,l,d){return!!e.expression.evaluate(o,null,{},l,d)}interpolate(){return!1}}class Rn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const o in e){const l=e[o];l.specification.overridable&&this.overridableProperties.push(o);const d=this.defaultPropertyValues[o]=new ea(l,void 0),m=this.defaultTransitionablePropertyValues[o]=new ja(l);this.defaultTransitioningPropertyValues[o]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=d.possiblyEvaluate({})}}}We("DataDrivenProperty",st),We("DataConstantProperty",Ye),We("CrossFadedDataDrivenProperty",ts),We("CrossFadedProperty",lu),We("ColorRampProperty",Hi);const Xi="-transition";class ui extends Si{constructor(e,o){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),o.layout&&(this._unevaluatedLayout=new bp(o.layout)),o.paint)){this._transitionablePaint=new nh(o.paint);for(const l in e.paint)this.setPaintProperty(l,e.paint[l],{validate:!1});for(const l in e.layout)this.setLayoutProperty(l,e.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ta(o.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,o,l={}){o!=null&&this._validate(xp,`layers.${this.id}.layout.${e}`,e,o,l)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,o):this.visibility=o)}getPaintProperty(e){return e.endsWith(Xi)?this._transitionablePaint.getTransition(e.slice(0,-Xi.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,o,l={}){if(o!=null&&this._validate(_p,`layers.${this.id}.paint.${e}`,e,o,l))return!1;if(e.endsWith(Xi))return this._transitionablePaint.setTransition(e.slice(0,-Xi.length),o||void 0),!1;{const d=this._transitionablePaint._values[e],m=d.property.specification["property-type"]==="cross-faded-data-driven",y=d.value.isDataDriven(),w=d.value;this._transitionablePaint.setValue(e,o),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value;return b.isDataDriven()||y||m||this._handleOverridablePaintPropertyUpdate(e,w,b)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,o,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,o){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,o)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Q(e,(o,l)=>!(o===void 0||l==="layout"&&!Object.keys(o).length||l==="paint"&&!Object.keys(o).length))}_validate(e,o,l,d,m={}){return(!m||m.validate!==!1)&&Ua(this,e.call(Js,{key:o,layerType:this.type,objectKey:l,value:d,styleSpec:we,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const o=this.paint.get(e);if(o instanceof li&&Wt(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}}const oh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ki{constructor(e,o){this._structArray=e,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ln{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,o){return e._trim(),o&&(e.isTransferred=!0,o.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const o=Object.create(this.prototype);return o.arrayBuffer=e.arrayBuffer,o.length=e.length,o.capacity=e.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function yn(r,e=1){let o=0,l=0;return{members:r.map(d=>{const m=oh[d.type].BYTES_PER_ELEMENT,y=o=uu(o,Math.max(e,m)),w=d.components||1;return l=Math.max(l,m),o+=m*w,{name:d.name,type:d.type,components:w,offset:y}}),size:uu(o,Math.max(l,e)),alignment:e}}function uu(r,e){return Math.ceil(r/e)*e}class mo extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,o)}emplace(e,o,l){const d=2*e;return this.int16[d+0]=o,this.int16[d+1]=l,e}}mo.prototype.bytesPerElement=4,We("StructArrayLayout2i4",mo);class h extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,o,l,d)}emplace(e,o,l,d,m){const y=4*e;return this.int16[y+0]=o,this.int16[y+1]=l,this.int16[y+2]=d,this.int16[y+3]=m,e}}h.prototype.bytesPerElement=8,We("StructArrayLayout4i8",h);class t extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,l,d,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,o,l,d,m,y)}emplace(e,o,l,d,m,y,w){const b=6*e;return this.int16[b+0]=o,this.int16[b+1]=l,this.int16[b+2]=d,this.int16[b+3]=m,this.int16[b+4]=y,this.int16[b+5]=w,e}}t.prototype.bytesPerElement=12,We("StructArrayLayout2i4i12",t);class s extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,l,d,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,o,l,d,m,y)}emplace(e,o,l,d,m,y,w){const b=4*e,k=8*e;return this.int16[b+0]=o,this.int16[b+1]=l,this.uint8[k+4]=d,this.uint8[k+5]=m,this.uint8[k+6]=y,this.uint8[k+7]=w,e}}s.prototype.bytesPerElement=8,We("StructArrayLayout2i4ub8",s);class c extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,o)}emplace(e,o,l){const d=2*e;return this.float32[d+0]=o,this.float32[d+1]=l,e}}c.prototype.bytesPerElement=8,We("StructArrayLayout2f8",c);class p extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,l,d,m,y,w,b,k,A){const z=this.length;return this.resize(z+1),this.emplace(z,e,o,l,d,m,y,w,b,k,A)}emplace(e,o,l,d,m,y,w,b,k,A,z){const L=10*e;return this.uint16[L+0]=o,this.uint16[L+1]=l,this.uint16[L+2]=d,this.uint16[L+3]=m,this.uint16[L+4]=y,this.uint16[L+5]=w,this.uint16[L+6]=b,this.uint16[L+7]=k,this.uint16[L+8]=A,this.uint16[L+9]=z,e}}p.prototype.bytesPerElement=20,We("StructArrayLayout10ui20",p);class g extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,l,d,m,y,w,b,k,A,z,L){const B=this.length;return this.resize(B+1),this.emplace(B,e,o,l,d,m,y,w,b,k,A,z,L)}emplace(e,o,l,d,m,y,w,b,k,A,z,L,B){const F=12*e;return this.int16[F+0]=o,this.int16[F+1]=l,this.int16[F+2]=d,this.int16[F+3]=m,this.uint16[F+4]=y,this.uint16[F+5]=w,this.uint16[F+6]=b,this.uint16[F+7]=k,this.int16[F+8]=A,this.int16[F+9]=z,this.int16[F+10]=L,this.int16[F+11]=B,e}}g.prototype.bytesPerElement=24,We("StructArrayLayout4i4ui4i24",g);class v extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,l)}emplace(e,o,l,d){const m=3*e;return this.float32[m+0]=o,this.float32[m+1]=l,this.float32[m+2]=d,e}}v.prototype.bytesPerElement=12,We("StructArrayLayout3f12",v);class S extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint32[1*e+0]=o,e}}S.prototype.bytesPerElement=4,We("StructArrayLayout1ul4",S);class E extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,l,d,m,y,w,b,k){const A=this.length;return this.resize(A+1),this.emplace(A,e,o,l,d,m,y,w,b,k)}emplace(e,o,l,d,m,y,w,b,k,A){const z=10*e,L=5*e;return this.int16[z+0]=o,this.int16[z+1]=l,this.int16[z+2]=d,this.int16[z+3]=m,this.int16[z+4]=y,this.int16[z+5]=w,this.uint32[L+3]=b,this.uint16[z+8]=k,this.uint16[z+9]=A,e}}E.prototype.bytesPerElement=20,We("StructArrayLayout6i1ul2ui20",E);class C extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,l,d,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,o,l,d,m,y)}emplace(e,o,l,d,m,y,w){const b=6*e;return this.int16[b+0]=o,this.int16[b+1]=l,this.int16[b+2]=d,this.int16[b+3]=m,this.int16[b+4]=y,this.int16[b+5]=w,e}}C.prototype.bytesPerElement=12,We("StructArrayLayout2i2i2i12",C);class P extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,l,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,o,l,d,m)}emplace(e,o,l,d,m,y){const w=4*e,b=8*e;return this.float32[w+0]=o,this.float32[w+1]=l,this.float32[w+2]=d,this.int16[b+6]=m,this.int16[b+7]=y,e}}P.prototype.bytesPerElement=16,We("StructArrayLayout2f1f2i16",P);class D extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,o,l,d)}emplace(e,o,l,d,m){const y=12*e,w=3*e;return this.uint8[y+0]=o,this.uint8[y+1]=l,this.float32[w+1]=d,this.float32[w+2]=m,e}}D.prototype.bytesPerElement=12,We("StructArrayLayout2ub2f12",D);class R extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,l)}emplace(e,o,l,d){const m=3*e;return this.uint16[m+0]=o,this.uint16[m+1]=l,this.uint16[m+2]=d,e}}R.prototype.bytesPerElement=6,We("StructArrayLayout3ui6",R);class q extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,l,d,m,y,w,b,k,A,z,L,B,F,X,H,ae){const fe=this.length;return this.resize(fe+1),this.emplace(fe,e,o,l,d,m,y,w,b,k,A,z,L,B,F,X,H,ae)}emplace(e,o,l,d,m,y,w,b,k,A,z,L,B,F,X,H,ae,fe){const ie=24*e,de=12*e,Ee=48*e;return this.int16[ie+0]=o,this.int16[ie+1]=l,this.uint16[ie+2]=d,this.uint16[ie+3]=m,this.uint32[de+2]=y,this.uint32[de+3]=w,this.uint32[de+4]=b,this.uint16[ie+10]=k,this.uint16[ie+11]=A,this.uint16[ie+12]=z,this.float32[de+7]=L,this.float32[de+8]=B,this.uint8[Ee+36]=F,this.uint8[Ee+37]=X,this.uint8[Ee+38]=H,this.uint32[de+10]=ae,this.int16[ie+22]=fe,e}}q.prototype.bytesPerElement=48,We("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",q);class j extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,l,d,m,y,w,b,k,A,z,L,B,F,X,H,ae,fe,ie,de,Ee,Se,qe,Xe,Ue,Re,Me,Ve){const Oe=this.length;return this.resize(Oe+1),this.emplace(Oe,e,o,l,d,m,y,w,b,k,A,z,L,B,F,X,H,ae,fe,ie,de,Ee,Se,qe,Xe,Ue,Re,Me,Ve)}emplace(e,o,l,d,m,y,w,b,k,A,z,L,B,F,X,H,ae,fe,ie,de,Ee,Se,qe,Xe,Ue,Re,Me,Ve,Oe){const Ae=34*e,it=17*e;return this.int16[Ae+0]=o,this.int16[Ae+1]=l,this.int16[Ae+2]=d,this.int16[Ae+3]=m,this.int16[Ae+4]=y,this.int16[Ae+5]=w,this.int16[Ae+6]=b,this.int16[Ae+7]=k,this.uint16[Ae+8]=A,this.uint16[Ae+9]=z,this.uint16[Ae+10]=L,this.uint16[Ae+11]=B,this.uint16[Ae+12]=F,this.uint16[Ae+13]=X,this.uint16[Ae+14]=H,this.uint16[Ae+15]=ae,this.uint16[Ae+16]=fe,this.uint16[Ae+17]=ie,this.uint16[Ae+18]=de,this.uint16[Ae+19]=Ee,this.uint16[Ae+20]=Se,this.uint16[Ae+21]=qe,this.uint16[Ae+22]=Xe,this.uint32[it+12]=Ue,this.float32[it+13]=Re,this.float32[it+14]=Me,this.float32[it+15]=Ve,this.float32[it+16]=Oe,e}}j.prototype.bytesPerElement=68,We("StructArrayLayout8i15ui1ul4f68",j);class $ extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.float32[1*e+0]=o,e}}$.prototype.bytesPerElement=4,We("StructArrayLayout1f4",$);class ee extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,l)}emplace(e,o,l,d){const m=3*e;return this.int16[m+0]=o,this.int16[m+1]=l,this.int16[m+2]=d,e}}ee.prototype.bytesPerElement=6,We("StructArrayLayout3i6",ee);class re extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,l)}emplace(e,o,l,d){const m=4*e;return this.uint32[2*e+0]=o,this.uint16[m+2]=l,this.uint16[m+3]=d,e}}re.prototype.bytesPerElement=8,We("StructArrayLayout1ul2ui8",re);class ce extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,o)}emplace(e,o,l){const d=2*e;return this.uint16[d+0]=o,this.uint16[d+1]=l,e}}ce.prototype.bytesPerElement=4,We("StructArrayLayout2ui4",ce);class W extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint16[1*e+0]=o,e}}W.prototype.bytesPerElement=2,We("StructArrayLayout1ui2",W);class pe extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,o,l,d)}emplace(e,o,l,d,m){const y=4*e;return this.float32[y+0]=o,this.float32[y+1]=l,this.float32[y+2]=d,this.float32[y+3]=m,e}}pe.prototype.bytesPerElement=16,We("StructArrayLayout4f16",pe);class he extends Ki{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new at(this.anchorPointX,this.anchorPointY)}}he.prototype.size=20;class xe extends E{get(e){return new he(this,e)}}We("CollisionBoxArray",xe);class ve extends Ki{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ve.prototype.size=48;class Ie extends q{get(e){return new ve(this,e)}}We("PlacedSymbolArray",Ie);class ye extends Ki{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}ye.prototype.size=68;class $e extends j{get(e){return new ye(this,e)}}We("SymbolInstanceArray",$e);class Le extends ${getoffsetX(e){return this.float32[1*e+0]}}We("GlyphOffsetArray",Le);class Ge extends ee{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}We("SymbolLineVertexArray",Ge);class ft extends Ki{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ft.prototype.size=8;class _t extends re{get(e){return new ft(this,e)}}We("FeatureIndexArray",_t);class rt extends mo{}class Lt extends mo{}class Rt extends mo{}class Et extends t{}class At extends s{}class Nt extends c{}class In extends p{}class ci extends g{}class Hr extends v{}class hi extends S{}class Ji extends C{}class Rr extends D{}class sr extends R{}class Ci extends ce{}const $a=yn([{name:"a_pos",components:2,type:"Int16"}],4),{members:bn}=$a;class vt{constructor(e=[]){this.segments=e}prepareSegment(e,o,l,d){let m=this.segments[this.segments.length-1];return e>vt.MAX_VERTEX_ARRAY_LENGTH&&Be(`Max vertices per segment is ${vt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>vt.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==d)&&(m={vertexOffset:o.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},d!==void 0&&(m.sortKey=d),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const e of this.segments)for(const o in e.vaos)e.vaos[o].destroy()}static simpleSegment(e,o,l,d){return new vt([{vertexOffset:e,primitiveOffset:o,vertexLength:l,primitiveLength:d,vaos:{},sortKey:0}])}}function Dt(r,e){return 256*(r=G(Math.floor(r),0,255))+G(Math.floor(e),0,255)}vt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,We("SegmentVector",vt);const An=yn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Pn={exports:{}},tn={exports:{}};tn.exports=function(r,e){var o,l,d,m,y,w,b,k;for(l=r.length-(o=3&r.length),d=e,y=3432918353,w=461845907,k=0;k<l;)b=255&r.charCodeAt(k)|(255&r.charCodeAt(++k))<<8|(255&r.charCodeAt(++k))<<16|(255&r.charCodeAt(++k))<<24,++k,d=27492+(65535&(m=5*(65535&(d=(d^=b=(65535&(b=(b=(65535&b)*y+(((b>>>16)*y&65535)<<16)&4294967295)<<15|b>>>17))*w+(((b>>>16)*w&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(b=0,o){case 3:b^=(255&r.charCodeAt(k+2))<<16;case 2:b^=(255&r.charCodeAt(k+1))<<8;case 1:d^=b=(65535&(b=(b=(65535&(b^=255&r.charCodeAt(k)))*y+(((b>>>16)*y&65535)<<16)&4294967295)<<15|b>>>17))*w+(((b>>>16)*w&65535)<<16)&4294967295}return d^=r.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0};var Br={exports:{}};Br.exports=function(r,e){for(var o,l=r.length,d=e^l,m=0;l>=4;)o=1540483477*(65535&(o=255&r.charCodeAt(m)|(255&r.charCodeAt(++m))<<8|(255&r.charCodeAt(++m))<<16|(255&r.charCodeAt(++m))<<24))+((1540483477*(o>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),l-=4,++m;switch(l){case 3:d^=(255&r.charCodeAt(m+2))<<16;case 2:d^=(255&r.charCodeAt(m+1))<<8;case 1:d=1540483477*(65535&(d^=255&r.charCodeAt(m)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};var go=tn.exports,cu=Br.exports;Pn.exports=go,Pn.exports.murmur3=go,Pn.exports.murmur2=cu;class ns{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,o,l,d){this.ids.push(sh(e)),this.positions.push(o,l,d)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const o=sh(e);let l=0,d=this.ids.length-1;for(;l<d;){const y=l+d>>1;this.ids[y]>=o?d=y:l=y+1}const m=[];for(;this.ids[l]===o;)m.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return m}static serialize(e,o){const l=new Float64Array(e.ids),d=new Uint32Array(e.positions);return hu(l,d,0,l.length-1),o&&o.push(l.buffer,d.buffer),{ids:l,positions:d}}static deserialize(e){const o=new ns;return o.ids=e.ids,o.positions=e.positions,o.indexed=!0,o}}function sh(r){const e=+r;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Pn.exports(String(r))}function hu(r,e,o,l){for(;o<l;){const d=r[o+l>>1];let m=o-1,y=l+1;for(;;){do m++;while(r[m]<d);do y--;while(r[y]>d);if(m>=y)break;Yi(r,m,y),Yi(e,3*m,3*y),Yi(e,3*m+1,3*y+1),Yi(e,3*m+2,3*y+2)}y-o<l-y?(hu(r,e,o,y),o=y+1):(hu(r,e,y+1,l),l=y)}}function Yi(r,e,o){const l=r[e];r[e]=r[o],r[o]=l}We("FeaturePositionMap",ns);class yo{constructor(e,o){this.gl=e.gl,this.location=o}}class _o extends yo{constructor(e,o){super(e,o),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Ga extends yo{constructor(e,o){super(e,o),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Og extends yo{constructor(e,o){super(e,o),this.current=U.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const y1=new Float32Array(16);function Sp(r){return[Dt(255*r.r,255*r.g),Dt(255*r.b,255*r.a)]}class du{constructor(e,o,l){this.value=e,this.uniformNames=o.map(d=>`u_${d}`),this.type=l}setUniform(e,o,l){e.set(l.constantOr(this.value))}getBinding(e,o,l){return this.type==="color"?new Og(e,o):new _o(e,o)}}class qa{constructor(e,o){this.uniformNames=o.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=e.tlbr}setUniform(e,o,l,d){const m=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&e.set(m)}getBinding(e,o,l){return l.substr(0,9)==="u_pattern"?new Ga(e,o):new _o(e,o)}}class xo{constructor(e,o,l,d){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=o.map(m=>({name:`a_${m}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,o,l,d,m){const y=this.paintVertexArray.length,w=this.expression.evaluate(new en(0),o,{},d,[],m);this.paintVertexArray.resize(e),this._setPaintValue(y,e,w)}updatePaintArray(e,o,l,d){const m=this.expression.evaluate({zoom:0},l,d);this._setPaintValue(e,o,m)}_setPaintValue(e,o,l){if(this.type==="color"){const d=Sp(l);for(let m=e;m<o;m++)this.paintVertexArray.emplace(m,d[0],d[1])}else{for(let d=e;d<o;d++)this.paintVertexArray.emplace(d,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ii{constructor(e,o,l,d,m,y){this.expression=e,this.uniformNames=o.map(w=>`u_${w}_t`),this.type=l,this.useIntegerZoom=d,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=o.map(w=>({name:`a_${w}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,o,l,d,m){const y=this.expression.evaluate(new en(this.zoom),o,{},d,[],m),w=this.expression.evaluate(new en(this.zoom+1),o,{},d,[],m),b=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(b,e,y,w)}updatePaintArray(e,o,l,d){const m=this.expression.evaluate({zoom:this.zoom},l,d),y=this.expression.evaluate({zoom:this.zoom+1},l,d);this._setPaintValue(e,o,m,y)}_setPaintValue(e,o,l,d){if(this.type==="color"){const m=Sp(l),y=Sp(d);for(let w=e;w<o;w++)this.paintVertexArray.emplace(w,m[0],m[1],y[0],y[1])}else{for(let m=e;m<o;m++)this.paintVertexArray.emplace(m,l,d);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,o){const l=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,d=G(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);e.set(d)}getBinding(e,o,l){return new _o(e,o)}}class rs{constructor(e,o,l,d,m,y){this.expression=e,this.type=o,this.useIntegerZoom=l,this.zoom=d,this.layerId=y,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,o,l){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(d,e,o.patterns&&o.patterns[this.layerId],l)}updatePaintArray(e,o,l,d,m){this._setPaintValues(e,o,l.patterns&&l.patterns[this.layerId],m)}_setPaintValues(e,o,l,d){if(!d||!l)return;const{min:m,mid:y,max:w}=l,b=d[m],k=d[y],A=d[w];if(b&&k&&A)for(let z=e;z<o;z++)this.zoomInPaintVertexArray.emplace(z,k.tl[0],k.tl[1],k.br[0],k.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],k.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(z,k.tl[0],k.tl[1],k.br[0],k.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],k.pixelRatio,A.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,An.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,An.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ng{constructor(e,o,l){this.binders={},this._buffers=[];const d=[];for(const m in e.paint._values){if(!l(m))continue;const y=e.paint.get(m);if(!(y instanceof li&&Wt(y.property.specification)))continue;const w=_1(m,e.type),b=y.value,k=y.property.specification.type,A=y.property.useIntegerZoom,z=y.property.specification["property-type"],L=z==="cross-faded"||z==="cross-faded-data-driven";if(b.kind==="constant")this.binders[m]=L?new qa(b.value,w):new du(b.value,w,k),d.push(`/u_${m}`);else if(b.kind==="source"||L){const B=Ug(m,k,"source");this.binders[m]=L?new rs(b,k,A,o,B,e.id):new xo(b,w,k,B),d.push(`/a_${m}`)}else{const B=Ug(m,k,"composite");this.binders[m]=new Ii(b,w,k,A,o,B),d.push(`/z_${m}`)}}this.cacheKey=d.sort().join("")}getMaxValue(e){const o=this.binders[e];return o instanceof xo||o instanceof Ii?o.maxValue:0}populatePaintArrays(e,o,l,d,m){for(const y in this.binders){const w=this.binders[y];(w instanceof xo||w instanceof Ii||w instanceof rs)&&w.populatePaintArray(e,o,l,d,m)}}setConstantPatternPositions(e,o){for(const l in this.binders){const d=this.binders[l];d instanceof qa&&d.setConstantPatternPositions(e,o)}}updatePaintArrays(e,o,l,d,m){let y=!1;for(const w in e){const b=o.getPositions(w);for(const k of b){const A=l.feature(k.index);for(const z in this.binders){const L=this.binders[z];if((L instanceof xo||L instanceof Ii||L instanceof rs)&&L.expression.isStateDependent===!0){const B=d.paint.get(z);L.expression=B.value,L.updatePaintArray(k.start,k.end,A,e[w],m),y=!0}}}}return y}defines(){const e=[];for(const o in this.binders){const l=this.binders[o];(l instanceof du||l instanceof qa)&&e.push(...l.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return e}getBinderAttributes(){const e=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof xo||l instanceof Ii)for(let d=0;d<l.paintVertexAttributes.length;d++)e.push(l.paintVertexAttributes[d].name);else if(l instanceof rs)for(let d=0;d<An.members.length;d++)e.push(An.members[d].name)}return e}getBinderUniforms(){const e=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof du||l instanceof qa||l instanceof Ii)for(const d of l.uniformNames)e.push(d)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,o){const l=[];for(const d in this.binders){const m=this.binders[d];if(m instanceof du||m instanceof qa||m instanceof Ii){for(const y of m.uniformNames)if(o[y]){const w=m.getBinding(e,o[y],y);l.push({name:y,property:d,binding:w})}}}return l}setUniforms(e,o,l,d){for(const{name:m,property:y,binding:w}of o)this.binders[y].setUniform(w,d,l.get(y),m)}updatePaintBuffers(e){this._buffers=[];for(const o in this.binders){const l=this.binders[o];if(e&&l instanceof rs){const d=e.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(l instanceof xo||l instanceof Ii)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(e){for(const o in this.binders){const l=this.binders[o];(l instanceof xo||l instanceof Ii||l instanceof rs)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const o=this.binders[e];(o instanceof xo||o instanceof Ii||o instanceof rs)&&o.destroy()}}}class na{constructor(e,o,l=()=>!0){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new Ng(d,o,l);this.needsUpload=!1,this._featureMap=new ns,this._bufferOffset=0}populatePaintArrays(e,o,l,d,m,y){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,o,d,m,y);o.id!==void 0&&this._featureMap.add(o.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,o,l,d){for(const m of l)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,o,m,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function _1(r,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}function Ug(r,e,o){const l={color:{source:c,composite:pe},number:{source:$,composite:c}},d=function(m){return{"line-pattern":{source:In,composite:In},"fill-pattern":{source:In,composite:In},"fill-extrusion-pattern":{source:In,composite:In}}[m]}(r);return d&&d[o]||l[e][o]}We("ConstantBinder",du),We("CrossFadedConstantBinder",qa),We("SourceExpressionBinder",xo),We("CrossFadedCompositeBinder",rs),We("CompositeExpressionBinder",Ii),We("ProgramConfiguration",Ng,{omit:["_buffers"]}),We("ProgramConfigurationSet",na);var Sn=8192;const Ep=Math.pow(2,14)-1,Vg=-Ep-1;function ra(r){const e=Sn/r.extent,o=r.loadGeometry();for(let l=0;l<o.length;l++){const d=o[l];for(let m=0;m<d.length;m++){const y=d[m],w=Math.round(y.x*e),b=Math.round(y.y*e);y.x=G(w,Vg,Ep),y.y=G(b,Vg,Ep),(w<y.x||w>y.x+1||b<y.y||b>y.y+1)&&Be("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return o}function ia(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?ra(r):[]}}function ah(r,e,o,l,d){r.emplaceBack(2*e+(l+1)/2,2*o+(d+1)/2)}class Tp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Lt,this.indexArray=new sr,this.segments=new vt,this.programConfigurations=new na(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,l){const d=this.layers[0],m=[];let y=null,w=!1;d.type==="circle"&&(y=d.layout.get("circle-sort-key"),w=!y.isConstant());for(const{feature:b,id:k,index:A,sourceLayerIndex:z}of e){const L=this.layers[0]._featureFilter.needGeometry,B=ia(b,L);if(!this.layers[0]._featureFilter.filter(new en(this.zoom),B,l))continue;const F=w?y.evaluate(B,{},l):void 0,X={id:k,properties:b.properties,type:b.type,sourceLayerIndex:z,index:A,geometry:L?B.geometry:ra(b),patterns:{},sortKey:F};m.push(X)}w&&m.sort((b,k)=>b.sortKey-k.sortKey);for(const b of m){const{geometry:k,index:A,sourceLayerIndex:z}=b,L=e[A].feature;this.addFeature(b,k,A,l),o.featureIndex.insert(L,k,A,z,this.index)}}update(e,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bn),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,o,l,d){for(const m of o)for(const y of m){const w=y.x,b=y.y;if(w<0||w>=Sn||b<0||b>=Sn)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),A=k.vertexLength;ah(this.layoutVertexArray,w,b,-1,-1),ah(this.layoutVertexArray,w,b,1,-1),ah(this.layoutVertexArray,w,b,1,1),ah(this.layoutVertexArray,w,b,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+3,A+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},d)}}function jg(r,e){for(let o=0;o<r.length;o++)if(Za(e,r[o]))return!0;for(let o=0;o<e.length;o++)if(Za(r,e[o]))return!0;return!!kp(r,e)}function x1(r,e,o){return!!Za(r,e)||!!Cp(e,r,o)}function $g(r,e){if(r.length===1)return qg(e,r[0]);for(let o=0;o<e.length;o++){const l=e[o];for(let d=0;d<l.length;d++)if(Za(r,l[d]))return!0}for(let o=0;o<r.length;o++)if(qg(e,r[o]))return!0;for(let o=0;o<e.length;o++)if(kp(r,e[o]))return!0;return!1}function v1(r,e,o){if(r.length>1){if(kp(r,e))return!0;for(let l=0;l<e.length;l++)if(Cp(e[l],r,o))return!0}for(let l=0;l<r.length;l++)if(Cp(r[l],e,o))return!0;return!1}function kp(r,e){if(r.length===0||e.length===0)return!1;for(let o=0;o<r.length-1;o++){const l=r[o],d=r[o+1];for(let m=0;m<e.length-1;m++)if(w1(l,d,e[m],e[m+1]))return!0}return!1}function w1(r,e,o,l){return Ke(r,o,l)!==Ke(e,o,l)&&Ke(r,e,o)!==Ke(r,e,l)}function Cp(r,e,o){const l=o*o;if(e.length===1)return r.distSqr(e[0])<l;for(let d=1;d<e.length;d++)if(Gg(r,e[d-1],e[d])<l)return!0;return!1}function Gg(r,e,o){const l=e.distSqr(o);if(l===0)return r.distSqr(e);const d=((r.x-e.x)*(o.x-e.x)+(r.y-e.y)*(o.y-e.y))/l;return r.distSqr(d<0?e:d>1?o:o.sub(e)._mult(d)._add(e))}function qg(r,e){let o,l,d,m=!1;for(let y=0;y<r.length;y++){o=r[y];for(let w=0,b=o.length-1;w<o.length;b=w++)l=o[w],d=o[b],l.y>e.y!=d.y>e.y&&e.x<(d.x-l.x)*(e.y-l.y)/(d.y-l.y)+l.x&&(m=!m)}return m}function Za(r,e){let o=!1;for(let l=0,d=r.length-1;l<r.length;d=l++){const m=r[l],y=r[d];m.y>e.y!=y.y>e.y&&e.x<(y.x-m.x)*(e.y-m.y)/(y.y-m.y)+m.x&&(o=!o)}return o}function b1(r,e,o){const l=o[0],d=o[2];if(r.x<l.x&&e.x<l.x||r.x>d.x&&e.x>d.x||r.y<l.y&&e.y<l.y||r.y>d.y&&e.y>d.y)return!1;const m=Ke(r,e,o[0]);return m!==Ke(r,e,o[1])||m!==Ke(r,e,o[2])||m!==Ke(r,e,o[3])}function pu(r,e,o){const l=e.paint.get(r).value;return l.kind==="constant"?l.value:o.programConfigurations.get(e.id).getMaxValue(r)}function lh(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function uh(r,e,o,l,d){if(!e[0]&&!e[1])return r;const m=at.convert(e)._mult(d);o==="viewport"&&m._rotate(-l);const y=[];for(let w=0;w<r.length;w++)y.push(r[w].sub(m));return y}We("CircleBucket",Tp,{omit:["layers"]});const S1=new Rn({"circle-sort-key":new st(we.layout_circle["circle-sort-key"])});var E1={paint:new Rn({"circle-radius":new st(we.paint_circle["circle-radius"]),"circle-color":new st(we.paint_circle["circle-color"]),"circle-blur":new st(we.paint_circle["circle-blur"]),"circle-opacity":new st(we.paint_circle["circle-opacity"]),"circle-translate":new Ye(we.paint_circle["circle-translate"]),"circle-translate-anchor":new Ye(we.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ye(we.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ye(we.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new st(we.paint_circle["circle-stroke-width"]),"circle-stroke-color":new st(we.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new st(we.paint_circle["circle-stroke-opacity"])}),layout:S1},ar=1e-6,lr=typeof Float32Array<"u"?Float32Array:Array;function Zg(){var r=new lr(9);return lr!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function Ip(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Wg(r,e,o){var l=e[0],d=e[1],m=e[2],y=e[3],w=e[4],b=e[5],k=e[6],A=e[7],z=e[8],L=e[9],B=e[10],F=e[11],X=e[12],H=e[13],ae=e[14],fe=e[15],ie=o[0],de=o[1],Ee=o[2],Se=o[3];return r[0]=ie*l+de*w+Ee*z+Se*X,r[1]=ie*d+de*b+Ee*L+Se*H,r[2]=ie*m+de*k+Ee*B+Se*ae,r[3]=ie*y+de*A+Ee*F+Se*fe,r[4]=(ie=o[4])*l+(de=o[5])*w+(Ee=o[6])*z+(Se=o[7])*X,r[5]=ie*d+de*b+Ee*L+Se*H,r[6]=ie*m+de*k+Ee*B+Se*ae,r[7]=ie*y+de*A+Ee*F+Se*fe,r[8]=(ie=o[8])*l+(de=o[9])*w+(Ee=o[10])*z+(Se=o[11])*X,r[9]=ie*d+de*b+Ee*L+Se*H,r[10]=ie*m+de*k+Ee*B+Se*ae,r[11]=ie*y+de*A+Ee*F+Se*fe,r[12]=(ie=o[12])*l+(de=o[13])*w+(Ee=o[14])*z+(Se=o[15])*X,r[13]=ie*d+de*b+Ee*L+Se*H,r[14]=ie*m+de*k+Ee*B+Se*ae,r[15]=ie*y+de*A+Ee*F+Se*fe,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var fu,T1=Wg;function Hg(){var r=new lr(3);return lr!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Xg(r,e,o){var l=new lr(3);return l[0]=r,l[1]=e,l[2]=o,l}function ch(r,e,o){var l=e[0],d=e[1],m=e[2],y=e[3];return r[0]=o[0]*l+o[4]*d+o[8]*m+o[12]*y,r[1]=o[1]*l+o[5]*d+o[9]*m+o[13]*y,r[2]=o[2]*l+o[6]*d+o[10]*m+o[14]*y,r[3]=o[3]*l+o[7]*d+o[11]*m+o[15]*y,r}function Kg(){var r=new lr(4);return lr!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Jg(r,e){const o=ch([],[r.x,r.y,0,1],e);return new at(o[0]/o[3],o[1]/o[3])}Hg(),fu=new lr(4),lr!=Float32Array&&(fu[0]=0,fu[1]=0,fu[2]=0,fu[3]=0),Hg(),Xg(1,0,0),Xg(0,1,0),Kg(),Kg(),Zg(),function(){var r;r=new lr(2),lr!=Float32Array&&(r[0]=0,r[1]=0)}();class Yg extends Tp{}We("HeatmapBucket",Yg,{omit:["layers"]});var k1={paint:new Rn({"heatmap-radius":new st(we.paint_heatmap["heatmap-radius"]),"heatmap-weight":new st(we.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ye(we.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Hi(we.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ye(we.paint_heatmap["heatmap-opacity"])})};function Ap(r,{width:e,height:o},l,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*o*l)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${e*o*l}`)}else d=new Uint8Array(e*o*l);return r.width=e,r.height=o,r.data=d,r}function Qg(r,{width:e,height:o},l){if(e===r.width&&o===r.height)return;const d=Ap({},{width:e,height:o},l);Pp(r,d,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,o)},l),r.width=e,r.height=o,r.data=d.data}function Pp(r,e,o,l,d,m){if(d.width===0||d.height===0)return e;if(d.width>r.width||d.height>r.height||o.x>r.width-d.width||o.y>r.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||l.x>e.width-d.width||l.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const y=r.data,w=e.data;if(y===w)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<d.height;b++){const k=((o.y+b)*r.width+o.x)*m,A=((l.y+b)*e.width+l.x)*m;for(let z=0;z<d.width*m;z++)w[A+z]=y[k+z]}return e}class mu{constructor(e,o){Ap(this,e,1,o)}resize(e){Qg(this,e,1)}clone(){return new mu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,o,l,d,m){Pp(e,o,l,d,m,1)}}class Xr{constructor(e,o){Ap(this,e,4,o)}resize(e){Qg(this,e,4)}replace(e,o){o?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Xr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,o,l,d,m){Pp(e,o,l,d,m,4)}}function ey(r){const e={},o=r.resolution||256,l=r.clips?r.clips.length:1,d=r.image||new Xr({width:o,height:l});if(Math.log(o)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${o}`);const m=(y,w,b)=>{e[r.evaluationKey]=b;const k=r.expression.evaluate(e);d.data[y+w+0]=Math.floor(255*k.r/k.a),d.data[y+w+1]=Math.floor(255*k.g/k.a),d.data[y+w+2]=Math.floor(255*k.b/k.a),d.data[y+w+3]=Math.floor(255*k.a)};if(r.clips)for(let y=0,w=0;y<l;++y,w+=4*o)for(let b=0,k=0;b<o;b++,k+=4){const A=b/(o-1),{start:z,end:L}=r.clips[y];m(w,k,z*(1-A)+L*A)}else for(let y=0,w=0;y<o;y++,w+=4)m(0,w,y/(o-1));return d}We("AlphaImage",mu),We("RGBAImage",Xr);var C1={paint:new Rn({"hillshade-illumination-direction":new Ye(we.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ye(we.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ye(we.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ye(we.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ye(we.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ye(we.paint_hillshade["hillshade-accent-color"])})};const I1=yn([{name:"a_pos",components:2,type:"Int16"}],4),{members:A1}=I1;var hh={exports:{}};function dh(r,e,o){o=o||2;var l,d,m,y,w,b,k,A=e&&e.length,z=A?e[0]*o:r.length,L=ty(r,0,z,o,!0),B=[];if(!L||L.next===L.prev)return B;if(A&&(L=function(X,H,ae,fe){var ie,de,Ee,Se=[];for(ie=0,de=H.length;ie<de;ie++)(Ee=ty(X,H[ie]*fe,ie<de-1?H[ie+1]*fe:X.length,fe,!1))===Ee.next&&(Ee.steiner=!0),Se.push(F1(Ee));for(Se.sort(L1),ie=0;ie<Se.length;ie++)ae=R1(Se[ie],ae);return ae}(r,e,L,o)),r.length>80*o){l=m=r[0],d=y=r[1];for(var F=o;F<z;F+=o)(w=r[F])<l&&(l=w),(b=r[F+1])<d&&(d=b),w>m&&(m=w),b>y&&(y=b);k=(k=Math.max(m-l,y-d))!==0?32767/k:0}return gu(L,B,o,l,d,k,0),B}function ty(r,e,o,l,d){var m,y;if(d===Dp(r,e,o,l)>0)for(m=e;m<o;m+=l)y=iy(m,r[m],r[m+1],y);else for(m=o-l;m>=e;m-=l)y=iy(m,r[m],r[m+1],y);return y&&ph(y,y.next)&&(_u(y),y=y.next),y}function oa(r,e){if(!r)return r;e||(e=r);var o,l=r;do if(o=!1,l.steiner||!ph(l,l.next)&&dn(l.prev,l,l.next)!==0)l=l.next;else{if(_u(l),(l=e=l.prev)===l.next)break;o=!0}while(o||l!==e);return e}function gu(r,e,o,l,d,m,y){if(r){!y&&m&&function(A,z,L,B){var F=A;do F.z===0&&(F.z=zp(F.x,F.y,z,L,B)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==A);F.prevZ.nextZ=null,F.prevZ=null,function(X){var H,ae,fe,ie,de,Ee,Se,qe,Xe=1;do{for(ae=X,X=null,de=null,Ee=0;ae;){for(Ee++,fe=ae,Se=0,H=0;H<Xe&&(Se++,fe=fe.nextZ);H++);for(qe=Xe;Se>0||qe>0&&fe;)Se!==0&&(qe===0||!fe||ae.z<=fe.z)?(ie=ae,ae=ae.nextZ,Se--):(ie=fe,fe=fe.nextZ,qe--),de?de.nextZ=ie:X=ie,ie.prevZ=de,de=ie;ae=fe}de.nextZ=null,Xe*=2}while(Ee>1)}(F)}(r,l,d,m);for(var w,b,k=r;r.prev!==r.next;)if(w=r.prev,b=r.next,m?z1(r,l,d,m):P1(r))e.push(w.i/o|0),e.push(r.i/o|0),e.push(b.i/o|0),_u(r),r=b.next,k=b.next;else if((r=b)===k){y?y===1?gu(r=M1(oa(r),e,o),e,o,l,d,m,2):y===2&&D1(r,e,o,l,d,m):gu(oa(r),e,o,l,d,m,1);break}}}function P1(r){var e=r.prev,o=r,l=r.next;if(dn(e,o,l)>=0)return!1;for(var d=e.x,m=o.x,y=l.x,w=e.y,b=o.y,k=l.y,A=d<m?d<y?d:y:m<y?m:y,z=w<b?w<k?w:k:b<k?b:k,L=d>m?d>y?d:y:m>y?m:y,B=w>b?w>k?w:k:b>k?b:k,F=l.next;F!==e;){if(F.x>=A&&F.x<=L&&F.y>=z&&F.y<=B&&Wa(d,w,m,b,y,k,F.x,F.y)&&dn(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function z1(r,e,o,l){var d=r.prev,m=r,y=r.next;if(dn(d,m,y)>=0)return!1;for(var w=d.x,b=m.x,k=y.x,A=d.y,z=m.y,L=y.y,B=w<b?w<k?w:k:b<k?b:k,F=A<z?A<L?A:L:z<L?z:L,X=w>b?w>k?w:k:b>k?b:k,H=A>z?A>L?A:L:z>L?z:L,ae=zp(B,F,e,o,l),fe=zp(X,H,e,o,l),ie=r.prevZ,de=r.nextZ;ie&&ie.z>=ae&&de&&de.z<=fe;){if(ie.x>=B&&ie.x<=X&&ie.y>=F&&ie.y<=H&&ie!==d&&ie!==y&&Wa(w,A,b,z,k,L,ie.x,ie.y)&&dn(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,de.x>=B&&de.x<=X&&de.y>=F&&de.y<=H&&de!==d&&de!==y&&Wa(w,A,b,z,k,L,de.x,de.y)&&dn(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;ie&&ie.z>=ae;){if(ie.x>=B&&ie.x<=X&&ie.y>=F&&ie.y<=H&&ie!==d&&ie!==y&&Wa(w,A,b,z,k,L,ie.x,ie.y)&&dn(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;de&&de.z<=fe;){if(de.x>=B&&de.x<=X&&de.y>=F&&de.y<=H&&de!==d&&de!==y&&Wa(w,A,b,z,k,L,de.x,de.y)&&dn(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function M1(r,e,o){var l=r;do{var d=l.prev,m=l.next.next;!ph(d,m)&&ny(d,l,l.next,m)&&yu(d,m)&&yu(m,d)&&(e.push(d.i/o|0),e.push(l.i/o|0),e.push(m.i/o|0),_u(l),_u(l.next),l=r=m),l=l.next}while(l!==r);return oa(l)}function D1(r,e,o,l,d,m){var y=r;do{for(var w=y.next.next;w!==y.prev;){if(y.i!==w.i&&O1(y,w)){var b=ry(y,w);return y=oa(y,y.next),b=oa(b,b.next),gu(y,e,o,l,d,m,0),void gu(b,e,o,l,d,m,0)}w=w.next}y=y.next}while(y!==r)}function L1(r,e){return r.x-e.x}function R1(r,e){var o=function(d,m){var y,w=m,b=d.x,k=d.y,A=-1/0;do{if(k<=w.y&&k>=w.next.y&&w.next.y!==w.y){var z=w.x+(k-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(z<=b&&z>A&&(A=z,y=w.x<w.next.x?w:w.next,z===b))return y}w=w.next}while(w!==m);if(!y)return null;var L,B=y,F=y.x,X=y.y,H=1/0;w=y;do b>=w.x&&w.x>=F&&b!==w.x&&Wa(k<X?b:A,k,F,X,k<X?A:b,k,w.x,w.y)&&(L=Math.abs(k-w.y)/(b-w.x),yu(w,d)&&(L<H||L===H&&(w.x>y.x||w.x===y.x&&B1(y,w)))&&(y=w,H=L)),w=w.next;while(w!==B);return y}(r,e);if(!o)return e;var l=ry(o,r);return oa(l,l.next),oa(o,o.next)}function B1(r,e){return dn(r.prev,r,e.prev)<0&&dn(e.next,r,r.next)<0}function zp(r,e,o,l,d){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-o)*d|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*d|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function F1(r){var e=r,o=r;do(e.x<o.x||e.x===o.x&&e.y<o.y)&&(o=e),e=e.next;while(e!==r);return o}function Wa(r,e,o,l,d,m,y,w){return(d-y)*(e-w)>=(r-y)*(m-w)&&(r-y)*(l-w)>=(o-y)*(e-w)&&(o-y)*(m-w)>=(d-y)*(l-w)}function O1(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(o,l){var d=o;do{if(d.i!==o.i&&d.next.i!==o.i&&d.i!==l.i&&d.next.i!==l.i&&ny(d,d.next,o,l))return!0;d=d.next}while(d!==o);return!1}(r,e)&&(yu(r,e)&&yu(e,r)&&function(o,l){var d=o,m=!1,y=(o.x+l.x)/2,w=(o.y+l.y)/2;do d.y>w!=d.next.y>w&&d.next.y!==d.y&&y<(d.next.x-d.x)*(w-d.y)/(d.next.y-d.y)+d.x&&(m=!m),d=d.next;while(d!==o);return m}(r,e)&&(dn(r.prev,r,e.prev)||dn(r,e.prev,e))||ph(r,e)&&dn(r.prev,r,r.next)>0&&dn(e.prev,e,e.next)>0)}function dn(r,e,o){return(e.y-r.y)*(o.x-e.x)-(e.x-r.x)*(o.y-e.y)}function ph(r,e){return r.x===e.x&&r.y===e.y}function ny(r,e,o,l){var d=mh(dn(r,e,o)),m=mh(dn(r,e,l)),y=mh(dn(o,l,r)),w=mh(dn(o,l,e));return d!==m&&y!==w||!(d!==0||!fh(r,o,e))||!(m!==0||!fh(r,l,e))||!(y!==0||!fh(o,r,l))||!(w!==0||!fh(o,e,l))}function fh(r,e,o){return e.x<=Math.max(r.x,o.x)&&e.x>=Math.min(r.x,o.x)&&e.y<=Math.max(r.y,o.y)&&e.y>=Math.min(r.y,o.y)}function mh(r){return r>0?1:r<0?-1:0}function yu(r,e){return dn(r.prev,r,r.next)<0?dn(r,e,r.next)>=0&&dn(r,r.prev,e)>=0:dn(r,e,r.prev)<0||dn(r,r.next,e)<0}function ry(r,e){var o=new Mp(r.i,r.x,r.y),l=new Mp(e.i,e.x,e.y),d=r.next,m=e.prev;return r.next=e,e.prev=r,o.next=d,d.prev=o,l.next=o,o.prev=l,m.next=l,l.prev=m,l}function iy(r,e,o,l){var d=new Mp(r,e,o);return l?(d.next=l.next,d.prev=l,l.next.prev=d,l.next=d):(d.prev=d,d.next=d),d}function _u(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Mp(r,e,o){this.i=r,this.x=e,this.y=o,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Dp(r,e,o,l){for(var d=0,m=e,y=o-l;m<o;m+=l)d+=(r[y]-r[m])*(r[m+1]+r[y+1]),y=m;return d}function N1(r,e,o,l,d){oy(r,e,o||0,l||r.length-1,d||U1)}function oy(r,e,o,l,d){for(;l>o;){if(l-o>600){var m=l-o+1,y=e-o+1,w=Math.log(m),b=.5*Math.exp(2*w/3),k=.5*Math.sqrt(w*b*(m-b)/m)*(y-m/2<0?-1:1);oy(r,e,Math.max(o,Math.floor(e-y*b/m+k)),Math.min(l,Math.floor(e+(m-y)*b/m+k)),d)}var A=r[e],z=o,L=l;for(xu(r,o,e),d(r[l],A)>0&&xu(r,o,l);z<L;){for(xu(r,z,L),z++,L--;d(r[z],A)<0;)z++;for(;d(r[L],A)>0;)L--}d(r[o],A)===0?xu(r,o,L):xu(r,++L,l),L<=e&&(o=L+1),e<=L&&(l=L-1)}}function xu(r,e,o){var l=r[e];r[e]=r[o],r[o]=l}function U1(r,e){return r<e?-1:r>e?1:0}function Lp(r,e){const o=r.length;if(o<=1)return[r];const l=[];let d,m;for(let y=0;y<o;y++){const w=Qe(r[y]);w!==0&&(r[y].area=Math.abs(w),m===void 0&&(m=w<0),m===w<0?(d&&l.push(d),d=[r[y]]):d.push(r[y]))}if(d&&l.push(d),e>1)for(let y=0;y<l.length;y++)l[y].length<=e||(N1(l[y],e,1,l[y].length-1,V1),l[y]=l[y].slice(0,e));return l}function V1(r,e){return e.area-r.area}function Rp(r,e,o){const l=o.patternDependencies;let d=!1;for(const m of e){const y=m.paint.get(`${r}-pattern`);y.isConstant()||(d=!0);const w=y.constantOr(null);w&&(d=!0,l[w.to]=!0,l[w.from]=!0)}return d}function Bp(r,e,o,l,d){const m=d.patternDependencies;for(const y of e){const w=y.paint.get(`${r}-pattern`).value;if(w.kind!=="constant"){let b=w.evaluate({zoom:l-1},o,{},d.availableImages),k=w.evaluate({zoom:l},o,{},d.availableImages),A=w.evaluate({zoom:l+1},o,{},d.availableImages);b=b&&b.name?b.name:b,k=k&&k.name?k.name:k,A=A&&A.name?A.name:A,m[b]=!0,m[k]=!0,m[A]=!0,o.patterns[y.id]={min:b,mid:k,max:A}}}return o}hh.exports=dh,hh.exports.default=dh,dh.deviation=function(r,e,o,l){var d=e&&e.length,m=Math.abs(Dp(r,0,d?e[0]*o:r.length,o));if(d)for(var y=0,w=e.length;y<w;y++)m-=Math.abs(Dp(r,e[y]*o,y<w-1?e[y+1]*o:r.length,o));var b=0;for(y=0;y<l.length;y+=3){var k=l[y]*o,A=l[y+1]*o,z=l[y+2]*o;b+=Math.abs((r[k]-r[z])*(r[A+1]-r[k+1])-(r[k]-r[A])*(r[z+1]-r[k+1]))}return m===0&&b===0?0:Math.abs((b-m)/m)},dh.flatten=function(r){for(var e=r[0][0].length,o={vertices:[],holes:[],dimensions:e},l=0,d=0;d<r.length;d++){for(var m=0;m<r[d].length;m++)for(var y=0;y<e;y++)o.vertices.push(r[d][m][y]);d>0&&o.holes.push(l+=r[d-1].length)}return o};class Fp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Rt,this.indexArray=new sr,this.indexArray2=new Ci,this.programConfigurations=new na(e.layers,e.zoom),this.segments=new vt,this.segments2=new vt,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,l){this.hasPattern=Rp("fill",this.layers,o);const d=this.layers[0].layout.get("fill-sort-key"),m=!d.isConstant(),y=[];for(const{feature:w,id:b,index:k,sourceLayerIndex:A}of e){const z=this.layers[0]._featureFilter.needGeometry,L=ia(w,z);if(!this.layers[0]._featureFilter.filter(new en(this.zoom),L,l))continue;const B=m?d.evaluate(L,{},l,o.availableImages):void 0,F={id:b,properties:w.properties,type:w.type,sourceLayerIndex:A,index:k,geometry:z?L.geometry:ra(w),patterns:{},sortKey:B};y.push(F)}m&&y.sort((w,b)=>w.sortKey-b.sortKey);for(const w of y){const{geometry:b,index:k,sourceLayerIndex:A}=w;if(this.hasPattern){const z=Bp("fill",this.layers,w,this.zoom,o);this.patternFeatures.push(z)}else this.addFeature(w,b,k,l,{});o.featureIndex.insert(e[k].feature,b,k,A,this.index)}}update(e,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,l)}addFeatures(e,o,l){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,o,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,A1),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,o,l,d,m){for(const y of Lp(o,500)){let w=0;for(const B of y)w+=B.length;const b=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),k=b.vertexLength,A=[],z=[];for(const B of y){if(B.length===0)continue;B!==y[0]&&z.push(A.length/2);const F=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),X=F.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(X+B.length-1,X),A.push(B[0].x),A.push(B[0].y);for(let H=1;H<B.length;H++)this.layoutVertexArray.emplaceBack(B[H].x,B[H].y),this.indexArray2.emplaceBack(X+H-1,X+H),A.push(B[H].x),A.push(B[H].y);F.vertexLength+=B.length,F.primitiveLength+=B.length}const L=hh.exports(A,z);for(let B=0;B<L.length;B+=3)this.indexArray.emplaceBack(k+L[B],k+L[B+1],k+L[B+2]);b.vertexLength+=w,b.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,m,d)}}We("FillBucket",Fp,{omit:["layers","patternFeatures"]});const j1=new Rn({"fill-sort-key":new st(we.layout_fill["fill-sort-key"])});var $1={paint:new Rn({"fill-antialias":new Ye(we.paint_fill["fill-antialias"]),"fill-opacity":new st(we.paint_fill["fill-opacity"]),"fill-color":new st(we.paint_fill["fill-color"]),"fill-outline-color":new st(we.paint_fill["fill-outline-color"]),"fill-translate":new Ye(we.paint_fill["fill-translate"]),"fill-translate-anchor":new Ye(we.paint_fill["fill-translate-anchor"]),"fill-pattern":new ts(we.paint_fill["fill-pattern"])}),layout:j1};const G1=yn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),q1=yn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Z1}=G1;var is={},W1=at,sy=Ha;function Ha(r,e,o,l,d){this.properties={},this.extent=o,this.type=0,this._pbf=r,this._geometry=-1,this._keys=l,this._values=d,r.readFields(H1,this,e)}function H1(r,e,o){r==1?e.id=o.readVarint():r==2?function(l,d){for(var m=l.readVarint()+l.pos;l.pos<m;){var y=d._keys[l.readVarint()],w=d._values[l.readVarint()];d.properties[y]=w}}(o,e):r==3?e.type=o.readVarint():r==4&&(e._geometry=o.pos)}function X1(r){for(var e,o,l=0,d=0,m=r.length,y=m-1;d<m;y=d++)l+=((o=r[y]).x-(e=r[d]).x)*(e.y+o.y);return l}Ha.types=["Unknown","Point","LineString","Polygon"],Ha.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,o=r.readVarint()+r.pos,l=1,d=0,m=0,y=0,w=[];r.pos<o;){if(d<=0){var b=r.readVarint();l=7&b,d=b>>3}if(d--,l===1||l===2)m+=r.readSVarint(),y+=r.readSVarint(),l===1&&(e&&w.push(e),e=[]),e.push(new W1(m,y));else{if(l!==7)throw new Error("unknown command "+l);e&&e.push(e[0].clone())}}return e&&w.push(e),w},Ha.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,o=1,l=0,d=0,m=0,y=1/0,w=-1/0,b=1/0,k=-1/0;r.pos<e;){if(l<=0){var A=r.readVarint();o=7&A,l=A>>3}if(l--,o===1||o===2)(d+=r.readSVarint())<y&&(y=d),d>w&&(w=d),(m+=r.readSVarint())<b&&(b=m),m>k&&(k=m);else if(o!==7)throw new Error("unknown command "+o)}return[y,b,w,k]},Ha.prototype.toGeoJSON=function(r,e,o){var l,d,m=this.extent*Math.pow(2,o),y=this.extent*r,w=this.extent*e,b=this.loadGeometry(),k=Ha.types[this.type];function A(B){for(var F=0;F<B.length;F++){var X=B[F];B[F]=[360*(X.x+y)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(X.y+w)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(l=0;l<b.length;l++)z[l]=b[l][0];A(b=z);break;case 2:for(l=0;l<b.length;l++)A(b[l]);break;case 3:for(b=function(B){var F=B.length;if(F<=1)return[B];for(var X,H,ae=[],fe=0;fe<F;fe++){var ie=X1(B[fe]);ie!==0&&(H===void 0&&(H=ie<0),H===ie<0?(X&&ae.push(X),X=[B[fe]]):X.push(B[fe]))}return X&&ae.push(X),ae}(b),l=0;l<b.length;l++)for(d=0;d<b[l].length;d++)A(b[l][d])}b.length===1?b=b[0]:k="Multi"+k;var L={type:"Feature",geometry:{type:k,coordinates:b},properties:this.properties};return"id"in this&&(L.id=this.id),L};var K1=sy,ay=ly;function ly(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(J1,this,e),this.length=this._features.length}function J1(r,e,o){r===15?e.version=o.readVarint():r===1?e.name=o.readString():r===5?e.extent=o.readVarint():r===2?e._features.push(o.pos):r===3?e._keys.push(o.readString()):r===4&&e._values.push(function(l){for(var d=null,m=l.readVarint()+l.pos;l.pos<m;){var y=l.readVarint()>>3;d=y===1?l.readString():y===2?l.readFloat():y===3?l.readDouble():y===4?l.readVarint64():y===5?l.readVarint():y===6?l.readSVarint():y===7?l.readBoolean():null}return d}(o))}ly.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new K1(this._pbf,e,this.extent,this._keys,this._values)};var Y1=ay;function Q1(r,e,o){if(r===3){var l=new Y1(o,o.readVarint()+o.pos);l.length&&(e[l.name]=l)}}is.VectorTile=function(r,e){this.layers=r.readFields(Q1,{},e)},is.VectorTileFeature=sy,is.VectorTileLayer=ay;const ew=is.VectorTileFeature.types,Op=Math.pow(2,13);function vu(r,e,o,l,d,m,y,w){r.emplaceBack(e,o,2*Math.floor(l*Op)+y,d*Op*2,m*Op*2,Math.round(w))}class Np{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Et,this.centroidVertexArray=new rt,this.indexArray=new sr,this.programConfigurations=new na(e.layers,e.zoom),this.segments=new vt,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,l){this.features=[],this.hasPattern=Rp("fill-extrusion",this.layers,o);for(const{feature:d,id:m,index:y,sourceLayerIndex:w}of e){const b=this.layers[0]._featureFilter.needGeometry,k=ia(d,b);if(!this.layers[0]._featureFilter.filter(new en(this.zoom),k,l))continue;const A={id:m,sourceLayerIndex:w,index:y,geometry:b?k.geometry:ra(d),properties:d.properties,type:d.type,patterns:{}};this.hasPattern?this.features.push(Bp("fill-extrusion",this.layers,A,this.zoom,o)):this.addFeature(A,A.geometry,y,l,{}),o.featureIndex.insert(d,A.geometry,y,w,this.index,!0)}}addFeatures(e,o,l){for(const d of this.features){const{geometry:m}=d;this.addFeature(d,m,d.index,o,l)}}update(e,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Z1),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,q1.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,o,l,d,m){const y={x:0,y:0,vertexCount:0};for(const w of Lp(o,500)){let b=0;for(const F of w)b+=F.length;let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const F of w){if(F.length===0||nw(F))continue;let X=0;for(let H=0;H<F.length;H++){const ae=F[H];if(H>=1){const fe=F[H-1];if(!tw(ae,fe)){k.vertexLength+4>vt.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ie=ae.sub(fe)._perp()._unit(),de=fe.dist(ae);X+de>32768&&(X=0),vu(this.layoutVertexArray,ae.x,ae.y,ie.x,ie.y,0,0,X),vu(this.layoutVertexArray,ae.x,ae.y,ie.x,ie.y,0,1,X),y.x+=2*ae.x,y.y+=2*ae.y,y.vertexCount+=2,X+=de,vu(this.layoutVertexArray,fe.x,fe.y,ie.x,ie.y,0,0,X),vu(this.layoutVertexArray,fe.x,fe.y,ie.x,ie.y,0,1,X),y.x+=2*fe.x,y.y+=2*fe.y,y.vertexCount+=2;const Ee=k.vertexLength;this.indexArray.emplaceBack(Ee,Ee+2,Ee+1),this.indexArray.emplaceBack(Ee+1,Ee+2,Ee+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+b>vt.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray)),ew[e.type]!=="Polygon")continue;const A=[],z=[],L=k.vertexLength;for(const F of w)if(F.length!==0){F!==w[0]&&z.push(A.length/2);for(let X=0;X<F.length;X++){const H=F[X];vu(this.layoutVertexArray,H.x,H.y,0,0,1,1,0),y.x+=H.x,y.y+=H.y,y.vertexCount+=1,A.push(H.x),A.push(H.y)}}const B=hh.exports(A,z);for(let F=0;F<B.length;F+=3)this.indexArray.emplaceBack(L+B[F],L+B[F+2],L+B[F+1]);k.primitiveLength+=B.length/3,k.vertexLength+=b}for(let w=0;w<y.vertexCount;w++)this.centroidVertexArray.emplaceBack(Math.floor(y.x/y.vertexCount),Math.floor(y.y/y.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,m,d)}}function tw(r,e){return r.x===e.x&&(r.x<0||r.x>Sn)||r.y===e.y&&(r.y<0||r.y>Sn)}function nw(r){return r.every(e=>e.x<0)||r.every(e=>e.x>Sn)||r.every(e=>e.y<0)||r.every(e=>e.y>Sn)}We("FillExtrusionBucket",Np,{omit:["layers","features"]});var rw={paint:new Rn({"fill-extrusion-opacity":new Ye(we["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new st(we["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ye(we["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ye(we["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ts(we["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new st(we["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new st(we["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ye(we["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function wu(r,e){return r.x*e.x+r.y*e.y}function uy(r,e){if(r.length===1){let o=0;const l=e[o++];let d;for(;!d||l.equals(d);)if(d=e[o++],!d)return 1/0;for(;o<e.length;o++){const m=e[o],y=r[0],w=d.sub(l),b=m.sub(l),k=y.sub(l),A=wu(w,w),z=wu(w,b),L=wu(b,b),B=wu(k,w),F=wu(k,b),X=A*L-z*z,H=(L*B-z*F)/X,ae=(A*F-z*B)/X,fe=l.z*(1-H-ae)+d.z*H+m.z*ae;if(isFinite(fe))return fe}return 1/0}{let o=1/0;for(const l of e)o=Math.min(o,l.z);return o}}const iw=yn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:ow}=iw,sw=yn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:aw}=sw,lw=is.VectorTileFeature.types,uw=Math.cos(Math.PI/180*37.5),cy=Math.pow(2,14)/.5;class Up{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new At,this.layoutVertexArray2=new Nt,this.indexArray=new sr,this.programConfigurations=new na(e.layers,e.zoom),this.segments=new vt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,l){this.hasPattern=Rp("line",this.layers,o);const d=this.layers[0].layout.get("line-sort-key"),m=!d.isConstant(),y=[];for(const{feature:w,id:b,index:k,sourceLayerIndex:A}of e){const z=this.layers[0]._featureFilter.needGeometry,L=ia(w,z);if(!this.layers[0]._featureFilter.filter(new en(this.zoom),L,l))continue;const B=m?d.evaluate(L,{},l):void 0,F={id:b,properties:w.properties,type:w.type,sourceLayerIndex:A,index:k,geometry:z?L.geometry:ra(w),patterns:{},sortKey:B};y.push(F)}m&&y.sort((w,b)=>w.sortKey-b.sortKey);for(const w of y){const{geometry:b,index:k,sourceLayerIndex:A}=w;if(this.hasPattern){const z=Bp("line",this.layers,w,this.zoom,o);this.patternFeatures.push(z)}else this.addFeature(w,b,k,l,{});o.featureIndex.insert(e[k].feature,b,k,A,this.index)}}update(e,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,l)}addFeatures(e,o,l){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,o,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,aw)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ow),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,o,l,d,m){const y=this.layers[0].layout,w=y.get("line-join").evaluate(e,{}),b=y.get("line-cap"),k=y.get("line-miter-limit"),A=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const z of o)this.addLine(z,e,w,b,k,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,m,d)}addLine(e,o,l,d,m,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ae=0;ae<e.length-1;ae++)this.totalDistance+=e[ae].dist(e[ae+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w=lw[o.type]==="Polygon";let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let k=0;for(;k<b-1&&e[k].equals(e[k+1]);)k++;if(b<(w?3:2))return;l==="bevel"&&(m=1.05);const A=this.overscaling<=16?122880/(512*this.overscaling):0,z=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let L,B,F,X,H;this.e1=this.e2=-1,w&&(L=e[b-2],H=e[k].sub(L)._unit()._perp());for(let ae=k;ae<b;ae++){if(F=ae===b-1?w?e[k+1]:void 0:e[ae+1],F&&e[ae].equals(F))continue;H&&(X=H),L&&(B=L),L=e[ae],H=F?F.sub(L)._unit()._perp():X,X=X||H;let fe=X.add(H);fe.x===0&&fe.y===0||fe._unit();const ie=X.x*H.x+X.y*H.y,de=fe.x*H.x+fe.y*H.y,Ee=de!==0?1/de:1/0,Se=2*Math.sqrt(2-2*de),qe=de<uw&&B&&F,Xe=X.x*H.y-X.y*H.x>0;if(qe&&ae>k){const Me=L.dist(B);if(Me>2*A){const Ve=L.sub(L.sub(B)._mult(A/Me)._round());this.updateDistance(B,Ve),this.addCurrentVertex(Ve,X,0,0,z),B=Ve}}const Ue=B&&F;let Re=Ue?l:w?"butt":d;if(Ue&&Re==="round"&&(Ee<y?Re="miter":Ee<=2&&(Re="fakeround")),Re==="miter"&&Ee>m&&(Re="bevel"),Re==="bevel"&&(Ee>2&&(Re="flipbevel"),Ee<m&&(Re="miter")),B&&this.updateDistance(B,L),Re==="miter")fe._mult(Ee),this.addCurrentVertex(L,fe,0,0,z);else if(Re==="flipbevel"){if(Ee>100)fe=H.mult(-1);else{const Me=Ee*X.add(H).mag()/X.sub(H).mag();fe._perp()._mult(Me*(Xe?-1:1))}this.addCurrentVertex(L,fe,0,0,z),this.addCurrentVertex(L,fe.mult(-1),0,0,z)}else if(Re==="bevel"||Re==="fakeround"){const Me=-Math.sqrt(Ee*Ee-1),Ve=Xe?Me:0,Oe=Xe?0:Me;if(B&&this.addCurrentVertex(L,X,Ve,Oe,z),Re==="fakeround"){const Ae=Math.round(180*Se/Math.PI/20);for(let it=1;it<Ae;it++){let tt=it/Ae;if(tt!==.5){const Ht=tt-.5;tt+=tt*Ht*(tt-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*Ht*Ht+(.848013+ie*(.215638*ie-1.06021)))}const xt=H.sub(X)._mult(tt)._add(X)._unit()._mult(Xe?-1:1);this.addHalfVertex(L,xt.x,xt.y,!1,Xe,0,z)}}F&&this.addCurrentVertex(L,H,-Ve,-Oe,z)}else if(Re==="butt")this.addCurrentVertex(L,fe,0,0,z);else if(Re==="square"){const Me=B?1:-1;this.addCurrentVertex(L,fe,Me,Me,z)}else Re==="round"&&(B&&(this.addCurrentVertex(L,X,0,0,z),this.addCurrentVertex(L,X,1,1,z,!0)),F&&(this.addCurrentVertex(L,H,-1,-1,z,!0),this.addCurrentVertex(L,H,0,0,z)));if(qe&&ae<b-1){const Me=L.dist(F);if(Me>2*A){const Ve=L.add(F.sub(L)._mult(A/Me)._round());this.updateDistance(L,Ve),this.addCurrentVertex(Ve,H,0,0,z),L=Ve}}}}addCurrentVertex(e,o,l,d,m,y=!1){const w=o.y*d-o.x,b=-o.y-o.x*d;this.addHalfVertex(e,o.x+o.y*l,o.y-o.x*l,y,!1,l,m),this.addHalfVertex(e,w,b,y,!0,-d,m),this.distance>cy/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,o,l,d,m,y))}addHalfVertex({x:e,y:o},l,d,m,y,w,b){const k=.5*(this.lineClips?this.scaledDistance*(cy-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(o<<1)+(y?1:0),Math.round(63*l)+128,Math.round(63*d)+128,1+(w===0?0:w<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const A=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),b.primitiveLength++),y?this.e2=A:this.e1=A}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,o){this.distance+=e.dist(o),this.updateScaledDistance()}}We("LineBucket",Up,{omit:["layers","patternFeatures"]});const cw=new Rn({"line-cap":new Ye(we.layout_line["line-cap"]),"line-join":new st(we.layout_line["line-join"]),"line-miter-limit":new Ye(we.layout_line["line-miter-limit"]),"line-round-limit":new Ye(we.layout_line["line-round-limit"]),"line-sort-key":new st(we.layout_line["line-sort-key"])});var hy={paint:new Rn({"line-opacity":new st(we.paint_line["line-opacity"]),"line-color":new st(we.paint_line["line-color"]),"line-translate":new Ye(we.paint_line["line-translate"]),"line-translate-anchor":new Ye(we.paint_line["line-translate-anchor"]),"line-width":new st(we.paint_line["line-width"]),"line-gap-width":new st(we.paint_line["line-gap-width"]),"line-offset":new st(we.paint_line["line-offset"]),"line-blur":new st(we.paint_line["line-blur"]),"line-dasharray":new lu(we.paint_line["line-dasharray"]),"line-pattern":new ts(we.paint_line["line-pattern"]),"line-gradient":new Hi(we.paint_line["line-gradient"])}),layout:cw};const dy=new class extends st{possiblyEvaluate(r,e){return e=new en(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(r,e)}evaluate(r,e,o,l){return e=_e({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(r,e,o,l)}}(hy.paint.properties["line-width"].specification);function py(r,e){return e>0?e+2*r:r}dy.useIntegerZoom=!0;const hw=yn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),dw=yn([{name:"a_projected_pos",components:3,type:"Float32"}],4);yn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const pw=yn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);yn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const fy=yn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),fw=yn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function mw(r,e,o){return r.sections.forEach(l=>{l.text=function(d,m,y){const w=m.layout.get("text-transform").evaluate(y,{});return w==="uppercase"?d=d.toLocaleUpperCase():w==="lowercase"&&(d=d.toLocaleLowerCase()),Lr.applyArabicShaping&&(d=Lr.applyArabicShaping(d)),d}(l.text,e,o)}),r}yn([{name:"triangle",components:3,type:"Uint16"}]),yn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),yn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),yn([{type:"Float32",name:"offsetX"}]),yn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const bu={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Bn=24,Vp=$t,my=function(r,e,o,l,d){var m,y,w=8*d-l-1,b=(1<<w)-1,k=b>>1,A=-7,z=o?d-1:0,L=o?-1:1,B=r[e+z];for(z+=L,m=B&(1<<-A)-1,B>>=-A,A+=w;A>0;m=256*m+r[e+z],z+=L,A-=8);for(y=m&(1<<-A)-1,m>>=-A,A+=l;A>0;y=256*y+r[e+z],z+=L,A-=8);if(m===0)m=1-k;else{if(m===b)return y?NaN:1/0*(B?-1:1);y+=Math.pow(2,l),m-=k}return(B?-1:1)*y*Math.pow(2,m-l)},gy=function(r,e,o,l,d,m){var y,w,b,k=8*m-d-1,A=(1<<k)-1,z=A>>1,L=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=l?0:m-1,F=l?1:-1,X=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(w=isNaN(e)?1:0,y=A):(y=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-y))<1&&(y--,b*=2),(e+=y+z>=1?L/b:L*Math.pow(2,1-z))*b>=2&&(y++,b/=2),y+z>=A?(w=0,y=A):y+z>=1?(w=(e*b-1)*Math.pow(2,d),y+=z):(w=e*Math.pow(2,z-1)*Math.pow(2,d),y=0));d>=8;r[o+B]=255&w,B+=F,w/=256,d-=8);for(y=y<<d|w,k+=d;k>0;r[o+B]=255&y,B+=F,y/=256,k-=8);r[o+B-F]|=128*X};function $t(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}$t.Varint=0,$t.Fixed64=1,$t.Bytes=2,$t.Fixed32=5;var os,jp=4294967296,yy=1/jp,_y=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function vo(r){return r.type===$t.Bytes?r.readVarint()+r.pos:r.pos+1}function Xa(r,e,o){return o?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function xy(r,e,o){var l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));o.realloc(l);for(var d=o.pos-1;d>=r;d--)o.buf[d+l]=o.buf[d]}function gw(r,e){for(var o=0;o<r.length;o++)e.writeVarint(r[o])}function yw(r,e){for(var o=0;o<r.length;o++)e.writeSVarint(r[o])}function _w(r,e){for(var o=0;o<r.length;o++)e.writeFloat(r[o])}function xw(r,e){for(var o=0;o<r.length;o++)e.writeDouble(r[o])}function vw(r,e){for(var o=0;o<r.length;o++)e.writeBoolean(r[o])}function ww(r,e){for(var o=0;o<r.length;o++)e.writeFixed32(r[o])}function bw(r,e){for(var o=0;o<r.length;o++)e.writeSFixed32(r[o])}function Sw(r,e){for(var o=0;o<r.length;o++)e.writeFixed64(r[o])}function Ew(r,e){for(var o=0;o<r.length;o++)e.writeSFixed64(r[o])}function gh(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function Ka(r,e,o){r[o]=e,r[o+1]=e>>>8,r[o+2]=e>>>16,r[o+3]=e>>>24}function vy(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}function Tw(r,e,o){r===1&&o.readMessage(kw,e)}function kw(r,e,o){if(r===3){const{id:l,bitmap:d,width:m,height:y,left:w,top:b,advance:k}=o.readMessage(Cw,{});e.push({id:l,bitmap:new mu({width:m+6,height:y+6},d),metrics:{width:m,height:y,left:w,top:b,advance:k}})}}function Cw(r,e,o){r===1?e.id=o.readVarint():r===2?e.bitmap=o.readBytes():r===3?e.width=o.readVarint():r===4?e.height=o.readVarint():r===5?e.left=o.readSVarint():r===6?e.top=o.readSVarint():r===7&&(e.advance=o.readVarint())}function wy(r){let e=0,o=0;for(const y of r)e+=y.w*y.h,o=Math.max(o,y.w);r.sort((y,w)=>w.h-y.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),o),h:1/0}];let d=0,m=0;for(const y of r)for(let w=l.length-1;w>=0;w--){const b=l[w];if(!(y.w>b.w||y.h>b.h)){if(y.x=b.x,y.y=b.y,m=Math.max(m,y.y+y.h),d=Math.max(d,y.x+y.w),y.w===b.w&&y.h===b.h){const k=l.pop();w<l.length&&(l[w]=k)}else y.h===b.h?(b.x+=y.w,b.w-=y.w):y.w===b.w?(b.y+=y.h,b.h-=y.h):(l.push({x:b.x+y.w,y:b.y,w:b.w-y.w,h:y.h}),b.y+=y.h,b.h-=y.h);break}}return{w:d,h:m,fill:e/(d*m)||0}}$t.prototype={destroy:function(){this.buf=null},readFields:function(r,e,o){for(o=o||this.length;this.pos<o;){var l=this.readVarint(),d=l>>3,m=this.pos;this.type=7&l,r(d,e,this),this.pos===m&&this.skip(l)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=gh(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=vy(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=gh(this.buf,this.pos)+gh(this.buf,this.pos+4)*jp;return this.pos+=8,r},readSFixed64:function(){var r=gh(this.buf,this.pos)+vy(this.buf,this.pos+4)*jp;return this.pos+=8,r},readFloat:function(){var r=my(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=my(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,o,l=this.buf;return e=127&(o=l[this.pos++]),o<128?e:(e|=(127&(o=l[this.pos++]))<<7,o<128?e:(e|=(127&(o=l[this.pos++]))<<14,o<128?e:(e|=(127&(o=l[this.pos++]))<<21,o<128?e:function(d,m,y){var w,b,k=y.buf;if(w=(112&(b=k[y.pos++]))>>4,b<128||(w|=(127&(b=k[y.pos++]))<<3,b<128)||(w|=(127&(b=k[y.pos++]))<<10,b<128)||(w|=(127&(b=k[y.pos++]))<<17,b<128)||(w|=(127&(b=k[y.pos++]))<<24,b<128)||(w|=(1&(b=k[y.pos++]))<<31,b<128))return Xa(d,w,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(o=l[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&_y?function(o,l,d){return _y.decode(o.subarray(l,d))}(this.buf,e,r):function(o,l,d){for(var m="",y=l;y<d;){var w,b,k,A=o[y],z=null,L=A>239?4:A>223?3:A>191?2:1;if(y+L>d)break;L===1?A<128&&(z=A):L===2?(192&(w=o[y+1]))==128&&(z=(31&A)<<6|63&w)<=127&&(z=null):L===3?(b=o[y+2],(192&(w=o[y+1]))==128&&(192&b)==128&&((z=(15&A)<<12|(63&w)<<6|63&b)<=2047||z>=55296&&z<=57343)&&(z=null)):L===4&&(b=o[y+2],k=o[y+3],(192&(w=o[y+1]))==128&&(192&b)==128&&(192&k)==128&&((z=(15&A)<<18|(63&w)<<12|(63&b)<<6|63&k)<=65535||z>=1114112)&&(z=null)),z===null?(z=65533,L=1):z>65535&&(z-=65536,m+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),m+=String.fromCharCode(z),y+=L}return m}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==$t.Bytes)return r.push(this.readVarint(e));var o=vo(this);for(r=r||[];this.pos<o;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==$t.Bytes)return r.push(this.readSVarint());var e=vo(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==$t.Bytes)return r.push(this.readBoolean());var e=vo(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==$t.Bytes)return r.push(this.readFloat());var e=vo(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==$t.Bytes)return r.push(this.readDouble());var e=vo(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==$t.Bytes)return r.push(this.readFixed32());var e=vo(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==$t.Bytes)return r.push(this.readSFixed32());var e=vo(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==$t.Bytes)return r.push(this.readFixed64());var e=vo(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==$t.Bytes)return r.push(this.readSFixed64());var e=vo(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===$t.Varint)for(;this.buf[this.pos++]>127;);else if(e===$t.Bytes)this.pos=this.readVarint()+this.pos;else if(e===$t.Fixed32)this.pos+=4;else{if(e!==$t.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var o=new Uint8Array(e);o.set(this.buf),this.buf=o,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Ka(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Ka(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Ka(this.buf,-1&r,this.pos),Ka(this.buf,Math.floor(r*yy),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Ka(this.buf,-1&r,this.pos),Ka(this.buf,Math.floor(r*yy),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,o){var l,d;if(e>=0?(l=e%4294967296|0,d=e/4294967296|0):(d=~(-e/4294967296),4294967295^(l=~(-e%4294967296))?l=l+1|0:(l=0,d=d+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(m,y,w){w.buf[w.pos++]=127&m|128,m>>>=7,w.buf[w.pos++]=127&m|128,m>>>=7,w.buf[w.pos++]=127&m|128,m>>>=7,w.buf[w.pos++]=127&m|128,w.buf[w.pos]=127&(m>>>=7)}(l,0,o),function(m,y){var w=(7&m)<<4;y.buf[y.pos++]|=w|((m>>>=3)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m)))))}(d,o)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(Boolean(r))},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(l,d,m){for(var y,w,b=0;b<d.length;b++){if((y=d.charCodeAt(b))>55295&&y<57344){if(!w){y>56319||b+1===d.length?(l[m++]=239,l[m++]=191,l[m++]=189):w=y;continue}if(y<56320){l[m++]=239,l[m++]=191,l[m++]=189,w=y;continue}y=w-55296<<10|y-56320|65536,w=null}else w&&(l[m++]=239,l[m++]=191,l[m++]=189,w=null);y<128?l[m++]=y:(y<2048?l[m++]=y>>6|192:(y<65536?l[m++]=y>>12|224:(l[m++]=y>>18|240,l[m++]=y>>12&63|128),l[m++]=y>>6&63|128),l[m++]=63&y|128)}return m}(this.buf,r,this.pos);var o=this.pos-e;o>=128&&xy(e,o,this),this.pos=e-1,this.writeVarint(o),this.pos+=o},writeFloat:function(r){this.realloc(4),gy(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),gy(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var o=0;o<e;o++)this.buf[this.pos++]=r[o]},writeRawMessage:function(r,e){this.pos++;var o=this.pos;r(e,this);var l=this.pos-o;l>=128&&xy(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l},writeMessage:function(r,e,o){this.writeTag(r,$t.Bytes),this.writeRawMessage(e,o)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,gw,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,yw,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,vw,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,_w,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,xw,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,ww,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,bw,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,Sw,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,Ew,e)},writeBytesField:function(r,e){this.writeTag(r,$t.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,$t.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,$t.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,$t.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,$t.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,$t.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,$t.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,$t.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,$t.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,$t.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,Boolean(e))}};class $p{constructor(e,{pixelRatio:o,version:l,stretchX:d,stretchY:m,content:y}){this.paddedRect=e,this.pixelRatio=o,this.stretchX=d,this.stretchY=m,this.content=y,this.version=l}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class by{constructor(e,o){const l={},d={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,l,m),this.addImages(o,d,m);const{w:y,h:w}=wy(m),b=new Xr({width:y||1,height:w||1});for(const k in e){const A=e[k],z=l[k].paddedRect;Xr.copy(A.data,b,{x:0,y:0},{x:z.x+1,y:z.y+1},A.data)}for(const k in o){const A=o[k],z=d[k].paddedRect,L=z.x+1,B=z.y+1,F=A.data.width,X=A.data.height;Xr.copy(A.data,b,{x:0,y:0},{x:L,y:B},A.data),Xr.copy(A.data,b,{x:0,y:X-1},{x:L,y:B-1},{width:F,height:1}),Xr.copy(A.data,b,{x:0,y:0},{x:L,y:B+X},{width:F,height:1}),Xr.copy(A.data,b,{x:F-1,y:0},{x:L-1,y:B},{width:1,height:X}),Xr.copy(A.data,b,{x:0,y:0},{x:L+F,y:B},{width:1,height:X})}this.image=b,this.iconPositions=l,this.patternPositions=d}addImages(e,o,l){for(const d in e){const m=e[d],y={x:0,y:0,w:m.data.width+2,h:m.data.height+2};l.push(y),o[d]=new $p(y,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(e,o){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),o),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),o)}patchUpdatedImage(e,o,l){if(!e||!o||e.version===o.version)return;e.version=o.version;const[d,m]=e.tl;l.update(o.data,void 0,{x:d,y:m})}}We("ImagePosition",$p),We("ImageAtlas",by),u.WritingMode=void 0,(os=u.WritingMode||(u.WritingMode={}))[os.none=0]="none",os[os.horizontal=1]="horizontal",os[os.vertical=2]="vertical",os[os.horizontalOnly=3]="horizontalOnly";const yh=-17;class Su{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,o){const l=new Su;return l.scale=e||1,l.fontStack=o,l}static forImage(e){const o=new Su;return o.imageName=e,o}}class Ja{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,o){const l=new Ja;for(let d=0;d<e.sections.length;d++){const m=e.sections[d];m.image?l.addImageSection(m):l.addTextSection(m,o)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let o="";for(let l=0;l<e.length;l++){const d=e.charCodeAt(l+1)||null,m=e.charCodeAt(l-1)||null;o+=d&&Jc(d)&&!bu[e[l+1]]||m&&Jc(m)&&!bu[e[l-1]]||!bu[e[l]]?e[l]:bu[e[l]]}return o}(this.text)}trim(){let e=0;for(let l=0;l<this.text.length&&xh[this.text.charCodeAt(l)];l++)e++;let o=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&xh[this.text.charCodeAt(l)];l--)o--;this.text=this.text.substring(e,o),this.sectionIndex=this.sectionIndex.slice(e,o)}substring(e,o){const l=new Ja;return l.text=this.text.substring(e,o),l.sectionIndex=this.sectionIndex.slice(e,o),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,o)=>Math.max(e,this.sections[o].scale),0)}addTextSection(e,o){this.text+=e.text,this.sections.push(Su.forText(e.scale,e.fontStack||o));const l=this.sections.length-1;for(let d=0;d<e.text.length;++d)this.sectionIndex.push(l)}addImageSection(e){const o=e.image?e.image.name:"";if(o.length===0)return void Be("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Su.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Be("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function _h(r,e,o,l,d,m,y,w,b,k,A,z,L,B,F,X){const H=Ja.fromFeature(r,d);let ae;z===u.WritingMode.vertical&&H.verticalizePunctuation();const{processBidirectionalText:fe,processStyledBidirectionalText:ie}=Lr;if(fe&&H.sections.length===1){ae=[];const Se=fe(H.toString(),Gp(H,k,m,e,l,B,F));for(const qe of Se){const Xe=new Ja;Xe.text=qe,Xe.sections=H.sections;for(let Ue=0;Ue<qe.length;Ue++)Xe.sectionIndex.push(0);ae.push(Xe)}}else if(ie){ae=[];const Se=ie(H.text,H.sectionIndex,Gp(H,k,m,e,l,B,F));for(const qe of Se){const Xe=new Ja;Xe.text=qe[0],Xe.sectionIndex=qe[1],Xe.sections=H.sections,ae.push(Xe)}}else ae=function(Se,qe){const Xe=[],Ue=Se.text;let Re=0;for(const Me of qe)Xe.push(Se.substring(Re,Me)),Re=Me;return Re<Ue.length&&Xe.push(Se.substring(Re,Ue.length)),Xe}(H,Gp(H,k,m,e,l,B,F));const de=[],Ee={positionedLines:de,text:H.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:z,iconsInText:!1,verticalizable:!1};return function(Se,qe,Xe,Ue,Re,Me,Ve,Oe,Ae,it,tt,xt){let Ht=0,nn=yh,En=0,Jr=0;const jn=Oe==="right"?1:Oe==="left"?0:.5;let _n=0;for(const xn of Re){xn.trim();const Gn=xn.getMaxScale(),Jn=(Gn-1)*Bn,ur={positionedGlyphs:[],lineOffset:0};Se.positionedLines[_n]=ur;const Er=ur.positionedGlyphs;let Tr=0;if(!xn.length()){nn+=Me,++_n;continue}for(let Mn=0;Mn<xn.length();Mn++){const wt=xn.getSection(Mn),Fr=xn.getSectionIndex(Mn),qn=xn.getCharCode(Mn);let Yn=0,di=null,Ai=null,Pi=null,bo=Bn;const pi=!(Ae===u.WritingMode.horizontal||!tt&&!nu(qn)||tt&&(xh[qn]||(zn=qn,Ne.Arabic(zn)||Ne["Arabic Supplement"](zn)||Ne["Arabic Extended-A"](zn)||Ne["Arabic Presentation Forms-A"](zn)||Ne["Arabic Presentation Forms-B"](zn))));if(wt.imageName){const Yr=Ue[wt.imageName];if(!Yr)continue;Pi=wt.imageName,Se.iconsInText=Se.iconsInText||!0,Ai=Yr.paddedRect;const kr=Yr.displaySize;wt.scale=wt.scale*Bn/xt,di={width:kr[0],height:kr[1],left:1,top:-3,advance:pi?kr[1]:kr[0]},Yn=Jn+(Bn-kr[1]*wt.scale),bo=di.advance;const So=pi?kr[0]*wt.scale-Bn*Gn:kr[1]*wt.scale-Bn*Gn;So>0&&So>Tr&&(Tr=So)}else{const Yr=Xe[wt.fontStack],kr=Yr&&Yr[qn];if(kr&&kr.rect)Ai=kr.rect,di=kr.metrics;else{const So=qe[wt.fontStack],ku=So&&So[qn];if(!ku)continue;di=ku.metrics}Yn=(Gn-wt.scale)*Bn}pi?(Se.verticalizable=!0,Er.push({glyph:qn,imageName:Pi,x:Ht,y:nn+Yn,vertical:pi,scale:wt.scale,fontStack:wt.fontStack,sectionIndex:Fr,metrics:di,rect:Ai}),Ht+=bo*wt.scale+it):(Er.push({glyph:qn,imageName:Pi,x:Ht,y:nn+Yn,vertical:pi,scale:wt.scale,fontStack:wt.fontStack,sectionIndex:Fr,metrics:di,rect:Ai}),Ht+=di.advance*wt.scale+it)}Er.length!==0&&(En=Math.max(Ht-it,En),Pw(Er,0,Er.length-1,jn,Tr)),Ht=0;const rn=Me*Gn+Tr;ur.lineOffset=Math.max(Tr,Jn),nn+=rn,Jr=Math.max(rn,Jr),++_n}var zn;const $n=nn-yh,{horizontalAlign:Kn,verticalAlign:Sr}=qp(Ve);(function(xn,Gn,Jn,ur,Er,Tr,rn,Mn,wt){const Fr=(Gn-Jn)*Er;let qn=0;qn=Tr!==rn?-Mn*ur-yh:(-ur*wt+.5)*rn;for(const Yn of xn)for(const di of Yn.positionedGlyphs)di.x+=Fr,di.y+=qn})(Se.positionedLines,jn,Kn,Sr,En,Jr,Me,$n,Re.length),Se.top+=-Sr*$n,Se.bottom=Se.top+$n,Se.left+=-Kn*En,Se.right=Se.left+En}(Ee,e,o,l,ae,y,w,b,z,k,L,X),!function(Se){for(const qe of Se)if(qe.positionedGlyphs.length!==0)return!1;return!0}(de)&&Ee}const xh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Iw={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Sy(r,e,o,l,d,m){if(e.imageName){const y=l[e.imageName];return y?y.displaySize[0]*e.scale*Bn/m+d:0}{const y=o[e.fontStack],w=y&&y[r];return w?w.metrics.advance*e.scale+d:0}}function Ey(r,e,o,l){const d=Math.pow(r-e,2);return l?r<e?d/2:2*d:d+Math.abs(o)*o}function Aw(r,e,o){let l=0;return r===10&&(l-=1e4),o&&(l+=150),r!==40&&r!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function Ty(r,e,o,l,d,m){let y=null,w=Ey(e,o,d,m);for(const b of l){const k=Ey(e-b.x,o,d,m)+b.badness;k<=w&&(y=b,w=k)}return{index:r,x:e,priorBreak:y,badness:w}}function ky(r){return r?ky(r.priorBreak).concat(r.index):[]}function Gp(r,e,o,l,d,m,y){if(m!=="point")return[];if(!r)return[];const w=[],b=function(L,B,F,X,H,ae){let fe=0;for(let ie=0;ie<L.length();ie++){const de=L.getSection(ie);fe+=Sy(L.getCharCode(ie),de,X,H,B,ae)}return fe/Math.max(1,Math.ceil(fe/F))}(r,e,o,l,d,y),k=r.text.indexOf("​")>=0;let A=0;for(let L=0;L<r.length();L++){const B=r.getSection(L),F=r.getCharCode(L);if(xh[F]||(A+=Sy(F,B,l,d,e,y)),L<r.length()-1){const X=!((z=F)<11904||!(Ne["Bopomofo Extended"](z)||Ne.Bopomofo(z)||Ne["CJK Compatibility Forms"](z)||Ne["CJK Compatibility Ideographs"](z)||Ne["CJK Compatibility"](z)||Ne["CJK Radicals Supplement"](z)||Ne["CJK Strokes"](z)||Ne["CJK Symbols and Punctuation"](z)||Ne["CJK Unified Ideographs Extension A"](z)||Ne["CJK Unified Ideographs"](z)||Ne["Enclosed CJK Letters and Months"](z)||Ne["Halfwidth and Fullwidth Forms"](z)||Ne.Hiragana(z)||Ne["Ideographic Description Characters"](z)||Ne["Kangxi Radicals"](z)||Ne["Katakana Phonetic Extensions"](z)||Ne.Katakana(z)||Ne["Vertical Forms"](z)||Ne["Yi Radicals"](z)||Ne["Yi Syllables"](z)));(Iw[F]||X||B.imageName)&&w.push(Ty(L+1,A,b,w,Aw(F,r.getCharCode(L+1),X&&k),!1))}}var z;return ky(Ty(r.length(),A,b,w,0,!0))}function qp(r){let e=.5,o=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:e,verticalAlign:o}}function Pw(r,e,o,l,d){if(!l&&!d)return;const m=r[o],y=(r[o].x+m.metrics.advance*m.scale)*l;for(let w=e;w<=o;w++)r[w].x-=y,r[w].y+=d}function zw(r,e,o){const{horizontalAlign:l,verticalAlign:d}=qp(o),m=e[0]-r.displaySize[0]*l,y=e[1]-r.displaySize[1]*d;return{image:r,top:y,bottom:y+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function Cy(r,e,o,l,d,m){const y=r.image;let w;if(y.content){const H=y.content,ae=y.pixelRatio||1;w=[H[0]/ae,H[1]/ae,y.displaySize[0]-H[2]/ae,y.displaySize[1]-H[3]/ae]}const b=e.left*m,k=e.right*m;let A,z,L,B;o==="width"||o==="both"?(B=d[0]+b-l[3],z=d[0]+k+l[1]):(B=d[0]+(b+k-y.displaySize[0])/2,z=B+y.displaySize[0]);const F=e.top*m,X=e.bottom*m;return o==="height"||o==="both"?(A=d[1]+F-l[0],L=d[1]+X+l[2]):(A=d[1]+(F+X-y.displaySize[1])/2,L=A+y.displaySize[1]),{image:y,top:A,right:z,bottom:L,left:B,collisionPadding:w}}const wo=128;function Iy(r,e){const{expression:o}=e;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new en(r+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:d}=o;let m=0;for(;m<l.length&&l[m]<=r;)m++;m=Math.max(0,m-1);let y=m;for(;y<l.length&&l[y]<r+1;)y++;y=Math.min(l.length-1,y);const w=l[m],b=l[y];return o.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:b,interpolationType:d}:{kind:"camera",minZoom:w,maxZoom:b,minSize:o.evaluate(new en(w)),maxSize:o.evaluate(new en(b)),interpolationType:d}}}class ss extends at{constructor(e,o,l,d){super(e,o),this.angle=l,d!==void 0&&(this.segment=d)}clone(){return new ss(this.x,this.y,this.angle,this.segment)}}function Ay(r,e,o,l,d){if(e.segment===void 0)return!0;let m=e,y=e.segment+1,w=0;for(;w>-o/2;){if(y--,y<0)return!1;w-=r[y].dist(m),m=r[y]}w+=r[y].dist(r[y+1]),y++;const b=[];let k=0;for(;w<o/2;){const A=r[y],z=r[y+1];if(!z)return!1;let L=r[y-1].angleTo(A)-A.angleTo(z);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:w,angleDelta:L}),k+=L;w-b[0].distance>l;)k-=b.shift().angleDelta;if(k>d)return!1;y++,w+=A.dist(z)}return!0}function Py(r){let e=0;for(let o=0;o<r.length-1;o++)e+=r[o].dist(r[o+1]);return e}function zy(r,e,o){return r?.6*e*o:0}function My(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function Mw(r,e,o,l,d,m){const y=zy(o,d,m),w=My(o,l)*m;let b=0;const k=Py(r)/2;for(let A=0;A<r.length-1;A++){const z=r[A],L=r[A+1],B=z.dist(L);if(b+B>k){const F=(k-b)/B,X=Yt(z.x,L.x,F),H=Yt(z.y,L.y,F),ae=new ss(X,H,L.angleTo(z),A);return ae._round(),!y||Ay(r,ae,w,y,e)?ae:void 0}b+=B}}function Dw(r,e,o,l,d,m,y,w,b){const k=zy(l,m,y),A=My(l,d),z=A*y,L=r[0].x===0||r[0].x===b||r[0].y===0||r[0].y===b;return e-z<e/4&&(e=z+e/4),Dy(r,L?e/2*w%e:(A/2+2*m)*y*w%e,e,k,o,z,L,!1,b)}function Dy(r,e,o,l,d,m,y,w,b){const k=m/2,A=Py(r);let z=0,L=e-o,B=[];for(let F=0;F<r.length-1;F++){const X=r[F],H=r[F+1],ae=X.dist(H),fe=H.angleTo(X);for(;L+o<z+ae;){L+=o;const ie=(L-z)/ae,de=Yt(X.x,H.x,ie),Ee=Yt(X.y,H.y,ie);if(de>=0&&de<b&&Ee>=0&&Ee<b&&L-k>=0&&L+k<=A){const Se=new ss(de,Ee,fe,F);Se._round(),l&&!Ay(r,Se,m,l,d)||B.push(Se)}}z+=ae}return w||B.length||y||(B=Dy(r,z/2,o,l,d,m,y,!0,b)),B}function Ly(r,e,o,l,d){const m=[];for(let y=0;y<r.length;y++){const w=r[y];let b;for(let k=0;k<w.length-1;k++){let A=w[k],z=w[k+1];A.x<e&&z.x<e||(A.x<e?A=new at(e,A.y+(e-A.x)/(z.x-A.x)*(z.y-A.y))._round():z.x<e&&(z=new at(e,A.y+(e-A.x)/(z.x-A.x)*(z.y-A.y))._round()),A.y<o&&z.y<o||(A.y<o?A=new at(A.x+(o-A.y)/(z.y-A.y)*(z.x-A.x),o)._round():z.y<o&&(z=new at(A.x+(o-A.y)/(z.y-A.y)*(z.x-A.x),o)._round()),A.x>=l&&z.x>=l||(A.x>=l?A=new at(l,A.y+(l-A.x)/(z.x-A.x)*(z.y-A.y))._round():z.x>=l&&(z=new at(l,A.y+(l-A.x)/(z.x-A.x)*(z.y-A.y))._round()),A.y>=d&&z.y>=d||(A.y>=d?A=new at(A.x+(d-A.y)/(z.y-A.y)*(z.x-A.x),d)._round():z.y>=d&&(z=new at(A.x+(d-A.y)/(z.y-A.y)*(z.x-A.x),d)._round()),b&&A.equals(b[b.length-1])||(b=[A],m.push(b)),b.push(z)))))}}return m}function Ry(r,e,o,l){const d=[],m=r.image,y=m.pixelRatio,w=m.paddedRect.w-2,b=m.paddedRect.h-2,k=r.right-r.left,A=r.bottom-r.top,z=m.stretchX||[[0,w]],L=m.stretchY||[[0,b]],B=(Me,Ve)=>Me+Ve[1]-Ve[0],F=z.reduce(B,0),X=L.reduce(B,0),H=w-F,ae=b-X;let fe=0,ie=F,de=0,Ee=X,Se=0,qe=H,Xe=0,Ue=ae;if(m.content&&l){const Me=m.content;fe=vh(z,0,Me[0]),de=vh(L,0,Me[1]),ie=vh(z,Me[0],Me[2]),Ee=vh(L,Me[1],Me[3]),Se=Me[0]-fe,Xe=Me[1]-de,qe=Me[2]-Me[0]-ie,Ue=Me[3]-Me[1]-Ee}const Re=(Me,Ve,Oe,Ae)=>{const it=wh(Me.stretch-fe,ie,k,r.left),tt=bh(Me.fixed-Se,qe,Me.stretch,F),xt=wh(Ve.stretch-de,Ee,A,r.top),Ht=bh(Ve.fixed-Xe,Ue,Ve.stretch,X),nn=wh(Oe.stretch-fe,ie,k,r.left),En=bh(Oe.fixed-Se,qe,Oe.stretch,F),Jr=wh(Ae.stretch-de,Ee,A,r.top),jn=bh(Ae.fixed-Xe,Ue,Ae.stretch,X),_n=new at(it,xt),zn=new at(nn,xt),$n=new at(nn,Jr),Kn=new at(it,Jr),Sr=new at(tt/y,Ht/y),xn=new at(En/y,jn/y),Gn=e*Math.PI/180;if(Gn){const Er=Math.sin(Gn),Tr=Math.cos(Gn),rn=[Tr,-Er,Er,Tr];_n._matMult(rn),zn._matMult(rn),Kn._matMult(rn),$n._matMult(rn)}const Jn=Me.stretch+Me.fixed,ur=Ve.stretch+Ve.fixed;return{tl:_n,tr:zn,bl:Kn,br:$n,tex:{x:m.paddedRect.x+1+Jn,y:m.paddedRect.y+1+ur,w:Oe.stretch+Oe.fixed-Jn,h:Ae.stretch+Ae.fixed-ur},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Sr,pixelOffsetBR:xn,minFontScaleX:qe/y/k,minFontScaleY:Ue/y/A,isSDF:o}};if(l&&(m.stretchX||m.stretchY)){const Me=By(z,H,F),Ve=By(L,ae,X);for(let Oe=0;Oe<Me.length-1;Oe++){const Ae=Me[Oe],it=Me[Oe+1];for(let tt=0;tt<Ve.length-1;tt++)d.push(Re(Ae,Ve[tt],it,Ve[tt+1]))}}else d.push(Re({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:b+1}));return d}function vh(r,e,o){let l=0;for(const d of r)l+=Math.max(e,Math.min(o,d[1]))-Math.max(e,Math.min(o,d[0]));return l}function By(r,e,o){const l=[{fixed:-1,stretch:0}];for(const[d,m]of r){const y=l[l.length-1];l.push({fixed:d-y.stretch,stretch:y.stretch}),l.push({fixed:d-y.stretch,stretch:y.stretch+(m-d)})}return l.push({fixed:e+1,stretch:o}),l}function wh(r,e,o,l){return r/e*o+l}function bh(r,e,o,l){return r-e*o/l}We("Anchor",ss);class Sh{constructor(e,o,l,d,m,y,w,b,k,A){if(this.boxStartIndex=e.length,k){let z=y.top,L=y.bottom;const B=y.collisionPadding;B&&(z-=B[1],L+=B[3]);let F=L-z;F>0&&(F=Math.max(10,F),this.circleDiameter=F)}else{let z=y.top*w-b[0],L=y.bottom*w+b[2],B=y.left*w-b[3],F=y.right*w+b[1];const X=y.collisionPadding;if(X&&(B-=X[0]*w,z-=X[1]*w,F+=X[2]*w,L+=X[3]*w),A){const H=new at(B,z),ae=new at(F,z),fe=new at(B,L),ie=new at(F,L),de=A*Math.PI/180;H._rotate(de),ae._rotate(de),fe._rotate(de),ie._rotate(de),B=Math.min(H.x,ae.x,fe.x,ie.x),F=Math.max(H.x,ae.x,fe.x,ie.x),z=Math.min(H.y,ae.y,fe.y,ie.y),L=Math.max(H.y,ae.y,fe.y,ie.y)}e.emplaceBack(o.x,o.y,B,z,F,L,l,d,m)}this.boxEndIndex=e.length}}class Lw{constructor(e=[],o=Rw){if(this.data=e,this.length=this.data.length,this.compare=o,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:o,compare:l}=this,d=o[e];for(;e>0;){const m=e-1>>1,y=o[m];if(l(d,y)>=0)break;o[e]=y,e=m}o[e]=d}_down(e){const{data:o,compare:l}=this,d=this.length>>1,m=o[e];for(;e<d;){let y=1+(e<<1),w=o[y];const b=y+1;if(b<this.length&&l(o[b],w)<0&&(y=b,w=o[b]),l(w,m)>=0)break;o[e]=w,e=y}o[e]=m}}function Rw(r,e){return r<e?-1:r>e?1:0}function Bw(r,e=1,o=!1){let l=1/0,d=1/0,m=-1/0,y=-1/0;const w=r[0];for(let B=0;B<w.length;B++){const F=w[B];(!B||F.x<l)&&(l=F.x),(!B||F.y<d)&&(d=F.y),(!B||F.x>m)&&(m=F.x),(!B||F.y>y)&&(y=F.y)}const b=Math.min(m-l,y-d);let k=b/2;const A=new Lw([],Fw);if(b===0)return new at(l,d);for(let B=l;B<m;B+=b)for(let F=d;F<y;F+=b)A.push(new Ya(B+k,F+k,k,r));let z=function(B){let F=0,X=0,H=0;const ae=B[0];for(let fe=0,ie=ae.length,de=ie-1;fe<ie;de=fe++){const Ee=ae[fe],Se=ae[de],qe=Ee.x*Se.y-Se.x*Ee.y;X+=(Ee.x+Se.x)*qe,H+=(Ee.y+Se.y)*qe,F+=3*qe}return new Ya(X/F,H/F,0,B)}(r),L=A.length;for(;A.length;){const B=A.pop();(B.d>z.d||!z.d)&&(z=B,o&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,L)),B.max-z.d<=e||(k=B.h/2,A.push(new Ya(B.p.x-k,B.p.y-k,k,r)),A.push(new Ya(B.p.x+k,B.p.y-k,k,r)),A.push(new Ya(B.p.x-k,B.p.y+k,k,r)),A.push(new Ya(B.p.x+k,B.p.y+k,k,r)),L+=4)}return o&&(console.log(`num probes: ${L}`),console.log(`best distance: ${z.d}`)),z.p}function Fw(r,e){return e.max-r.max}function Ya(r,e,o,l){this.p=new at(r,e),this.h=o,this.d=function(d,m){let y=!1,w=1/0;for(let b=0;b<m.length;b++){const k=m[b];for(let A=0,z=k.length,L=z-1;A<z;L=A++){const B=k[A],F=k[L];B.y>d.y!=F.y>d.y&&d.x<(F.x-B.x)*(d.y-B.y)/(F.y-B.y)+B.x&&(y=!y),w=Math.min(w,Gg(d,B,F))}}return(y?1:-1)*Math.sqrt(w)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}const Zp=Number.POSITIVE_INFINITY;function Fy(r,e){return e[1]!==Zp?function(o,l,d){let m=0,y=0;switch(l=Math.abs(l),d=Math.abs(d),o){case"top-right":case"top-left":case"top":y=d-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-d}switch(o){case"top-right":case"bottom-right":case"right":m=-l;break;case"top-left":case"bottom-left":case"left":m=l}return[m,y]}(r,e[0],e[1]):function(o,l){let d=0,m=0;l<0&&(l=0);const y=l/Math.sqrt(2);switch(o){case"top-right":case"top-left":m=y-7;break;case"bottom-right":case"bottom-left":m=7-y;break;case"bottom":m=7-l;break;case"top":m=l-7}switch(o){case"top-right":case"bottom-right":d=-y;break;case"top-left":case"bottom-left":d=y;break;case"left":d=l;break;case"right":d=-l}return[d,m]}(r,e[0])}function Wp(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ow(r,e,o,l,d,m,y,w,b,k,A){let z=m.textMaxSize.evaluate(e,{});z===void 0&&(z=y);const L=r.layers[0].layout,B=L.get("icon-offset").evaluate(e,{},A),F=Ny(o.horizontal),X=y/24,H=r.tilePixelRatio*X,ae=r.tilePixelRatio*z/24,fe=r.tilePixelRatio*w,ie=r.tilePixelRatio*L.get("symbol-spacing"),de=L.get("text-padding")*r.tilePixelRatio,Ee=function(Ae,it,tt,xt=1){const Ht=Ae.get("icon-padding").evaluate(it,{},tt),nn=Ht&&Ht.values;return[nn[0]*xt,nn[1]*xt,nn[2]*xt,nn[3]*xt]}(L,e,A,r.tilePixelRatio),Se=L.get("text-max-angle")/180*Math.PI,qe=L.get("text-rotation-alignment")!=="viewport"&&L.get("symbol-placement")!=="point",Xe=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",Ue=L.get("symbol-placement"),Re=ie/2,Me=L.get("icon-text-fit");let Ve;l&&Me!=="none"&&(r.allowVerticalPlacement&&o.vertical&&(Ve=Cy(l,o.vertical,Me,L.get("icon-text-fit-padding"),B,X)),F&&(l=Cy(l,F,Me,L.get("icon-text-fit-padding"),B,X)));const Oe=(Ae,it)=>{it.x<0||it.x>=Sn||it.y<0||it.y>=Sn||function(tt,xt,Ht,nn,En,Jr,jn,_n,zn,$n,Kn,Sr,xn,Gn,Jn,ur,Er,Tr,rn,Mn,wt,Fr,qn,Yn,di){const Ai=tt.addToLineVertexArray(xt,Ht);let Pi,bo,pi,Yr,kr=0,So=0,ku=0,t_=0,rf=-1,of=-1;const Eo={};let n_=Pn.exports(""),sf=0,af=0;if(_n._unevaluatedLayout.getValue("text-radial-offset")===void 0?[sf,af]=_n.layout.get("text-offset").evaluate(wt,{},Yn).map(Cr=>Cr*Bn):(sf=_n.layout.get("text-radial-offset").evaluate(wt,{},Yn)*Bn,af=Zp),tt.allowVerticalPlacement&&nn.vertical){const Cr=_n.layout.get("text-rotate").evaluate(wt,{},Yn)+90;pi=new Sh(zn,xt,$n,Kn,Sr,nn.vertical,xn,Gn,Jn,Cr),jn&&(Yr=new Sh(zn,xt,$n,Kn,Sr,jn,Er,Tr,Jn,Cr))}if(En){const Cr=_n.layout.get("icon-rotate").evaluate(wt,{}),Qi=_n.layout.get("icon-text-fit")!=="none",Cu=Ry(En,Cr,qn,Qi),Iu=jn?Ry(jn,Cr,qn,Qi):void 0;bo=new Sh(zn,xt,$n,Kn,Sr,En,Er,Tr,!1,Cr),kr=4*Cu.length;const o_=tt.iconSizeData;let aa=null;o_.kind==="source"?(aa=[wo*_n.layout.get("icon-size").evaluate(wt,{})],aa[0]>as&&Be(`${tt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):o_.kind==="composite"&&(aa=[wo*Fr.compositeIconSizes[0].evaluate(wt,{},Yn),wo*Fr.compositeIconSizes[1].evaluate(wt,{},Yn)],(aa[0]>as||aa[1]>as)&&Be(`${tt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),tt.addSymbols(tt.icon,Cu,aa,Mn,rn,wt,u.WritingMode.none,xt,Ai.lineStartIndex,Ai.lineLength,-1,Yn),rf=tt.icon.placedSymbolArray.length-1,Iu&&(So=4*Iu.length,tt.addSymbols(tt.icon,Iu,aa,Mn,rn,wt,u.WritingMode.vertical,xt,Ai.lineStartIndex,Ai.lineLength,-1,Yn),of=tt.icon.placedSymbolArray.length-1)}const r_=Object.keys(nn.horizontal);for(const Cr of r_){const Qi=nn.horizontal[Cr];if(!Pi){n_=Pn.exports(Qi.text);const Iu=_n.layout.get("text-rotate").evaluate(wt,{},Yn);Pi=new Sh(zn,xt,$n,Kn,Sr,Qi,xn,Gn,Jn,Iu)}const Cu=Qi.positionedLines.length===1;if(ku+=Oy(tt,xt,Qi,Jr,_n,Jn,wt,ur,Ai,nn.vertical?u.WritingMode.horizontal:u.WritingMode.horizontalOnly,Cu?r_:[Cr],Eo,rf,Fr,Yn),Cu)break}nn.vertical&&(t_+=Oy(tt,xt,nn.vertical,Jr,_n,Jn,wt,ur,Ai,u.WritingMode.vertical,["vertical"],Eo,of,Fr,Yn));const Jw=Pi?Pi.boxStartIndex:tt.collisionBoxArray.length,Yw=Pi?Pi.boxEndIndex:tt.collisionBoxArray.length,Qw=pi?pi.boxStartIndex:tt.collisionBoxArray.length,eb=pi?pi.boxEndIndex:tt.collisionBoxArray.length,tb=bo?bo.boxStartIndex:tt.collisionBoxArray.length,nb=bo?bo.boxEndIndex:tt.collisionBoxArray.length,rb=Yr?Yr.boxStartIndex:tt.collisionBoxArray.length,ib=Yr?Yr.boxEndIndex:tt.collisionBoxArray.length;let zi=-1;const Ih=(Cr,Qi)=>Cr&&Cr.circleDiameter?Math.max(Cr.circleDiameter,Qi):Qi;zi=Ih(Pi,zi),zi=Ih(pi,zi),zi=Ih(bo,zi),zi=Ih(Yr,zi);const i_=zi>-1?1:0;i_&&(zi*=di/Bn),tt.glyphOffsetArray.length>=Qa.MAX_GLYPHS&&Be("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),wt.sortKey!==void 0&&tt.addToSortKeyRanges(tt.symbolInstances.length,wt.sortKey),tt.symbolInstances.emplaceBack(xt.x,xt.y,Eo.right>=0?Eo.right:-1,Eo.center>=0?Eo.center:-1,Eo.left>=0?Eo.left:-1,Eo.vertical||-1,rf,of,n_,Jw,Yw,Qw,eb,tb,nb,rb,ib,$n,ku,t_,kr,So,i_,0,xn,sf,af,zi)}(r,it,Ae,o,l,d,Ve,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,H,[de,de,de,de],qe,b,fe,Ee,Xe,B,e,m,k,A,y)};if(Ue==="line")for(const Ae of Ly(e.geometry,0,0,Sn,Sn)){const it=Dw(Ae,ie,Se,o.vertical||F,l,24,ae,r.overscaling,Sn);for(const tt of it){const xt=F;xt&&Nw(r,xt.text,Re,tt)||Oe(Ae,tt)}}else if(Ue==="line-center"){for(const Ae of e.geometry)if(Ae.length>1){const it=Mw(Ae,Se,o.vertical||F,l,24,ae);it&&Oe(Ae,it)}}else if(e.type==="Polygon")for(const Ae of Lp(e.geometry,0)){const it=Bw(Ae,16);Oe(Ae[0],new ss(it.x,it.y,0))}else if(e.type==="LineString")for(const Ae of e.geometry)Oe(Ae,new ss(Ae[0].x,Ae[0].y,0));else if(e.type==="Point")for(const Ae of e.geometry)for(const it of Ae)Oe([it],new ss(it.x,it.y,0))}const as=32640;function Oy(r,e,o,l,d,m,y,w,b,k,A,z,L,B,F){const X=function(fe,ie,de,Ee,Se,qe,Xe,Ue){const Re=Ee.layout.get("text-rotate").evaluate(qe,{})*Math.PI/180,Me=[];for(const Ve of ie.positionedLines)for(const Oe of Ve.positionedGlyphs){if(!Oe.rect)continue;const Ae=Oe.rect||{};let it=4,tt=!0,xt=1,Ht=0;const nn=(Se||Ue)&&Oe.vertical,En=Oe.metrics.advance*Oe.scale/2;if(Ue&&ie.verticalizable){const rn=(Oe.scale-1)*Bn,Mn=(Bn-Oe.metrics.width*Oe.scale)/2;Ht=Ve.lineOffset/2-(Oe.imageName?-Mn:rn)}if(Oe.imageName){const rn=Xe[Oe.imageName];tt=rn.sdf,xt=rn.pixelRatio,it=1/xt}const Jr=Se?[Oe.x+En,Oe.y]:[0,0];let jn=Se?[0,0]:[Oe.x+En+de[0],Oe.y+de[1]-Ht],_n=[0,0];nn&&(_n=jn,jn=[0,0]);const zn=(Oe.metrics.left-it)*Oe.scale-En+jn[0],$n=(-Oe.metrics.top-it)*Oe.scale+jn[1],Kn=zn+Ae.w*Oe.scale/xt,Sr=$n+Ae.h*Oe.scale/xt,xn=new at(zn,$n),Gn=new at(Kn,$n),Jn=new at(zn,Sr),ur=new at(Kn,Sr);if(nn){const rn=new at(-En,En-yh),Mn=-Math.PI/2,wt=12-En,Fr=new at(22-wt,-(Oe.imageName?wt:0)),qn=new at(..._n);xn._rotateAround(Mn,rn)._add(Fr)._add(qn),Gn._rotateAround(Mn,rn)._add(Fr)._add(qn),Jn._rotateAround(Mn,rn)._add(Fr)._add(qn),ur._rotateAround(Mn,rn)._add(Fr)._add(qn)}if(Re){const rn=Math.sin(Re),Mn=Math.cos(Re),wt=[Mn,-rn,rn,Mn];xn._matMult(wt),Gn._matMult(wt),Jn._matMult(wt),ur._matMult(wt)}const Er=new at(0,0),Tr=new at(0,0);Me.push({tl:xn,tr:Gn,bl:Jn,br:ur,tex:Ae,writingMode:ie.writingMode,glyphOffset:Jr,sectionIndex:Oe.sectionIndex,isSDF:tt,pixelOffsetTL:Er,pixelOffsetBR:Tr,minFontScaleX:0,minFontScaleY:0})}return Me}(0,o,w,d,m,y,l,r.allowVerticalPlacement),H=r.textSizeData;let ae=null;H.kind==="source"?(ae=[wo*d.layout.get("text-size").evaluate(y,{})],ae[0]>as&&Be(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):H.kind==="composite"&&(ae=[wo*B.compositeTextSizes[0].evaluate(y,{},F),wo*B.compositeTextSizes[1].evaluate(y,{},F)],(ae[0]>as||ae[1]>as)&&Be(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,X,ae,w,m,y,k,e,b.lineStartIndex,b.lineLength,L,F);for(const fe of A)z[fe]=r.text.placedSymbolArray.length-1;return 4*X.length}function Ny(r){for(const e in r)return r[e];return null}function Nw(r,e,o,l){const d=r.compareText;if(e in d){const m=d[e];for(let y=m.length-1;y>=0;y--)if(l.dist(m[y])<o)return!0}else d[e]=[];return d[e].push(l),!1}const Uw=is.VectorTileFeature.types,Vw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Eh(r,e,o,l,d,m,y,w,b,k,A,z,L){const B=w?Math.min(as,Math.round(w[0])):0,F=w?Math.min(as,Math.round(w[1])):0;r.emplaceBack(e,o,Math.round(32*l),Math.round(32*d),m,y,(B<<1)+(b?1:0),F,16*k,16*A,256*z,256*L)}function Hp(r,e,o){r.emplaceBack(e.x,e.y,o),r.emplaceBack(e.x,e.y,o),r.emplaceBack(e.x,e.y,o),r.emplaceBack(e.x,e.y,o)}function jw(r){for(const e of r.sections)if(Qc(e.text))return!0;return!1}class Xp{constructor(e){this.layoutVertexArray=new ci,this.indexArray=new sr,this.programConfigurations=e,this.segments=new vt,this.dynamicLayoutVertexArray=new Hr,this.opacityVertexArray=new hi,this.placedSymbolArray=new Ie}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,o,l,d){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,dw.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Vw,!0),this.opacityVertexBuffer.itemSize=1),(l||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}We("SymbolBuffers",Xp);class Kp{constructor(e,o,l){this.layoutVertexArray=new e,this.layoutAttributes=o,this.indexArray=new l,this.segments=new vt,this.collisionVertexArray=new Rr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,pw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}We("CollisionBuffers",Kp);class Qa{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ip([]),this.placementViewportMatrix=Ip([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Iy(this.zoom,o["text-size"]),this.iconSizeData=Iy(this.zoom,o["icon-size"]);const l=this.layers[0].layout,d=l.get("symbol-sort-key"),m=l.get("symbol-z-order");this.canOverlap=Yp(l,"text-overlap","text-allow-overlap")!=="never"||Yp(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(y=>u.WritingMode[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID}createArrays(){this.text=new Xp(new na(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Xp(new na(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Le,this.lineVertexArray=new Ge,this.symbolInstances=new $e}calculateGlyphDependencies(e,o,l,d,m){for(let y=0;y<e.length;y++)if(o[e.charCodeAt(y)]=!0,(l||d)&&m){const w=bu[e.charAt(y)];w&&(o[w.charCodeAt(0)]=!0)}}populate(e,o,l){const d=this.layers[0],m=d.layout,y=m.get("text-font"),w=m.get("text-field"),b=m.get("icon-image"),k=(w.value.kind!=="constant"||w.value.value instanceof Y&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),A=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,z=m.get("symbol-sort-key");if(this.features=[],!k&&!A)return;const L=o.iconDependencies,B=o.glyphDependencies,F=o.availableImages,X=new en(this.zoom);for(const{feature:H,id:ae,index:fe,sourceLayerIndex:ie}of e){const de=d._featureFilter.needGeometry,Ee=ia(H,de);if(!d._featureFilter.filter(X,Ee,l))continue;let Se,qe;if(de||(Ee.geometry=ra(H)),k){const Ue=d.getValueAndResolveTokens("text-field",Ee,l,F),Re=Y.factory(Ue);jw(Re)&&(this.hasRTLText=!0),(!this.hasRTLText||Qs()==="unavailable"||this.hasRTLText&&Lr.isParsed())&&(Se=mw(Re,d,Ee))}if(A){const Ue=d.getValueAndResolveTokens("icon-image",Ee,l,F);qe=Ue instanceof ne?Ue:ne.fromString(Ue)}if(!Se&&!qe)continue;const Xe=this.sortFeaturesByKey?z.evaluate(Ee,{},l):void 0;if(this.features.push({id:ae,text:Se,icon:qe,index:fe,sourceLayerIndex:ie,geometry:Ee.geometry,properties:H.properties,type:Uw[H.type],sortKey:Xe}),qe&&(L[qe.name]=!0),Se){const Ue=y.evaluate(Ee,{},l).join(","),Re=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.WritingMode.vertical)>=0;for(const Me of Se.sections)if(Me.image)L[Me.image.name]=!0;else{const Ve=Va(Se.toString()),Oe=Me.fontStack||Ue,Ae=B[Oe]=B[Oe]||{};this.calculateGlyphDependencies(Me.text,Ae,Re,this.allowVerticalPlacement,Ve)}}}m.get("symbol-placement")==="line"&&(this.features=function(H){const ae={},fe={},ie=[];let de=0;function Ee(Ue){ie.push(H[Ue]),de++}function Se(Ue,Re,Me){const Ve=fe[Ue];return delete fe[Ue],fe[Re]=Ve,ie[Ve].geometry[0].pop(),ie[Ve].geometry[0]=ie[Ve].geometry[0].concat(Me[0]),Ve}function qe(Ue,Re,Me){const Ve=ae[Re];return delete ae[Re],ae[Ue]=Ve,ie[Ve].geometry[0].shift(),ie[Ve].geometry[0]=Me[0].concat(ie[Ve].geometry[0]),Ve}function Xe(Ue,Re,Me){const Ve=Me?Re[0][Re[0].length-1]:Re[0][0];return`${Ue}:${Ve.x}:${Ve.y}`}for(let Ue=0;Ue<H.length;Ue++){const Re=H[Ue],Me=Re.geometry,Ve=Re.text?Re.text.toString():null;if(!Ve){Ee(Ue);continue}const Oe=Xe(Ve,Me),Ae=Xe(Ve,Me,!0);if(Oe in fe&&Ae in ae&&fe[Oe]!==ae[Ae]){const it=qe(Oe,Ae,Me),tt=Se(Oe,Ae,ie[it].geometry);delete ae[Oe],delete fe[Ae],fe[Xe(Ve,ie[tt].geometry,!0)]=tt,ie[it].geometry=null}else Oe in fe?Se(Oe,Ae,Me):Ae in ae?qe(Oe,Ae,Me):(Ee(Ue),ae[Oe]=de-1,fe[Ae]=de-1)}return ie.filter(Ue=>Ue.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((H,ae)=>H.sortKey-ae.sortKey)}update(e,o,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,o,this.layers,l),this.icon.programConfigurations.updatePaintArrays(e,o,this.layers,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,o){const l=this.lineVertexArray.length;if(e.segment!==void 0){let d=e.dist(o[e.segment+1]),m=e.dist(o[e.segment]);const y={};for(let w=e.segment+1;w<o.length;w++)y[w]={x:o[w].x,y:o[w].y,tileUnitDistanceFromAnchor:d},w<o.length-1&&(d+=o[w+1].dist(o[w]));for(let w=e.segment||0;w>=0;w--)y[w]={x:o[w].x,y:o[w].y,tileUnitDistanceFromAnchor:m},w>0&&(m+=o[w-1].dist(o[w]));for(let w=0;w<o.length;w++){const b=y[w];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,o,l,d,m,y,w,b,k,A,z,L){const B=e.indexArray,F=e.layoutVertexArray,X=e.segments.prepareSegment(4*o.length,F,B,this.canOverlap?y.sortKey:void 0),H=this.glyphOffsetArray.length,ae=X.vertexLength,fe=this.allowVerticalPlacement&&w===u.WritingMode.vertical?Math.PI/2:0,ie=y.text&&y.text.sections;for(let de=0;de<o.length;de++){const{tl:Ee,tr:Se,bl:qe,br:Xe,tex:Ue,pixelOffsetTL:Re,pixelOffsetBR:Me,minFontScaleX:Ve,minFontScaleY:Oe,glyphOffset:Ae,isSDF:it,sectionIndex:tt}=o[de],xt=X.vertexLength,Ht=Ae[1];Eh(F,b.x,b.y,Ee.x,Ht+Ee.y,Ue.x,Ue.y,l,it,Re.x,Re.y,Ve,Oe),Eh(F,b.x,b.y,Se.x,Ht+Se.y,Ue.x+Ue.w,Ue.y,l,it,Me.x,Re.y,Ve,Oe),Eh(F,b.x,b.y,qe.x,Ht+qe.y,Ue.x,Ue.y+Ue.h,l,it,Re.x,Me.y,Ve,Oe),Eh(F,b.x,b.y,Xe.x,Ht+Xe.y,Ue.x+Ue.w,Ue.y+Ue.h,l,it,Me.x,Me.y,Ve,Oe),Hp(e.dynamicLayoutVertexArray,b,fe),B.emplaceBack(xt,xt+1,xt+2),B.emplaceBack(xt+1,xt+2,xt+3),X.vertexLength+=4,X.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ae[0]),de!==o.length-1&&tt===o[de+1].sectionIndex||e.programConfigurations.populatePaintArrays(F.length,y,y.index,{},L,ie&&ie[tt])}e.placedSymbolArray.emplaceBack(b.x,b.y,H,this.glyphOffsetArray.length-H,ae,k,A,b.segment,l?l[0]:0,l?l[1]:0,d[0],d[1],w,0,!1,0,z)}_addCollisionDebugVertex(e,o,l,d,m,y){return o.emplaceBack(0,0),e.emplaceBack(l.x,l.y,d,m,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(e,o,l,d,m,y,w){const b=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),k=b.vertexLength,A=m.layoutVertexArray,z=m.collisionVertexArray,L=w.anchorX,B=w.anchorY;this._addCollisionDebugVertex(A,z,y,L,B,new at(e,o)),this._addCollisionDebugVertex(A,z,y,L,B,new at(l,o)),this._addCollisionDebugVertex(A,z,y,L,B,new at(l,d)),this._addCollisionDebugVertex(A,z,y,L,B,new at(e,d)),b.vertexLength+=4;const F=m.indexArray;F.emplaceBack(k,k+1),F.emplaceBack(k+1,k+2),F.emplaceBack(k+2,k+3),F.emplaceBack(k+3,k),b.primitiveLength+=4}addDebugCollisionBoxes(e,o,l,d){for(let m=e;m<o;m++){const y=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,d?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Kp(Ji,fy.members,Ci),this.iconCollisionBox=new Kp(Ji,fy.members,Ci);for(let e=0;e<this.symbolInstances.length;e++){const o=this.symbolInstances.get(e);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}}_deserializeCollisionBoxesForSymbol(e,o,l,d,m,y,w,b,k){const A={};for(let z=o;z<l;z++){const L=e.get(z);A.textBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},A.textFeatureIndex=L.featureIndex;break}for(let z=d;z<m;z++){const L=e.get(z);A.verticalTextBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},A.verticalTextFeatureIndex=L.featureIndex;break}for(let z=y;z<w;z++){const L=e.get(z);A.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},A.iconFeatureIndex=L.featureIndex;break}for(let z=b;z<k;z++){const L=e.get(z);A.verticalIconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},A.verticalIconFeatureIndex=L.featureIndex;break}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const l=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,o){const l=e.placedSymbolArray.get(o),d=l.vertexStartIndex+4*l.numGlyphs;for(let m=l.vertexStartIndex;m<d;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(e),l=Math.cos(e),d=[],m=[],y=[];for(let w=0;w<this.symbolInstances.length;++w){y.push(w);const b=this.symbolInstances.get(w);d.push(0|Math.round(o*b.anchorX+l*b.anchorY)),m.push(b.featureIndex)}return y.sort((w,b)=>d[w]-d[b]||m[b]-m[w]),y}addToSortKeyRanges(e,o){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===o?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const l=this.symbolInstances.get(o);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((d,m,y)=>{d>=0&&y.indexOf(d)===m&&this.addIndicesForPlacedSymbol(this.text,d)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}We("SymbolBucket",Qa,{omit:["layers","collisionBoxArray","features","compareText"]}),Qa.MAX_GLYPHS=65535,Qa.addDynamicAttributes=Hp;const $w=new Rn({"symbol-placement":new Ye(we.layout_symbol["symbol-placement"]),"symbol-spacing":new Ye(we.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ye(we.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new st(we.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ye(we.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ye(we.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ye(we.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ye(we.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ye(we.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ye(we.layout_symbol["icon-rotation-alignment"]),"icon-size":new st(we.layout_symbol["icon-size"]),"icon-text-fit":new Ye(we.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ye(we.layout_symbol["icon-text-fit-padding"]),"icon-image":new st(we.layout_symbol["icon-image"]),"icon-rotate":new st(we.layout_symbol["icon-rotate"]),"icon-padding":new st(we.layout_symbol["icon-padding"]),"icon-keep-upright":new Ye(we.layout_symbol["icon-keep-upright"]),"icon-offset":new st(we.layout_symbol["icon-offset"]),"icon-anchor":new st(we.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ye(we.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ye(we.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ye(we.layout_symbol["text-rotation-alignment"]),"text-field":new st(we.layout_symbol["text-field"]),"text-font":new st(we.layout_symbol["text-font"]),"text-size":new st(we.layout_symbol["text-size"]),"text-max-width":new st(we.layout_symbol["text-max-width"]),"text-line-height":new Ye(we.layout_symbol["text-line-height"]),"text-letter-spacing":new st(we.layout_symbol["text-letter-spacing"]),"text-justify":new st(we.layout_symbol["text-justify"]),"text-radial-offset":new st(we.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ye(we.layout_symbol["text-variable-anchor"]),"text-anchor":new st(we.layout_symbol["text-anchor"]),"text-max-angle":new Ye(we.layout_symbol["text-max-angle"]),"text-writing-mode":new Ye(we.layout_symbol["text-writing-mode"]),"text-rotate":new st(we.layout_symbol["text-rotate"]),"text-padding":new Ye(we.layout_symbol["text-padding"]),"text-keep-upright":new Ye(we.layout_symbol["text-keep-upright"]),"text-transform":new st(we.layout_symbol["text-transform"]),"text-offset":new st(we.layout_symbol["text-offset"]),"text-allow-overlap":new Ye(we.layout_symbol["text-allow-overlap"]),"text-overlap":new Ye(we.layout_symbol["text-overlap"]),"text-ignore-placement":new Ye(we.layout_symbol["text-ignore-placement"]),"text-optional":new Ye(we.layout_symbol["text-optional"])});var Jp={paint:new Rn({"icon-opacity":new st(we.paint_symbol["icon-opacity"]),"icon-color":new st(we.paint_symbol["icon-color"]),"icon-halo-color":new st(we.paint_symbol["icon-halo-color"]),"icon-halo-width":new st(we.paint_symbol["icon-halo-width"]),"icon-halo-blur":new st(we.paint_symbol["icon-halo-blur"]),"icon-translate":new Ye(we.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ye(we.paint_symbol["icon-translate-anchor"]),"text-opacity":new st(we.paint_symbol["text-opacity"]),"text-color":new st(we.paint_symbol["text-color"],{runtimeType:Ln,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new st(we.paint_symbol["text-halo-color"]),"text-halo-width":new st(we.paint_symbol["text-halo-width"]),"text-halo-blur":new st(we.paint_symbol["text-halo-blur"]),"text-translate":new Ye(we.paint_symbol["text-translate"]),"text-translate-anchor":new Ye(we.paint_symbol["text-translate-anchor"])}),layout:$w};class Uy{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:$i,this.defaultValue=e}evaluate(e){if(e.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(e.formattedSection))return o.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}We("FormatSectionOverride",Uy,{omit:["defaultValue"]});class Th extends ui{constructor(e){super(e,Jp)}recalculate(e,o){if(super.recalculate(e,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const d=[];for(const m of l)d.indexOf(m)<0&&d.push(m);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,o,l,d){const m=this.layout.get(e).evaluate(o,{},l,d),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||Us(y.value)||!m?m:function(w,b){return b.replace(/{([^{}]+)}/g,(k,A)=>A in w?String(w[A]):"")}(o.properties,m)}createBucket(e){return new Qa(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Jp.paint.overridableProperties){if(!Th.hasPaintOverride(this.layout,e))continue;const o=this.paint.get(e),l=new Uy(o),d=new Ra(l,o.property.specification);let m=null;m=o.value.kind==="constant"||o.value.kind==="source"?new js("source",d):new Kl("composite",d,o.value.zoomStops),this.paint._values[e]=new li(o.property,m,o.parameters)}}_handleOverridablePaintPropertyUpdate(e,o,l){return!(!this.layout||o.isDataDriven()||l.isDataDriven())&&Th.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,o){const l=e.get("text-field"),d=Jp.paint.properties[o];let m=!1;const y=w=>{for(const b of w)if(d.overrides&&d.overrides.hasOverride(b))return void(m=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Y)y(l.value.value.sections);else if(l.value.kind==="source"){const w=k=>{m||(k instanceof Je&&me(k.value)===kn?y(k.value.sections):k instanceof Da?y(k.sections):k.eachChild(w))},b=l.value;b._styleExpression&&w(b._styleExpression.expression)}return m}}function Yp(r,e,o){let l="never";const d=r.get(e);return d?l=d:r.get(o)&&(l="always"),l}var Gw={paint:new Rn({"background-color":new Ye(we.paint_background["background-color"]),"background-pattern":new lu(we.paint_background["background-pattern"]),"background-opacity":new Ye(we.paint_background["background-opacity"])})},qw={paint:new Rn({"raster-opacity":new Ye(we.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ye(we.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ye(we.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ye(we.paint_raster["raster-brightness-max"]),"raster-saturation":new Ye(we.paint_raster["raster-saturation"]),"raster-contrast":new Ye(we.paint_raster["raster-contrast"]),"raster-resampling":new Ye(we.paint_raster["raster-resampling"]),"raster-fade-duration":new Ye(we.paint_raster["raster-fade-duration"])})};class Zw extends ui{constructor(e){super(e,{}),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const Ww={circle:class extends ui{constructor(r){super(r,E1)}createBucket(r){return new Tp(r)}queryRadius(r){const e=r;return pu("circle-radius",this,e)+pu("circle-stroke-width",this,e)+lh(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,o,l,d,m,y,w){const b=uh(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,y),k=this.paint.get("circle-radius").evaluate(e,o)+this.paint.get("circle-stroke-width").evaluate(e,o),A=this.paint.get("circle-pitch-alignment")==="map",z=A?b:function(B,F){return B.map(X=>Jg(X,F))}(b,w),L=A?k*y:k;for(const B of l)for(const F of B){const X=A?F:Jg(F,w);let H=L;const ae=ch([],[F.x,F.y,0,1],w);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?H*=ae[3]/m.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(H*=m.cameraToCenterDistance/ae[3]),x1(z,X,H))return!0}return!1}},heatmap:class extends ui{constructor(r){super(r,k1),this._updateColorRamp()}createBucket(r){return new Yg(r)}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ey({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends ui{constructor(r){super(r,C1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends ui{constructor(r){super(r,$1)}recalculate(r,e){super.recalculate(r,e);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Fp(r)}queryRadius(){return lh(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,o,l,d,m,y){return $g(uh(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,y),l)}isTileClipped(){return!0}},"fill-extrusion":class extends ui{constructor(r){super(r,rw)}createBucket(r){return new Np(r)}queryRadius(){return lh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(r,e,o,l,d,m,y,w){const b=uh(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,y),k=this.paint.get("fill-extrusion-height").evaluate(e,o),A=this.paint.get("fill-extrusion-base").evaluate(e,o),z=function(B,F,X,H){const ae=[];for(const fe of B){const ie=[fe.x,fe.y,0,1];ch(ie,ie,F),ae.push(new at(ie[0]/ie[3],ie[1]/ie[3]))}return ae}(b,w),L=function(B,F,X,H){const ae=[],fe=[],ie=H[8]*F,de=H[9]*F,Ee=H[10]*F,Se=H[11]*F,qe=H[8]*X,Xe=H[9]*X,Ue=H[10]*X,Re=H[11]*X;for(const Me of B){const Ve=[],Oe=[];for(const Ae of Me){const it=Ae.x,tt=Ae.y,xt=H[0]*it+H[4]*tt+H[12],Ht=H[1]*it+H[5]*tt+H[13],nn=H[2]*it+H[6]*tt+H[14],En=H[3]*it+H[7]*tt+H[15],Jr=nn+Ee,jn=En+Se,_n=xt+qe,zn=Ht+Xe,$n=nn+Ue,Kn=En+Re,Sr=new at((xt+ie)/jn,(Ht+de)/jn);Sr.z=Jr/jn,Ve.push(Sr);const xn=new at(_n/Kn,zn/Kn);xn.z=$n/Kn,Oe.push(xn)}ae.push(Ve),fe.push(Oe)}return[ae,fe]}(l,A,k,w);return function(B,F,X){let H=1/0;$g(X,F)&&(H=uy(X,F[0]));for(let ae=0;ae<F.length;ae++){const fe=F[ae],ie=B[ae];for(let de=0;de<fe.length-1;de++){const Ee=fe[de],Se=[Ee,fe[de+1],ie[de+1],ie[de],Ee];jg(X,Se)&&(H=Math.min(H,uy(X,Se)))}}return H!==1/0&&H}(L[0],L[1],z)}},line:class extends ui{constructor(r){super(r,hy),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Rs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=dy.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Up(r)}queryRadius(r){const e=r,o=py(pu("line-width",this,e),pu("line-gap-width",this,e)),l=pu("line-offset",this,e);return o/2+Math.abs(l)+lh(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,o,l,d,m,y){const w=uh(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,y),b=y/2*py(this.paint.get("line-width").evaluate(e,o),this.paint.get("line-gap-width").evaluate(e,o)),k=this.paint.get("line-offset").evaluate(e,o);return k&&(l=function(A,z){const L=[];for(let B=0;B<A.length;B++){const F=A[B],X=[];for(let H=0;H<F.length;H++){const ae=F[H-1],fe=F[H],ie=F[H+1],de=H===0?new at(0,0):fe.sub(ae)._unit()._perp(),Ee=H===F.length-1?new at(0,0):ie.sub(fe)._unit()._perp(),Se=de._add(Ee)._unit(),qe=Se.x*Ee.x+Se.y*Ee.y;qe!==0&&Se._mult(1/qe),X.push(Se._mult(z)._add(fe))}L.push(X)}return L}(l,k*y)),function(A,z,L){for(let B=0;B<z.length;B++){const F=z[B];if(A.length>=3){for(let X=0;X<F.length;X++)if(Za(A,F[X]))return!0}if(v1(A,F,L))return!0}return!1}(w,l,b)}isTileClipped(){return!0}},symbol:Th,background:class extends ui{constructor(r){super(r,Gw)}},raster:class extends ui{constructor(r){super(r,qw)}}};class Hw{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Vy=63710088e-1;class un{constructor(e,o){if(isNaN(e)||isNaN(o))throw new Error(`Invalid LngLat object: (${e}, ${o})`);if(this.lng=+e,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new un(Te(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const o=Math.PI/180,l=this.lat*o,d=e.lat*o,m=Math.sin(l)*Math.sin(d)+Math.cos(l)*Math.cos(d)*Math.cos((e.lng-this.lng)*o);return Vy*Math.acos(Math.min(m,1))}toBounds(e=0){const o=360*e/40075017,l=o/Math.cos(Math.PI/180*this.lat);return new sa(new un(this.lng-l,this.lat-o),new un(this.lng+l,this.lat+o))}static convert(e){if(e instanceof un)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new un(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new un(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class sa{constructor(e,o){e&&(o?this.setSouthWest(e).setNorthEast(o):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof un?new un(e.lng,e.lat):un.convert(e),this}setSouthWest(e){return this._sw=e instanceof un?new un(e.lng,e.lat):un.convert(e),this}extend(e){const o=this._sw,l=this._ne;let d,m;if(e instanceof un)d=e,m=e;else{if(!(e instanceof sa))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(sa.convert(e)):this.extend(un.convert(e)):this;if(d=e._sw,m=e._ne,!d||!m)return this}return o||l?(o.lng=Math.min(d.lng,o.lng),o.lat=Math.min(d.lat,o.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new un(d.lng,d.lat),this._ne=new un(m.lng,m.lat)),this}getCenter(){return new un((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new un(this.getWest(),this.getNorth())}getSouthEast(){return new un(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:o,lat:l}=un.convert(e);let d=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&d}static convert(e){return e instanceof sa?e:e&&new sa(e)}}const jy=2*Math.PI*Vy;function $y(r){return jy*Math.cos(r*Math.PI/180)}function Gy(r){return(180+r)/360}function qy(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Zy(r,e){return r/$y(e)}function Qp(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class kh{constructor(e,o,l=0){this.x=+e,this.y=+o,this.z=+l}static fromLngLat(e,o=0){const l=un.convert(e);return new kh(Gy(l.lng),qy(l.lat),Zy(o,l.lat))}toLngLat(){return new un(360*this.x-180,Qp(this.y))}toAltitude(){return this.z*$y(Qp(this.y))}meterInMercatorCoordinateUnits(){return 1/jy*(e=Qp(this.y),1/Math.cos(e*Math.PI/180));var e}}function Wy(r,e,o){var l=2*Math.PI*6378137/256/Math.pow(2,o);return[r*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class ef{constructor(e,o,l){if(e<0||e>25||l<0||l>=Math.pow(2,e)||o<0||o>=Math.pow(2,e))throw new Error(`x=${o}, y=${l}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=o,this.y=l,this.key=Eu(0,e,e,o,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,o,l){const d=(y=this.y,w=this.z,b=Wy(256*(m=this.x),256*(y=Math.pow(2,w)-y-1),w),k=Wy(256*(m+1),256*(y+1),w),b[0]+","+b[1]+","+k[0]+","+k[1]);var m,y,w,b,k;const A=function(z,L,B){let F,X="";for(let H=z;H>0;H--)F=1<<H-1,X+=(L&F?1:0)+(B&F?2:0);return X}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,o>1?"@2x":"").replace(/{quadkey}/g,A).replace(/{bbox-epsg-3857}/g,d)}isChildOf(e){const o=this.z-e.z;return o>0&&e.x===this.x>>o&&e.y===this.y>>o}getTilePoint(e){const o=Math.pow(2,this.z);return new at((e.x*o-this.x)*Sn,(e.y*o-this.y)*Sn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Hy{constructor(e,o){this.wrap=e,this.canonical=o,this.key=Eu(e,o.z,o.z,o.x,o.y)}}class Kr{constructor(e,o,l,d,m){if(e<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${l}`);this.overscaledZ=e,this.wrap=o,this.canonical=new ef(l,+d,+m),this.key=Eu(o,e,l,d,m)}clone(){return new Kr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?new Kr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Kr(e,this.wrap,e,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(e,o){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-e;return e>this.canonical.z?Eu(this.wrap*+o,e,this.canonical.z,this.canonical.x,this.canonical.y):Eu(this.wrap*+o,e,e,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const o=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>o&&e.canonical.y===this.canonical.y>>o}children(e){if(this.overscaledZ>=e)return[new Kr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,l=2*this.canonical.x,d=2*this.canonical.y;return[new Kr(o,this.wrap,o,l,d),new Kr(o,this.wrap,o,l+1,d),new Kr(o,this.wrap,o,l,d+1),new Kr(o,this.wrap,o,l+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Kr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Kr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Hy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new kh(e.x-this.wrap,e.y))}}function Eu(r,e,o,l,d){(r*=2)<0&&(r=-1*r-1);const m=1<<o;return(m*m*r+m*d+l).toString(36)+o.toString(36)+e.toString(36)}We("CanonicalTileID",ef),We("OverscaledTileID",Kr,{omit:["posMatrix"]});class Xy{constructor(e,o,l){if(this.uid=e,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return void Be(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const d=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=l||"mapbox";for(let m=0;m<d;m++)this.data[this._idx(-1,m)]=this.data[this._idx(0,m)],this.data[this._idx(d,m)]=this.data[this._idx(d-1,m)],this.data[this._idx(m,-1)]=this.data[this._idx(m,0)],this.data[this._idx(m,d)]=this.data[this._idx(m,d-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(d,-1)]=this.data[this._idx(d-1,0)],this.data[this._idx(-1,d)]=this.data[this._idx(0,d-1)],this.data[this._idx(d,d)]=this.data[this._idx(d-1,d-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let m=0;m<d;m++)for(let y=0;y<d;y++){const w=this.get(m,y);w>this.max&&(this.max=w),w<this.min&&(this.min=w)}}get(e,o){const l=new Uint8Array(this.data.buffer),d=4*this._idx(e,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(l[d],l[d+1],l[d+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,o){if(e<-1||e>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(e+1)}_unpackMapbox(e,o,l){return(256*e*256+256*o+l)/10-1e4}_unpackTerrarium(e,o,l){return 256*e+o+l/256-32768}getPixels(){return new Xr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,o,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=o*this.dim,m=o*this.dim+this.dim,y=l*this.dim,w=l*this.dim+this.dim;switch(o){case-1:d=m-1;break;case 1:m=d+1}switch(l){case-1:y=w-1;break;case 1:w=y+1}const b=-o*this.dim,k=-l*this.dim;for(let A=y;A<w;A++)for(let z=d;z<m;z++)this.data[this._idx(z,A)]=e.data[this._idx(z+b,A+k)]}}We("DEMData",Xy);class Ky{constructor(e){this._stringToNumber={},this._numberToString=[];for(let o=0;o<e.length;o++){const l=e[o];this._stringToNumber[l]=o,this._numberToString[o]=l}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Jy{constructor(e,o,l,d,m){this.type="Feature",this._vectorTileFeature=e,e._z=o,e._x=l,e._y=d,this.properties=e.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(e[o]=this[o]);return e}}class Yy{constructor(e,o){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ys(Sn,16,0),this.grid3D=new Ys(Sn,16,0),this.featureIndexArray=new _t,this.promoteId=o}insert(e,o,l,d,m,y){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,d,m);const b=y?this.grid3D:this.grid;for(let k=0;k<o.length;k++){const A=o[k],z=[1/0,1/0,-1/0,-1/0];for(let L=0;L<A.length;L++){const B=A[L];z[0]=Math.min(z[0],B.x),z[1]=Math.min(z[1],B.y),z[2]=Math.max(z[2],B.x),z[3]=Math.max(z[3],B.y)}z[0]<Sn&&z[1]<Sn&&z[2]>=0&&z[3]>=0&&b.insert(w,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new is.VectorTile(new Vp(this.rawTileData)).layers,this.sourceLayerCoder=new Ky(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,o,l,d){this.loadVTLayers();const m=e.params||{},y=Sn/e.tileSize/e.scale,w=Oa(m.filter),b=e.queryGeometry,k=e.queryPadding*y,A=e_(b),z=this.grid.query(A.minX-k,A.minY-k,A.maxX+k,A.maxY+k),L=e_(e.cameraQueryGeometry),B=this.grid3D.query(L.minX-k,L.minY-k,L.maxX+k,L.maxY+k,(H,ae,fe,ie)=>function(de,Ee,Se,qe,Xe){for(const Re of de)if(Ee<=Re.x&&Se<=Re.y&&qe>=Re.x&&Xe>=Re.y)return!0;const Ue=[new at(Ee,Se),new at(Ee,Xe),new at(qe,Xe),new at(qe,Se)];if(de.length>2){for(const Re of Ue)if(Za(de,Re))return!0}for(let Re=0;Re<de.length-1;Re++)if(b1(de[Re],de[Re+1],Ue))return!0;return!1}(e.cameraQueryGeometry,H-k,ae-k,fe+k,ie+k));for(const H of B)z.push(H);z.sort(Xw);const F={};let X;for(let H=0;H<z.length;H++){const ae=z[H];if(ae===X)continue;X=ae;const fe=this.featureIndexArray.get(ae);let ie=null;this.loadMatchingFeature(F,fe.bucketIndex,fe.sourceLayerIndex,fe.featureIndex,w,m.layers,m.availableImages,o,l,d,(de,Ee,Se)=>(ie||(ie=ra(de)),Ee.queryIntersectsFeature(b,de,Se,ie,this.z,e.transform,y,e.pixelPosMatrix)))}return F}loadMatchingFeature(e,o,l,d,m,y,w,b,k,A,z){const L=this.bucketLayerIDs[o];if(y&&!function(H,ae){for(let fe=0;fe<H.length;fe++)if(ae.indexOf(H[fe])>=0)return!0;return!1}(y,L))return;const B=this.sourceLayerCoder.decode(l),F=this.vtLayers[B].feature(d);if(m.needGeometry){const H=ia(F,!0);if(!m.filter(new en(this.tileID.overscaledZ),H,this.tileID.canonical))return}else if(!m.filter(new en(this.tileID.overscaledZ),F))return;const X=this.getId(F,B);for(let H=0;H<L.length;H++){const ae=L[H];if(y&&y.indexOf(ae)<0)continue;const fe=b[ae];if(!fe)continue;let ie={};X&&A&&(ie=A.getState(fe.sourceLayer||"_geojsonTileLayer",X));const de=_e({},k[ae]);de.paint=Qy(de.paint,fe.paint,F,ie,w),de.layout=Qy(de.layout,fe.layout,F,ie,w);const Ee=!z||z(F,fe,ie);if(!Ee)continue;const Se=new Jy(F,this.z,this.x,this.y,X);Se.layer=de;let qe=e[ae];qe===void 0&&(qe=e[ae]=[]),qe.push({featureIndex:d,feature:Se,intersectionZ:Ee})}}lookupSymbolFeatures(e,o,l,d,m,y,w,b){const k={};this.loadVTLayers();const A=Oa(m);for(const z of e)this.loadMatchingFeature(k,l,d,z,A,y,w,b,o);return k}hasLayer(e){for(const o of this.bucketLayerIDs)for(const l of o)if(e===l)return!0;return!1}getId(e,o){let l=e.id;return this.promoteId&&(l=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]],typeof l=="boolean"&&(l=Number(l))),l}}function Qy(r,e,o,l,d){return se(r,(m,y)=>{const w=e instanceof ta?e.get(y):null;return w&&w.evaluate?w.evaluate(o,l,d):w})}function e_(r){let e=1/0,o=1/0,l=-1/0,d=-1/0;for(const m of r)e=Math.min(e,m.x),o=Math.min(o,m.y),l=Math.max(l,m.x),d=Math.max(d,m.y);return{minX:e,minY:o,maxX:l,maxY:d}}function Xw(r,e){return e-r}var tf;We("FeatureIndex",Yy,{omit:["rawTileData","sourceLayerCoder"]}),u.PerformanceMarkers=void 0,(tf=u.PerformanceMarkers||(u.PerformanceMarkers={})).create="create",tf.load="load",tf.fullLoad="fullLoad";let Ch=null,Tu=[];const nf=1e3/30,Kw={mark(r){performance.mark(r)},frame(r){const e=r;Ch!=null&&Tu.push(e-Ch),Ch=e},clearMetrics(){Ch=null,Tu=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const r in u.PerformanceMarkers)performance.clearMarks(u.PerformanceMarkers[r])},getPerformanceMetrics(){performance.measure("loadTime",u.PerformanceMarkers.create,u.PerformanceMarkers.load),performance.measure("fullLoadTime",u.PerformanceMarkers.create,u.PerformanceMarkers.fullLoad);const r=performance.getEntriesByName("loadTime")[0].duration,e=performance.getEntriesByName("fullLoadTime")[0].duration,o=Tu.length,l=1/(Tu.reduce((m,y)=>m+y,0)/o/1e3),d=Tu.filter(m=>m>nf).reduce((m,y)=>m+(y-nf)/nf,0);return{loadTime:r,fullLoadTime:e,fps:l,percentDroppedFrames:d/(o+d)*100}}};u.AJAXError=yr,u.ARRAY_TYPE=lr,u.Actor=class{constructor(r,e,o){this.target=r,this.parent=e,this.mapId=o,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},bt(["receive","process"],this),this.invoker=new Hw(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=et()?r:window}send(r,e,o,l,d=!1){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(this.callbacks[m]=o);const y=Mr(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:r,hasCallback:!!o,targetMapId:l,mustQueue:d,sourceMapId:this.mapId,data:fo(e,y)},y),{cancel:()=>{o&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(r){const e=r.data,o=e.id;if(o&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[o];const l=this.cancelCallbacks[o];delete this.cancelCallbacks[o],l&&l()}else et()||e.mustQueue?(this.tasks[o]=e,this.taskQueue.push(o),this.invoker.trigger()):this.processTask(o,e)}process(){if(!this.taskQueue.length)return;const r=this.taskQueue.shift(),e=this.tasks[r];delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(r,e)}processTask(r,e){if(e.type==="<response>"){const o=this.callbacks[r];delete this.callbacks[r],o&&(e.error?o(Zi(e.error)):o(null,Zi(e.data)))}else{let o=!1;const l=Mr(this.globalScope)?void 0:[],d=e.hasCallback?(w,b)=>{o=!0,delete this.cancelCallbacks[r],this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:w?fo(w):null,data:fo(b,l)},l)}:w=>{o=!0};let m=null;const y=Zi(e.data);if(this.parent[e.type])m=this.parent[e.type](e.sourceMapId,y,d);else if(this.parent.getWorkerSource){const w=e.type.split(".");m=this.parent.getWorkerSource(e.sourceMapId,w[0],y.source)[w[1]](y,d)}else d(new Error(`Could not find function ${e.type}`));!o&&m&&m.cancel&&(this.cancelCallbacks[r]=m.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},u.AlphaImage=mu,u.CanonicalTileID=ef,u.CollisionBoxArray=xe,u.CollisionCircleLayoutArray=class extends P{},u.Color=U,u.DEMData=Xy,u.DataConstantProperty=Ye,u.DictionaryCoder=Ky,u.EXTENT=Sn,u.ErrorEvent=Uo,u.EvaluationParameters=en,u.Event=bi,u.Evented=Si,u.FeatureIndex=Yy,u.FillBucket=Fp,u.FillExtrusionBucket=Np,u.GeoJSONFeature=Jy,u.ImageAtlas=by,u.ImagePosition=$p,u.LineBucket=Up,u.LineStripIndexArray=class extends W{},u.LngLat=un,u.LngLatBounds=sa,u.MercatorCoordinate=kh,u.ONE_EM=Bn,u.OverscaledTileID=Kr,u.PerformanceUtils=Kw,u.PosArray=rt,u.Properties=Rn,u.QuadTriangleArray=class extends R{},u.RGBAImage=Xr,u.RasterBoundsArray=class extends h{},u.RequestPerformance=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},u.ResourceType=vi,u.SegmentVector=vt,u.SymbolBucket=Qa,u.Transitionable=nh,u.TriangleIndexArray=sr,u.Uniform1f=_o,u.Uniform1i=class extends yo{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},u.Uniform2f=class extends yo{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},u.Uniform3f=class extends yo{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},u.Uniform4f=Ga,u.UniformColor=Og,u.UniformMatrix4f=class extends yo{constructor(r,e){super(r,e),this.current=y1}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},u.UnwrappedTileID=Hy,u.ValidationError=Fe,u.ZoomHistory=eu,u.add=function(r,e,o){return r[0]=e[0]+o[0],r[1]=e[1]+o[1],r[2]=e[2]+o[2],r},u.addDynamicAttributes=Hp,u.asyncAll=function(r,e,o){if(!r.length)return o(null,[]);let l=r.length;const d=new Array(r.length);let m=null;r.forEach((y,w)=>{e(y,(b,k)=>{b&&(m=b),d[w]=k,--l==0&&o(m,d)})})},u.bezier=ue,u.bindAll=bt,u.cacheEntryPossiblyAdded=function(r){rr++,rr>qr&&(r.getActor().send("enforceCacheSizeLimit",Kt),rr=0)},u.clamp=G,u.clearTileCache=function(r){const e=caches.delete(lt);r&&e.catch(r).then(()=>r())},u.clipLine=Ly,u.clone=function(r){var e=new lr(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},u.clone$1=le,u.clone$2=function(r){var e=new lr(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e},u.collisionCircleLayout=fw,u.config=Ze,u.copy=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},u.create=function(){var r=new lr(16);return lr!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},u.create$1=Zg,u.createExpression=Vs,u.createFilter=Oa,u.createLayout=yn,u.createStyleLayer=function(r){return r.type==="custom"?new Zw(r):new Ww[r.type](r)},u.cross=function(r,e,o){var l=e[0],d=e[1],m=e[2],y=o[0],w=o[1],b=o[2];return r[0]=d*b-m*w,r[1]=m*y-l*b,r[2]=l*w-d*y,r},u.dot=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]},u.dot$1=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]},u.ease=oe,u.emitValidationErrors=Ua,u.enforceCacheSizeLimit=function(r){nr(),ct&&ct.then(e=>{e.keys().then(o=>{for(let l=0;l<o.length-r;l++)e.delete(o[l])})})},u.equals=function(r,e){var o=r[0],l=r[1],d=r[2],m=r[3],y=r[4],w=r[5],b=r[6],k=r[7],A=r[8],z=r[9],L=r[10],B=r[11],F=r[12],X=r[13],H=r[14],ae=r[15],fe=e[0],ie=e[1],de=e[2],Ee=e[3],Se=e[4],qe=e[5],Xe=e[6],Ue=e[7],Re=e[8],Me=e[9],Ve=e[10],Oe=e[11],Ae=e[12],it=e[13],tt=e[14],xt=e[15];return Math.abs(o-fe)<=ar*Math.max(1,Math.abs(o),Math.abs(fe))&&Math.abs(l-ie)<=ar*Math.max(1,Math.abs(l),Math.abs(ie))&&Math.abs(d-de)<=ar*Math.max(1,Math.abs(d),Math.abs(de))&&Math.abs(m-Ee)<=ar*Math.max(1,Math.abs(m),Math.abs(Ee))&&Math.abs(y-Se)<=ar*Math.max(1,Math.abs(y),Math.abs(Se))&&Math.abs(w-qe)<=ar*Math.max(1,Math.abs(w),Math.abs(qe))&&Math.abs(b-Xe)<=ar*Math.max(1,Math.abs(b),Math.abs(Xe))&&Math.abs(k-Ue)<=ar*Math.max(1,Math.abs(k),Math.abs(Ue))&&Math.abs(A-Re)<=ar*Math.max(1,Math.abs(A),Math.abs(Re))&&Math.abs(z-Me)<=ar*Math.max(1,Math.abs(z),Math.abs(Me))&&Math.abs(L-Ve)<=ar*Math.max(1,Math.abs(L),Math.abs(Ve))&&Math.abs(B-Oe)<=ar*Math.max(1,Math.abs(B),Math.abs(Oe))&&Math.abs(F-Ae)<=ar*Math.max(1,Math.abs(F),Math.abs(Ae))&&Math.abs(X-it)<=ar*Math.max(1,Math.abs(X),Math.abs(it))&&Math.abs(H-tt)<=ar*Math.max(1,Math.abs(H),Math.abs(tt))&&Math.abs(ae-xt)<=ar*Math.max(1,Math.abs(ae),Math.abs(xt))},u.evaluateSizeForFeature=function(r,{uSize:e,uSizeT:o},{lowerSize:l,upperSize:d}){return r.kind==="source"?l/wo:r.kind==="composite"?Yt(l/wo,d/wo,o):e},u.evaluateSizeForZoom=function(r,e){let o=0,l=0;if(r.kind==="constant")l=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:d,minZoom:m,maxZoom:y}=r,w=d?G(vr.interpolationFactor(d,e,m,y),0,1):0;r.kind==="camera"?l=Yt(r.minSize,r.maxSize,w):o=w}return{uSizeT:o,uSize:l}},u.evaluateVariableOffset=Fy,u.evented=au,u.exported=oi,u.exported$1=Un,u.extend=_e,u.filterObject=Q,u.fromRotation=function(r,e){var o=Math.sin(e),l=Math.cos(e);return r[0]=l,r[1]=o,r[2]=0,r[3]=-o,r[4]=l,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},u.fromScaling=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},u.getAnchorAlignment=qp,u.getAnchorJustification=Wp,u.getArrayBuffer=No,u.getImage=ji,u.getJSON=function(r,e){return Oo(_e(r,{type:"json"}),e)},u.getOverlapMode=Yp,u.getRTLTextPluginStatus=Qs,u.getReferrer=Ps,u.getVideo=function(r,e){const o=window.document.createElement("video");o.muted=!0,o.onloadstart=function(){e(null,o)};for(let l=0;l<r.length;l++){const d=window.document.createElement("source");zs(r[l])||(o.crossOrigin="Anonymous"),d.src=r[l],o.appendChild(d)}return{cancel:()=>{}}},u.identity=Ip,u.invert=function(r,e){var o=e[0],l=e[1],d=e[2],m=e[3],y=e[4],w=e[5],b=e[6],k=e[7],A=e[8],z=e[9],L=e[10],B=e[11],F=e[12],X=e[13],H=e[14],ae=e[15],fe=o*w-l*y,ie=o*b-d*y,de=o*k-m*y,Ee=l*b-d*w,Se=l*k-m*w,qe=d*k-m*b,Xe=A*X-z*F,Ue=A*H-L*F,Re=A*ae-B*F,Me=z*H-L*X,Ve=z*ae-B*X,Oe=L*ae-B*H,Ae=fe*Oe-ie*Ve+de*Me+Ee*Re-Se*Ue+qe*Xe;return Ae?(r[0]=(w*Oe-b*Ve+k*Me)*(Ae=1/Ae),r[1]=(d*Ve-l*Oe-m*Me)*Ae,r[2]=(X*qe-H*Se+ae*Ee)*Ae,r[3]=(L*Se-z*qe-B*Ee)*Ae,r[4]=(b*Re-y*Oe-k*Ue)*Ae,r[5]=(o*Oe-d*Re+m*Ue)*Ae,r[6]=(H*de-F*qe-ae*ie)*Ae,r[7]=(A*qe-L*de+B*ie)*Ae,r[8]=(y*Ve-w*Re+k*Xe)*Ae,r[9]=(l*Re-o*Ve-m*Xe)*Ae,r[10]=(F*Se-X*de+ae*fe)*Ae,r[11]=(z*de-A*Se-B*fe)*Ae,r[12]=(w*Ue-y*Me-b*Xe)*Ae,r[13]=(o*Me-l*Ue+d*Xe)*Ae,r[14]=(X*ie-F*Ee-H*fe)*Ae,r[15]=(A*Ee-z*ie+L*fe)*Ae,r):null},u.isImageBitmap=Gr,u.isSafari=Mr,u.isWorker=et,u.keysDifference=function(r,e){const o=[];for(const l in r)l in e||o.push(l);return o},u.lazyLoadRTLTextPlugin=function(){Lr.isLoading()||Lr.isLoaded()||Qs()!=="deferred"||th()},u.makeRequest=Oo,u.mapObject=se,u.mercatorXfromLng=Gy,u.mercatorYfromLat=qy,u.mercatorZfromAltitude=Zy,u.mul=T1,u.mul$1=function(r,e,o){return r[0]=e[0]*o[0],r[1]=e[1]*o[1],r[2]=e[2]*o[2],r[3]=e[3]*o[3],r},u.multiply=Wg,u.nextPowerOfTwo=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},u.normalize=function(r,e){var o=e[0],l=e[1],d=e[2],m=o*o+l*l+d*d;return m>0&&(m=1/Math.sqrt(m)),r[0]=e[0]*m,r[1]=e[1]*m,r[2]=e[2]*m,r},u.number=Yt,u.ortho=function(r,e,o,l,d,m,y){var w=1/(e-o),b=1/(l-d),k=1/(m-y);return r[0]=-2*w,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*b,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*k,r[11]=0,r[12]=(e+o)*w,r[13]=(d+l)*b,r[14]=(y+m)*k,r[15]=1,r},u.parseCacheControl=Zt,u.parseGlyphPbf=function(r){return new Vp(r).readFields(Tw,[])},u.pbf=Vp,u.performSymbolLayout=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=Sn/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const e=r.bucket.layers[0].layout,o=r.bucket.layers[0]._unevaluatedLayout._values,l={layoutIconSize:o["icon-size"].possiblyEvaluate(new en(r.bucket.zoom+1),r.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new en(r.bucket.zoom+1),r.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new en(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:b,maxZoom:k}=r.bucket.textSizeData;l.compositeTextSizes=[o["text-size"].possiblyEvaluate(new en(b),r.canonical),o["text-size"].possiblyEvaluate(new en(k),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:b,maxZoom:k}=r.bucket.iconSizeData;l.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new en(b),r.canonical),o["icon-size"].possiblyEvaluate(new en(k),r.canonical)]}const d=e.get("text-line-height")*Bn,m=e.get("text-rotation-alignment")!=="viewport"&&e.get("symbol-placement")!=="point",y=e.get("text-keep-upright"),w=e.get("text-size");for(const b of r.bucket.features){const k=e.get("text-font").evaluate(b,{},r.canonical).join(","),A=w.evaluate(b,{},r.canonical),z=l.layoutTextSize.evaluate(b,{},r.canonical),L=l.layoutIconSize.evaluate(b,{},r.canonical),B={horizontal:{},vertical:void 0},F=b.text;let X,H=[0,0];if(F){const ie=F.toString(),de=e.get("text-letter-spacing").evaluate(b,{},r.canonical)*Bn,Ee=vp(ie)?de:0,Se=e.get("text-anchor").evaluate(b,{},r.canonical),qe=e.get("text-variable-anchor");if(!qe){const Ve=e.get("text-radial-offset").evaluate(b,{},r.canonical);H=Ve?Fy(Se,[Ve*Bn,Zp]):e.get("text-offset").evaluate(b,{},r.canonical).map(Oe=>Oe*Bn)}let Xe=m?"center":e.get("text-justify").evaluate(b,{},r.canonical);const Ue=e.get("symbol-placement"),Re=Ue==="point"?e.get("text-max-width").evaluate(b,{},r.canonical)*Bn:0,Me=()=>{r.bucket.allowVerticalPlacement&&Va(ie)&&(B.vertical=_h(F,r.glyphMap,r.glyphPositions,r.imagePositions,k,Re,d,Se,"left",Ee,H,u.WritingMode.vertical,!0,Ue,z,A))};if(!m&&qe){const Ve=Xe==="auto"?qe.map(Ae=>Wp(Ae)):[Xe];let Oe=!1;for(let Ae=0;Ae<Ve.length;Ae++){const it=Ve[Ae];if(!B.horizontal[it])if(Oe)B.horizontal[it]=B.horizontal[0];else{const tt=_h(F,r.glyphMap,r.glyphPositions,r.imagePositions,k,Re,d,"center",it,Ee,H,u.WritingMode.horizontal,!1,Ue,z,A);tt&&(B.horizontal[it]=tt,Oe=tt.positionedLines.length===1)}}Me()}else{Xe==="auto"&&(Xe=Wp(Se));const Ve=_h(F,r.glyphMap,r.glyphPositions,r.imagePositions,k,Re,d,Se,Xe,Ee,H,u.WritingMode.horizontal,!1,Ue,z,A);Ve&&(B.horizontal[Xe]=Ve),Me(),Va(ie)&&m&&y&&(B.vertical=_h(F,r.glyphMap,r.glyphPositions,r.imagePositions,k,Re,d,Se,Xe,Ee,H,u.WritingMode.vertical,!1,Ue,z,A))}}let ae=!1;if(b.icon&&b.icon.name){const ie=r.imageMap[b.icon.name];ie&&(X=zw(r.imagePositions[b.icon.name],e.get("icon-offset").evaluate(b,{},r.canonical),e.get("icon-anchor").evaluate(b,{},r.canonical)),ae=!!ie.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=ae:r.bucket.sdfIcons!==ae&&Be("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ie.pixelRatio!==r.bucket.pixelRatio||e.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const fe=Ny(B.horizontal)||B.vertical;r.bucket.iconsInText=!!fe&&fe.iconsInText,(fe||X)&&Ow(r.bucket,b,B,X,r.imageMap,l,z,L,H,ae,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},u.perspective=function(r,e,o,l,d){var m,y=1/Math.tan(e/2);return r[0]=y/o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=y,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,d!=null&&d!==1/0?(r[10]=(d+l)*(m=1/(l-d)),r[14]=2*d*l*m):(r[10]=-1,r[14]=-2*l),r},u.pick=function(r,e){const o={};for(let l=0;l<e.length;l++){const d=e[l];d in r&&(o[d]=r[d])}return o},u.plugin=Lr,u.pointGeometry=at,u.polygonIntersectsPolygon=jg,u.potpack=wy,u.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],u.register=We,u.registerForPluginStateChange=function(r){return r({pluginStatus:or,pluginURL:Wi}),au.on("pluginStateChange",r),r},u.renderColorRamp=ey,u.rotateX=function(r,e,o){var l=Math.sin(o),d=Math.cos(o),m=e[4],y=e[5],w=e[6],b=e[7],k=e[8],A=e[9],z=e[10],L=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=m*d+k*l,r[5]=y*d+A*l,r[6]=w*d+z*l,r[7]=b*d+L*l,r[8]=k*d-m*l,r[9]=A*d-y*l,r[10]=z*d-w*l,r[11]=L*d-b*l,r},u.rotateZ=function(r,e,o){var l=Math.sin(o),d=Math.cos(o),m=e[0],y=e[1],w=e[2],b=e[3],k=e[4],A=e[5],z=e[6],L=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=m*d+k*l,r[1]=y*d+A*l,r[2]=w*d+z*l,r[3]=b*d+L*l,r[4]=k*d-m*l,r[5]=A*d-y*l,r[6]=z*d-w*l,r[7]=L*d-b*l,r},u.scale=function(r,e,o){var l=o[0],d=o[1],m=o[2];return r[0]=e[0]*l,r[1]=e[1]*l,r[2]=e[2]*l,r[3]=e[3]*l,r[4]=e[4]*d,r[5]=e[5]*d,r[6]=e[6]*d,r[7]=e[7]*d,r[8]=e[8]*m,r[9]=e[9]*m,r[10]=e[10]*m,r[11]=e[11]*m,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},u.scale$1=function(r,e,o){return r[0]=e[0]*o,r[1]=e[1]*o,r[2]=e[2]*o,r},u.setCacheLimits=function(r,e){Kt=r,qr=e},u.setRTLTextPlugin=function(r,e,o=!1){if(or===ru||or===iu||or===ou)throw new Error("setRTLTextPlugin cannot be called multiple times.");Wi=oi.resolveURL(r),or=ru,su=e,es(),o||th()},u.spec=we,u.sphericalToCartesian=function([r,e,o]){return e+=90,e*=Math.PI/180,o*=Math.PI/180,{x:r*Math.cos(e)*Math.sin(o),y:r*Math.sin(e)*Math.sin(o),z:r*Math.cos(o)}},u.sqrLen=function(r){var e=r[0],o=r[1];return e*e+o*o},u.sub=function(r,e,o){return r[0]=e[0]-o[0],r[1]=e[1]-o[1],r[2]=e[2]-o[2],r},u.toEvaluationFeature=ia,u.transformMat3=function(r,e,o){var l=e[0],d=e[1],m=e[2];return r[0]=l*o[0]+d*o[3]+m*o[6],r[1]=l*o[1]+d*o[4]+m*o[7],r[2]=l*o[2]+d*o[5]+m*o[8],r},u.transformMat4=ch,u.transformMat4$1=function(r,e,o){var l=e[0],d=e[1];return r[0]=o[0]*l+o[4]*d+o[12],r[1]=o[1]*l+o[5]*d+o[13],r},u.translate=function(r,e,o){var l,d,m,y,w,b,k,A,z,L,B,F,X=o[0],H=o[1],ae=o[2];return e===r?(r[12]=e[0]*X+e[4]*H+e[8]*ae+e[12],r[13]=e[1]*X+e[5]*H+e[9]*ae+e[13],r[14]=e[2]*X+e[6]*H+e[10]*ae+e[14],r[15]=e[3]*X+e[7]*H+e[11]*ae+e[15]):(d=e[1],m=e[2],y=e[3],w=e[4],b=e[5],k=e[6],A=e[7],z=e[8],L=e[9],B=e[10],F=e[11],r[0]=l=e[0],r[1]=d,r[2]=m,r[3]=y,r[4]=w,r[5]=b,r[6]=k,r[7]=A,r[8]=z,r[9]=L,r[10]=B,r[11]=F,r[12]=l*X+w*H+z*ae+e[12],r[13]=d*X+b*H+L*ae+e[13],r[14]=m*X+k*H+B*ae+e[14],r[15]=y*X+A*H+F*ae+e[15]),r},u.triggerPluginCompletionEvent=eh,u.unicodeBlockLookup=Ne,u.uniqueId=function(){return be++},u.validateCustomStyleLayer=function(r){const e=[],o=r.id;return o===void 0&&e.push({message:`layers.${o}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${o}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),e},u.validateLight=Ql,u.validateStyle=Js,u.vectorTile=is,u.warnOnce=Be,u.wrap=Te}),x(["./shared"],function(u){function N(V){const I=typeof V;if(I==="number"||I==="boolean"||I==="string"||V==null)return JSON.stringify(V);if(Array.isArray(V)){let U="[";for(const K of V)U+=`${N(K)},`;return`${U}]`}const M=Object.keys(V).sort();let O="{";for(let U=0;U<M.length;U++)O+=`${JSON.stringify(M[U])}:${N(V[M[U]])},`;return`${O}}`}function Z(V){let I="";for(const M of u.refProperties)I+=`/${N(V[M])}`;return I}class ue{constructor(I){this.keyCache={},I&&this.replace(I)}replace(I){this._layerConfigs={},this._layers={},this.update(I,[])}update(I,M){for(const U of I){this._layerConfigs[U.id]=U;const K=this._layers[U.id]=u.createStyleLayer(U);K._featureFilter=u.createFilter(K.filter),this.keyCache[U.id]&&delete this.keyCache[U.id]}for(const U of M)delete this.keyCache[U],delete this._layerConfigs[U],delete this._layers[U];this.familiesBySource={};const O=function(U,K){const te={};for(let J=0;J<U.length;J++){const ne=K&&K[U[J].id]||Z(U[J]);K&&(K[U[J].id]=ne);let ge=te[ne];ge||(ge=te[ne]=[]),ge.push(U[J])}const Y=[];for(const J in te)Y.push(te[J]);return Y}(Object.values(this._layerConfigs),this.keyCache);for(const U of O){const K=U.map(Ce=>this._layers[Ce.id]),te=K[0];if(te.visibility==="none")continue;const Y=te.source||"";let J=this.familiesBySource[Y];J||(J=this.familiesBySource[Y]={});const ne=te.sourceLayer||"_geojsonTileLayer";let ge=J[ne];ge||(ge=J[ne]=[]),ge.push(K)}}}class oe{constructor(I){const M={},O=[];for(const Y in I){const J=I[Y],ne=M[Y]={};for(const ge in J){const Ce=J[+ge];if(!Ce||Ce.bitmap.width===0||Ce.bitmap.height===0)continue;const me={x:0,y:0,w:Ce.bitmap.width+2,h:Ce.bitmap.height+2};O.push(me),ne[ge]={rect:me,metrics:Ce.metrics}}}const{w:U,h:K}=u.potpack(O),te=new u.AlphaImage({width:U||1,height:K||1});for(const Y in I){const J=I[Y];for(const ne in J){const ge=J[+ne];if(!ge||ge.bitmap.width===0||ge.bitmap.height===0)continue;const Ce=M[Y][ne].rect;u.AlphaImage.copy(ge.bitmap,te,{x:0,y:0},{x:Ce.x+1,y:Ce.y+1},ge.bitmap)}}this.image=te,this.positions=M}}u.register("GlyphAtlas",oe);class G{constructor(I){this.tileID=new u.OverscaledTileID(I.tileID.overscaledZ,I.tileID.wrap,I.tileID.canonical.z,I.tileID.canonical.x,I.tileID.canonical.y),this.uid=I.uid,this.zoom=I.zoom,this.pixelRatio=I.pixelRatio,this.tileSize=I.tileSize,this.source=I.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=I.showCollisionBoxes,this.collectResourceTiming=!!I.collectResourceTiming,this.returnDependencies=!!I.returnDependencies,this.promoteId=I.promoteId}parse(I,M,O,U,K){this.status="parsing",this.data=I,this.collisionBoxArray=new u.CollisionBoxArray;const te=new u.DictionaryCoder(Object.keys(I.layers).sort()),Y=new u.FeatureIndex(this.tileID,this.promoteId);Y.bucketLayerIDs=[];const J={},ne={featureIndex:Y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:O},ge=M.familiesBySource[this.source];for(const ht in ge){const yt=I.layers[ht];if(!yt)continue;yt.version===1&&u.warnOnce(`Vector tile source "${this.source}" layer "${ht}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const It=te.encode(ht),Vt=[];for(let Cn=0;Cn<yt.length;Cn++){const Jt=yt.feature(Cn),Vn=Y.getId(Jt,ht);Vt.push({feature:Jt,id:Vn,index:Cn,sourceLayerIndex:It})}for(const Cn of ge[ht]){const Jt=Cn[0];Jt.source!==this.source&&u.warnOnce(`layer.source = ${Jt.source} does not equal this.source = ${this.source}`),Jt.minzoom&&this.zoom<Math.floor(Jt.minzoom)||Jt.maxzoom&&this.zoom>=Jt.maxzoom||Jt.visibility!=="none"&&(Te(Cn,this.zoom,O),(J[Jt.id]=Jt.createBucket({index:Y.bucketLayerIDs.length,layers:Cn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:It,sourceID:this.source})).populate(Vt,ne,this.tileID.canonical),Y.bucketLayerIDs.push(Cn.map(Vn=>Vn.id)))}}let Ce,me,He,Je;const je=u.mapObject(ne.glyphDependencies,ht=>Object.keys(ht).map(Number));Object.keys(je).length?U.send("getGlyphs",{uid:this.uid,stacks:je},(ht,yt)=>{Ce||(Ce=ht,me=yt,Ct.call(this))}):me={};const ot=Object.keys(ne.iconDependencies);ot.length?U.send("getImages",{icons:ot,source:this.source,tileID:this.tileID,type:"icons"},(ht,yt)=>{Ce||(Ce=ht,He=yt,Ct.call(this))}):He={};const ut=Object.keys(ne.patternDependencies);function Ct(){if(Ce)return K(Ce);if(me&&He&&Je){const ht=new oe(me),yt=new u.ImageAtlas(He,Je);for(const It in J){const Vt=J[It];Vt instanceof u.SymbolBucket?(Te(Vt.layers,this.zoom,O),u.performSymbolLayout({bucket:Vt,glyphMap:me,glyphPositions:ht.positions,imageMap:He,imagePositions:yt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Vt.hasPattern&&(Vt instanceof u.LineBucket||Vt instanceof u.FillBucket||Vt instanceof u.FillExtrusionBucket)&&(Te(Vt.layers,this.zoom,O),Vt.addFeatures(ne,this.tileID.canonical,yt.patternPositions))}this.status="done",K(null,{buckets:Object.values(J).filter(It=>!It.isEmpty()),featureIndex:Y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ht.image,imageAtlas:yt,glyphMap:this.returnDependencies?me:null,iconMap:this.returnDependencies?He:null,glyphPositions:this.returnDependencies?ht.positions:null})}}ut.length?U.send("getImages",{icons:ut,source:this.source,tileID:this.tileID,type:"patterns"},(ht,yt)=>{Ce||(Ce=ht,Je=yt,Ct.call(this))}):Je={},Ct.call(this)}}function Te(V,I,M){const O=new u.EvaluationParameters(I);for(const U of V)U.recalculate(O,M)}function _e(V,I){const M=u.getArrayBuffer(V.request,(O,U,K,te)=>{O?I(O):U&&I(null,{vectorTile:new u.vectorTile.VectorTile(new u.pbf(U)),rawData:U,cacheControl:K,expires:te})});return()=>{M.cancel(),I()}}class be{constructor(I,M,O,U){this.actor=I,this.layerIndex=M,this.availableImages=O,this.loadVectorData=U||_e,this.loading={},this.loaded={}}loadTile(I,M){const O=I.uid;this.loading||(this.loading={});const U=!!(I&&I.request&&I.request.collectResourceTiming)&&new u.RequestPerformance(I.request),K=this.loading[O]=new G(I);K.abort=this.loadVectorData(I,(te,Y)=>{if(delete this.loading[O],te||!Y)return K.status="done",this.loaded[O]=K,M(te);const J=Y.rawData,ne={};Y.expires&&(ne.expires=Y.expires),Y.cacheControl&&(ne.cacheControl=Y.cacheControl);const ge={};if(U){const Ce=U.finish();Ce&&(ge.resourceTiming=JSON.parse(JSON.stringify(Ce)))}K.vectorTile=Y.vectorTile,K.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ce,me)=>{if(Ce||!me)return M(Ce);M(null,u.extend({rawTileData:J.slice(0)},me,ne,ge))}),this.loaded=this.loaded||{},this.loaded[O]=K})}reloadTile(I,M){const O=this.loaded,U=I.uid,K=this;if(O&&O[U]){const te=O[U];te.showCollisionBoxes=I.showCollisionBoxes;const Y=(J,ne)=>{const ge=te.reloadCallback;ge&&(delete te.reloadCallback,te.parse(te.vectorTile,K.layerIndex,this.availableImages,K.actor,ge)),M(J,ne)};te.status==="parsing"?te.reloadCallback=Y:te.status==="done"&&(te.vectorTile?te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,Y):Y())}}abortTile(I,M){const O=this.loading,U=I.uid;O&&O[U]&&O[U].abort&&(O[U].abort(),delete O[U]),M()}removeTile(I,M){const O=this.loaded,U=I.uid;O&&O[U]&&delete O[U],M()}}class bt{constructor(){this.loaded={}}loadTile(I,M){const{uid:O,encoding:U,rawImageData:K}=I,te=u.isImageBitmap(K)?this.getImageData(K):K,Y=new u.DEMData(O,te,U);this.loaded=this.loaded||{},this.loaded[O]=Y,M(null,Y)}getImageData(I){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(I.width,I.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=I.width,this.offscreenCanvas.height=I.height,this.offscreenCanvasContext.drawImage(I,0,0,I.width,I.height);const M=this.offscreenCanvasContext.getImageData(-1,-1,I.width+2,I.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new u.RGBAImage({width:M.width,height:M.height},M.data)}removeTile(I){const M=this.loaded,O=I.uid;M&&M[O]&&delete M[O]}}var se=function V(I,M){var O,U=I&&I.type;if(U==="FeatureCollection")for(O=0;O<I.features.length;O++)V(I.features[O],M);else if(U==="GeometryCollection")for(O=0;O<I.geometries.length;O++)V(I.geometries[O],M);else if(U==="Feature")V(I.geometry,M);else if(U==="Polygon")Q(I.coordinates,M);else if(U==="MultiPolygon")for(O=0;O<I.coordinates.length;O++)Q(I.coordinates[O],M);return I};function Q(V,I){if(V.length!==0){le(V[0],I);for(var M=1;M<V.length;M++)le(V[M],!I)}}function le(V,I){for(var M=0,O=0,U=0,K=V.length,te=K-1;U<K;te=U++){var Y=(V[U][0]-V[te][0])*(V[te][1]+V[U][1]),J=M+Y;O+=Math.abs(M)>=Math.abs(Y)?M-J+Y:Y-J+M,M=J}M+O>=0!=!!I&&V.reverse()}const Pe=u.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Be{constructor(I){this._feature=I,this.extent=u.EXTENT,this.type=I.type,this.properties=I.tags,"id"in I&&!isNaN(I.id)&&(this.id=parseInt(I.id,10))}loadGeometry(){if(this._feature.type===1){const I=[];for(const M of this._feature.geometry)I.push([new u.pointGeometry(M[0],M[1])]);return I}{const I=[];for(const M of this._feature.geometry){const O=[];for(const U of M)O.push(new u.pointGeometry(U[0],U[1]));I.push(O)}return I}}toGeoJSON(I,M,O){return Pe.call(this,I,M,O)}}class Ke{constructor(I){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.EXTENT,this.length=I.length,this._features=I}feature(I){return new Be(this._features[I])}}var Qe={exports:{}},et=u.pointGeometry,Zt=u.vectorTile.VectorTileFeature,mt=wn;function wn(V,I){this.options=I||{},this.features=V,this.length=V.length}function Hn(V,I){this.id=typeof V.id=="number"?V.id:void 0,this.type=V.type,this.rawGeometry=V.type===1?[V.geometry]:V.geometry,this.properties=V.tags,this.extent=I||4096}wn.prototype.feature=function(V){return new Hn(this.features[V],this.options.extent)},Hn.prototype.loadGeometry=function(){var V=this.rawGeometry;this.geometry=[];for(var I=0;I<V.length;I++){for(var M=V[I],O=[],U=0;U<M.length;U++)O.push(new et(M[U][0],M[U][1]));this.geometry.push(O)}return this.geometry},Hn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var V=this.geometry,I=1/0,M=-1/0,O=1/0,U=-1/0,K=0;K<V.length;K++)for(var te=V[K],Y=0;Y<te.length;Y++){var J=te[Y];I=Math.min(I,J.x),M=Math.max(M,J.x),O=Math.min(O,J.y),U=Math.max(U,J.y)}return[I,O,M,U]},Hn.prototype.toGeoJSON=Zt.prototype.toGeoJSON;var Mr=u.pbf,Gr=mt;function oi(V){var I=new Mr;return function(M,O){for(var U in M.layers)O.writeMessage(3,at,M.layers[U])}(V,I),I.finish()}function at(V,I){var M;I.writeVarintField(15,V.version||1),I.writeStringField(1,V.name||""),I.writeVarintField(5,V.extent||4096);var O={keys:[],values:[],keycache:{},valuecache:{}};for(M=0;M<V.length;M++)O.feature=V.feature(M),I.writeMessage(2,mr,O);var U=O.keys;for(M=0;M<U.length;M++)I.writeStringField(3,U[M]);var K=O.values;for(M=0;M<K.length;M++)I.writeMessage(4,Kt,K[M])}function mr(V,I){var M=V.feature;M.id!==void 0&&I.writeVarintField(1,M.id),I.writeMessage(2,Ze,V),I.writeVarintField(3,M.type),I.writeMessage(4,Ut,M)}function Ze(V,I){var M=V.feature,O=V.keys,U=V.values,K=V.keycache,te=V.valuecache;for(var Y in M.properties){var J=M.properties[Y],ne=K[Y];if(J!==null){ne===void 0&&(O.push(Y),K[Y]=ne=O.length-1),I.writeVarint(ne);var ge=typeof J;ge!=="string"&&ge!=="boolean"&&ge!=="number"&&(J=JSON.stringify(J));var Ce=ge+":"+J,me=te[Ce];me===void 0&&(U.push(J),te[Ce]=me=U.length-1),I.writeVarint(me)}}}function lt(V,I){return(I<<3)+(7&V)}function ct(V){return V<<1^V>>31}function Ut(V,I){for(var M=V.loadGeometry(),O=V.type,U=0,K=0,te=M.length,Y=0;Y<te;Y++){var J=M[Y],ne=1;O===1&&(ne=J.length),I.writeVarint(lt(1,ne));for(var ge=O===3?J.length-1:J.length,Ce=0;Ce<ge;Ce++){Ce===1&&O!==1&&I.writeVarint(lt(2,ge-1));var me=J[Ce].x-U,He=J[Ce].y-K;I.writeVarint(ct(me)),I.writeVarint(ct(He)),U+=me,K+=He}O===3&&I.writeVarint(lt(7,1))}}function Kt(V,I){var M=typeof V;M==="string"?I.writeStringField(1,V):M==="boolean"?I.writeBooleanField(7,V):M==="number"&&(V%1!=0?I.writeDoubleField(3,V):V<0?I.writeSVarintField(6,V):I.writeVarintField(5,V))}function qr(V,I,M,O,U,K){if(U-O<=M)return;const te=O+U>>1;nr(V,I,te,O,U,K%2),qr(V,I,M,O,te-1,K+1),qr(V,I,M,te+1,U,K+1)}function nr(V,I,M,O,U,K){for(;U>O;){if(U-O>600){const ne=U-O+1,ge=M-O+1,Ce=Math.log(ne),me=.5*Math.exp(2*Ce/3),He=.5*Math.sqrt(Ce*me*(ne-me)/ne)*(ge-ne/2<0?-1:1);nr(V,I,M,Math.max(O,Math.floor(M-ge*me/ne+He)),Math.min(U,Math.floor(M+(ne-ge)*me/ne+He)),K)}const te=I[2*M+K];let Y=O,J=U;for(rr(V,I,O,M),I[2*U+K]>te&&rr(V,I,O,U);Y<J;){for(rr(V,I,Y,J),Y++,J--;I[2*Y+K]<te;)Y++;for(;I[2*J+K]>te;)J--}I[2*O+K]===te?rr(V,I,O,J):(J++,rr(V,I,J,U)),J<=M&&(O=J+1),M<=J&&(U=J-1)}}function rr(V,I,M,O){Un(V,M,O),Un(I,2*M,2*O),Un(I,2*M+1,2*O+1)}function Un(V,I,M){const O=V[I];V[I]=V[M],V[M]=O}function gr(V,I,M,O){const U=V-M,K=I-O;return U*U+K*K}Qe.exports=oi,Qe.exports.fromVectorTileJs=oi,Qe.exports.fromGeojsonVt=function(V,I){I=I||{};var M={};for(var O in V)M[O]=new Gr(V[O].features,I),M[O].name=O,M[O].version=I.version,M[O].extent=I.extent;return oi({layers:M})},Qe.exports.GeoJSONWrapper=Gr;const Ni=V=>V[0],ir=V=>V[1];class Fo{constructor(I,M=Ni,O=ir,U=64,K=Float64Array){this.nodeSize=U,this.points=I;const te=I.length<65536?Uint16Array:Uint32Array,Y=this.ids=new te(I.length),J=this.coords=new K(2*I.length);for(let ne=0;ne<I.length;ne++)Y[ne]=ne,J[2*ne]=M(I[ne]),J[2*ne+1]=O(I[ne]);qr(Y,J,U,0,Y.length-1,0)}range(I,M,O,U){return function(K,te,Y,J,ne,ge,Ce){const me=[0,K.length-1,0],He=[];let Je,je;for(;me.length;){const ot=me.pop(),ut=me.pop(),Ct=me.pop();if(ut-Ct<=Ce){for(let It=Ct;It<=ut;It++)Je=te[2*It],je=te[2*It+1],Je>=Y&&Je<=ne&&je>=J&&je<=ge&&He.push(K[It]);continue}const ht=Math.floor((Ct+ut)/2);Je=te[2*ht],je=te[2*ht+1],Je>=Y&&Je<=ne&&je>=J&&je<=ge&&He.push(K[ht]);const yt=(ot+1)%2;(ot===0?Y<=Je:J<=je)&&(me.push(Ct),me.push(ht-1),me.push(yt)),(ot===0?ne>=Je:ge>=je)&&(me.push(ht+1),me.push(ut),me.push(yt))}return He}(this.ids,this.coords,I,M,O,U,this.nodeSize)}within(I,M,O){return function(U,K,te,Y,J,ne){const ge=[0,U.length-1,0],Ce=[],me=J*J;for(;ge.length;){const He=ge.pop(),Je=ge.pop(),je=ge.pop();if(Je-je<=ne){for(let yt=je;yt<=Je;yt++)gr(K[2*yt],K[2*yt+1],te,Y)<=me&&Ce.push(U[yt]);continue}const ot=Math.floor((je+Je)/2),ut=K[2*ot],Ct=K[2*ot+1];gr(ut,Ct,te,Y)<=me&&Ce.push(U[ot]);const ht=(He+1)%2;(He===0?te-J<=ut:Y-J<=Ct)&&(ge.push(je),ge.push(ot-1),ge.push(ht)),(He===0?te+J>=ut:Y+J>=Ct)&&(ge.push(ot+1),ge.push(Je),ge.push(ht))}return Ce}(this.ids,this.coords,I,M,O,this.nodeSize)}}const As={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:V=>V},vi=Math.fround||(yr=new Float32Array(1),V=>(yr[0]=+V,yr[0]));var yr;class Ps{constructor(I){this.options=ji(Object.create(As),I),this.trees=new Array(this.options.maxZoom+1)}load(I){const{log:M,minZoom:O,maxZoom:U,nodeSize:K}=this.options;M&&console.time("total time");const te=`prepare ${I.length} points`;M&&console.time(te),this.points=I;let Y=[];for(let J=0;J<I.length;J++)I[J].geometry&&Y.push(Oo(I[J],J));this.trees[U+1]=new Fo(Y,Ms,wi,K,Float32Array),M&&console.timeEnd(te);for(let J=U;J>=O;J--){const ne=+Date.now();Y=this._cluster(Y,J),this.trees[J]=new Fo(Y,Ms,wi,K,Float32Array),M&&console.log("z%d: %d clusters in %dms",J,Y.length,+Date.now()-ne)}return M&&console.timeEnd("total time"),this}getClusters(I,M){let O=((I[0]+180)%360+360)%360-180;const U=Math.max(-90,Math.min(90,I[1]));let K=I[2]===180?180:((I[2]+180)%360+360)%360-180;const te=Math.max(-90,Math.min(90,I[3]));if(I[2]-I[0]>=360)O=-180,K=180;else if(O>K){const ge=this.getClusters([O,U,180,te],M),Ce=this.getClusters([-180,U,K,te],M);return ge.concat(Ce)}const Y=this.trees[this._limitZoom(M)],J=Y.range(Tt(O),si(te),Tt(K),si(U)),ne=[];for(const ge of J){const Ce=Y.points[ge];ne.push(Ce.numPoints?No(Ce):this.points[Ce.index])}return ne}getChildren(I){const M=this._getOriginId(I),O=this._getOriginZoom(I),U="No cluster with the specified id.",K=this.trees[O];if(!K)throw new Error(U);const te=K.points[M];if(!te)throw new Error(U);const Y=this.options.radius/(this.options.extent*Math.pow(2,O-1)),J=K.within(te.x,te.y,Y),ne=[];for(const ge of J){const Ce=K.points[ge];Ce.parentId===I&&ne.push(Ce.numPoints?No(Ce):this.points[Ce.index])}if(ne.length===0)throw new Error(U);return ne}getLeaves(I,M,O){const U=[];return this._appendLeaves(U,I,M=M||10,O=O||0,0),U}getTile(I,M,O){const U=this.trees[this._limitZoom(I)],K=Math.pow(2,I),{extent:te,radius:Y}=this.options,J=Y/te,ne=(O-J)/K,ge=(O+1+J)/K,Ce={features:[]};return this._addTileFeatures(U.range((M-J)/K,ne,(M+1+J)/K,ge),U.points,M,O,K,Ce),M===0&&this._addTileFeatures(U.range(1-J/K,ne,1,ge),U.points,K,O,K,Ce),M===K-1&&this._addTileFeatures(U.range(0,ne,J/K,ge),U.points,-1,O,K,Ce),Ce.features.length?Ce:null}getClusterExpansionZoom(I){let M=this._getOriginZoom(I)-1;for(;M<=this.options.maxZoom;){const O=this.getChildren(I);if(M++,O.length!==1)break;I=O[0].properties.cluster_id}return M}_appendLeaves(I,M,O,U,K){const te=this.getChildren(M);for(const Y of te){const J=Y.properties;if(J&&J.cluster?K+J.point_count<=U?K+=J.point_count:K=this._appendLeaves(I,J.cluster_id,O,U,K):K<U?K++:I.push(Y),I.length===O)break}return K}_addTileFeatures(I,M,O,U,K,te){for(const Y of I){const J=M[Y],ne=J.numPoints;let ge,Ce,me;if(ne)ge=zs(J),Ce=J.x,me=J.y;else{const je=this.points[J.index];ge=je.properties,Ce=Tt(je.geometry.coordinates[0]),me=si(je.geometry.coordinates[1])}const He={type:1,geometry:[[Math.round(this.options.extent*(Ce*K-O)),Math.round(this.options.extent*(me*K-U))]],tags:ge};let Je;ne?Je=J.id:this.options.generateId?Je=J.index:this.points[J.index].id&&(Je=this.points[J.index].id),Je!==void 0&&(He.id=Je),te.features.push(He)}}_limitZoom(I){return Math.max(this.options.minZoom,Math.min(Math.floor(+I),this.options.maxZoom+1))}_cluster(I,M){const O=[],{radius:U,extent:K,reduce:te,minPoints:Y}=this.options,J=U/(K*Math.pow(2,M));for(let ne=0;ne<I.length;ne++){const ge=I[ne];if(ge.zoom<=M)continue;ge.zoom=M;const Ce=this.trees[M+1],me=Ce.within(ge.x,ge.y,J),He=ge.numPoints||1;let Je=He;for(const je of me){const ot=Ce.points[je];ot.zoom>M&&(Je+=ot.numPoints||1)}if(Je>He&&Je>=Y){let je=ge.x*He,ot=ge.y*He,ut=te&&He>1?this._map(ge,!0):null;const Ct=(ne<<5)+(M+1)+this.points.length;for(const ht of me){const yt=Ce.points[ht];if(yt.zoom<=M)continue;yt.zoom=M;const It=yt.numPoints||1;je+=yt.x*It,ot+=yt.y*It,yt.parentId=Ct,te&&(ut||(ut=this._map(ge,!0)),te(ut,this._map(yt)))}ge.parentId=Ct,O.push(Ui(je/Je,ot/Je,Ct,Je,ut))}else if(O.push(ge),Je>1)for(const je of me){const ot=Ce.points[je];ot.zoom<=M||(ot.zoom=M,O.push(ot))}}return O}_getOriginId(I){return I-this.points.length>>5}_getOriginZoom(I){return(I-this.points.length)%32}_map(I,M){if(I.numPoints)return M?ji({},I.properties):I.properties;const O=this.points[I.index].properties,U=this.options.map(O);return M&&U===O?ji({},U):U}}function Ui(V,I,M,O,U){return{x:vi(V),y:vi(I),zoom:1/0,id:M,parentId:-1,numPoints:O,properties:U}}function Oo(V,I){const[M,O]=V.geometry.coordinates;return{x:vi(Tt(M)),y:vi(si(O)),zoom:1/0,index:I,parentId:-1}}function No(V){return{type:"Feature",id:V.id,properties:zs(V),geometry:{type:"Point",coordinates:[(I=V.x,360*(I-.5)),Vi(V.y)]}};var I}function zs(V){const I=V.numPoints,M=I>=1e4?`${Math.round(I/1e3)}k`:I>=1e3?Math.round(I/100)/10+"k":I;return ji(ji({},V.properties),{cluster:!0,cluster_id:V.id,point_count:I,point_count_abbreviated:M})}function Tt(V){return V/360+.5}function si(V){const I=Math.sin(V*Math.PI/180),M=.5-.25*Math.log((1+I)/(1-I))/Math.PI;return M<0?0:M>1?1:M}function Vi(V){const I=(180-360*V)*Math.PI/180;return 360*Math.atan(Math.exp(I))/Math.PI-90}function ji(V,I){for(const M in I)V[M]=I[M];return V}function Ms(V){return V.x}function wi(V){return V.y}function bi(V,I,M,O){for(var U,K=O,te=M-I>>1,Y=M-I,J=V[I],ne=V[I+1],ge=V[M],Ce=V[M+1],me=I+3;me<M;me+=3){var He=Uo(V[me],V[me+1],J,ne,ge,Ce);if(He>K)U=me,K=He;else if(He===K){var Je=Math.abs(me-te);Je<Y&&(U=me,Y=Je)}}K>O&&(U-I>3&&bi(V,I,U,O),V[U+2]=K,M-U>3&&bi(V,U,M,O))}function Uo(V,I,M,O,U,K){var te=U-M,Y=K-O;if(te!==0||Y!==0){var J=((V-M)*te+(I-O)*Y)/(te*te+Y*Y);J>1?(M=U,O=K):J>0&&(M+=te*J,O+=Y*J)}return(te=V-M)*te+(Y=I-O)*Y}function Si(V,I,M,O){var U={id:V===void 0?null:V,type:I,geometry:M,tags:O,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(K){var te=K.geometry,Y=K.type;if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")we(K,te);else if(Y==="Polygon"||Y==="MultiLineString")for(var J=0;J<te.length;J++)we(K,te[J]);else if(Y==="MultiPolygon")for(J=0;J<te.length;J++)for(var ne=0;ne<te[J].length;ne++)we(K,te[J][ne])}(U),U}function we(V,I){for(var M=0;M<I.length;M+=3)V.minX=Math.min(V.minX,I[M]),V.minY=Math.min(V.minY,I[M+1]),V.maxX=Math.max(V.maxX,I[M]),V.maxY=Math.max(V.maxY,I[M+1])}function Fe(V,I,M,O){if(I.geometry){var U=I.geometry.coordinates,K=I.geometry.type,te=Math.pow(M.tolerance/((1<<M.maxZoom)*M.extent),2),Y=[],J=I.id;if(M.promoteId?J=I.properties[M.promoteId]:M.generateId&&(J=O||0),K==="Point")so(U,Y);else if(K==="MultiPoint")for(var ne=0;ne<U.length;ne++)so(U[ne],Y);else if(K==="LineString")Zr(U,Y,te,!1);else if(K==="MultiLineString"){if(M.lineMetrics){for(ne=0;ne<U.length;ne++)Zr(U[ne],Y=[],te,!1),V.push(Si(J,"LineString",Y,I.properties));return}kt(U,Y,te,!1)}else if(K==="Polygon")kt(U,Y,te,!0);else{if(K!=="MultiPolygon"){if(K==="GeometryCollection"){for(ne=0;ne<I.geometry.geometries.length;ne++)Fe(V,{id:J,geometry:I.geometry.geometries[ne],properties:I.properties},M,O);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ne=0;ne<U.length;ne++){var ge=[];kt(U[ne],ge,te,!0),Y.push(ge)}}V.push(Si(J,K,Y,I.properties))}}function so(V,I){I.push(Dr(V[0])),I.push(_r(V[1])),I.push(0)}function Zr(V,I,M,O){for(var U,K,te=0,Y=0;Y<V.length;Y++){var J=Dr(V[Y][0]),ne=_r(V[Y][1]);I.push(J),I.push(ne),I.push(0),Y>0&&(te+=O?(U*ne-J*K)/2:Math.sqrt(Math.pow(J-U,2)+Math.pow(ne-K,2))),U=J,K=ne}var ge=I.length-3;I[2]=1,bi(I,0,ge,M),I[ge+2]=1,I.size=Math.abs(te),I.start=0,I.end=I.size}function kt(V,I,M,O){for(var U=0;U<V.length;U++){var K=[];Zr(V[U],K,M,O),I.push(K)}}function Dr(V){return V/360+.5}function _r(V){var I=Math.sin(V*Math.PI/180),M=.5-.25*Math.log((1+I)/(1-I))/Math.PI;return M<0?0:M>1?1:M}function xr(V,I,M,O,U,K,te,Y){if(O/=I,K>=(M/=I)&&te<O)return V;if(te<M||K>=O)return null;for(var J=[],ne=0;ne<V.length;ne++){var ge=V[ne],Ce=ge.geometry,me=ge.type,He=U===0?ge.minX:ge.minY,Je=U===0?ge.maxX:ge.maxY;if(He>=M&&Je<O)J.push(ge);else if(!(Je<M||He>=O)){var je=[];if(me==="Point"||me==="MultiPoint")$i(Ce,je,M,O,U);else if(me==="LineString")De(Ce,je,M,O,U,!1,Y.lineMetrics);else if(me==="MultiLineString")pt(Ce,je,M,O,U,!1);else if(me==="Polygon")pt(Ce,je,M,O,U,!0);else if(me==="MultiPolygon")for(var ot=0;ot<Ce.length;ot++){var ut=[];pt(Ce[ot],ut,M,O,U,!0),ut.length&&je.push(ut)}if(je.length){if(Y.lineMetrics&&me==="LineString"){for(ot=0;ot<je.length;ot++)J.push(Si(ge.id,me,je[ot],ge.tags));continue}me!=="LineString"&&me!=="MultiLineString"||(je.length===1?(me="LineString",je=je[0]):me="MultiLineString"),me!=="Point"&&me!=="MultiPoint"||(me=je.length===3?"Point":"MultiPoint"),J.push(Si(ge.id,me,je,ge.tags))}}}return J.length?J:null}function $i(V,I,M,O,U){for(var K=0;K<V.length;K+=3){var te=V[K+U];te>=M&&te<=O&&(I.push(V[K]),I.push(V[K+1]),I.push(V[K+2]))}}function De(V,I,M,O,U,K,te){for(var Y,J,ne=gt(V),ge=U===0?Gi:dt,Ce=V.start,me=0;me<V.length-3;me+=3){var He=V[me],Je=V[me+1],je=V[me+2],ot=V[me+3],ut=V[me+4],Ct=U===0?He:Je,ht=U===0?ot:ut,yt=!1;te&&(Y=Math.sqrt(Math.pow(He-ot,2)+Math.pow(Je-ut,2))),Ct<M?ht>M&&(J=ge(ne,He,Je,ot,ut,M),te&&(ne.start=Ce+Y*J)):Ct>O?ht<O&&(J=ge(ne,He,Je,ot,ut,O),te&&(ne.start=Ce+Y*J)):Ln(ne,He,Je,je),ht<M&&Ct>=M&&(J=ge(ne,He,Je,ot,ut,M),yt=!0),ht>O&&Ct<=O&&(J=ge(ne,He,Je,ot,ut,O),yt=!0),!K&&yt&&(te&&(ne.end=Ce+Y*J),I.push(ne),ne=gt(V)),te&&(Ce+=Y)}var It=V.length-3;He=V[It],Je=V[It+1],je=V[It+2],(Ct=U===0?He:Je)>=M&&Ct<=O&&Ln(ne,He,Je,je),It=ne.length-3,K&&It>=3&&(ne[It]!==ne[0]||ne[It+1]!==ne[1])&&Ln(ne,ne[0],ne[1],ne[2]),ne.length&&I.push(ne)}function gt(V){var I=[];return I.size=V.size,I.start=V.start,I.end=V.end,I}function pt(V,I,M,O,U,K){for(var te=0;te<V.length;te++)De(V[te],I,M,O,U,K,!1)}function Ln(V,I,M,O){V.push(I),V.push(M),V.push(O)}function Gi(V,I,M,O,U,K){var te=(K-I)/(O-I);return V.push(K),V.push(M+(U-M)*te),V.push(1),te}function dt(V,I,M,O,U,K){var te=(K-M)/(U-M);return V.push(I+(O-I)*te),V.push(K),V.push(1),te}function Ei(V,I){for(var M=[],O=0;O<V.length;O++){var U,K=V[O],te=K.type;if(te==="Point"||te==="MultiPoint"||te==="LineString")U=kn(K.geometry,I);else if(te==="MultiLineString"||te==="Polygon"){U=[];for(var Y=0;Y<K.geometry.length;Y++)U.push(kn(K.geometry[Y],I))}else if(te==="MultiPolygon")for(U=[],Y=0;Y<K.geometry.length;Y++){for(var J=[],ne=0;ne<K.geometry[Y].length;ne++)J.push(kn(K.geometry[Y][ne],I));U.push(J)}M.push(Si(K.id,te,U,K.tags))}return M}function kn(V,I){var M=[];M.size=V.size,V.start!==void 0&&(M.start=V.start,M.end=V.end);for(var O=0;O<V.length;O+=3)M.push(V[O]+I,V[O+1],V[O+2]);return M}function Vo(V,I){if(V.transformed)return V;var M,O,U,K=1<<V.z,te=V.x,Y=V.y;for(M=0;M<V.features.length;M++){var J=V.features[M],ne=J.geometry,ge=J.type;if(J.geometry=[],ge===1)for(O=0;O<ne.length;O+=2)J.geometry.push(gn(ne[O],ne[O+1],I,K,te,Y));else for(O=0;O<ne.length;O++){var Ce=[];for(U=0;U<ne[O].length;U+=2)Ce.push(gn(ne[O][U],ne[O][U+1],I,K,te,Y));J.geometry.push(Ce)}}return V.transformed=!0,V}function gn(V,I,M,O,U,K){return[Math.round(M*(V*O-U)),Math.round(M*(I*O-K))]}function Xn(V,I,M,O,U){for(var K=I===U.maxZoom?0:U.tolerance/((1<<I)*U.extent),te={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:M,y:O,z:I,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Y=0;Y<V.length;Y++){te.numFeatures++,Ot(te,V[Y],K,U);var J=V[Y].minX,ne=V[Y].minY,ge=V[Y].maxX,Ce=V[Y].maxY;J<te.minX&&(te.minX=J),ne<te.minY&&(te.minY=ne),ge>te.maxX&&(te.maxX=ge),Ce>te.maxY&&(te.maxY=Ce)}return te}function Ot(V,I,M,O){var U=I.geometry,K=I.type,te=[];if(K==="Point"||K==="MultiPoint")for(var Y=0;Y<U.length;Y+=3)te.push(U[Y]),te.push(U[Y+1]),V.numPoints++,V.numSimplified++;else if(K==="LineString")jo(te,U,V,M,!1,!1);else if(K==="MultiLineString"||K==="Polygon")for(Y=0;Y<U.length;Y++)jo(te,U[Y],V,M,K==="Polygon",Y===0);else if(K==="MultiPolygon")for(var J=0;J<U.length;J++){var ne=U[J];for(Y=0;Y<ne.length;Y++)jo(te,ne[Y],V,M,!0,Y===0)}if(te.length){var ge=I.tags||null;if(K==="LineString"&&O.lineMetrics){for(var Ce in ge={},I.tags)ge[Ce]=I.tags[Ce];ge.mapbox_clip_start=U.start/U.size,ge.mapbox_clip_end=U.end/U.size}var me={geometry:te,type:K==="Polygon"||K==="MultiPolygon"?3:K==="LineString"||K==="MultiLineString"?2:1,tags:ge};I.id!==null&&(me.id=I.id),V.features.push(me)}}function jo(V,I,M,O,U,K){var te=O*O;if(O>0&&I.size<(U?te:O))M.numPoints+=I.length/3;else{for(var Y=[],J=0;J<I.length;J+=3)(O===0||I[J+2]>te)&&(M.numSimplified++,Y.push(I[J]),Y.push(I[J+1])),M.numPoints++;U&&function(ne,ge){for(var Ce=0,me=0,He=ne.length,Je=He-2;me<He;Je=me,me+=2)Ce+=(ne[me]-ne[Je])*(ne[me+1]+ne[Je+1]);if(Ce>0===ge)for(me=0,He=ne.length;me<He/2;me+=2){var je=ne[me],ot=ne[me+1];ne[me]=ne[He-2-me],ne[me+1]=ne[He-1-me],ne[He-2-me]=je,ne[He-1-me]=ot}}(Y,K),V.push(Y)}}function ai(V,I){var M=(I=this.options=function(U,K){for(var te in K)U[te]=K[te];return U}(Object.create(this.options),I)).debug;if(M&&console.time("preprocess data"),I.maxZoom<0||I.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(I.promoteId&&I.generateId)throw new Error("promoteId and generateId cannot be used together.");var O=function(U,K){var te=[];if(U.type==="FeatureCollection")for(var Y=0;Y<U.features.length;Y++)Fe(te,U.features[Y],K,Y);else Fe(te,U.type==="Feature"?U:{geometry:U},K);return te}(V,I);this.tiles={},this.tileCoords=[],M&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",I.indexMaxZoom,I.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),O=function(U,K){var te=K.buffer/K.extent,Y=U,J=xr(U,1,-1-te,te,0,-1,2,K),ne=xr(U,1,1-te,2+te,0,-1,2,K);return(J||ne)&&(Y=xr(U,1,-te,1+te,0,-1,2,K)||[],J&&(Y=Ei(J,1).concat(Y)),ne&&(Y=Y.concat(Ei(ne,-1)))),Y}(O,I),O.length&&this.splitTile(O,0,0,0),M&&(O.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ao(V,I,M){return 32*((1<<V)*M+I)+V}function lo(V,I){const M=V.tileID.canonical;if(!this._geoJSONIndex)return I(null,null);const O=this._geoJSONIndex.getTile(M.z,M.x,M.y);if(!O)return I(null,null);const U=new Ke(O.features);let K=Qe.exports(U);K.byteOffset===0&&K.byteLength===K.buffer.byteLength||(K=new Uint8Array(K)),I(null,{vectorTile:U,rawData:K.buffer})}ai.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ai.prototype.splitTile=function(V,I,M,O,U,K,te){for(var Y=[V,I,M,O],J=this.options,ne=J.debug;Y.length;){O=Y.pop(),M=Y.pop(),I=Y.pop(),V=Y.pop();var ge=1<<I,Ce=ao(I,M,O),me=this.tiles[Ce];if(!me&&(ne>1&&console.time("creation"),me=this.tiles[Ce]=Xn(V,I,M,O,J),this.tileCoords.push({z:I,x:M,y:O}),ne)){ne>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",I,M,O,me.numFeatures,me.numPoints,me.numSimplified),console.timeEnd("creation"));var He="z"+I;this.stats[He]=(this.stats[He]||0)+1,this.total++}if(me.source=V,U){if(I===J.maxZoom||I===U)continue;var Je=1<<U-I;if(M!==Math.floor(K/Je)||O!==Math.floor(te/Je))continue}else if(I===J.indexMaxZoom||me.numPoints<=J.indexMaxPoints)continue;if(me.source=null,V.length!==0){ne>1&&console.time("clipping");var je,ot,ut,Ct,ht,yt,It=.5*J.buffer/J.extent,Vt=.5-It,Cn=.5+It,Jt=1+It;je=ot=ut=Ct=null,ht=xr(V,ge,M-It,M+Cn,0,me.minX,me.maxX,J),yt=xr(V,ge,M+Vt,M+Jt,0,me.minX,me.maxX,J),V=null,ht&&(je=xr(ht,ge,O-It,O+Cn,1,me.minY,me.maxY,J),ot=xr(ht,ge,O+Vt,O+Jt,1,me.minY,me.maxY,J),ht=null),yt&&(ut=xr(yt,ge,O-It,O+Cn,1,me.minY,me.maxY,J),Ct=xr(yt,ge,O+Vt,O+Jt,1,me.minY,me.maxY,J),yt=null),ne>1&&console.timeEnd("clipping"),Y.push(je||[],I+1,2*M,2*O),Y.push(ot||[],I+1,2*M,2*O+1),Y.push(ut||[],I+1,2*M+1,2*O),Y.push(Ct||[],I+1,2*M+1,2*O+1)}}},ai.prototype.getTile=function(V,I,M){var O=this.options,U=O.extent,K=O.debug;if(V<0||V>24)return null;var te=1<<V,Y=ao(V,I=(I%te+te)%te,M);if(this.tiles[Y])return Vo(this.tiles[Y],U);K>1&&console.log("drilling down to z%d-%d-%d",V,I,M);for(var J,ne=V,ge=I,Ce=M;!J&&ne>0;)ne--,ge=Math.floor(ge/2),Ce=Math.floor(Ce/2),J=this.tiles[ao(ne,ge,Ce)];return J&&J.source?(K>1&&console.log("found parent tile z%d-%d-%d",ne,ge,Ce),K>1&&console.time("drilling down"),this.splitTile(J.source,ne,ge,Ce,V,I,M),K>1&&console.timeEnd("drilling down"),this.tiles[Y]?Vo(this.tiles[Y],U):null):null};class $o extends be{constructor(I,M,O,U){super(I,M,O,lo),U&&(this.loadGeoJSON=U)}loadData(I,M){var O;(O=this._pendingRequest)===null||O===void 0||O.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const U=!!(I&&I.request&&I.request.collectResourceTiming)&&new u.RequestPerformance(I.request);this._pendingCallback=M,this._pendingRequest=this.loadGeoJSON(I,(K,te)=>{if(delete this._pendingCallback,delete this._pendingRequest,K||!te)return M(K);if(typeof te!="object")return M(new Error(`Input data given to '${I.source}' is not a valid GeoJSON object.`));{se(te,!0);try{if(I.filter){const J=u.createExpression(I.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(J.result==="error")throw new Error(J.value.map(ge=>`${ge.key}: ${ge.message}`).join(", "));te={type:"FeatureCollection",features:te.features.filter(ge=>J.value.evaluate({zoom:0},ge))}}this._geoJSONIndex=I.cluster?new Ps(function({superclusterOptions:J,clusterProperties:ne}){if(!ne||!J)return J;const ge={},Ce={},me={accumulated:null,zoom:0},He={properties:null},Je=Object.keys(ne);for(const je of Je){const[ot,ut]=ne[je],Ct=u.createExpression(ut),ht=u.createExpression(typeof ot=="string"?[ot,["accumulated"],["get",je]]:ot);ge[je]=Ct.value,Ce[je]=ht.value}return J.map=je=>{He.properties=je;const ot={};for(const ut of Je)ot[ut]=ge[ut].evaluate(me,He);return ot},J.reduce=(je,ot)=>{He.properties=ot;for(const ut of Je)me.accumulated=je[ut],je[ut]=Ce[ut].evaluate(me,He)},J}(I)).load(te.features):function(J,ne){return new ai(J,ne)}(te,I.geojsonVtOptions)}catch(J){return M(J)}this.loaded={};const Y={};if(U){const J=U.finish();J&&(Y.resourceTiming={},Y.resourceTiming[I.source]=JSON.parse(JSON.stringify(J)))}M(null,Y)}})}reloadTile(I,M){const O=this.loaded;return O&&O[I.uid]?super.reloadTile(I,M):this.loadTile(I,M)}loadGeoJSON(I,M){if(I.request)return u.getJSON(I.request,M);if(typeof I.data=="string")try{M(null,JSON.parse(I.data))}catch{M(new Error(`Input data given to '${I.source}' is not a valid GeoJSON object.`))}else M(new Error(`Input data given to '${I.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(I,M){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),M()}getClusterExpansionZoom(I,M){try{M(null,this._geoJSONIndex.getClusterExpansionZoom(I.clusterId))}catch(O){M(O)}}getClusterChildren(I,M){try{M(null,this._geoJSONIndex.getChildren(I.clusterId))}catch(O){M(O)}}getClusterLeaves(I,M){try{M(null,this._geoJSONIndex.getLeaves(I.clusterId,I.limit,I.offset))}catch(O){M(O)}}}class uo{constructor(I){this.self=I,this.actor=new u.Actor(I,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:be,geojson:$o},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(M,O)=>{if(this.workerSourceTypes[M])throw new Error(`Worker source with name "${M}" already registered.`);this.workerSourceTypes[M]=O},this.self.registerRTLTextPlugin=M=>{if(u.plugin.isParsed())throw new Error("RTL text plugin already registered.");u.plugin.applyArabicShaping=M.applyArabicShaping,u.plugin.processBidirectionalText=M.processBidirectionalText,u.plugin.processStyledBidirectionalText=M.processStyledBidirectionalText}}setReferrer(I,M){this.referrer=M}setImages(I,M,O){this.availableImages[I]=M;for(const U in this.workerSources[I]){const K=this.workerSources[I][U];for(const te in K)K[te].availableImages=M}O()}setLayers(I,M,O){this.getLayerIndex(I).replace(M),O()}updateLayers(I,M,O){this.getLayerIndex(I).update(M.layers,M.removedIds),O()}loadTile(I,M,O){this.getWorkerSource(I,M.type,M.source).loadTile(M,O)}loadDEMTile(I,M,O){this.getDEMWorkerSource(I,M.source).loadTile(M,O)}reloadTile(I,M,O){this.getWorkerSource(I,M.type,M.source).reloadTile(M,O)}abortTile(I,M,O){this.getWorkerSource(I,M.type,M.source).abortTile(M,O)}removeTile(I,M,O){this.getWorkerSource(I,M.type,M.source).removeTile(M,O)}removeDEMTile(I,M){this.getDEMWorkerSource(I,M.source).removeTile(M)}removeSource(I,M,O){if(!this.workerSources[I]||!this.workerSources[I][M.type]||!this.workerSources[I][M.type][M.source])return;const U=this.workerSources[I][M.type][M.source];delete this.workerSources[I][M.type][M.source],U.removeSource!==void 0?U.removeSource(M,O):O()}loadWorkerSource(I,M,O){try{this.self.importScripts(M.url),O()}catch(U){O(U.toString())}}syncRTLPluginState(I,M,O){try{u.plugin.setState(M);const U=u.plugin.getPluginURL();if(u.plugin.isLoaded()&&!u.plugin.isParsed()&&U!=null){this.self.importScripts(U);const K=u.plugin.isParsed();O(K?void 0:new Error(`RTL Text Plugin failed to import scripts from ${U}`),K)}}catch(U){O(U.toString())}}getAvailableImages(I){let M=this.availableImages[I];return M||(M=[]),M}getLayerIndex(I){let M=this.layerIndexes[I];return M||(M=this.layerIndexes[I]=new ue),M}getWorkerSource(I,M,O){if(this.workerSources[I]||(this.workerSources[I]={}),this.workerSources[I][M]||(this.workerSources[I][M]={}),!this.workerSources[I][M][O]){const U={send:(K,te,Y)=>{this.actor.send(K,te,Y,I)}};this.workerSources[I][M][O]=new this.workerSourceTypes[M](U,this.getLayerIndex(I),this.getAvailableImages(I))}return this.workerSources[I][M][O]}getDEMWorkerSource(I,M){return this.demWorkerSources[I]||(this.demWorkerSources[I]={}),this.demWorkerSources[I][M]||(this.demWorkerSources[I][M]=new bt),this.demWorkerSources[I][M]}enforceCacheSizeLimit(I,M){u.enforceCacheSizeLimit(M)}}return u.isWorker()&&(self.worker=new uo(self)),uo}),x(["./shared"],function(u){var N=Z;function Z(h){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var c,p,g=new Blob([""],{type:"text/javascript"}),v=URL.createObjectURL(g);try{p=new Worker(v),c=!0}catch{c=!1}return p&&p.terminate(),URL.revokeObjectURL(v),c}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var c=document.createElement("canvas");c.width=c.height=1;var p=c.getContext("2d");if(!p)return!1;var g=p.getImageData(0,0,1,1);return g&&g.width===c.width}()?(ue[s=t&&t.failIfMajorPerformanceCaveat]===void 0&&(ue[s]=function(c){var p,g=function(v){var S=document.createElement("canvas"),E=Object.create(Z.webGLContextAttributes);return E.failIfMajorPerformanceCaveat=v,S.getContext("webgl",E)||S.getContext("experimental-webgl",E)}(c);if(!g)return!1;try{p=g.createShader(g.VERTEX_SHADER)}catch{return!1}return!(!p||g.isContextLost())&&(g.shaderSource(p,"void main() {}"),g.compileShader(p),g.getShaderParameter(p,g.COMPILE_STATUS)===!0)}(s)),ue[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(h)}var ue={};function oe(h,t){if(Array.isArray(h)){if(!Array.isArray(t)||h.length!==t.length)return!1;for(let s=0;s<h.length;s++)if(!oe(h[s],t[s]))return!1;return!0}if(typeof h=="object"&&h!==null&&t!==null){if(typeof t!="object"||Object.keys(h).length!==Object.keys(t).length)return!1;for(const s in h)if(!oe(h[s],t[s]))return!1;return!0}return h===t}Z.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class G{static testProp(t){if(!G.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in G.docStyle)return t[s];return t[0]}static create(t,s,c){const p=window.document.createElement(t);return s!==void 0&&(p.className=s),c&&c.appendChild(p),p}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){G.docStyle&&G.selectProp&&(G.userSelect=G.docStyle[G.selectProp],G.docStyle[G.selectProp]="none")}static enableDrag(){G.docStyle&&G.selectProp&&(G.docStyle[G.selectProp]=G.userSelect)}static setTransform(t,s){t.style[G.transformProp]=s}static addEventListener(t,s,c,p={}){t.addEventListener(s,c,"passive"in p?p:p.capture)}static removeEventListener(t,s,c,p={}){t.removeEventListener(s,c,"passive"in p?p:p.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",G.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",G.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",G.suppressClickInternal,!0)},0)}static mousePos(t,s){const c=t.getBoundingClientRect();return new u.pointGeometry(s.clientX-c.left-t.clientLeft,s.clientY-c.top-t.clientTop)}static touchPos(t,s){const c=t.getBoundingClientRect(),p=[];for(let g=0;g<s.length;g++)p.push(new u.pointGeometry(s[g].clientX-c.left-t.clientLeft,s[g].clientY-c.top-t.clientTop));return p}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}G.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,G.selectProp=G.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),G.transformProp=G.testProp(["transform","WebkitTransform"]);class Te{constructor(t){this._transformRequestFn=t}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeSpriteURL(t,s,c){const p=function(g){const v=g.match(_e);if(!v)throw new Error(`Unable to parse URL "${g}"`);return{protocol:v[1],authority:v[2],path:v[3]||"/",params:v[4]?v[4].split("&"):[]}}(t);return p.path+=`${s}${c}`,function(g){const v=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${v}`}(p)}setTransformRequest(t){this._transformRequestFn=t}}const _e=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class be{constructor(t,s,c,p){this.context=t,this.format=c,this.texture=t.gl.createTexture(),this.update(s,p)}update(t,s,c){const{width:p,height:g}=t,v=!(this.size&&this.size[0]===p&&this.size[1]===g||c),{context:S}=this,{gl:E}=S;if(this.useMipmap=Boolean(s&&s.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!s||s.premultiply!==!1)),v)this.size=[p,g],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||u.isImageBitmap(t)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,t):E.texImage2D(E.TEXTURE_2D,0,this.format,p,g,0,this.format,E.UNSIGNED_BYTE,t.data);else{const{x:C,y:P}=c||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||u.isImageBitmap(t)?E.texSubImage2D(E.TEXTURE_2D,0,C,P,E.RGBA,E.UNSIGNED_BYTE,t):E.texSubImage2D(E.TEXTURE_2D,0,C,P,p,g,E.RGBA,E.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D)}bind(t,s,c){const{context:p}=this,{gl:g}=p;g.bindTexture(g.TEXTURE_2D,this.texture),c!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=g.LINEAR),t!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,t),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,c||t),this.filter=t),s!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,s),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function bt(h){const{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class se extends u.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,callback:c}of this.requestors)this._notify(s,c);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let c=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new u.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),c=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new u.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),c=!1),this._validateContent(s.content,s)||(this.fire(new u.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),c=!1),c}_validateStretch(t,s){if(!t)return!0;let c=0;for(const p of t){if(p[0]<c||p[1]<p[0]||s<p[1])return!1;c=p[1]}return!0}_validateContent(t,s){return!(t&&(t.length!==4||t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,s){const c=this.images[t];if(c.data.width!==s.data.width||c.data.height!==s.data.height)throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=c.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,s){let c=!0;if(!this.isLoaded())for(const p of t)this.images[p]||(c=!1);this.isLoaded()||c?this._notify(t,s):this.requestors.push({ids:t,callback:s})}_notify(t,s){const c={};for(const p of t){this.images[p]||this.fire(new u.Event("styleimagemissing",{id:p}));const g=this.images[p];g?c[p]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:Boolean(g.userImage&&g.userImage.render)}:u.warnOnce(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,c)}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],c=this.getImage(t);if(!c)return null;if(s&&s.position.version===c.version)return s.position;if(s)s.position.version=c.version;else{const p={w:c.data.width+2,h:c.data.height+2,x:0,y:0},g=new u.ImagePosition(p,c);this.patterns[t]={bin:p,position:g}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new be(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const g in this.patterns)t.push(this.patterns[g].bin);const{w:s,h:c}=u.potpack(t),p=this.atlasImage;p.resize({width:s||1,height:c||1});for(const g in this.patterns){const{bin:v}=this.patterns[g],S=v.x+1,E=v.y+1,C=this.images[g].data,P=C.width,D=C.height;u.RGBAImage.copy(C,p,{x:0,y:0},{x:S,y:E},{width:P,height:D}),u.RGBAImage.copy(C,p,{x:0,y:D-1},{x:S,y:E-1},{width:P,height:1}),u.RGBAImage.copy(C,p,{x:0,y:0},{x:S,y:E+D},{width:P,height:1}),u.RGBAImage.copy(C,p,{x:P-1,y:0},{x:S-1,y:E},{width:1,height:D}),u.RGBAImage.copy(C,p,{x:0,y:0},{x:S+P,y:E},{width:1,height:D})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const c=this.images[s];c||u.warnOnce(`Image with ID: "${s}" was not found`),bt(c)&&this.updateImage(s,c)}}}const Q=1e20;function le(h,t,s,c,p,g,v,S,E){for(let C=t;C<t+c;C++)Pe(h,s*g+C,g,p,v,S,E);for(let C=s;C<s+p;C++)Pe(h,C*g+t,1,c,v,S,E)}function Pe(h,t,s,c,p,g,v){g[0]=0,v[0]=-Q,v[1]=Q,p[0]=h[t];for(let S=1,E=0,C=0;S<c;S++){p[S]=h[t+S*s];const P=S*S;do{const D=g[E];C=(p[S]-p[D]+P-D*D)/(S-D)/2}while(C<=v[E]&&--E>-1);E++,g[E]=S,v[E]=C,v[E+1]=Q}for(let S=0,E=0;S<c;S++){for(;v[E+1]<S;)E++;const C=g[E],P=S-C;h[t+S*s]=p[C]+P*P}}class Be{constructor(t,s){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={}}setURL(t){this.url=t}getGlyphs(t,s){const c=[];for(const p in t)for(const g of t[p])c.push({stack:p,id:g});u.asyncAll(c,({stack:p,id:g},v)=>{let S=this.entries[p];S||(S=this.entries[p]={glyphs:{},requests:{},ranges:{}});let E=S.glyphs[g];if(E!==void 0)return void v(null,{stack:p,id:g,glyph:E});if(E=this._tinySDF(S,p,g),E)return S.glyphs[g]=E,void v(null,{stack:p,id:g,glyph:E});const C=Math.floor(g/256);if(256*C>65535)return void v(new Error("glyphs > 65535 not supported"));if(S.ranges[C])return void v(null,{stack:p,id:g,glyph:E});let P=S.requests[C];P||(P=S.requests[C]=[],Be.loadGlyphRange(p,C,this.url,this.requestManager,(D,R)=>{if(R){for(const q in R)this._doesCharSupportLocalGlyph(+q)||(S.glyphs[+q]=R[+q]);S.ranges[C]=!0}for(const q of P)q(D,R);delete S.requests[C]})),P.push((D,R)=>{D?v(D):R&&v(null,{stack:p,id:g,glyph:R[g]||null})})},(p,g)=>{if(p)s(p);else if(g){const v={};for(const{stack:S,id:E,glyph:C}of g)(v[S]||(v[S]={}))[E]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};s(null,v)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(u.unicodeBlockLookup["CJK Unified Ideographs"](t)||u.unicodeBlockLookup["Hangul Syllables"](t)||u.unicodeBlockLookup.Hiragana(t)||u.unicodeBlockLookup.Katakana(t))}_tinySDF(t,s,c){const p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let g=t.tinySDF;if(!g){let S="400";/bold/i.test(s)?S="900":/medium/i.test(s)?S="500":/light/i.test(s)&&(S="200"),g=t.tinySDF=new Be.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:p,fontWeight:S})}const v=g.draw(String.fromCharCode(c));return{id:c,bitmap:new u.AlphaImage({width:v.width||30,height:v.height||30},v.data),metrics:{width:v.glyphWidth||24,height:v.glyphHeight||24,left:v.glyphLeft||0,top:v.glyphTop-27||-8,advance:v.glyphAdvance||24}}}}Be.loadGlyphRange=function(h,t,s,c,p){const g=256*t,v=g+255,S=c.transformRequest(s.replace("{fontstack}",h).replace("{range}",`${g}-${v}`),u.ResourceType.Glyphs);u.getArrayBuffer(S,(E,C)=>{if(E)p(E);else if(C){const P={};for(const D of u.parseGlyphPbf(C))P[D.id]=D;p(null,P)}})},Be.TinySDF=class{constructor({fontSize:h=24,buffer:t=3,radius:s=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:g="normal",fontStyle:v="normal"}={}){this.buffer=t,this.cutoff=c,this.radius=s;const S=this.size=h+4*t,E=this._createCanvas(S),C=this.ctx=E.getContext("2d",{willReadFrequently:!0});C.font=`${v} ${g} ${h}px ${p}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(h){const t=document.createElement("canvas");return t.width=t.height=h,t}draw(h){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:g}=this.ctx.measureText(h),v=Math.ceil(s),S=Math.min(this.size-this.buffer,Math.ceil(g-p)),E=Math.min(this.size-this.buffer,v+Math.ceil(c)),C=S+2*this.buffer,P=E+2*this.buffer,D=Math.max(C*P,0),R=new Uint8ClampedArray(D),q={data:R,width:C,height:P,glyphWidth:S,glyphHeight:E,glyphTop:v,glyphLeft:0,glyphAdvance:t};if(S===0||E===0)return q;const{ctx:j,buffer:$,gridInner:ee,gridOuter:re}=this;j.clearRect($,$,S,E),j.fillText(h,$,$+v);const ce=j.getImageData($,$,S,E);re.fill(Q,0,D),ee.fill(0,0,D);for(let W=0;W<E;W++)for(let pe=0;pe<S;pe++){const he=ce.data[4*(W*S+pe)+3]/255;if(he===0)continue;const xe=(W+$)*C+pe+$;if(he===1)re[xe]=0,ee[xe]=Q;else{const ve=.5-he;re[xe]=ve>0?ve*ve:0,ee[xe]=ve<0?ve*ve:0}}le(re,0,0,C,P,C,this.f,this.v,this.z),le(ee,$,$,S,E,C,this.f,this.v,this.z);for(let W=0;W<D;W++){const pe=Math.sqrt(re[W])-Math.sqrt(ee[W]);R[W]=Math.round(255-255*(pe/this.radius+this.cutoff))}return q}};const Ke=new u.Properties({anchor:new u.DataConstantProperty(u.spec.light.anchor),position:new class{constructor(){this.specification=u.spec.light.position}possiblyEvaluate(h,t){return u.sphericalToCartesian(h.expression.evaluate(t))}interpolate(h,t,s){return{x:u.number(h.x,t.x,s),y:u.number(h.y,t.y,s),z:u.number(h.z,t.z,s)}}},color:new u.DataConstantProperty(u.spec.light.color),intensity:new u.DataConstantProperty(u.spec.light.intensity)}),Qe="-transition";class et extends u.Evented{constructor(t){super(),this._transitionable=new u.Transitionable(Ke),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(u.validateLight,t,s))for(const c in t){const p=t[c];c.endsWith(Qe)?this._transitionable.setTransition(c.slice(0,-Qe.length),p):this._transitionable.setValue(c,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,c){return(!c||c.validate!==!1)&&u.emitValidationErrors(this,t.call(u.validateStyle,u.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}class Zt{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const c=t.join(",")+String(s);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(t,s)),this.dashEntry[c]}getDashRanges(t,s,c){const p=[];let g=t.length%2==1?-t[t.length-1]*c:0,v=t[0]*c,S=!0;p.push({left:g,right:v,isDash:S,zeroLength:t[0]===0});let E=t[0];for(let C=1;C<t.length;C++){S=!S;const P=t[C];g=E*c,E+=P,v=E*c,p.push({left:g,right:v,isDash:S,zeroLength:P===0})}return p}addRoundDash(t,s,c){const p=s/2;for(let g=-c;g<=c;g++){const v=this.width*(this.nextRow+c+g);let S=0,E=t[S];for(let C=0;C<this.width;C++){C/E.right>1&&(E=t[++S]);const P=Math.abs(C-E.left),D=Math.abs(C-E.right),R=Math.min(P,D);let q;const j=g/c*(p+1);if(E.isDash){const $=p-Math.abs(j);q=Math.sqrt(R*R+$*$)}else q=p-Math.sqrt(R*R+j*j);this.data[v+C]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(t){for(let S=t.length-1;S>=0;--S){const E=t[S],C=t[S+1];E.zeroLength?t.splice(S,1):C&&C.isDash===E.isDash&&(C.left=E.left,t.splice(S,1))}const s=t[0],c=t[t.length-1];s.isDash===c.isDash&&(s.left=c.left-this.width,c.right=s.right+this.width);const p=this.width*this.nextRow;let g=0,v=t[g];for(let S=0;S<this.width;S++){S/v.right>1&&(v=t[++g]);const E=Math.abs(S-v.left),C=Math.abs(S-v.right),P=Math.min(E,C);this.data[p+S]=Math.max(0,Math.min(255,(v.isDash?P:-P)+128))}}addDash(t,s){const c=s?7:0,p=2*c+1;if(this.nextRow+p>this.height)return u.warnOnce("LineAtlas out of space"),null;let g=0;for(let S=0;S<t.length;S++)g+=t[S];if(g!==0){const S=this.width/g,E=this.getDashRanges(t,this.width,S);s?this.addRoundDash(E,S,c):this.addRegularDash(E)}const v={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:g};return this.nextRow+=p,this.dirty=!0,v}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}class mt{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=u.uniqueId();const c=this.workerPool.acquire(this.id);for(let p=0;p<c.length;p++){const g=new mt.Actor(c[p],s,this.id);g.name=`Worker ${p}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s,c){u.asyncAll(this.actors,(p,g)=>{p.send(t,s,g)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function wn(h,t,s){const c=function(p,g){if(p)return s(p);if(g){const v=u.pick(u.extend(g,h),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);g.vector_layers&&(v.vectorLayers=g.vector_layers,v.vectorLayerIds=v.vectorLayers.map(S=>S.id)),s(null,v)}};return h.url?u.getJSON(t.transformRequest(h.url,u.ResourceType.Source),c):u.exported.frame(()=>c(null,h))}mt.Actor=u.Actor;class Hn{constructor(t,s,c){this.bounds=u.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),c=Math.floor(u.mercatorXfromLng(this.bounds.getWest())*s),p=Math.floor(u.mercatorYfromLat(this.bounds.getNorth())*s),g=Math.ceil(u.mercatorXfromLng(this.bounds.getEast())*s),v=Math.ceil(u.mercatorYfromLat(this.bounds.getSouth())*s);return t.x>=c&&t.x<g&&t.y>=p&&t.y<v}}class Mr extends u.Evented{constructor(t,s,c,p){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.extend(this,u.pick(s,["url","scheme","tileSize","promoteId"])),this._options=u.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=wn(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t?this.fire(new u.ErrorEvent(t)):s&&(u.extend(this,s),s.bounds&&(this.tileBounds=new Hn(s.bounds,this.minzoom,this.maxzoom)),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return u.extend({},this._options)}loadTile(t,s){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(c,u.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function g(v,S){return delete t.request,t.aborted?s(null):v&&v.status!==404?s(v):(S&&S.resourceTiming&&(t.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&t.setExpiryData(S),t.loadVectorData(S,this.map.painter),u.cacheEntryPossiblyAdded(this.dispatcher),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}p.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",p,g.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",p,g.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Gr extends u.Evented{constructor(t,s,c,p){super(),this.id=t,this.dispatcher=c,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.extend({type:"raster"},s),u.extend(this,u.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=wn(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new u.ErrorEvent(t)):s&&(u.extend(this,s),s.bounds&&(this.tileBounds=new Hn(s.bounds,this.minzoom,this.maxzoom)),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return u.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=u.getImage(this.map._requestManager.transformRequest(c,u.ResourceType.Tile),(p,g,v)=>{if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(p)t.state="errored",s(p);else if(g){this.map._refreshExpiredTiles&&t.setExpiryData(v);const S=this.map.painter.context,E=S.gl;t.texture=this.map.painter.getTileTexture(g.width),t.texture?t.texture.update(g,{useMipmap:!0}):(t.texture=new be(S,g,E.RGBA,{useMipmap:!0}),t.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),S.extTextureFilterAnisotropic&&E.texParameterf(E.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax)),t.state="loaded",u.cacheEntryPossiblyAdded(this.dispatcher),s(null)}})}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s()}unloadTile(t,s){t.texture&&this.map.painter.saveTileTexture(t.texture),s()}hasTransition(){return!1}}let oi;class at extends Gr{constructor(t,s,c,p){super(t,s,c,p),this.type="raster-dem",this.maxzoom=22,this._options=u.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(t,s){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function p(g,v){g&&(t.state="errored",s(g)),v&&(t.dem=v,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",s(null))}t.request=u.getImage(this.map._requestManager.transformRequest(c,u.ResourceType.Tile),function(g,v){if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(g)t.state="errored",s(g);else if(v){this.map._refreshExpiredTiles&&t.setExpiryData(v),delete v.cacheControl,delete v.expires;const S=u.isImageBitmap(v)&&(oi==null&&(oi=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),oi)?v:u.exported.getImageData(v,1),E={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:S,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",E,p.bind(this)))}}.bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const s=t.canonical,c=Math.pow(2,s.z),p=(s.x-1+c)%c,g=s.x===0?t.wrap-1:t.wrap,v=(s.x+1+c)%c,S=s.x+1===c?t.wrap+1:t.wrap,E={};return E[new u.OverscaledTileID(t.overscaledZ,g,s.z,p,s.y).key]={backfilled:!1},E[new u.OverscaledTileID(t.overscaledZ,S,s.z,v,s.y).key]={backfilled:!1},s.y>0&&(E[new u.OverscaledTileID(t.overscaledZ,g,s.z,p,s.y-1).key]={backfilled:!1},E[new u.OverscaledTileID(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},E[new u.OverscaledTileID(t.overscaledZ,S,s.z,v,s.y-1).key]={backfilled:!1}),s.y+1<c&&(E[new u.OverscaledTileID(t.overscaledZ,g,s.z,p,s.y+1).key]={backfilled:!1},E[new u.OverscaledTileID(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},E[new u.OverscaledTileID(t.overscaledZ,S,s.z,v,s.y+1).key]={backfilled:!1}),E}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class mr extends u.Evented{constructor(t,s,c,p){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=c.getActor(),this.setEventedParent(p),this._data=s.data,this._options=u.extend({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const g=u.EXTENT/this.tileSize;this.workerOptions=u.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*g,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*g,extent:u.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:u.EXTENT,radius:(s.clusterRadius||50)*g,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData("content"),this}getClusterExpansionZoom(t,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},s),this}getClusterChildren(t,s){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},s),this}getClusterLeaves(t,s,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:s,offset:c},p),this}_updateWorkerData(t){const s=u.extend({},this.workerOptions),c=this._data;typeof c=="string"?(s.request=this.map._requestManager.transformRequest(u.exported.resolveURL(c),u.ResourceType.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(c),this._pendingLoads++,this.fire(new u.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,s,(p,g)=>{if(this._pendingLoads--,this._removed||g&&g.abandoned)return void this.fire(new u.Event("dataabort",{dataType:"source",sourceDataType:t}));let v=null;if(g&&g.resourceTiming&&g.resourceTiming[this.id]&&(v=g.resourceTiming[this.id].slice(0)),p)return void this.fire(new u.ErrorEvent(p));const S={dataType:"source",sourceDataType:t};this._collectResourceTiming&&v&&v.length>0&&u.extend(S,{resourceTiming:v}),this.fire(new u.Event("data",S))})}loaded(){return this._pendingLoads===0}loadTile(t,s){const c=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const p={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(c,p,(g,v)=>(delete t.request,t.unloadVectorData(),t.aborted?s(null):g?s(g):(t.loadVectorData(v,this.map.painter,c==="reloadTile"),s(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return u.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Ze=u.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class lt extends u.Evented{constructor(t,s,c,p){super(),this.id=t,this.dispatcher=c,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=s}load(t,s){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this.url=this.options.url,u.getImage(this.map._requestManager.transformRequest(this.url,u.ResourceType.Image),(c,p)=>{this._loaded=!0,c?this.fire(new u.ErrorEvent(c)):p&&(this.image=p,t&&(this.coordinates=t),s&&s(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t;const s=t.map(u.MercatorCoordinate.fromLngLat);this.tileID=function(p){let g=1/0,v=1/0,S=-1/0,E=-1/0;for(const R of p)g=Math.min(g,R.x),v=Math.min(v,R.y),S=Math.max(S,R.x),E=Math.max(E,R.y);const C=Math.max(S-g,E-v),P=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),D=Math.pow(2,P);return new u.CanonicalTileID(P,Math.floor((g+S)/2*D),Math.floor((v+E)/2*D))}(s),this.minzoom=this.maxzoom=this.tileID.z;const c=s.map(p=>this.tileID.getTilePoint(p)._round());return this._boundsArray=new u.RasterBoundsArray,this._boundsArray.emplaceBack(c[0].x,c[0].y,0,0),this._boundsArray.emplaceBack(c[1].x,c[1].y,u.EXTENT,0),this._boundsArray.emplaceBack(c[3].x,c[3].y,0,u.EXTENT),this._boundsArray.emplaceBack(c[2].x,c[2].y,u.EXTENT,u.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Ze.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new be(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const c in this.tiles){const p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture)}}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class ct extends lt{constructor(t,s,c,p){super(t,s,c,p),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const s of t.urls)this.urls.push(this.map._requestManager.transformRequest(s,u.ResourceType.Source).url);u.getVideo(this.urls,(s,c)=>{this._loaded=!0,s?this.fire(new u.ErrorEvent(s)):c&&(this.video=c,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Ze.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new be(t,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const c in this.tiles){const p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ut extends lt{constructor(t,s,c,p){super(t,s,c,p),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(v=>typeof v!="number"))||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,c=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Ze.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new be(s,this.canvas,c.RGBA,{premultiply:!0});for(const p in this.tiles){const g=this.tiles[p];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Kt={vector:Mr,raster:Gr,"raster-dem":at,geojson:mr,video:ct,image:lt,canvas:Ut};function qr(h,t){const s=u.create();return u.translate(s,s,[1,1,0]),u.scale(s,s,[.5*h.width,.5*h.height,1]),u.multiply(s,s,h.calculatePosMatrix(t.toUnwrapped()))}function nr(h,t,s,c,p,g){const v=function(D,R,q){if(D)for(const j of D){const $=R[j];if($&&$.source===q&&$.type==="fill-extrusion")return!0}else for(const j in R){const $=R[j];if($.source===q&&$.type==="fill-extrusion")return!0}return!1}(p&&p.layers,t,h.id),S=g.maxPitchScaleFactor(),E=h.tilesIn(c,S,v);E.sort(rr);const C=[];for(const D of E)C.push({wrappedTileID:D.tileID.wrapped().key,queryResults:D.tile.queryRenderedFeatures(t,s,h._state,D.queryGeometry,D.cameraQueryGeometry,D.scale,p,g,S,qr(h.transform,D.tileID))});const P=function(D){const R={},q={};for(const j of D){const $=j.queryResults,ee=j.wrappedTileID,re=q[ee]=q[ee]||{};for(const ce in $){const W=$[ce],pe=re[ce]=re[ce]||{},he=R[ce]=R[ce]||[];for(const xe of W)pe[xe.featureIndex]||(pe[xe.featureIndex]=!0,he.push(xe))}}return R}(C);for(const D in P)P[D].forEach(R=>{const q=R.feature,j=h.getFeatureState(q.layer["source-layer"],q.id);q.source=q.layer.source,q.layer["source-layer"]&&(q.sourceLayer=q.layer["source-layer"]),q.state=j});return P}function rr(h,t){const s=h.tileID,c=t.tileID;return s.overscaledZ-c.overscaledZ||s.canonical.y-c.canonical.y||s.wrap-c.wrap||s.canonical.x-c.canonical.x}class Un{constructor(t,s){this.tileID=t,this.uid=u.uniqueId(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const s=t+this.timeAdded;s<u.exported.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.textures.forEach(s=>t.saveTileTexture(s)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(t,s,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(p,g){const v={};if(!g)return v;for(const S of p){const E=S.layerIds.map(C=>g.getLayer(C)).filter(Boolean);if(E.length!==0){S.layers=E,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(C=>E.filter(P=>P.id===C)[0]));for(const C of E)v[C.id]=S}}return v}(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const g=this.buckets[p];if(g instanceof u.SymbolBucket){if(this.hasSymbolBuckets=!0,!c)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const g=this.buckets[p];if(g instanceof u.SymbolBucket&&g.hasRTLText){this.hasRTLText=!0,u.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const p in this.buckets){const g=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(p).queryRadius(g))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new u.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const c in this.buckets){const p=this.buckets[c];p.uploadPending()&&p.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new be(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new be(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,c,p,g,v,S,E,C,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:g,scale:v,tileSize:this.tileSize,pixelPosMatrix:P,transform:E,params:S,queryPadding:this.queryPadding*C},t,s,c):{}}querySourceFeatures(t,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const p=c.loadVTLayers(),g=s?s.sourceLayer:"",v=p._geojsonTileLayer||p[g];if(!v)return;const S=u.createFilter(s&&s.filter),{z:E,x:C,y:P}=this.tileID.canonical,D={z:E,x:C,y:P};for(let R=0;R<v.length;R++){const q=v.feature(R);if(S.needGeometry){const ee=u.toEvaluationFeature(q,!0);if(!S.filter(new u.EvaluationParameters(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!S.filter(new u.EvaluationParameters(this.tileID.overscaledZ),q))continue;const j=c.getId(q,g),$=new u.GeoJSONFeature(q,E,C,P,j);$.tile=D,t.push($)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const c=u.parseCacheControl(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let p=!1;if(this.expirationTime>c)p=!1;else if(s)if(this.expirationTime<s)p=!0;else{const g=this.expirationTime-s;g?this.expirationTime=c+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!s.style.hasLayer(p))continue;const g=this.buckets[p],v=g.layers[0].sourceLayer||"_geojsonTileLayer",S=c[v],E=t[v];if(!S||!E||Object.keys(E).length===0)continue;g.update(E,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const C=s&&s.style&&s.style.getLayer(p);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<u.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=u.exported.now()+t}setDependencies(t,s){const c={};for(const p of s)c[p]=!0;this.dependencies[t]=c}hasDependency(t,s){for(const c of t){const p=this.dependencies[c];if(p){for(const g of s)if(p[g])return!0}}return!1}}class gr{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,c){const p=t.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const g={value:s,timeout:void 0};if(c!==void 0&&(g.timeout=setTimeout(()=>{this.remove(t,g)},c)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const c=t.wrapped().key,p=s===void 0?0:this.data[c].indexOf(s),g=this.data[c][p];return this.data[c].splice(p,1),g.timeout&&clearTimeout(g.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(g.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const c in this.data)for(const p of this.data[c])t(p.value)||s.push(p);for(const c of s)this.remove(c.value.tileID,c)}}class Ni{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,c){const p=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},u.extend(this.stateChanges[t][p],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==p&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const g in this.state[t][p])c[g]||(this.deletedStates[t][p][g]=null)}else for(const g in c)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][g]===null&&delete this.deletedStates[t][p][g]}removeFeatureState(t,s,c){if(this.deletedStates[t]===null)return;const p=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&s!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][c]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(c in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][c]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,s){const c=String(s),p=u.extend({},(this.state[t]||{})[c],(this.stateChanges[t]||{})[c]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const g=this.deletedStates[t][s];if(g===null)return{};for(const v in g)delete p[v]}return p}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const c={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const g={};for(const v in this.stateChanges[p])this.state[p][v]||(this.state[p][v]={}),u.extend(this.state[p][v],this.stateChanges[p][v]),g[v]=this.state[p][v];c[p]=g}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const g={};if(this.deletedStates[p]===null)for(const v in this.state[p])g[v]={},this.state[p][v]={};else for(const v in this.deletedStates[p]){if(this.deletedStates[p][v]===null)this.state[p][v]={};else for(const S of Object.keys(this.deletedStates[p][v]))delete this.state[p][v][S];g[v]=this.state[p][v]}c[p]=c[p]||{},u.extend(c[p],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const p in t)t[p].setFeatureState(c,s)}}class ir extends u.Evented{constructor(t,s,c){super(),this.id=t,this.dispatcher=c,this.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(p,g,v,S){const E=new Kt[g.type](p,g,v,S);if(E.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${E.id}`);return u.bindAll(["load","abort","unload","serialize","prepare"],E),E}(t,s,c,this),this._tiles={},this._cache=new gr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ni}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const s=this._tiles[t];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s){return this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new u.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const c=this._tiles[s];c.upload(t),c.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Fo).map(t=>t.key)}getRenderableIds(t){const s=[];for(const c in this._tiles)this._isIdRenderable(c,t)&&s.push(this._tiles[c]);return t?s.sort((c,p)=>{const g=c.tileID,v=p.tileID,S=new u.pointGeometry(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),E=new u.pointGeometry(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-v.overscaledZ||E.y-S.y||E.x-S.x}).map(c=>c.tileID.key):s.map(c=>c.tileID).sort(Fo).map(c=>c.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,s){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,t,s)))}_tileLoaded(t,s,c,p){if(p)return t.state="errored",void(p.status!==404?this._source.fire(new u.ErrorEvent(p,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=u.exported.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new u.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const s=this.getRenderableIds();for(let p=0;p<s.length;p++){const g=s[p];if(t.neighboringTiles&&t.neighboringTiles[g]){const v=this.getTileByID(g);c(t,v),c(v,t)}}function c(p,g){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let v=g.tileID.canonical.x-p.tileID.canonical.x;const S=g.tileID.canonical.y-p.tileID.canonical.y,E=Math.pow(2,p.tileID.canonical.z),C=g.tileID.key;v===0&&S===0||Math.abs(S)>1||(Math.abs(v)>1&&(Math.abs(v+E)===1?v+=E:Math.abs(v-E)===1&&(v-=E)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,v,S),p.neighboringTiles&&p.neighboringTiles[C]&&(p.neighboringTiles[C].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,c,p){for(const g in this._tiles){let v=this._tiles[g];if(p[g]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>c)continue;let S=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){const C=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[C.key],v&&v.hasData()&&(S=C)}let E=S;for(;E.overscaledZ>s;)if(E=E.scaledTo(E.overscaledZ-1),t[E.key]){p[S.key]=S;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=t.overscaledZ-1;c>=s;c--){const p=t.scaledTo(c),g=this._getLoadedTile(p);if(g)return g}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,c=Math.ceil(t.height/this._source.tileSize)+1,p=Math.floor(s*c*5),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(g)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const c={};for(const p in this._tiles){const g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+s),c[g.tileID.key]=g}this._tiles=c;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}update(t,s){if(this.transform=t,this.terrain=s,!this._sourceLoaded||this._paused)return;let c;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(C=>new u.OverscaledTileID(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y)):(c=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(c=c.filter(C=>this._source.hasTile(C)))):c=[];const p=t.coveringZoomLevel(this._source),g=Math.max(p-ir.maxOverzooming,this._source.minzoom),v=Math.max(p+ir.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const C={};for(const P of c)if(P.canonical.z>this._source.minzoom){const D=P.scaledTo(P.canonical.z-1);C[D.key]=D;const R=P.scaledTo(Math.max(this._source.minzoom,Math.min(P.canonical.z,5)));C[R.key]=R}c=c.concat(Object.values(C))}const S=this._updateRetainedTiles(c,p);if(As(this._source.type)){const C={},P={},D=Object.keys(S);for(const R of D){const q=S[R],j=this._tiles[R];if(!j||j.fadeEndTime&&j.fadeEndTime<=u.exported.now())continue;const $=this.findLoadedParent(q,g);$&&(this._addTile($.tileID),C[$.tileID.key]=$.tileID),P[R]=q}this._retainLoadedChildren(P,p,v,S);for(const R in C)S[R]||(this._coveredTiles[R]=!0,S[R]=C[R]);if(s){const R={},q={};for(const j of c)this._tiles[j.key].hasData()?R[j.key]=j:q[j.key]=j;for(const j in q){const $=q[j].children(this._source.maxzoom);this._tiles[$[0].key]&&this._tiles[$[1].key]&&this._tiles[$[2].key]&&this._tiles[$[3].key]&&(R[$[0].key]=S[$[0].key]=$[0],R[$[1].key]=S[$[1].key]=$[1],R[$[2].key]=S[$[2].key]=$[2],R[$[3].key]=S[$[3].key]=$[3],delete q[j])}for(const j in q){const $=this.findLoadedParent(q[j],this._source.minzoom);if($){R[$.tileID.key]=S[$.tileID.key]=$.tileID;for(const ee in R)R[ee].isChildOf($.tileID)&&delete R[ee]}}for(const j in this._tiles)R[j]||(this._coveredTiles[j]=!0)}}for(const C in S)this._tiles[C].clearFadeHold();const E=u.keysDifference(this._tiles,S);for(const C of E){const P=this._tiles[C];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(C)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){const c={},p={},g=Math.max(s-ir.maxOverzooming,this._source.minzoom),v=Math.max(s+ir.maxUnderzooming,this._source.minzoom),S={};for(const E of t){const C=this._addTile(E);c[E.key]=E,C.hasData()||s<this._source.maxzoom&&(S[E.key]=E)}this._retainLoadedChildren(S,s,v,c);for(const E of t){let C=this._tiles[E.key];if(C.hasData())continue;if(s+1>this._source.maxzoom){const D=E.children(this._source.maxzoom)[0],R=this.getTile(D);if(R&&R.hasData()){c[D.key]=D;continue}}else{const D=E.children(this._source.maxzoom);if(c[D[0].key]&&c[D[1].key]&&c[D[2].key]&&c[D[3].key])continue}let P=C.wasRequested();for(let D=E.overscaledZ-1;D>=g;--D){const R=E.scaledTo(D);if(p[R.key]||(p[R.key]=!0,C=this.getTile(R),!C&&P&&(C=this._addTile(R)),C&&(c[R.key]=R,P=C.wasRequested(),C.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let c,p=this._tiles[t].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){c=this._loadedParentTiles[p.key];break}s.push(p.key);const g=p.scaledTo(p.overscaledZ-1);if(c=this._getLoadedTile(g),c)break;p=g}for(const g of s)this._loadedParentTiles[g]=c}}_addTile(t){let s=this._tiles[t.key];if(s)return s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const c=s;return s||(s=new Un(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))),s.uses++,this._tiles[t.key]=s,c||this._source.fire(new u.Event("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=s.getExpiryTimeout();c&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},c))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,s,c){const p=[],g=this.transform;if(!g)return p;const v=c?g.getCameraQueryGeometry(t):t,S=t.map(j=>g.pointCoordinate(j,this.terrain)),E=v.map(j=>g.pointCoordinate(j,this.terrain)),C=this.getIds();let P=1/0,D=1/0,R=-1/0,q=-1/0;for(const j of E)P=Math.min(P,j.x),D=Math.min(D,j.y),R=Math.max(R,j.x),q=Math.max(q,j.y);for(let j=0;j<C.length;j++){const $=this._tiles[C[j]];if($.holdingForFade())continue;const ee=$.tileID,re=Math.pow(2,g.zoom-$.tileID.overscaledZ),ce=s*$.queryPadding*u.EXTENT/$.tileSize/re,W=[ee.getTilePoint(new u.MercatorCoordinate(P,D)),ee.getTilePoint(new u.MercatorCoordinate(R,q))];if(W[0].x-ce<u.EXTENT&&W[0].y-ce<u.EXTENT&&W[1].x+ce>=0&&W[1].y+ce>=0){const pe=S.map(xe=>ee.getTilePoint(xe)),he=E.map(xe=>ee.getTilePoint(xe));p.push({tile:$,tileID:ee,queryGeometry:pe,cameraQueryGeometry:he,scale:re})}}return p}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(c=>this._tiles[c].tileID);for(const c of s)c.posMatrix=this.transform.calculatePosMatrix(c.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(As(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=u.exported.now())return!0}return!1}setFeatureState(t,s,c){this._state.updateState(t=t||"_geojsonTileLayer",s,c)}removeFeatureState(t,s,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,c)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,c){const p=this._tiles[t];p&&p.setDependencies(s,c)}reloadTilesForDependencies(t,s){for(const c in this._tiles)this._tiles[c].hasDependency(t,s)&&this._reloadTile(c,"reloading");this._cache.filter(c=>!c.hasDependency(t,s))}}function Fo(h,t){const s=Math.abs(2*h.wrap)-+(h.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return h.overscaledZ-t.overscaledZ||c-s||t.canonical.y-h.canonical.y||t.canonical.x-h.canonical.x}function As(h){return h==="raster"||h==="image"||h==="video"}ir.maxOverzooming=10,ir.maxUnderzooming=3;const vi="mapboxgl_preloaded_worker_pool";class yr{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<yr.workerCount;)this.workers.push(new Worker(mo.workerUrl));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[vi]}numActive(){return Object.keys(this.active).length}}const Ps=Math.floor(u.exported.hardwareConcurrency/2);let Ui;function Oo(){return Ui||(Ui=new yr),Ui}function No(h,t){const s={};for(const c in h)c!=="ref"&&(s[c]=h[c]);return u.refProperties.forEach(c=>{c in t&&(s[c]=t[c])}),s}function zs(h){h=h.slice();const t=Object.create(null);for(let s=0;s<h.length;s++)t[h[s].id]=h[s];for(let s=0;s<h.length;s++)"ref"in h[s]&&(h[s]=No(h[s],t[h[s].ref]));return h}yr.workerCount=Math.max(Math.min(Ps,6),1);const Tt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function si(h,t,s){s.push({command:Tt.addSource,args:[h,t[h]]})}function Vi(h,t,s){t.push({command:Tt.removeSource,args:[h]}),s[h]=!0}function ji(h,t,s,c){Vi(h,s,c),si(h,t,s)}function Ms(h,t,s){let c;for(c in h[s])if(Object.prototype.hasOwnProperty.call(h[s],c)&&c!=="data"&&!oe(h[s][c],t[s][c]))return!1;for(c in t[s])if(Object.prototype.hasOwnProperty.call(t[s],c)&&c!=="data"&&!oe(h[s][c],t[s][c]))return!1;return!0}function wi(h,t,s,c,p,g){let v;for(v in t=t||{},h=h||{})Object.prototype.hasOwnProperty.call(h,v)&&(oe(h[v],t[v])||s.push({command:g,args:[c,v,t[v],p]}));for(v in t)Object.prototype.hasOwnProperty.call(t,v)&&!Object.prototype.hasOwnProperty.call(h,v)&&(oe(h[v],t[v])||s.push({command:g,args:[c,v,t[v],p]}))}function bi(h){return h.id}function Uo(h,t){return h[t.id]=t,h}class Si{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=u.clamp(t,0,1);let s=1,c=this._distances[s];const p=t*this.paddedLength+this.padding;for(;c<p&&s<this._distances.length;)c=this._distances[++s];const g=s-1,v=this._distances[g],S=c-v,E=S>0?(p-v)/S:0;return this.points[g].mult(1-E).add(this.points[s].mult(E))}}function we(h,t){let s=!0;return h==="always"||h!=="never"&&t!=="never"||(s=!1),s}class Fe{constructor(t,s,c){const p=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(s/c);for(let v=0;v<this.xCellCount*this.yCellCount;v++)p.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,c,p,g){this._forEachCell(s,c,p,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(g)}insertCircle(t,s,c,p){this._forEachCell(s-p,c-p,s+p,c+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(c),this.circles.push(p)}_insertBoxCell(t,s,c,p,g,v){this.boxCells[g].push(v)}_insertCircleCell(t,s,c,p,g,v){this.circleCells[g].push(v)}_query(t,s,c,p,g,v,S){if(c<0||t>this.width||p<0||s>this.height)return[];const E=[];if(t<=0&&s<=0&&this.width<=c&&this.height<=p){if(g)return[{key:null,x1:t,y1:s,x2:c,y2:p}];for(let C=0;C<this.boxKeys.length;C++)E.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const P=this.circles[3*C],D=this.circles[3*C+1],R=this.circles[3*C+2];E.push({key:this.circleKeys[C],x1:P-R,y1:D-R,x2:P+R,y2:D+R})}}else this._forEachCell(t,s,c,p,this._queryCell,E,{hitTest:g,overlapMode:v,seenUids:{box:{},circle:{}}},S);return E}query(t,s,c,p){return this._query(t,s,c,p,!1,null)}hitTest(t,s,c,p,g,v){return this._query(t,s,c,p,!0,g,v).length>0}hitTestCircle(t,s,c,p,g){const v=t-c,S=t+c,E=s-c,C=s+c;if(S<0||v>this.width||C<0||E>this.height)return!1;const P=[];return this._forEachCell(v,E,S,C,this._queryCellCircle,P,{hitTest:!0,overlapMode:p,circle:{x:t,y:s,radius:c},seenUids:{box:{},circle:{}}},g),P.length>0}_queryCell(t,s,c,p,g,v,S,E){const{seenUids:C,hitTest:P,overlapMode:D}=S,R=this.boxCells[g];if(R!==null){const j=this.bboxes;for(const $ of R)if(!C.box[$]){C.box[$]=!0;const ee=4*$,re=this.boxKeys[$];if(t<=j[ee+2]&&s<=j[ee+3]&&c>=j[ee+0]&&p>=j[ee+1]&&(!E||E(re))&&(!P||!we(D,re.overlapMode))&&(v.push({key:re,x1:j[ee],y1:j[ee+1],x2:j[ee+2],y2:j[ee+3]}),P))return!0}}const q=this.circleCells[g];if(q!==null){const j=this.circles;for(const $ of q)if(!C.circle[$]){C.circle[$]=!0;const ee=3*$,re=this.circleKeys[$];if(this._circleAndRectCollide(j[ee],j[ee+1],j[ee+2],t,s,c,p)&&(!E||E(re))&&(!P||!we(D,re.overlapMode))){const ce=j[ee],W=j[ee+1],pe=j[ee+2];if(v.push({key:re,x1:ce-pe,y1:W-pe,x2:ce+pe,y2:W+pe}),P)return!0}}}return!1}_queryCellCircle(t,s,c,p,g,v,S,E){const{circle:C,seenUids:P,overlapMode:D}=S,R=this.boxCells[g];if(R!==null){const j=this.bboxes;for(const $ of R)if(!P.box[$]){P.box[$]=!0;const ee=4*$,re=this.boxKeys[$];if(this._circleAndRectCollide(C.x,C.y,C.radius,j[ee+0],j[ee+1],j[ee+2],j[ee+3])&&(!E||E(re))&&!we(D,re.overlapMode))return v.push(!0),!0}}const q=this.circleCells[g];if(q!==null){const j=this.circles;for(const $ of q)if(!P.circle[$]){P.circle[$]=!0;const ee=3*$,re=this.circleKeys[$];if(this._circlesCollide(j[ee],j[ee+1],j[ee+2],C.x,C.y,C.radius)&&(!E||E(re))&&!we(D,re.overlapMode))return v.push(!0),!0}}}_forEachCell(t,s,c,p,g,v,S,E){const C=this._convertToXCellCoord(t),P=this._convertToYCellCoord(s),D=this._convertToXCellCoord(c),R=this._convertToYCellCoord(p);for(let q=C;q<=D;q++)for(let j=P;j<=R;j++)if(g.call(this,t,s,c,p,this.xCellCount*j+q,v,S,E))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,c,p,g,v){const S=p-t,E=g-s,C=c+v;return C*C>S*S+E*E}_circleAndRectCollide(t,s,c,p,g,v,S){const E=(v-p)/2,C=Math.abs(t-(p+E));if(C>E+c)return!1;const P=(S-g)/2,D=Math.abs(s-(g+P));if(D>P+c)return!1;if(C<=E||D<=P)return!0;const R=C-E,q=D-P;return R*R+q*q<=c*c}}function so(h,t,s,c,p){const g=u.create();return t?(u.scale(g,g,[1/p,1/p,1]),s||u.rotateZ(g,g,c.angle)):u.multiply(g,c.labelPlaneMatrix,h),g}function Zr(h,t,s,c,p){if(t){const g=u.clone(h);return u.scale(g,g,[p,p,1]),s||u.rotateZ(g,g,-c.angle),g}return c.glCoordMatrix}function kt(h,t,s){let c;s?(c=[h.x,h.y,s(h.x,h.y),1],u.transformMat4(c,c,t)):(c=[h.x,h.y,0,1],Ei(c,c,t));const p=c[3];return{point:new u.pointGeometry(c[0]/p,c[1]/p),signedDistanceFromCamera:p}}function Dr(h,t){return .5+h/t*.5}function _r(h,t){const s=h[0]/h[3],c=h[1]/h[3];return s>=-t[0]&&s<=t[0]&&c>=-t[1]&&c<=t[1]}function xr(h,t,s,c,p,g,v,S,E,C){const P=c?h.textSizeData:h.iconSizeData,D=u.evaluateSizeForZoom(P,s.transform.zoom),R=[256/s.width*2+1,256/s.height*2+1],q=c?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;q.clear();const j=h.lineVertexArray,$=c?h.text.placedSymbolArray:h.icon.placedSymbolArray,ee=s.transform.width/s.transform.height;let re=!1;for(let ce=0;ce<$.length;ce++){const W=$.get(ce);if(W.hidden||W.writingMode===u.WritingMode.vertical&&!re){dt(W.numGlyphs,q);continue}let pe;if(re=!1,C?(pe=[W.anchorX,W.anchorY,C(W.anchorX,W.anchorY),1],u.transformMat4(pe,pe,t)):(pe=[W.anchorX,W.anchorY,0,1],Ei(pe,pe,t)),!_r(pe,R)){dt(W.numGlyphs,q);continue}const he=Dr(s.transform.cameraToCenterDistance,pe[3]),xe=u.evaluateSizeForFeature(P,D,W),ve=v?xe/he:xe*he,Ie=new u.pointGeometry(W.anchorX,W.anchorY),ye=kt(Ie,p,C).point,$e={},Le=gt(W,ve,!1,S,t,p,g,h.glyphOffsetArray,j,q,ye,Ie,$e,ee,E,C);re=Le.useVertical,(Le.notEnoughRoom||re||Le.needsFlipping&&gt(W,ve,!0,S,t,p,g,h.glyphOffsetArray,j,q,ye,Ie,$e,ee,E,C).notEnoughRoom)&&dt(W.numGlyphs,q)}c?h.text.dynamicLayoutVertexBuffer.updateData(q):h.icon.dynamicLayoutVertexBuffer.updateData(q)}function $i(h,t,s,c,p,g,v,S,E,C,P,D,R){const q=S.glyphStartIndex+S.numGlyphs,j=S.lineStartIndex,$=S.lineStartIndex+S.lineLength,ee=t.getoffsetX(S.glyphStartIndex),re=t.getoffsetX(q-1),ce=Ln(h*ee,s,c,p,g,v,S.segment,j,$,E,C,P,D,R);if(!ce)return null;const W=Ln(h*re,s,c,p,g,v,S.segment,j,$,E,C,P,D,R);return W?{first:ce,last:W}:null}function De(h,t,s,c){return h===u.WritingMode.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*c?{useVertical:!0}:(h===u.WritingMode.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function gt(h,t,s,c,p,g,v,S,E,C,P,D,R,q,j,$){const ee=t/24,re=h.lineOffsetX*ee,ce=h.lineOffsetY*ee;let W;if(h.numGlyphs>1){const pe=h.glyphStartIndex+h.numGlyphs,he=h.lineStartIndex,xe=h.lineStartIndex+h.lineLength,ve=$i(ee,S,re,ce,s,P,D,h,E,g,R,j,$);if(!ve)return{notEnoughRoom:!0};const Ie=kt(ve.first.point,v,$).point,ye=kt(ve.last.point,v,$).point;if(c&&!s){const $e=De(h.writingMode,Ie,ye,q);if($e)return $e}W=[ve.first];for(let $e=h.glyphStartIndex+1;$e<pe-1;$e++)W.push(Ln(ee*S.getoffsetX($e),re,ce,s,P,D,h.segment,he,xe,E,g,R,j,$));W.push(ve.last)}else{if(c&&!s){const he=kt(D,p,$).point,xe=h.lineStartIndex+h.segment+1,ve=new u.pointGeometry(E.getx(xe),E.gety(xe)),Ie=kt(ve,p,$),ye=Ie.signedDistanceFromCamera>0?Ie.point:pt(D,ve,he,1,p,$),$e=De(h.writingMode,he,ye,q);if($e)return $e}const pe=Ln(ee*S.getoffsetX(h.glyphStartIndex),re,ce,s,P,D,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,E,g,R,j,$);if(!pe)return{notEnoughRoom:!0};W=[pe]}for(const pe of W)u.addDynamicAttributes(C,pe.point,pe.angle);return{}}function pt(h,t,s,c,p,g){const v=kt(h.add(h.sub(t)._unit()),p,g).point,S=s.sub(v);return s.add(S._mult(c/S.mag()))}function Ln(h,t,s,c,p,g,v,S,E,C,P,D,R,q){const j=c?h-t:h+t;let $=j>0?1:-1,ee=0;c&&($*=-1,ee=Math.PI),$<0&&(ee+=Math.PI);let re=$>0?S+v:S+v+1,ce=p,W=p,pe=0,he=0;const xe=Math.abs(j),ve=[];for(;pe+he<=xe;){if(re+=$,re<S||re>=E)return null;if(W=ce,ve.push(ce),ce=D[re],ce===void 0){const Ge=new u.pointGeometry(C.getx(re),C.gety(re)),ft=kt(Ge,P,q);if(ft.signedDistanceFromCamera>0)ce=D[re]=ft.point;else{const _t=re-$;ce=pt(pe===0?g:new u.pointGeometry(C.getx(_t),C.gety(_t)),Ge,W,xe-pe+1,P,q)}}pe+=he,he=W.dist(ce)}const Ie=(xe-pe)/he,ye=ce.sub(W),$e=ye.mult(Ie)._add(W);$e._add(ye._unit()._perp()._mult(s*$));const Le=ee+Math.atan2(ce.y-W.y,ce.x-W.x);return ve.push($e),{point:$e,angle:R?Le:0,path:ve}}const Gi=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function dt(h,t){for(let s=0;s<h;s++){const c=t.length;t.resize(c+4),t.float32.set(Gi,3*c)}}function Ei(h,t,s){const c=t[0],p=t[1];return h[0]=s[0]*c+s[4]*p+s[12],h[1]=s[1]*c+s[5]*p+s[13],h[3]=s[3]*c+s[7]*p+s[15],h}const kn=100;class Vo{constructor(t,s=new Fe(t.width+200,t.height+200,25),c=new Fe(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=c,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+kn,this.screenBottomBoundary=t.height+kn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,c,p,g,v){const S=this.projectAndGetPerspectiveRatio(p,t.anchorPointX,t.anchorPointY,v),E=c*S.perspectiveRatio,C=t.x1*E+S.point.x,P=t.y1*E+S.point.y,D=t.x2*E+S.point.x,R=t.y2*E+S.point.y;return!this.isInsideGrid(C,P,D,R)||s!=="always"&&this.grid.hitTest(C,P,D,R,s,g)||S.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[C,P,D,R],offscreen:this.isOffscreen(C,P,D,R)}}placeCollisionCircles(t,s,c,p,g,v,S,E,C,P,D,R,q,j){const $=[],ee=new u.pointGeometry(s.anchorX,s.anchorY),re=kt(ee,v,j),ce=Dr(this.transform.cameraToCenterDistance,re.signedDistanceFromCamera),W=(P?g/ce:g*ce)/u.ONE_EM,pe=kt(ee,S,j).point,he=$i(W,p,s.lineOffsetX*W,s.lineOffsetY*W,!1,pe,ee,s,c,S,{},!1,j);let xe=!1,ve=!1,Ie=!0;if(he){const ye=.5*R*ce+q,$e=new u.pointGeometry(-100,-100),Le=new u.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ge=new Si,ft=he.first,_t=he.last;let rt=[];for(let Et=ft.path.length-1;Et>=1;Et--)rt.push(ft.path[Et]);for(let Et=1;Et<_t.path.length;Et++)rt.push(_t.path[Et]);const Lt=2.5*ye;if(E){const Et=rt.map(At=>kt(At,E,j));rt=Et.some(At=>At.signedDistanceFromCamera<=0)?[]:Et.map(At=>At.point)}let Rt=[];if(rt.length>0){const Et=rt[0].clone(),At=rt[0].clone();for(let Nt=1;Nt<rt.length;Nt++)Et.x=Math.min(Et.x,rt[Nt].x),Et.y=Math.min(Et.y,rt[Nt].y),At.x=Math.max(At.x,rt[Nt].x),At.y=Math.max(At.y,rt[Nt].y);Rt=Et.x>=$e.x&&At.x<=Le.x&&Et.y>=$e.y&&At.y<=Le.y?[rt]:At.x<$e.x||Et.x>Le.x||At.y<$e.y||Et.y>Le.y?[]:u.clipLine([rt],$e.x,$e.y,Le.x,Le.y)}for(const Et of Rt){Ge.reset(Et,.25*ye);let At=0;At=Ge.length<=.5*ye?1:Math.ceil(Ge.paddedLength/Lt)+1;for(let Nt=0;Nt<At;Nt++){const In=Nt/Math.max(At-1,1),ci=Ge.lerp(In),Hr=ci.x+kn,hi=ci.y+kn;$.push(Hr,hi,ye,0);const Ji=Hr-ye,Rr=hi-ye,sr=Hr+ye,Ci=hi+ye;if(Ie=Ie&&this.isOffscreen(Ji,Rr,sr,Ci),ve=ve||this.isInsideGrid(Ji,Rr,sr,Ci),t!=="always"&&this.grid.hitTestCircle(Hr,hi,ye,t,D)&&(xe=!0,!C))return{circles:[],offscreen:!1,collisionDetected:xe}}}}return{circles:!C&&xe||!ve||ce<this.perspectiveRatioCutoff?[]:$,offscreen:Ie,collisionDetected:xe}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let c=1/0,p=1/0,g=-1/0,v=-1/0;for(const P of t){const D=new u.pointGeometry(P.x+kn,P.y+kn);c=Math.min(c,D.x),p=Math.min(p,D.y),g=Math.max(g,D.x),v=Math.max(v,D.y),s.push(D)}const S=this.grid.query(c,p,g,v).concat(this.ignoredGrid.query(c,p,g,v)),E={},C={};for(const P of S){const D=P.key;if(E[D.bucketInstanceId]===void 0&&(E[D.bucketInstanceId]={}),E[D.bucketInstanceId][D.featureIndex])continue;const R=[new u.pointGeometry(P.x1,P.y1),new u.pointGeometry(P.x2,P.y1),new u.pointGeometry(P.x2,P.y2),new u.pointGeometry(P.x1,P.y2)];u.polygonIntersectsPolygon(s,R)&&(E[D.bucketInstanceId][D.featureIndex]=!0,C[D.bucketInstanceId]===void 0&&(C[D.bucketInstanceId]=[]),C[D.bucketInstanceId].push(D.featureIndex))}return C}insertCollisionBox(t,s,c,p,g,v){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:g,collisionGroupID:v,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,c,p,g,v){const S=c?this.ignoredGrid:this.grid,E={bucketInstanceId:p,featureIndex:g,collisionGroupID:v,overlapMode:s};for(let C=0;C<t.length;C+=4)S.insertCircle(E,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,s,c,p){let g;return p?(g=[s,c,p(s,c),1],u.transformMat4(g,g,t)):(g=[s,c,0,1],Ei(g,g,t)),{point:new u.pointGeometry((g[0]/g[3]+1)/2*this.transform.width+kn,(-g[1]/g[3]+1)/2*this.transform.height+kn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}}isOffscreen(t,s,c,p){return c<kn||t>=this.screenRightBoundary||p<kn||s>this.screenBottomBoundary}isInsideGrid(t,s,c,p){return c>=0&&t<this.gridRightBoundary&&p>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=u.identity([]);return u.translate(t,t,[-100,-100,0]),t}}function gn(h,t,s){return t*(u.EXTENT/(h.tileSize*Math.pow(2,s-h.tileID.overscaledZ)))}class Xn{constructor(t,s,c,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):p&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class Ot{constructor(t,s,c,p,g){this.text=new Xn(t?t.text:null,s,c,g),this.icon=new Xn(t?t.icon:null,s,p,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class jo{constructor(t,s,c){this.text=t,this.icon=s,this.skipFade=c}}class ai{constructor(){this.invProjMatrix=u.create(),this.viewportMatrix=u.create(),this.circles=[]}}class ao{constructor(t,s,c,p,g){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=c,this.bucketIndex=p,this.tileID=g}}class lo{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:c=>c.collisionGroupID===s}}return this.collisionGroups[t]}}function $o(h,t,s,c,p){const{horizontalAlign:g,verticalAlign:v}=u.getAnchorAlignment(h),S=-(g-.5)*t,E=-(v-.5)*s,C=u.evaluateVariableOffset(h,c);return new u.pointGeometry(S+C[0]*p,E+C[1]*p)}function uo(h,t,s,c,p,g){const{x1:v,x2:S,y1:E,y2:C,anchorPointX:P,anchorPointY:D}=h,R=new u.pointGeometry(t,s);return c&&R._rotate(p?g:-g),{x1:v+R.x,y1:E+R.y,x2:S+R.x,y2:C+R.y,anchorPointX:P,anchorPointY:D}}class V{constructor(t,s,c,p,g){this.transform=t.clone(),this.terrain=s,this.collisionIndex=new Vo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new lo(p),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,c,p){const g=c.getBucket(s),v=c.latestFeatureIndex;if(!g||!v||s.id!==g.layerIds[0])return;const S=c.collisionBoxArray,E=g.layers[0].layout,C=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),P=c.tileSize/u.EXTENT,D=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),R=E.get("text-pitch-alignment")==="map",q=E.get("text-rotation-alignment")==="map",j=gn(c,1,this.transform.zoom),$=so(D,R,q,this.transform,j);let ee=null;if(R){const ce=Zr(D,R,q,this.transform,j);ee=u.multiply([],this.transform.labelPlaneMatrix,ce)}this.retainedQueryData[g.bucketInstanceId]=new ao(g.bucketInstanceId,v,g.sourceLayerIndex,g.index,c.tileID);const re={bucket:g,layout:E,posMatrix:D,textLabelPlaneMatrix:$,labelToScreenMatrix:ee,scale:C,textPixelRatio:P,holdingForFade:c.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:u.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(p)for(const ce of g.sortKeyRanges){const{sortKey:W,symbolInstanceStart:pe,symbolInstanceEnd:he}=ce;t.push({sortKey:W,symbolInstanceStart:pe,symbolInstanceEnd:he,parameters:re})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:re})}attemptAnchorPlacement(t,s,c,p,g,v,S,E,C,P,D,R,q,j,$,ee){const re=[R.textOffset0,R.textOffset1],ce=$o(t,c,p,re,g),W=this.collisionIndex.placeCollisionBox(uo(s,ce.x,ce.y,v,S,this.transform.angle),D,E,C,P.predicate,ee);if((!$||this.collisionIndex.placeCollisionBox(uo($,ce.x,ce.y,v,S,this.transform.angle),D,E,C,P.predicate,ee).box.length!==0)&&W.box.length>0){let pe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[R.crossTileID]&&this.prevPlacement.placements[R.crossTileID]&&this.prevPlacement.placements[R.crossTileID].text&&(pe=this.prevPlacement.variableOffsets[R.crossTileID].anchor),R.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[R.crossTileID]={textOffset:re,width:c,height:p,anchor:t,textBoxScale:g,prevAnchor:pe},this.markUsedJustification(q,t,R,j),q.allowVerticalPlacement&&(this.markUsedOrientation(q,j,R),this.placedOrientations[R.crossTileID]=j),{shift:ce,placedGlyphBoxes:W}}}placeLayerBucketPart(t,s,c){const{bucket:p,layout:g,posMatrix:v,textLabelPlaneMatrix:S,labelToScreenMatrix:E,textPixelRatio:C,holdingForFade:P,collisionBoxArray:D,partiallyEvaluatedTextSize:R,collisionGroup:q}=t.parameters,j=g.get("text-optional"),$=g.get("icon-optional"),ee=u.getOverlapMode(g,"text-overlap","text-allow-overlap"),re=ee==="always",ce=u.getOverlapMode(g,"icon-overlap","icon-allow-overlap"),W=ce==="always",pe=g.get("text-rotation-alignment")==="map",he=g.get("text-pitch-alignment")==="map",xe=g.get("icon-text-fit")!=="none",ve=g.get("symbol-z-order")==="viewport-y",Ie=re&&(W||!p.hasIconData()||$),ye=W&&(re||!p.hasTextData()||j);!p.collisionArrays&&D&&p.deserializeCollisionBoxes(D);const $e=(Le,Ge)=>{if(s[Le.crossTileID])return;if(P)return void(this.placements[Le.crossTileID]=new jo(!1,!1,!1));let ft=!1,_t=!1,rt=!0,Lt=null,Rt={box:null,offscreen:null},Et={box:null,offscreen:null},At=null,Nt=null,In=null,ci=0,Hr=0,hi=0;Ge.textFeatureIndex?ci=Ge.textFeatureIndex:Le.useRuntimeCollisionCircles&&(ci=Le.featureIndex),Ge.verticalTextFeatureIndex&&(Hr=Ge.verticalTextFeatureIndex);const Ji=this.retainedQueryData[p.bucketInstanceId].tileID,Rr=this.terrain?(bn,vt)=>this.terrain.getElevation(Ji,bn,vt):null;for(const bn of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const vt=Ge[bn];vt&&(vt.elevation=Rr?Rr(vt.anchorPointX,vt.anchorPointY):0)}const sr=Ge.textBox;if(sr){const bn=Dt=>{let An=u.WritingMode.horizontal;if(p.allowVerticalPlacement&&!Dt&&this.prevPlacement){const Pn=this.prevPlacement.placedOrientations[Le.crossTileID];Pn&&(this.placedOrientations[Le.crossTileID]=Pn,An=Pn,this.markUsedOrientation(p,An,Le))}return An},vt=(Dt,An)=>{if(p.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&Ge.verticalTextBox){for(const Pn of p.writingModes)if(Pn===u.WritingMode.vertical?(Rt=An(),Et=Rt):Rt=Dt(),Rt&&Rt.box&&Rt.box.length)break}else Rt=Dt()};if(g.get("text-variable-anchor")){let Dt=g.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Le.crossTileID]){const tn=this.prevPlacement.variableOffsets[Le.crossTileID];Dt.indexOf(tn.anchor)>0&&(Dt=Dt.filter(Br=>Br!==tn.anchor),Dt.unshift(tn.anchor))}const An=(tn,Br,go)=>{const cu=tn.x2-tn.x1,ns=tn.y2-tn.y1,sh=Le.textBoxScale,hu=xe&&ce==="never"?Br:null;let Yi={box:[],offscreen:!1};const yo=ee!=="never"?2*Dt.length:Dt.length;for(let _o=0;_o<yo;++_o){const Ga=this.attemptAnchorPlacement(Dt[_o%Dt.length],tn,cu,ns,sh,pe,he,C,v,q,_o>=Dt.length?ee:"never",Le,p,go,hu,Rr);if(Ga&&(Yi=Ga.placedGlyphBoxes,Yi&&Yi.box&&Yi.box.length)){ft=!0,Lt=Ga.shift;break}}return Yi};vt(()=>An(sr,Ge.iconBox,u.WritingMode.horizontal),()=>{const tn=Ge.verticalTextBox;return p.allowVerticalPlacement&&!(Rt&&Rt.box&&Rt.box.length)&&Le.numVerticalGlyphVertices>0&&tn?An(tn,Ge.verticalIconBox,u.WritingMode.vertical):{box:null,offscreen:null}}),Rt&&(ft=Rt.box,rt=Rt.offscreen);const Pn=bn(Rt&&Rt.box);if(!ft&&this.prevPlacement){const tn=this.prevPlacement.variableOffsets[Le.crossTileID];tn&&(this.variableOffsets[Le.crossTileID]=tn,this.markUsedJustification(p,tn.anchor,Le,Pn))}}else{const Dt=(An,Pn)=>{const tn=this.collisionIndex.placeCollisionBox(An,ee,C,v,q.predicate,Rr);return tn&&tn.box&&tn.box.length&&(this.markUsedOrientation(p,Pn,Le),this.placedOrientations[Le.crossTileID]=Pn),tn};vt(()=>Dt(sr,u.WritingMode.horizontal),()=>{const An=Ge.verticalTextBox;return p.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&An?Dt(An,u.WritingMode.vertical):{box:null,offscreen:null}}),bn(Rt&&Rt.box&&Rt.box.length)}}if(At=Rt,ft=At&&At.box&&At.box.length>0,rt=At&&At.offscreen,Le.useRuntimeCollisionCircles){const bn=p.text.placedSymbolArray.get(Le.centerJustifiedTextSymbolIndex),vt=u.evaluateSizeForFeature(p.textSizeData,R,bn),Dt=g.get("text-padding");Nt=this.collisionIndex.placeCollisionCircles(ee,bn,p.lineVertexArray,p.glyphOffsetArray,vt,v,S,E,c,he,q.predicate,Le.collisionCircleDiameter,Dt,Rr),Nt.circles.length&&Nt.collisionDetected&&!c&&u.warnOnce("Collisions detected, but collision boxes are not shown"),ft=re||Nt.circles.length>0&&!Nt.collisionDetected,rt=rt&&Nt.offscreen}if(Ge.iconFeatureIndex&&(hi=Ge.iconFeatureIndex),Ge.iconBox){const bn=vt=>{const Dt=xe&&Lt?uo(vt,Lt.x,Lt.y,pe,he,this.transform.angle):vt;return this.collisionIndex.placeCollisionBox(Dt,ce,C,v,q.predicate,Rr)};Et&&Et.box&&Et.box.length&&Ge.verticalIconBox?(In=bn(Ge.verticalIconBox),_t=In.box.length>0):(In=bn(Ge.iconBox),_t=In.box.length>0),rt=rt&&In.offscreen}const Ci=j||Le.numHorizontalGlyphVertices===0&&Le.numVerticalGlyphVertices===0,$a=$||Le.numIconVertices===0;if(Ci||$a?$a?Ci||(_t=_t&&ft):ft=_t&&ft:_t=ft=_t&&ft,ft&&At&&At.box&&this.collisionIndex.insertCollisionBox(At.box,ee,g.get("text-ignore-placement"),p.bucketInstanceId,Et&&Et.box&&Hr?Hr:ci,q.ID),_t&&In&&this.collisionIndex.insertCollisionBox(In.box,ce,g.get("icon-ignore-placement"),p.bucketInstanceId,hi,q.ID),Nt&&(ft&&this.collisionIndex.insertCollisionCircles(Nt.circles,ee,g.get("text-ignore-placement"),p.bucketInstanceId,ci,q.ID),c)){const bn=p.bucketInstanceId;let vt=this.collisionCircleArrays[bn];vt===void 0&&(vt=this.collisionCircleArrays[bn]=new ai);for(let Dt=0;Dt<Nt.circles.length;Dt+=4)vt.circles.push(Nt.circles[Dt+0]),vt.circles.push(Nt.circles[Dt+1]),vt.circles.push(Nt.circles[Dt+2]),vt.circles.push(Nt.collisionDetected?1:0)}if(Le.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Le.crossTileID]=new jo(ft||Ie,_t||ye,rt||p.justReloaded),s[Le.crossTileID]=!0};if(ve){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Le=p.getSortedSymbolIndexes(this.transform.angle);for(let Ge=Le.length-1;Ge>=0;--Ge){const ft=Le[Ge];$e(p.symbolInstances.get(ft),p.collisionArrays[ft])}}else for(let Le=t.symbolInstanceStart;Le<t.symbolInstanceEnd;Le++)$e(p.symbolInstances.get(Le),p.collisionArrays[Le]);if(c&&p.bucketInstanceId in this.collisionCircleArrays){const Le=this.collisionCircleArrays[p.bucketInstanceId];u.invert(Le.invProjMatrix,v),Le.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}markUsedJustification(t,s,c,p){let g;g=p===u.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[u.getAnchorJustification(s)];const v=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const S of v)S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=g>=0&&S!==g?0:c.crossTileID)}markUsedOrientation(t,s,c){const p=s===u.WritingMode.horizontal||s===u.WritingMode.horizontalOnly?s:0,g=s===u.WritingMode.vertical?s:0,v=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const S of v)t.text.placedSymbolArray.get(S).placedOrientation=p;c.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let c=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const p=s?s.symbolFadeChange(t):1,g=s?s.opacities:{},v=s?s.variableOffsets:{},S=s?s.placedOrientations:{};for(const E in this.placements){const C=this.placements[E],P=g[E];P?(this.opacities[E]=new Ot(P,p,C.text,C.icon),c=c||C.text!==P.text.placed||C.icon!==P.icon.placed):(this.opacities[E]=new Ot(null,p,C.text,C.icon,C.skipFade),c=c||C.text||C.icon)}for(const E in g){const C=g[E];if(!this.opacities[E]){const P=new Ot(C,p,!1,!1);P.isHidden()||(this.opacities[E]=P,c=c||C.text.placed||C.icon.placed)}}for(const E in v)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=v[E]);for(const E in S)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=S[E]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const c={};for(const p of s){const g=p.getBucket(t);g&&p.latestFeatureIndex&&t.id===g.layerIds[0]&&this.updateBucketOpacities(g,c,p.collisionBoxArray)}}updateBucketOpacities(t,s,c){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const p=t.layers[0].layout,g=new Ot(null,0,!1,!1,!0),v=p.get("text-allow-overlap"),S=p.get("icon-allow-overlap"),E=p.get("text-variable-anchor"),C=p.get("text-rotation-alignment")==="map",P=p.get("text-pitch-alignment")==="map",D=p.get("icon-text-fit")!=="none",R=new Ot(null,0,v&&(S||!t.hasIconData()||p.get("icon-optional")),S&&(v||!t.hasTextData()||p.get("text-optional")),!0);!t.collisionArrays&&c&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(c);const q=(j,$,ee)=>{for(let re=0;re<$/4;re++)j.opacityVertexArray.emplaceBack(ee)};for(let j=0;j<t.symbolInstances.length;j++){const $=t.symbolInstances.get(j),{numHorizontalGlyphVertices:ee,numVerticalGlyphVertices:re,crossTileID:ce}=$;let W=this.opacities[ce];s[ce]?W=g:W||(W=R,this.opacities[ce]=W),s[ce]=!0;const pe=$.numIconVertices>0,he=this.placedOrientations[$.crossTileID],xe=he===u.WritingMode.vertical,ve=he===u.WritingMode.horizontal||he===u.WritingMode.horizontalOnly;if(ee>0||re>0){const Ie=ne(W.text);q(t.text,ee,xe?ge:Ie),q(t.text,re,ve?ge:Ie);const ye=W.text.isHidden();[$.rightJustifiedTextSymbolIndex,$.centerJustifiedTextSymbolIndex,$.leftJustifiedTextSymbolIndex].forEach(Ge=>{Ge>=0&&(t.text.placedSymbolArray.get(Ge).hidden=ye||xe?1:0)}),$.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get($.verticalPlacedTextSymbolIndex).hidden=ye||ve?1:0);const $e=this.variableOffsets[$.crossTileID];$e&&this.markUsedJustification(t,$e.anchor,$,he);const Le=this.placedOrientations[$.crossTileID];Le&&(this.markUsedJustification(t,"left",$,Le),this.markUsedOrientation(t,Le,$))}if(pe){const Ie=ne(W.icon),ye=!(D&&$.verticalPlacedIconSymbolIndex&&xe);$.placedIconSymbolIndex>=0&&(q(t.icon,$.numIconVertices,ye?Ie:ge),t.icon.placedSymbolArray.get($.placedIconSymbolIndex).hidden=W.icon.isHidden()),$.verticalPlacedIconSymbolIndex>=0&&(q(t.icon,$.numVerticalIconVertices,ye?ge:Ie),t.icon.placedSymbolArray.get($.verticalPlacedIconSymbolIndex).hidden=W.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ie=t.collisionArrays[j];if(Ie){let ye=new u.pointGeometry(0,0);if(Ie.textBox||Ie.verticalTextBox){let Le=!0;if(E){const Ge=this.variableOffsets[ce];Ge?(ye=$o(Ge.anchor,Ge.width,Ge.height,Ge.textOffset,Ge.textBoxScale),C&&ye._rotate(P?this.transform.angle:-this.transform.angle)):Le=!1}Ie.textBox&&I(t.textCollisionBox.collisionVertexArray,W.text.placed,!Le||xe,ye.x,ye.y),Ie.verticalTextBox&&I(t.textCollisionBox.collisionVertexArray,W.text.placed,!Le||ve,ye.x,ye.y)}const $e=Boolean(!ve&&Ie.verticalIconBox);Ie.iconBox&&I(t.iconCollisionBox.collisionVertexArray,W.icon.placed,$e,D?ye.x:0,D?ye.y:0),Ie.verticalIconBox&&I(t.iconCollisionBox.collisionVertexArray,W.icon.placed,!$e,D?ye.x:0,D?ye.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const j=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=j.invProjMatrix,t.placementViewportMatrix=j.viewportMatrix,t.collisionCircleArray=j.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const c=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function I(h,t,s,c,p){h.emplaceBack(t?1:0,s?1:0,c||0,p||0),h.emplaceBack(t?1:0,s?1:0,c||0,p||0),h.emplaceBack(t?1:0,s?1:0,c||0,p||0),h.emplaceBack(t?1:0,s?1:0,c||0,p||0)}const M=Math.pow(2,25),O=Math.pow(2,24),U=Math.pow(2,17),K=Math.pow(2,16),te=Math.pow(2,9),Y=Math.pow(2,8),J=Math.pow(2,1);function ne(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const t=h.placed?1:0,s=Math.floor(127*h.opacity);return s*M+t*O+s*U+t*K+s*te+t*Y+s*J+t}const ge=0;class Ce{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,c,p,g){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(v,p,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((S,E)=>S.sortKey-E.sortKey));this._currentPartIndex<v.length;)if(s.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,g())return!0;return!1}}class me{constructor(t,s,c,p,g,v,S,E){this.placement=new V(t,s,v,S,E),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,s,c){const p=u.exported.now(),g=()=>{const v=u.exported.now()-p;return!this._forceFullPlacement&&v>2};for(;this._currentPlacementIndex>=0;){const v=s[t[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=S)&&(!v.maxzoom||v.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Ce(v)),this._inProgressLayer.continuePlacement(c[v.source],this.placement,this._showCollisionBoxes,v,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const He=512/u.EXTENT/2;class Je{constructor(t,s,c){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(let p=0;p<s.length;p++){const g=s.get(p),v=g.key;this.indexedSymbolInstances[v]||(this.indexedSymbolInstances[v]=[]),this.indexedSymbolInstances[v].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,t)})}}getScaledCoordinates(t,s){const c=He/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*u.EXTENT+t.anchorX)*c),y:Math.floor((s.canonical.y*u.EXTENT+t.anchorY)*c)}}findMatches(t,s,c){const p=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let g=0;g<t.length;g++){const v=t.get(g);if(v.crossTileID)continue;const S=this.indexedSymbolInstances[v.key];if(!S)continue;const E=this.getScaledCoordinates(v,s);for(const C of S)if(Math.abs(C.coord.x-E.x)<=p&&Math.abs(C.coord.y-E.y)<=p&&!c[C.crossTileID]){c[C.crossTileID]=!0,v.crossTileID=C.crossTileID;break}}}}class je{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ot{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const c in this.indexes){const p=this.indexes[c],g={};for(const v in p){const S=p[v];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+s),g[S.tileID.key]=S}this.indexes[c]=g}this.lng=t}addBucket(t,s,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<s.symbolInstances.length;g++)s.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const p=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const v=this.indexes[g];if(Number(g)>t.overscaledZ)for(const S in v){const E=v[S];E.tileID.isChildOf(t)&&E.findMatches(s.symbolInstances,t,p)}else{const S=v[t.scaledTo(Number(g)).key];S&&S.findMatches(s.symbolInstances,t,p)}}for(let g=0;g<s.symbolInstances.length;g++){const v=s.symbolInstances.get(g);v.crossTileID||(v.crossTileID=c.generate(),p[v.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Je(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const c in s.indexedSymbolInstances)for(const p of s.indexedSymbolInstances[c])delete this.usedCrossTileIDs[t][p.crossTileID]}removeStaleBuckets(t){let s=!1;for(const c in this.indexes){const p=this.indexes[c];for(const g in p)t[p[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,p[g]),delete p[g],s=!0)}return s}}class ut{constructor(){this.layerIndexes={},this.crossTileIDs=new je,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,c){let p=this.layerIndexes[t.id];p===void 0&&(p=this.layerIndexes[t.id]=new ot);let g=!1;const v={};p.handleWrapJump(c);for(const S of s){const E=S.getBucket(t);E&&t.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(S.tileID,E,this.crossTileIDs)&&(g=!0),v[E.bucketInstanceId]=!0)}return p.removeStaleBuckets(v)&&(g=!0),g}pruneUnusedLayers(t){const s={};t.forEach(c=>{s[c]=!0});for(const c in this.layerIndexes)s[c]||delete this.layerIndexes[c]}}var Ct=u.createLayout([{name:"a_pos",type:"Int16",components:2}]);class ht extends u.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=t._cache.max,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const t in this._tiles){const s=this._tiles[t];s.textures.forEach(c=>c.destroy()),s.textures=[]}}update(t,s){this.sourceCache.update(t,s),this._renderableTilesKeys=[];for(const c of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),u.ortho(c.posMatrix,0,u.EXTENT,0,u.EXTENT,0,1),this._tiles[c.key]=new Un(c,this.tileSize))}removeOutdated(t){const s={};this.renderHistory=this.renderHistory.filter((c,p)=>this.renderHistory.indexOf(c)===p).slice(0,this.renderHistorySize);for(const c of this._renderableTilesKeys)s[c]=!0;for(const c of this.renderHistory)s[c]=!0;for(const c in this._tiles)s[c]||(this._tiles[c].clearTextures(t),delete this._tiles[c])}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const s={};for(const c of this._renderableTilesKeys){const p=this._tiles[c].tileID;if(p.canonical.equals(t.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16),u.ortho(g.posMatrix,0,u.EXTENT,0,u.EXTENT,0,1),s[c]=g}else if(p.canonical.isChildOf(t.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16);const v=p.canonical.z-t.canonical.z,S=p.canonical.x-(p.canonical.x>>v<<v),E=p.canonical.y-(p.canonical.y>>v<<v),C=u.EXTENT>>v;u.ortho(g.posMatrix,0,C,0,C,0,1),u.translate(g.posMatrix,g.posMatrix,[-S*C,-E*C,0]),s[c]=g}else if(t.canonical.isChildOf(p.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16);const v=t.canonical.z-p.canonical.z,S=t.canonical.x-(t.canonical.x>>v<<v),E=t.canonical.y-(t.canonical.y>>v<<v),C=u.EXTENT>>v;u.ortho(g.posMatrix,0,u.EXTENT,0,u.EXTENT,0,1),u.translate(g.posMatrix,g.posMatrix,[S*C,E*C,0]),u.scale(g.posMatrix,g.posMatrix,[1/2**v,1/2**v,0]),s[c]=g}}return s}getSourceTile(t,s){const c=this.sourceCache._source;let p=t.overscaledZ-this.deltaZoom;if(p>c.maxzoom&&(p=c.maxzoom),p<c.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(p).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!g||!g.dem)&&s)for(;p>=c.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(t.scaledTo(p--).key);return g}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(s=>s.timeLoaded>=t)}}class yt{constructor(t,s,c){this.style=t,this.sourceCache=new ht(s),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.elevationOffset=typeof c.elevationOffset=="number"?c.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(t,s,c,p=u.EXTENT){if(!(s>=0&&s<p&&c>=0&&c<p))return this.elevationOffset;let g=0;const v=this.getTerrainData(t);if(v.tile&&v.tile.dem){const S=u.transformMat4$1([],[s/p*u.EXTENT,c/p*u.EXTENT],v.u_terrain_matrix),E=[S[0]*v.tile.dem.dim,S[1]*v.tile.dem.dim],C=[Math.floor(E[0]),Math.floor(E[1])],P=v.tile.dem.get(C[0],C[1]),D=v.tile.dem.get(C[0],C[1]+1),R=v.tile.dem.get(C[0]+1,C[1]),q=v.tile.dem.get(C[0]+1,C[1]+1);g=u.number(u.number(P,D,E[0]-C[0]),u.number(R,q,E[0]-C[0]),E[1]-C[1])}return g}rememberForRerender(t,s){for(const c in this.sourceCache._tiles){const p=this.sourceCache._tiles[c];(p.tileID.equals(s)||p.tileID.isChildOf(s))&&(t===this.sourceCache.sourceCache.id&&(p.timeLoaded=Date.now()),this._rerender[t]=this._rerender[t]||{},this._rerender[t][p.tileID.key]=!0)}}needsRerender(t,s){return this._rerender[t]&&this._rerender[t][s.key]}clearRerenderCache(){this._rerender={}}getElevation(t,s,c,p=u.EXTENT){return(this.getDEMElevation(t,s,c,p)+this.elevationOffset)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const p=this.style.map.painter.context,g=new u.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new be(p,g,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new be(p,new u.RGBAImage({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.identity([])}const s=this.sourceCache.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const p=this.style.map.painter.context;s.demTexture=this.style.map.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new be(p,s.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),s.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const c=s&&s+s.tileID.key+t.key;if(c&&!this._demMatrixCache[c]){const p=this.sourceCache.sourceCache._source.maxzoom;let g=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=p?g=t.canonical.z-p:u.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=t.canonical.x-(t.canonical.x>>g<<g),S=t.canonical.y-(t.canonical.y>>g<<g),E=u.fromScaling(new Float64Array(16),[1/(u.EXTENT<<g),1/(u.EXTENT<<g),0]);u.translate(E,E,[v*u.EXTENT,S*u.EXTENT,0]),this._demMatrixCache[t.key]={matrix:E,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getRTTFramebuffer(){const t=this.style.map.painter;if(!this._rttFramebuffer){const s=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=t.context.createFramebuffer(s,s,!0),this._rttFramebuffer.depthAttachment.set(t.context.createRenderbuffer(t.context.gl.DEPTH_COMPONENT16,s,s))}return this._rttFramebuffer}getFramebuffer(t){const s=this.style.map.painter,c=s.width/devicePixelRatio,p=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new be(s.context,{width:c,height:p,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new be(s.context,{width:c,height:p,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(c,p,!0),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,c,p))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,v=0;g<this._coordsTextureSize;g++)for(let S=0;S<this._coordsTextureSize;S++,v+=4)s[v+0]=255&S,s[v+1]=255&g,s[v+2]=S>>8<<4|g>>8,s[v+3]=0;const c=new u.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),p=new be(t,c,t.gl.RGBA,{premultiply:!1});return p.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(t){const s=new Uint8Array(4),c=this.style.map.painter,p=c.context,g=p.gl;p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(t.x,c.height/devicePixelRatio-t.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,s),p.bindFramebuffer.set(null);const v=s[0]+(s[2]>>4<<8),S=s[1]+((15&s[2])<<8),E=this.coordsIndex[255-s[3]],C=E&&this.sourceCache.getTileByID(E);if(!C)return null;const P=this._coordsTextureSize,D=(1<<C.tileID.canonical.z)*P;return new u.MercatorCoordinate((C.tileID.canonical.x*P+v)/D,(C.tileID.canonical.y*P+S)/D,this.getElevation(C.tileID,v,S,P))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.style.map.painter.context,s=new u.PosArray,c=new u.TriangleIndexArray,p=this.meshSize,g=u.EXTENT/p,v=p*p;for(let S=0;S<=p;S++)for(let E=0;E<=p;E++)s.emplaceBack(E*g,S*g);for(let S=0;S<v;S+=p+1)for(let E=0;E<p;E++)c.emplaceBack(E+S,p+E+S+1,p+E+S+2),c.emplaceBack(E+S,p+E+S+2,E+S+1);return this._mesh={indexBuffer:t.createIndexBuffer(c),vertexBuffer:t.createVertexBuffer(s,Ct.members),segments:u.SegmentVector.simpleSegment(0,0,s.length,c.length)},this._mesh}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,c={minElevation:null,maxElevation:null};return s&&s.dem&&(c.minElevation=(s.dem.min+this.elevationOffset)*this.exaggeration,c.maxElevation=(s.dem.max+this.elevationOffset)*this.exaggeration),c}}const It=(h,t)=>u.emitValidationErrors(h,t&&t.filter(s=>s.identifier!=="source.canvas")),Vt=u.pick(Tt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Cn=u.pick(Tt,["setCenter","setZoom","setBearing","setPitch"]),Jt=function(){const h={},t=u.spec.$version;for(const s in u.spec.$root){const c=u.spec.$root[s];if(c.required){let p=null;p=s==="version"?t:c.type==="array"?[]:{},p!=null&&(h[s]=p)}}return h}();class Vn extends u.Evented{constructor(t,s={}){super(),this.map=t,this.dispatcher=new mt(Oo(),this),this.imageManager=new se,this.imageManager.setEventedParent(this),this.glyphManager=new Be(t._requestManager,s.localIdeographFontFamily),this.lineAtlas=new Zt(256,512),this.crossTileSymbolIndex=new ut,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",u.getReferrer());const c=this;this._rtlTextPluginCallback=Vn.registerForPluginStateChange(p=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(g,v)=>{if(u.triggerPluginCompletionEvent(g),v&&v.every(S=>S))for(const S in c.sourceCaches)c.sourceCaches[S].reload()})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const g=this.sourceCaches[p.sourceId];if(!g)return;const v=g.getSource();if(v&&v.vectorLayerIds)for(const S in this._layers){const E=this._layers[S];E.source===v.id&&this._validateLayer(E)}})}loadURL(t,s={}){this.fire(new u.Event("dataloading",{dataType:"style"}));const c=typeof s.validate!="boolean"||s.validate,p=this.map._requestManager.transformRequest(t,u.ResourceType.Style);this._request=u.getJSON(p,(g,v)=>{this._request=null,g?this.fire(new u.ErrorEvent(g)):v&&this._load(v,c)})}loadJSON(t,s={}){this.fire(new u.Event("dataloading",{dataType:"style"})),this._request=u.exported.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new u.Event("dataloading",{dataType:"style"})),this._load(Jt,!1)}_load(t,s){if(s&&It(this,u.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const p in t.sources)this.addSource(p,t.sources[p],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);const c=zs(this.stylesheet.layers);this._order=c.map(p=>p.id),this._layers={},this._serializedLayers={};for(let p of c)p=u.createStyleLayer(p),p.setEventedParent(this,{layer:{id:p.id}}),this._layers[p.id]=p,this._serializedLayers[p.id]=p.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new et(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new u.Event("data",{dataType:"style"})),this.fire(new u.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(s,c,p,g){let v,S,E;const C=p>1?"@2x":"";let P=u.getJSON(c.transformRequest(c.normalizeSpriteURL(s,C,".json"),u.ResourceType.SpriteJSON),(q,j)=>{P=null,E||(E=q,v=j,R())}),D=u.getImage(c.transformRequest(c.normalizeSpriteURL(s,C,".png"),u.ResourceType.SpriteImage),(q,j)=>{D=null,E||(E=q,S=j,R())});function R(){if(E)g(E);else if(v&&S){const q=u.exported.getImageData(S),j={};for(const $ in v){const{width:ee,height:re,x:ce,y:W,sdf:pe,pixelRatio:he,stretchX:xe,stretchY:ve,content:Ie}=v[$],ye=new u.RGBAImage({width:ee,height:re});u.RGBAImage.copy(q,ye,{x:ce,y:W},{x:0,y:0},{width:ee,height:re}),j[$]={data:ye,pixelRatio:he,sdf:pe,stretchX:xe,stretchY:ve,content:Ie}}g(null,j)}}return{cancel(){P&&(P.cancel(),P=null),D&&(D.cancel(),D=null)}}}(t,this.map._requestManager,this.map.getPixelRatio(),(s,c)=>{if(this._spriteRequest=null,s)this.fire(new u.ErrorEvent(s));else if(c)for(const p in c)this.imageManager.addImage(p,c[p]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))})}_validateLayer(t){const s=this.sourceCaches[t.source];if(!s)return;const c=t.sourceLayer;if(!c)return;const p=s.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(c)===-1)&&this.fire(new u.ErrorEvent(new Error(`Source layer "${c}" does not exist on source "${p.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const s=[];for(const c of t){const p=this._layers[c];p.type!=="custom"&&s.push(p.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(this._changed){const p=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(p.length||g.length)&&this._updateWorkerLayers(p,g);for(const v in this._updatedSources){const S=this._updatedSources[v];if(S==="reload")this._reloadSource(v);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(v)}}this._updateTilesForChangedImages();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const c={};for(const p in this.sourceCaches){const g=this.sourceCaches[p];c[p]=g.used,g.used=!1}for(const p of this._order){const g=this._layers[p];g.recalculate(t,this._availableImages),!g.isHidden(t.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(const p in c){const g=this.sourceCaches[p];c[p]!==g.used&&g.fire(new u.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(t),this.z=t.zoom,s&&this.fire(new u.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(t){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),t){const s=this.sourceCaches[t.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);this.terrain=new yt(this,s,t),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=c=>{c.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=c=>{c.tile&&(c.sourceId===t.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(c.sourceId,c.tile.tileID)):c.source.type==="geojson"&&this.terrain.rememberForRerender(c.sourceId,c.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new u.Event("terrain",{terrain:t}))}setState(t){if(this._checkLoaded(),It(this,u.validateStyle(t)))return!1;(t=u.clone$1(t)).layers=zs(t.layers);const s=function(p,g){if(!p)return[{command:Tt.setStyle,args:[g]}];let v=[];try{if(!oe(p.version,g.version))return[{command:Tt.setStyle,args:[g]}];oe(p.center,g.center)||v.push({command:Tt.setCenter,args:[g.center]}),oe(p.zoom,g.zoom)||v.push({command:Tt.setZoom,args:[g.zoom]}),oe(p.bearing,g.bearing)||v.push({command:Tt.setBearing,args:[g.bearing]}),oe(p.pitch,g.pitch)||v.push({command:Tt.setPitch,args:[g.pitch]}),oe(p.sprite,g.sprite)||v.push({command:Tt.setSprite,args:[g.sprite]}),oe(p.glyphs,g.glyphs)||v.push({command:Tt.setGlyphs,args:[g.glyphs]}),oe(p.transition,g.transition)||v.push({command:Tt.setTransition,args:[g.transition]}),oe(p.light,g.light)||v.push({command:Tt.setLight,args:[g.light]});const S={},E=[];(function(P,D,R,q){let j;for(j in D=D||{},P=P||{})Object.prototype.hasOwnProperty.call(P,j)&&(Object.prototype.hasOwnProperty.call(D,j)||Vi(j,R,q));for(j in D)Object.prototype.hasOwnProperty.call(D,j)&&(Object.prototype.hasOwnProperty.call(P,j)?oe(P[j],D[j])||(P[j].type==="geojson"&&D[j].type==="geojson"&&Ms(P,D,j)?R.push({command:Tt.setGeoJSONSourceData,args:[j,D[j].data]}):ji(j,D,R,q)):si(j,D,R))})(p.sources,g.sources,E,S);const C=[];p.layers&&p.layers.forEach(P=>{S[P.source]?v.push({command:Tt.removeLayer,args:[P.id]}):C.push(P)}),v=v.concat(E),function(P,D,R){D=D||[];const q=(P=P||[]).map(bi),j=D.map(bi),$=P.reduce(Uo,{}),ee=D.reduce(Uo,{}),re=q.slice(),ce=Object.create(null);let W,pe,he,xe,ve,Ie,ye;for(W=0,pe=0;W<q.length;W++)he=q[W],Object.prototype.hasOwnProperty.call(ee,he)?pe++:(R.push({command:Tt.removeLayer,args:[he]}),re.splice(re.indexOf(he,pe),1));for(W=0,pe=0;W<j.length;W++)he=j[j.length-1-W],re[re.length-1-W]!==he&&(Object.prototype.hasOwnProperty.call($,he)?(R.push({command:Tt.removeLayer,args:[he]}),re.splice(re.lastIndexOf(he,re.length-pe),1)):pe++,Ie=re[re.length-W],R.push({command:Tt.addLayer,args:[ee[he],Ie]}),re.splice(re.length-W,0,he),ce[he]=!0);for(W=0;W<j.length;W++)if(he=j[W],xe=$[he],ve=ee[he],!ce[he]&&!oe(xe,ve))if(oe(xe.source,ve.source)&&oe(xe["source-layer"],ve["source-layer"])&&oe(xe.type,ve.type)){for(ye in wi(xe.layout,ve.layout,R,he,null,Tt.setLayoutProperty),wi(xe.paint,ve.paint,R,he,null,Tt.setPaintProperty),oe(xe.filter,ve.filter)||R.push({command:Tt.setFilter,args:[he,ve.filter]}),oe(xe.minzoom,ve.minzoom)&&oe(xe.maxzoom,ve.maxzoom)||R.push({command:Tt.setLayerZoomRange,args:[he,ve.minzoom,ve.maxzoom]}),xe)Object.prototype.hasOwnProperty.call(xe,ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&(ye.indexOf("paint.")===0?wi(xe[ye],ve[ye],R,he,ye.slice(6),Tt.setPaintProperty):oe(xe[ye],ve[ye])||R.push({command:Tt.setLayerProperty,args:[he,ye,ve[ye]]}));for(ye in ve)Object.prototype.hasOwnProperty.call(ve,ye)&&!Object.prototype.hasOwnProperty.call(xe,ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&(ye.indexOf("paint.")===0?wi(xe[ye],ve[ye],R,he,ye.slice(6),Tt.setPaintProperty):oe(xe[ye],ve[ye])||R.push({command:Tt.setLayerProperty,args:[he,ye,ve[ye]]}))}else R.push({command:Tt.removeLayer,args:[he]}),Ie=re[re.lastIndexOf(he)+1],R.push({command:Tt.addLayer,args:[ve,Ie]})}(C,g.layers,v)}catch(S){console.warn("Unable to compute style diff:",S),v=[{command:Tt.setStyle,args:[g]}]}return v}(this.serialize(),t).filter(p=>!(p.command in Cn));if(s.length===0)return!1;const c=s.filter(p=>!(p.command in Vt));if(c.length>0)throw new Error(`Unimplemented: ${c.map(p=>p.command).join(", ")}.`);return s.forEach(p=>{p.command!=="setTransition"&&this[p.command].apply(this,p.args)}),this.stylesheet=t,!0}addImage(t,s){if(this.getImage(t))return this.fire(new u.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new u.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,c={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(u.validateStyle.source,`sources.${t}`,s,null,c))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const p=this.sourceCaches[t]=new ir(t,s,this.dispatcher);p.style=this,p.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:p.serialize(),sourceId:t})),p.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===t)return this.fire(new u.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${c}" is using it.`)));const s=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],s.fire(new u.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const c=this.sourceCaches[t].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(s),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,s,c={}){this._checkLoaded();const p=t.id;if(this.getLayer(p))return void this.fire(new u.ErrorEvent(new Error(`Layer "${p}" already exists on this map.`)));let g;if(t.type==="custom"){if(It(this,u.validateCustomStyleLayer(t)))return;g=u.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(p,t.source),t=u.clone$1(t),t=u.extend(t,{source:p})),this._validate(u.validateStyle.layer,`layers.${p}`,t,{arrayIndex:-1},c))return;g=u.createStyleLayer(t),this._validateLayer(g),g.setEventedParent(this,{layer:{id:p}}),this._serializedLayers[g.id]=g.serialize()}const v=s?this._order.indexOf(s):this._order.length;if(s&&v===-1)this.fire(new u.ErrorEvent(new Error(`Cannot add layer "${p}" before non-existing layer "${s}".`)));else{if(this._order.splice(v,0,p),this._layerOrderChanged=!0,this._layers[p]=g,this._removedLayers[p]&&g.source&&g.type!=="custom"){const S=this._removedLayers[p];delete this._removedLayers[p],S.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const c=this._order.indexOf(t);this._order.splice(c,1);const p=s?this._order.indexOf(s):this._order.length;s&&p===-1?this.fire(new u.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(p,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new u.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,c){this._checkLoaded();const p=this.getLayer(t);p?p.minzoom===s&&p.maxzoom===c||(s!=null&&(p.minzoom=s),c!=null&&(p.maxzoom=c),this._updateLayer(p)):this.fire(new u.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,c={}){this._checkLoaded();const p=this.getLayer(t);if(p){if(!oe(p.filter,s))return s==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(u.validateStyle.filter,`layers.${p.id}.filter`,s,null,c)||(p.filter=u.clone$1(s),this._updateLayer(p)))}else this.fire(new u.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return u.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,s,c,p={}){this._checkLoaded();const g=this.getLayer(t);g?oe(g.getLayoutProperty(s),c)||(g.setLayoutProperty(s,c,p),this._updateLayer(g)):this.fire(new u.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const c=this.getLayer(t);if(c)return c.getLayoutProperty(s);this.fire(new u.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,c,p={}){this._checkLoaded();const g=this.getLayer(t);g?oe(g.getPaintProperty(s),c)||(g.setPaintProperty(s,c,p)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new u.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const c=t.source,p=t.sourceLayer,g=this.sourceCaches[c];if(g===void 0)return void this.fire(new u.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)));const v=g.getSource().type;v==="geojson"&&p?this.fire(new u.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||p?(t.id===void 0&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),g.setFeatureState(p,t.id,s)):this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const c=t.source,p=this.sourceCaches[c];if(p===void 0)return void this.fire(new u.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)));const g=p.getSource().type,v=g==="vector"?t.sourceLayer:void 0;g!=="vector"||v?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new u.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(v,t.id,s):this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,c=t.sourceLayer,p=this.sourceCaches[s];if(p!==void 0)return p.getSource().type!=="vector"||c?(t.id===void 0&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),p.getFeatureState(c,t.id)):void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return u.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return u.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:u.mapObject(this.sourceCaches,t=>t.serialize()),layers:this._serializeLayers(this._order)},t=>t!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=v=>this._layers[v].type==="fill-extrusion",c={},p=[];for(let v=this._order.length-1;v>=0;v--){const S=this._order[v];if(s(S)){c[S]=v;for(const E of t){const C=E[S];if(C)for(const P of C)p.push(P)}}}p.sort((v,S)=>S.intersectionZ-v.intersectionZ);const g=[];for(let v=this._order.length-1;v>=0;v--){const S=this._order[v];if(s(S))for(let E=p.length-1;E>=0;E--){const C=p[E].feature;if(c[C.layer.id]<v)break;g.push(C),p.pop()}else for(const E of t){const C=E[S];if(C)for(const P of C)g.push(P.feature)}}return g}queryRenderedFeatures(t,s,c){s&&s.filter&&this._validate(u.validateStyle.filter,"queryRenderedFeatures.filter",s.filter,null,s);const p={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new u.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const v of s.layers){const S=this._layers[v];if(!S)return this.fire(new u.ErrorEvent(new Error(`The layer '${v}' does not exist in the map's style and cannot be queried for features.`))),[];p[S.source]=!0}}const g=[];s.availableImages=this._availableImages;for(const v in this.sourceCaches)s.layers&&!p[v]||g.push(nr(this.sourceCaches[v],this._layers,this._serializedLayers,t,s,c));return this.placement&&g.push(function(v,S,E,C,P,D,R){const q={},j=D.queryRenderedSymbols(C),$=[];for(const ee of Object.keys(j).map(Number))$.push(R[ee]);$.sort(rr);for(const ee of $){const re=ee.featureIndex.lookupSymbolFeatures(j[ee.bucketInstanceId],S,ee.bucketIndex,ee.sourceLayerIndex,P.filter,P.layers,P.availableImages,v);for(const ce in re){const W=q[ce]=q[ce]||[],pe=re[ce];pe.sort((he,xe)=>{const ve=ee.featureSortOrder;if(ve){const Ie=ve.indexOf(he.featureIndex);return ve.indexOf(xe.featureIndex)-Ie}return xe.featureIndex-he.featureIndex});for(const he of pe)W.push(he)}}for(const ee in q)q[ee].forEach(re=>{const ce=re.feature,W=E[v[ee].source].getFeatureState(ce.layer["source-layer"],ce.id);ce.source=ce.layer.source,ce.layer["source-layer"]&&(ce.sourceLayer=ce.layer["source-layer"]),ce.state=W});return q}(this._layers,this._serializedLayers,this.sourceCaches,t,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(t,s){s&&s.filter&&this._validate(u.validateStyle.filter,"querySourceFeatures.filter",s.filter,null,s);const c=this.sourceCaches[t];return c?function(p,g){const v=p.getRenderableIds().map(C=>p.getTileByID(C)),S=[],E={};for(let C=0;C<v.length;C++){const P=v[C],D=P.tileID.canonical.key;E[D]||(E[D]=!0,P.querySourceFeatures(S,g))}return S}(c,s):[]}addSourceType(t,s,c){return Vn.getSourceType(t)?c(new Error(`A source type called "${t}" already exists.`)):(Vn.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},c):c(null,null))}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const c=this.light.getLight();let p=!1;for(const v in t)if(!oe(t[v],c[v])){p=!0;break}if(!p)return;const g={now:u.exported.now(),transition:u.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(g)}_validate(t,s,c,p,g={}){return(!g||g.validate!==!1)&&It(this,t.call(u.validateStyle,u.extend({key:s,style:this.serialize(),value:c,styleSpec:u.spec},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),u.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const s=this.sourceCaches[t];s.setEventedParent(null),s.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const s in this.sourceCaches)this.sourceCaches[s].update(t,this.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,s,c,p,g=!1){let v=!1,S=!1;const E={};for(const C of this._order){const P=this._layers[C];if(P.type!=="symbol")continue;if(!E[P.source]){const R=this.sourceCaches[P.source];E[P.source]=R.getRenderableIds(!0).map(q=>R.getTileByID(q)).sort((q,j)=>j.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(j.tileID)?-1:1))}const D=this.crossTileSymbolIndex.addLayer(P,E[P.source],t.center.lng);v=v||D}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(u.exported.now(),t.zoom))&&(this.pauseablePlacement=new me(t,this.terrain,this._order,g,s,c,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(u.exported.now()),S=!0),v&&this.pauseablePlacement.placement.setStale()),S||v)for(const C of this._order){const P=this._layers[C];P.type==="symbol"&&this.placement.updateLayerOpacities(P,E[P.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(u.exported.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s,c){this.imageManager.getImages(s.icons,c),this._updateTilesForChangedImages();const p=this.sourceCaches[s.source];p&&p.setDependencies(s.tileID.key,s.type,s.icons)}getGlyphs(t,s,c){this.glyphManager.getGlyphs(s.stacks,c)}getResource(t,s,c){return u.makeRequest(s,c)}}Vn.getSourceType=function(h){return Kt[h]},Vn.setSourceType=function(h,t){Kt[h]=t},Vn.registerForPluginStateChange=u.registerForPluginStateChange;var Go="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ds={prelude:jt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:jt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:jt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:jt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:jt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:jt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:jt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:jt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:jt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:jt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:jt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:jt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:jt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:jt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:jt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:jt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:jt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:jt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:jt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:jt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:jt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:jt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:jt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:jt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:jt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:jt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:jt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Go),terrainDepth:jt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Go),terrainCoords:jt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Go)};function jt(h,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=t.match(/attribute ([\w]+) ([\w]+)/g),p=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=g?g.concat(p):p,S={};return{fragmentSource:h=h.replace(s,(E,C,P,D,R)=>(S[R]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${R}
varying ${P} ${D} ${R};
#else
uniform ${P} ${D} u_${R};
#endif
`:`
#ifdef HAS_UNIFORM_u_${R}
    ${P} ${D} ${R} = u_${R};
#endif
`)),vertexSource:t=t.replace(s,(E,C,P,D,R)=>{const q=D==="float"?"vec2":"vec4",j=R.match(/color/)?"color":q;return S[R]?C==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
attribute ${P} ${q} a_${R};
varying ${P} ${D} ${R};
#else
uniform ${P} ${D} u_${R};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = a_${R};
#else
    ${P} ${D} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = unpack_mix_${j}(a_${R}, u_${R}_t);
#else
    ${P} ${D} ${R} = u_${R};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
attribute ${P} ${q} a_${R};
#else
uniform ${P} ${D} u_${R};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${P} ${D} ${R} = a_${R};
#else
    ${P} ${D} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${P} ${D} ${R} = unpack_mix_${j}(a_${R}, u_${R}_t);
#else
    ${P} ${D} ${R} = u_${R};
#endif
`}),staticAttributes:c,staticUniforms:v}}class Ml{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,c,p,g,v,S,E,C){this.context=t;let P=this.boundPaintVertexBuffers.length!==p.length;for(let D=0;!P&&D<p.length;D++)this.boundPaintVertexBuffers[D]!==p[D]&&(P=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===s&&this.boundLayoutVertexBuffer===c&&!P&&this.boundIndexBuffer===g&&this.boundVertexOffset===v&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===E&&this.boundDynamicVertexBuffer3===C?(t.bindVertexArrayOES.set(this.vao),S&&S.bind(),g&&g.dynamicDraw&&g.bind(),E&&E.bind(),C&&C.bind()):this.freshBind(s,c,p,g,v,S,E,C)}freshBind(t,s,c,p,g,v,S,E){let C;const P=t.numAttributes,D=this.context,R=D.gl;if(D.extVertexArrayObject)this.vao&&this.destroy(),this.vao=D.extVertexArrayObject.createVertexArrayOES(),D.bindVertexArrayOES.set(this.vao),C=0,this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=p,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=E;else{C=D.currentNumAttributes||0;for(let q=P;q<C;q++)R.disableVertexAttribArray(q)}s.enableAttributes(R,t);for(const q of c)q.enableAttributes(R,t);v&&v.enableAttributes(R,t),S&&S.enableAttributes(R,t),E&&E.enableAttributes(R,t),s.bind(),s.setVertexAttribPointers(R,t,g);for(const q of c)q.bind(),q.setVertexAttribPointers(R,t,g);v&&(v.bind(),v.setVertexAttribPointers(R,t,g)),p&&p.bind(),S&&(S.bind(),S.setVertexAttribPointers(R,t,g)),E&&(E.bind(),E.setVertexAttribPointers(R,t,g)),D.currentNumAttributes=P}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Dl(h){const t=[];for(let s=0;s<h.length;s++){if(h[s]===null)continue;const c=h[s].split(" ");t.push(c.pop())}return t}class bc{constructor(t,s,c,p,g,v,S){const E=t.gl;this.program=E.createProgram();const C=Dl(c.staticAttributes),P=p?p.getBinderAttributes():[],D=C.concat(P),R=Ds.prelude.staticUniforms?Dl(Ds.prelude.staticUniforms):[],q=c.staticUniforms?Dl(c.staticUniforms):[],j=p?p.getBinderUniforms():[],$=R.concat(q).concat(j),ee=[];for(const ve of $)ee.indexOf(ve)<0&&ee.push(ve);const re=p?p.defines():[];v&&re.push("#define OVERDRAW_INSPECTOR;"),S&&re.push("#define TERRAIN3D;");const ce=re.concat(Ds.prelude.fragmentSource,c.fragmentSource).join(`
`),W=re.concat(Ds.prelude.vertexSource,c.vertexSource).join(`
`),pe=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(pe,ce),E.compileShader(pe),E.attachShader(this.program,pe);const he=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(he,W),E.compileShader(he),E.attachShader(this.program,he),this.attributes={};const xe={};this.numAttributes=D.length;for(let ve=0;ve<this.numAttributes;ve++)D[ve]&&(E.bindAttribLocation(this.program,ve,D[ve]),this.attributes[D[ve]]=ve);E.linkProgram(this.program),E.deleteShader(he),E.deleteShader(pe);for(let ve=0;ve<ee.length;ve++){const Ie=ee[ve];if(Ie&&!xe[Ie]){const ye=E.getUniformLocation(this.program,Ie);ye&&(xe[Ie]=ye)}}this.fixedUniforms=g(t,xe),this.terrainUniforms=((ve,Ie)=>({u_depth:new u.Uniform1i(ve,Ie.u_depth),u_terrain:new u.Uniform1i(ve,Ie.u_terrain),u_terrain_dim:new u.Uniform1f(ve,Ie.u_terrain_dim),u_terrain_matrix:new u.UniformMatrix4f(ve,Ie.u_terrain_matrix),u_terrain_unpack:new u.Uniform4f(ve,Ie.u_terrain_unpack),u_terrain_offset:new u.Uniform1f(ve,Ie.u_terrain_offset),u_terrain_exaggeration:new u.Uniform1f(ve,Ie.u_terrain_exaggeration)}))(t,xe),this.binderUniforms=p?p.getUniforms(t,xe):[]}draw(t,s,c,p,g,v,S,E,C,P,D,R,q,j,$,ee,re,ce){const W=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(c),t.setStencilMode(p),t.setColorMode(g),t.setCullFace(v),E){t.activeTexture.set(W.TEXTURE2),W.bindTexture(W.TEXTURE_2D,E.depthTexture),t.activeTexture.set(W.TEXTURE3),W.bindTexture(W.TEXTURE_2D,E.texture);for(const he in this.terrainUniforms)this.terrainUniforms[he].set(E[he])}for(const he in this.fixedUniforms)this.fixedUniforms[he].set(S[he]);$&&$.setUniforms(t,this.binderUniforms,q,{zoom:j});let pe=0;switch(s){case W.LINES:pe=2;break;case W.TRIANGLES:pe=3;break;case W.LINE_STRIP:pe=1}for(const he of R.get()){const xe=he.vaos||(he.vaos={});(xe[C]||(xe[C]=new Ml)).bind(t,this,P,$?$.getPaintVertexBuffers():[],D,he.vertexOffset,ee,re,ce),W.drawElements(s,he.primitiveLength*pe,W.UNSIGNED_SHORT,he.primitiveOffset*pe*2)}}}function Sc(h,t,s){const c=1/gn(s,1,t.transform.tileZoom),p=Math.pow(2,s.tileID.overscaledZ),g=s.tileSize*Math.pow(2,t.transform.tileZoom)/p,v=g*(s.tileID.canonical.x+s.tileID.wrap*p),S=g*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[c,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[v>>16,S>>16],u_pixel_coord_lower:[65535&v,65535&S]}}const Ll=(h,t,s,c)=>{const p=t.style.light,g=p.properties.get("position"),v=[g.x,g.y,g.z],S=u.create$1();p.properties.get("anchor")==="viewport"&&u.fromRotation(S,-t.transform.angle),u.transformMat3(v,v,S);const E=p.properties.get("color");return{u_matrix:h,u_lightpos:v,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+s,u_opacity:c}},rp=(h,t,s,c,p,g,v)=>u.extend(Ll(h,t,s,c),Sc(g,t,v),{u_height_factor:-Math.pow(2,p.overscaledZ)/v.tileSize/8}),Ea=h=>({u_matrix:h}),Rl=(h,t,s,c)=>u.extend(Ea(h),Sc(s,t,c)),Ec=(h,t)=>({u_matrix:h,u_world:t}),Tc=(h,t,s,c,p)=>u.extend(Rl(h,t,s,c),{u_world:p}),kc=(h,t,s,c)=>{const p=h.transform;let g,v;if(c.paint.get("circle-pitch-alignment")==="map"){const S=gn(s,1,p.zoom);g=!0,v=[S,S]}else g=!1,v=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(c.paint.get("circle-pitch-scale")==="map"),u_matrix:h.translatePosMatrix(t.posMatrix,s,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:h.pixelRatio,u_extrude_scale:v}},co=(h,t,s)=>{const c=gn(s,1,t.zoom),p=Math.pow(2,t.zoom-s.tileID.overscaledZ),g=s.tileID.overscaleFactor();return{u_matrix:h,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:c,u_extrude_scale:[t.pixelsToGLUnits[0]/(c*p),t.pixelsToGLUnits[1]/(c*p)],u_overscale_factor:g}},Ls=(h,t,s=1)=>({u_matrix:h,u_color:t,u_overlay:0,u_overlay_scale:s}),qo=h=>({u_matrix:h}),Ta=(h,t,s,c)=>({u_matrix:h,u_extrude_scale:gn(t,1,s),u_intensity:c});function ka(h,t){const s=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new u.MercatorCoordinate(0,c/s).toLngLat().lat,new u.MercatorCoordinate(0,(c+1)/s).toLngLat().lat]}const Zo=(h,t,s,c)=>{const p=h.transform;return{u_matrix:Bs(h,t,s,c),u_ratio:1/gn(t,1,p.zoom),u_device_pixel_ratio:h.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Bl=(h,t,s,c,p)=>u.extend(Zo(h,t,s,p),{u_image:0,u_image_height:c}),Ca=(h,t,s,c,p)=>{const g=h.transform,v=Yt(t,g);return{u_matrix:Bs(h,t,s,p),u_texsize:t.imageAtlasTexture.size,u_ratio:1/gn(t,1,g.zoom),u_device_pixel_ratio:h.pixelRatio,u_image:0,u_scale:[v,c.fromScale,c.toScale],u_fade:c.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Rs=(h,t,s,c,p,g)=>{const v=h.lineAtlas,S=Yt(t,h.transform),E=s.layout.get("line-cap")==="round",C=v.getDash(c.from,E),P=v.getDash(c.to,E),D=C.width*p.fromScale,R=P.width*p.toScale;return u.extend(Zo(h,t,s,g),{u_patternscale_a:[S/D,-C.height/2],u_patternscale_b:[S/R,-P.height/2],u_sdfgamma:v.width/(256*Math.min(D,R)*h.pixelRatio)/2,u_image:0,u_tex_y_a:C.y,u_tex_y_b:P.y,u_mix:p.t})};function Yt(h,t){return 1/gn(h,1,t.tileZoom)}function Bs(h,t,s,c){return h.translatePosMatrix(c?c.posMatrix:t.tileID.posMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Cc=(h,t,s,c,p)=>{return{u_matrix:h,u_tl_parent:t,u_scale_parent:s,u_buffer_scale:1,u_fade_t:c.mix,u_opacity:c.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(v=p.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(g=p.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:Ic(p.paint.get("raster-hue-rotate"))};var g,v};function Ic(h){h*=Math.PI/180;const t=Math.sin(h),s=Math.cos(h);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const Fl=(h,t,s,c,p,g,v,S,E,C)=>{const P=p.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:P.cameraToCenterDistance,u_pitch:P.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:P.width/P.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:v,u_coord_matrix:S,u_is_text:+E,u_pitch_with_map:+c,u_texsize:C,u_texture:0}},Ia=(h,t,s,c,p,g,v,S,E,C,P)=>{const D=p.transform;return u.extend(Fl(h,t,s,c,p,g,v,S,E,C),{u_gamma_scale:c?Math.cos(D._pitch)*D.cameraToCenterDistance:1,u_device_pixel_ratio:p.pixelRatio,u_is_halo:+P})},Ac=(h,t,s,c,p,g,v,S,E,C)=>u.extend(Ia(h,t,s,c,p,g,v,S,!0,E,!0),{u_texsize_icon:C,u_texture_icon:1}),ip=(h,t,s)=>({u_matrix:h,u_opacity:t,u_color:s}),op=(h,t,s,c,p,g)=>u.extend(function(v,S,E,C){const P=E.imageManager.getPattern(v.from.toString()),D=E.imageManager.getPattern(v.to.toString()),{width:R,height:q}=E.imageManager.getPixelSize(),j=Math.pow(2,C.tileID.overscaledZ),$=C.tileSize*Math.pow(2,E.transform.tileZoom)/j,ee=$*(C.tileID.canonical.x+C.tileID.wrap*j),re=$*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:D.tl,u_pattern_br_b:D.br,u_texsize:[R,q],u_mix:S.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:D.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/gn(C,1,E.transform.tileZoom),u_pixel_coord_upper:[ee>>16,re>>16],u_pixel_coord_lower:[65535&ee,65535&re]}}(c,g,s,p),{u_matrix:h,u_opacity:t}),Ol={fillExtrusion:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_lightpos:new u.Uniform3f(h,t.u_lightpos),u_lightintensity:new u.Uniform1f(h,t.u_lightintensity),u_lightcolor:new u.Uniform3f(h,t.u_lightcolor),u_vertical_gradient:new u.Uniform1f(h,t.u_vertical_gradient),u_opacity:new u.Uniform1f(h,t.u_opacity)}),fillExtrusionPattern:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_lightpos:new u.Uniform3f(h,t.u_lightpos),u_lightintensity:new u.Uniform1f(h,t.u_lightintensity),u_lightcolor:new u.Uniform3f(h,t.u_lightcolor),u_vertical_gradient:new u.Uniform1f(h,t.u_vertical_gradient),u_height_factor:new u.Uniform1f(h,t.u_height_factor),u_image:new u.Uniform1i(h,t.u_image),u_texsize:new u.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new u.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new u.Uniform3f(h,t.u_scale),u_fade:new u.Uniform1f(h,t.u_fade),u_opacity:new u.Uniform1f(h,t.u_opacity)}),fill:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix)}),fillPattern:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_image:new u.Uniform1i(h,t.u_image),u_texsize:new u.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new u.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new u.Uniform3f(h,t.u_scale),u_fade:new u.Uniform1f(h,t.u_fade)}),fillOutline:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_world:new u.Uniform2f(h,t.u_world)}),fillOutlinePattern:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_world:new u.Uniform2f(h,t.u_world),u_image:new u.Uniform1i(h,t.u_image),u_texsize:new u.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new u.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new u.Uniform3f(h,t.u_scale),u_fade:new u.Uniform1f(h,t.u_fade)}),circle:(h,t)=>({u_camera_to_center_distance:new u.Uniform1f(h,t.u_camera_to_center_distance),u_scale_with_map:new u.Uniform1i(h,t.u_scale_with_map),u_pitch_with_map:new u.Uniform1i(h,t.u_pitch_with_map),u_extrude_scale:new u.Uniform2f(h,t.u_extrude_scale),u_device_pixel_ratio:new u.Uniform1f(h,t.u_device_pixel_ratio),u_matrix:new u.UniformMatrix4f(h,t.u_matrix)}),collisionBox:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_camera_to_center_distance:new u.Uniform1f(h,t.u_camera_to_center_distance),u_pixels_to_tile_units:new u.Uniform1f(h,t.u_pixels_to_tile_units),u_extrude_scale:new u.Uniform2f(h,t.u_extrude_scale),u_overscale_factor:new u.Uniform1f(h,t.u_overscale_factor)}),collisionCircle:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_inv_matrix:new u.UniformMatrix4f(h,t.u_inv_matrix),u_camera_to_center_distance:new u.Uniform1f(h,t.u_camera_to_center_distance),u_viewport_size:new u.Uniform2f(h,t.u_viewport_size)}),debug:(h,t)=>({u_color:new u.UniformColor(h,t.u_color),u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_overlay:new u.Uniform1i(h,t.u_overlay),u_overlay_scale:new u.Uniform1f(h,t.u_overlay_scale)}),clippingMask:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix)}),heatmap:(h,t)=>({u_extrude_scale:new u.Uniform1f(h,t.u_extrude_scale),u_intensity:new u.Uniform1f(h,t.u_intensity),u_matrix:new u.UniformMatrix4f(h,t.u_matrix)}),heatmapTexture:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_world:new u.Uniform2f(h,t.u_world),u_image:new u.Uniform1i(h,t.u_image),u_color_ramp:new u.Uniform1i(h,t.u_color_ramp),u_opacity:new u.Uniform1f(h,t.u_opacity)}),hillshade:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_image:new u.Uniform1i(h,t.u_image),u_latrange:new u.Uniform2f(h,t.u_latrange),u_light:new u.Uniform2f(h,t.u_light),u_shadow:new u.UniformColor(h,t.u_shadow),u_highlight:new u.UniformColor(h,t.u_highlight),u_accent:new u.UniformColor(h,t.u_accent)}),hillshadePrepare:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_image:new u.Uniform1i(h,t.u_image),u_dimension:new u.Uniform2f(h,t.u_dimension),u_zoom:new u.Uniform1f(h,t.u_zoom),u_unpack:new u.Uniform4f(h,t.u_unpack)}),line:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_ratio:new u.Uniform1f(h,t.u_ratio),u_device_pixel_ratio:new u.Uniform1f(h,t.u_device_pixel_ratio),u_units_to_pixels:new u.Uniform2f(h,t.u_units_to_pixels)}),lineGradient:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_ratio:new u.Uniform1f(h,t.u_ratio),u_device_pixel_ratio:new u.Uniform1f(h,t.u_device_pixel_ratio),u_units_to_pixels:new u.Uniform2f(h,t.u_units_to_pixels),u_image:new u.Uniform1i(h,t.u_image),u_image_height:new u.Uniform1f(h,t.u_image_height)}),linePattern:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_texsize:new u.Uniform2f(h,t.u_texsize),u_ratio:new u.Uniform1f(h,t.u_ratio),u_device_pixel_ratio:new u.Uniform1f(h,t.u_device_pixel_ratio),u_image:new u.Uniform1i(h,t.u_image),u_units_to_pixels:new u.Uniform2f(h,t.u_units_to_pixels),u_scale:new u.Uniform3f(h,t.u_scale),u_fade:new u.Uniform1f(h,t.u_fade)}),lineSDF:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_ratio:new u.Uniform1f(h,t.u_ratio),u_device_pixel_ratio:new u.Uniform1f(h,t.u_device_pixel_ratio),u_units_to_pixels:new u.Uniform2f(h,t.u_units_to_pixels),u_patternscale_a:new u.Uniform2f(h,t.u_patternscale_a),u_patternscale_b:new u.Uniform2f(h,t.u_patternscale_b),u_sdfgamma:new u.Uniform1f(h,t.u_sdfgamma),u_image:new u.Uniform1i(h,t.u_image),u_tex_y_a:new u.Uniform1f(h,t.u_tex_y_a),u_tex_y_b:new u.Uniform1f(h,t.u_tex_y_b),u_mix:new u.Uniform1f(h,t.u_mix)}),raster:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_tl_parent:new u.Uniform2f(h,t.u_tl_parent),u_scale_parent:new u.Uniform1f(h,t.u_scale_parent),u_buffer_scale:new u.Uniform1f(h,t.u_buffer_scale),u_fade_t:new u.Uniform1f(h,t.u_fade_t),u_opacity:new u.Uniform1f(h,t.u_opacity),u_image0:new u.Uniform1i(h,t.u_image0),u_image1:new u.Uniform1i(h,t.u_image1),u_brightness_low:new u.Uniform1f(h,t.u_brightness_low),u_brightness_high:new u.Uniform1f(h,t.u_brightness_high),u_saturation_factor:new u.Uniform1f(h,t.u_saturation_factor),u_contrast_factor:new u.Uniform1f(h,t.u_contrast_factor),u_spin_weights:new u.Uniform3f(h,t.u_spin_weights)}),symbolIcon:(h,t)=>({u_is_size_zoom_constant:new u.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new u.Uniform1f(h,t.u_size_t),u_size:new u.Uniform1f(h,t.u_size),u_camera_to_center_distance:new u.Uniform1f(h,t.u_camera_to_center_distance),u_pitch:new u.Uniform1f(h,t.u_pitch),u_rotate_symbol:new u.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new u.Uniform1f(h,t.u_fade_change),u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new u.Uniform1i(h,t.u_is_text),u_pitch_with_map:new u.Uniform1i(h,t.u_pitch_with_map),u_texsize:new u.Uniform2f(h,t.u_texsize),u_texture:new u.Uniform1i(h,t.u_texture)}),symbolSDF:(h,t)=>({u_is_size_zoom_constant:new u.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new u.Uniform1f(h,t.u_size_t),u_size:new u.Uniform1f(h,t.u_size),u_camera_to_center_distance:new u.Uniform1f(h,t.u_camera_to_center_distance),u_pitch:new u.Uniform1f(h,t.u_pitch),u_rotate_symbol:new u.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new u.Uniform1f(h,t.u_fade_change),u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new u.Uniform1i(h,t.u_is_text),u_pitch_with_map:new u.Uniform1i(h,t.u_pitch_with_map),u_texsize:new u.Uniform2f(h,t.u_texsize),u_texture:new u.Uniform1i(h,t.u_texture),u_gamma_scale:new u.Uniform1f(h,t.u_gamma_scale),u_device_pixel_ratio:new u.Uniform1f(h,t.u_device_pixel_ratio),u_is_halo:new u.Uniform1i(h,t.u_is_halo)}),symbolTextAndIcon:(h,t)=>({u_is_size_zoom_constant:new u.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new u.Uniform1f(h,t.u_size_t),u_size:new u.Uniform1f(h,t.u_size),u_camera_to_center_distance:new u.Uniform1f(h,t.u_camera_to_center_distance),u_pitch:new u.Uniform1f(h,t.u_pitch),u_rotate_symbol:new u.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new u.Uniform1f(h,t.u_fade_change),u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new u.Uniform1i(h,t.u_is_text),u_pitch_with_map:new u.Uniform1i(h,t.u_pitch_with_map),u_texsize:new u.Uniform2f(h,t.u_texsize),u_texsize_icon:new u.Uniform2f(h,t.u_texsize_icon),u_texture:new u.Uniform1i(h,t.u_texture),u_texture_icon:new u.Uniform1i(h,t.u_texture_icon),u_gamma_scale:new u.Uniform1f(h,t.u_gamma_scale),u_device_pixel_ratio:new u.Uniform1f(h,t.u_device_pixel_ratio),u_is_halo:new u.Uniform1i(h,t.u_is_halo)}),background:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_opacity:new u.Uniform1f(h,t.u_opacity),u_color:new u.UniformColor(h,t.u_color)}),backgroundPattern:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_opacity:new u.Uniform1f(h,t.u_opacity),u_image:new u.Uniform1i(h,t.u_image),u_pattern_tl_a:new u.Uniform2f(h,t.u_pattern_tl_a),u_pattern_br_a:new u.Uniform2f(h,t.u_pattern_br_a),u_pattern_tl_b:new u.Uniform2f(h,t.u_pattern_tl_b),u_pattern_br_b:new u.Uniform2f(h,t.u_pattern_br_b),u_texsize:new u.Uniform2f(h,t.u_texsize),u_mix:new u.Uniform1f(h,t.u_mix),u_pattern_size_a:new u.Uniform2f(h,t.u_pattern_size_a),u_pattern_size_b:new u.Uniform2f(h,t.u_pattern_size_b),u_scale_a:new u.Uniform1f(h,t.u_scale_a),u_scale_b:new u.Uniform1f(h,t.u_scale_b),u_pixel_coord_upper:new u.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(h,t.u_pixel_coord_lower),u_tile_units_to_pixels:new u.Uniform1f(h,t.u_tile_units_to_pixels)}),terrain:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_texture:new u.Uniform1i(h,t.u_texture)}),terrainDepth:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix)}),terrainCoords:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_texture:new u.Uniform1i(h,t.u_texture),u_terrain_coords_id:new u.Uniform1f(h,t.u_terrain_coords_id)})};class Nl{constructor(t,s,c){this.context=t;const p=t.gl;this.buffer=p.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ul={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Vl{constructor(t,s,c,p){this.length=s.length,this.attributes=c,this.itemSize=s.bytesPerElement,this.dynamicDraw=p,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),t.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let c=0;c<this.attributes.length;c++){const p=s.attributes[this.attributes[c].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,s,c){for(let p=0;p<this.attributes.length;p++){const g=this.attributes[p],v=s.attributes[g.name];v!==void 0&&t.vertexAttribPointer(v,g.components,t[Ul[g.type]],!1,this.itemSize,g.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class zt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Pc extends zt{getDefault(){return u.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class sp extends zt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Fs extends zt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Os extends zt{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class zc extends zt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class vr extends zt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class jl extends zt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Aa extends zt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Pa extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class $l extends zt{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Gl extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class za extends zt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ql extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class Zl extends zt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ma extends zt{getDefault(){return u.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Mc extends zt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Dc extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class Wo extends zt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ap extends zt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class lp extends zt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class up extends zt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class cp extends zt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class hp extends zt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class dp extends zt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Wl extends zt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Da extends zt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Hl extends zt{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Xl extends zt{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class Ho extends zt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Lc extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Rc extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class La extends zt{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class ho extends La{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Bc extends La{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Xo{constructor(t,s,c,p){this.context=t,this.width=s,this.height=c;const g=t.gl,v=this.framebuffer=g.createFramebuffer();if(this.colorAttachment=new ho(t,v),p&&(this.depthAttachment=new Bc(t,v)),g.checkFramebufferStatus(g.FRAMEBUFFER)!==g.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const c=this.depthAttachment.get();c&&t.deleteRenderbuffer(c)}t.deleteFramebuffer(this.framebuffer)}}class Wt{constructor(t,s,c){this.blendFunction=t,this.blendColor=s,this.mask=c}}Wt.Replace=[1,0],Wt.disabled=new Wt(Wt.Replace,u.Color.transparent,[!1,!1,!1,!1]),Wt.unblended=new Wt(Wt.Replace,u.Color.transparent,[!0,!0,!0,!0]),Wt.alphaBlended=new Wt([1,771],u.Color.transparent,[!0,!0,!0,!0]);class Fc{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Pc(this),this.clearDepth=new sp(this),this.clearStencil=new Fs(this),this.colorMask=new Os(this),this.depthMask=new zc(this),this.stencilMask=new vr(this),this.stencilFunc=new jl(this),this.stencilOp=new Aa(this),this.stencilTest=new Pa(this),this.depthRange=new $l(this),this.depthTest=new Gl(this),this.depthFunc=new za(this),this.blend=new ql(this),this.blendFunc=new Zl(this),this.blendColor=new Ma(this),this.blendEquation=new Mc(this),this.cullFace=new Dc(this),this.cullFaceSide=new Wo(this),this.frontFace=new ap(this),this.program=new lp(this),this.activeTexture=new up(this),this.viewport=new cp(this),this.bindFramebuffer=new hp(this),this.bindRenderbuffer=new dp(this),this.bindTexture=new Wl(this),this.bindVertexBuffer=new Da(this),this.bindElementBuffer=new Hl(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Xl(this),this.pixelStoreUnpack=new Ho(this),this.pixelStoreUnpackPremultiplyAlpha=new Lc(this),this.pixelStoreUnpackFlipY=new Rc(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new Nl(this,t,s)}createVertexBuffer(t,s,c){return new Vl(this,t,s,c)}createRenderbuffer(t,s,c){const p=this.gl,g=p.createRenderbuffer();return this.bindRenderbuffer.set(g),p.renderbufferStorage(p.RENDERBUFFER,t,s,c),this.bindRenderbuffer.set(null),g}createFramebuffer(t,s,c){return new Xo(this,t,s,c)}clear({color:t,depth:s}){const c=this.gl;let p=0;t&&(p|=c.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(p|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),c.clear(p)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){oe(t.blendFunction,Wt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class St{constructor(t,s,c){this.func=t,this.mask=s,this.range=c}}St.ReadOnly=!1,St.ReadWrite=!0,St.disabled=new St(519,St.ReadOnly,[0,1]);const Mt=7680;class Gt{constructor(t,s,c,p,g,v){this.test=t,this.ref=s,this.mask=c,this.fail=p,this.depthFail=g,this.pass=v}}Gt.disabled=new Gt({func:519,mask:0},0,0,Mt,Mt,Mt);class Qt{constructor(t,s,c){this.enable=t,this.mode=s,this.frontFace=c}}let Ns;function Ko(h,t,s,c,p,g,v){const S=h.context,E=S.gl,C=h.useProgram("collisionBox"),P=[];let D=0,R=0;for(let W=0;W<c.length;W++){const pe=c[W],he=t.getTile(pe),xe=he.getBucket(s);if(!xe)continue;let ve=pe.posMatrix;p[0]===0&&p[1]===0||(ve=h.translatePosMatrix(pe.posMatrix,he,p,g));const Ie=v?xe.textCollisionBox:xe.iconCollisionBox,ye=xe.collisionCircleArray;if(ye.length>0){const $e=u.create(),Le=ve;u.mul($e,xe.placementInvProjMatrix,h.transform.glCoordMatrix),u.mul($e,$e,xe.placementViewportMatrix),P.push({circleArray:ye,circleOffset:R,transform:Le,invTransform:$e,coord:pe}),D+=ye.length/4,R=D}Ie&&C.draw(S,E.LINES,St.disabled,Gt.disabled,h.colorModeForRenderPass(),Qt.disabled,co(ve,h.transform,he),h.style.terrain&&h.style.terrain.getTerrainData(pe),s.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,null,h.transform.zoom,null,null,Ie.collisionVertexBuffer)}if(!v||!P.length)return;const q=h.useProgram("collisionCircle"),j=new u.CollisionCircleLayoutArray;j.resize(4*D),j._trim();let $=0;for(const W of P)for(let pe=0;pe<W.circleArray.length/4;pe++){const he=4*pe,xe=W.circleArray[he+0],ve=W.circleArray[he+1],Ie=W.circleArray[he+2],ye=W.circleArray[he+3];j.emplace($++,xe,ve,Ie,ye,0),j.emplace($++,xe,ve,Ie,ye,1),j.emplace($++,xe,ve,Ie,ye,2),j.emplace($++,xe,ve,Ie,ye,3)}(!Ns||Ns.length<2*D)&&(Ns=function(W){const pe=2*W,he=new u.QuadTriangleArray;he.resize(pe),he._trim();for(let xe=0;xe<pe;xe++){const ve=6*xe;he.uint16[ve+0]=4*xe+0,he.uint16[ve+1]=4*xe+1,he.uint16[ve+2]=4*xe+2,he.uint16[ve+3]=4*xe+2,he.uint16[ve+4]=4*xe+3,he.uint16[ve+5]=4*xe+0}return he}(D));const ee=S.createIndexBuffer(Ns,!0),re=S.createVertexBuffer(j,u.collisionCircleLayout.members,!0);for(const W of P){const pe={u_matrix:W.transform,u_inv_matrix:W.invTransform,u_camera_to_center_distance:(ce=h.transform).cameraToCenterDistance,u_viewport_size:[ce.width,ce.height]};q.draw(S,E.TRIANGLES,St.disabled,Gt.disabled,h.colorModeForRenderPass(),Qt.disabled,pe,h.style.terrain&&h.style.terrain.getTerrainData(W.coord),s.id,re,ee,u.SegmentVector.simpleSegment(0,2*W.circleOffset,W.circleArray.length,W.circleArray.length/2),null,h.transform.zoom,null,null,null)}var ce;re.destroy(),ee.destroy()}Qt.disabled=new Qt(!1,1029,2305),Qt.backCCW=new Qt(!0,1029,2305);const pp=u.identity(new Float32Array(16));function fp(h,t,s,c,p,g){const{horizontalAlign:v,verticalAlign:S}=u.getAnchorAlignment(h),E=-(v-.5)*t,C=-(S-.5)*s,P=u.evaluateVariableOffset(h,c);return new u.pointGeometry((E/p+P[0])*g,(C/p+P[1])*g)}function Oc(h,t,s,c,p,g,v,S,E,C,P){const D=h.text.placedSymbolArray,R=h.text.dynamicLayoutVertexArray,q=h.icon.dynamicLayoutVertexArray,j={};R.clear();for(let $=0;$<D.length;$++){const ee=D.get($),re=h.allowVerticalPlacement&&!ee.placedOrientation,ce=ee.hidden||!ee.crossTileID||re?null:c[ee.crossTileID];if(ce){const W=new u.pointGeometry(ee.anchorX,ee.anchorY),pe=kt(W,s?v:g,P),he=Dr(p.cameraToCenterDistance,pe.signedDistanceFromCamera);let xe=u.evaluateSizeForFeature(h.textSizeData,E,ee)*he/u.ONE_EM;s&&(xe*=h.tilePixelRatio/S);const{width:ve,height:Ie,anchor:ye,textOffset:$e,textBoxScale:Le}=ce,Ge=fp(ye,ve,Ie,$e,Le,xe),ft=s?kt(W.add(Ge),g,P).point:pe.point.add(t?Ge.rotate(-p.angle):Ge),_t=h.allowVerticalPlacement&&ee.placedOrientation===u.WritingMode.vertical?Math.PI/2:0;for(let rt=0;rt<ee.numGlyphs;rt++)u.addDynamicAttributes(R,ft,_t);C&&ee.associatedIconIndex>=0&&(j[ee.associatedIconIndex]={shiftedAnchor:ft,angle:_t})}else dt(ee.numGlyphs,R)}if(C){q.clear();const $=h.icon.placedSymbolArray;for(let ee=0;ee<$.length;ee++){const re=$.get(ee);if(re.hidden)dt(re.numGlyphs,q);else{const ce=j[ee];if(ce)for(let W=0;W<re.numGlyphs;W++)u.addDynamicAttributes(q,ce.shiftedAnchor,ce.angle);else dt(re.numGlyphs,q)}}h.icon.dynamicLayoutVertexBuffer.updateData(q)}h.text.dynamicLayoutVertexBuffer.updateData(R)}function mp(h,t,s){return s.iconsInText&&t?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Ra(h,t,s,c,p,g,v,S,E,C,P,D){const R=h.context,q=R.gl,j=h.transform,$=S==="map",ee=E==="map",re=S!=="viewport"&&s.layout.get("symbol-placement")!=="point",ce=$&&!ee&&!re,W=!s.layout.get("symbol-sort-key").isConstant();let pe=!1;const he=h.depthModeForSublayer(0,St.ReadOnly),xe=s.layout.get("text-variable-anchor"),ve=[];for(const Ie of c){const ye=t.getTile(Ie),$e=ye.getBucket(s);if(!$e)continue;const Le=p?$e.text:$e.icon;if(!Le||!Le.segments.get().length)continue;const Ge=Le.programConfigurations.get(s.id),ft=p||$e.sdfIcons,_t=p?$e.textSizeData:$e.iconSizeData,rt=ee||j.pitch!==0,Lt=h.useProgram(mp(ft,p,$e),Ge),Rt=u.evaluateSizeForZoom(_t,j.zoom),Et=h.style.terrain&&h.style.terrain.getTerrainData(Ie);let At,Nt,In,ci,Hr=[0,0],hi=null;if(p){if(Nt=ye.glyphAtlasTexture,In=q.LINEAR,At=ye.glyphAtlasTexture.size,$e.iconsInText){Hr=ye.imageAtlasTexture.size,hi=ye.imageAtlasTexture;const Br=_t.kind==="composite"||_t.kind==="camera";ci=rt||h.options.rotating||h.options.zooming||Br?q.LINEAR:q.NEAREST}}else{const Br=s.layout.get("icon-size").constantOr(0)!==1||$e.iconsNeedLinear;Nt=ye.imageAtlasTexture,In=ft||h.options.rotating||h.options.zooming||Br||rt?q.LINEAR:q.NEAREST,At=ye.imageAtlasTexture.size}const Ji=gn(ye,1,h.transform.zoom),Rr=so(Ie.posMatrix,ee,$,h.transform,Ji),sr=Zr(Ie.posMatrix,ee,$,h.transform,Ji),Ci=xe&&$e.hasTextData(),$a=s.layout.get("icon-text-fit")!=="none"&&Ci&&$e.hasIconData();if(re){const Br=h.style.terrain?(cu,ns)=>h.style.terrain.getElevation(Ie,cu,ns):null,go=s.layout.get("text-rotation-alignment")==="map";xr($e,Ie.posMatrix,h,p,Rr,sr,ee,C,go,Br)}const bn=h.translatePosMatrix(Ie.posMatrix,ye,g,v),vt=re||p&&xe||$a?pp:Rr,Dt=h.translatePosMatrix(sr,ye,g,v,!0),An=ft&&s.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Pn;Pn=ft?$e.iconsInText?Ac(_t.kind,Rt,ce,ee,h,bn,vt,Dt,At,Hr):Ia(_t.kind,Rt,ce,ee,h,bn,vt,Dt,p,At,!0):Fl(_t.kind,Rt,ce,ee,h,bn,vt,Dt,p,At);const tn={program:Lt,buffers:Le,uniformValues:Pn,atlasTexture:Nt,atlasTextureIcon:hi,atlasInterpolation:In,atlasInterpolationIcon:ci,isSDF:ft,hasHalo:An};if(W&&$e.canOverlap){pe=!0;const Br=Le.segments.get();for(const go of Br)ve.push({segments:new u.SegmentVector([go]),sortKey:go.sortKey,state:tn,terrainData:Et})}else ve.push({segments:Le.segments,sortKey:0,state:tn,terrainData:Et})}pe&&ve.sort((Ie,ye)=>Ie.sortKey-ye.sortKey);for(const Ie of ve){const ye=Ie.state;if(R.activeTexture.set(q.TEXTURE0),ye.atlasTexture.bind(ye.atlasInterpolation,q.CLAMP_TO_EDGE),ye.atlasTextureIcon&&(R.activeTexture.set(q.TEXTURE1),ye.atlasTextureIcon&&ye.atlasTextureIcon.bind(ye.atlasInterpolationIcon,q.CLAMP_TO_EDGE)),ye.isSDF){const $e=ye.uniformValues;ye.hasHalo&&($e.u_is_halo=1,Us(ye.buffers,Ie.segments,s,h,ye.program,he,P,D,$e,Ie.terrainData)),$e.u_is_halo=0}Us(ye.buffers,Ie.segments,s,h,ye.program,he,P,D,ye.uniformValues,Ie.terrainData)}}function Us(h,t,s,c,p,g,v,S,E,C){const P=c.context;p.draw(P,P.gl.TRIANGLES,g,v,S,Qt.disabled,E,C,s.id,h.layoutVertexBuffer,h.indexBuffer,t,s.paint,c.transform.zoom,h.programConfigurations.get(s.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function Vs(h,t,s,c,p,g,v){const S=h.context.gl,E=s.paint.get("fill-pattern"),C=E&&E.constantOr(1),P=s.getCrossfadeParameters();let D,R,q,j,$;v?(R=C&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",D=S.LINES):(R=C?"fillPattern":"fill",D=S.TRIANGLES);for(const ee of c){const re=t.getTile(ee);if(C&&!re.patternsLoaded())continue;const ce=re.getBucket(s);if(!ce)continue;const W=ce.programConfigurations.get(s.id),pe=h.useProgram(R,W),he=h.style.terrain&&h.style.terrain.getTerrainData(ee);C&&(h.context.activeTexture.set(S.TEXTURE0),re.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),W.updatePaintBuffers(P));const xe=E.constantOr(null);if(xe&&re.imageAtlas){const ye=re.imageAtlas,$e=ye.patternPositions[xe.to.toString()],Le=ye.patternPositions[xe.from.toString()];$e&&Le&&W.setConstantPatternPositions($e,Le)}const ve=he?ee:null,Ie=h.translatePosMatrix(ve?ve.posMatrix:ee.posMatrix,re,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(v){j=ce.indexBuffer2,$=ce.segments2;const ye=[S.drawingBufferWidth,S.drawingBufferHeight];q=R==="fillOutlinePattern"&&C?Tc(Ie,h,P,re,ye):Ec(Ie,ye)}else j=ce.indexBuffer,$=ce.segments,q=C?Rl(Ie,h,P,re):Ea(Ie);pe.draw(h.context,D,p,h.stencilModeForClipping(ee),g,Qt.disabled,q,he,s.id,ce.layoutVertexBuffer,j,$,s.paint,h.transform.zoom,W)}}function js(h,t,s,c,p,g,v){const S=h.context,E=S.gl,C=s.paint.get("fill-extrusion-pattern"),P=C.constantOr(1),D=s.getCrossfadeParameters(),R=s.paint.get("fill-extrusion-opacity");for(const q of c){const j=t.getTile(q),$=j.getBucket(s);if(!$)continue;const ee=h.style.terrain&&h.style.terrain.getTerrainData(q),re=$.programConfigurations.get(s.id),ce=h.useProgram(P?"fillExtrusionPattern":"fillExtrusion",re);P&&(h.context.activeTexture.set(E.TEXTURE0),j.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),re.updatePaintBuffers(D));const W=C.constantOr(null);if(W&&j.imageAtlas){const ve=j.imageAtlas,Ie=ve.patternPositions[W.to.toString()],ye=ve.patternPositions[W.from.toString()];Ie&&ye&&re.setConstantPatternPositions(Ie,ye)}const pe=h.translatePosMatrix(q.posMatrix,j,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),he=s.paint.get("fill-extrusion-vertical-gradient"),xe=P?rp(pe,h,he,R,q,D,j):Ll(pe,h,he,R);ce.draw(S,S.gl.TRIANGLES,p,g,v,Qt.backCCW,xe,ee,s.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,s.paint,h.transform.zoom,re,h.style.terrain&&$.centroidVertexBuffer)}}function Kl(h,t,s,c,p,g,v){const S=h.context,E=S.gl,C=s.fbo;if(!C)return;const P=h.useProgram("hillshade"),D=h.style.terrain&&h.style.terrain.getTerrainData(t);S.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,C.colorAttachment.get()),P.draw(S,E.TRIANGLES,p,g,v,Qt.disabled,((R,q,j,$)=>{const ee=j.paint.get("hillshade-shadow-color"),re=j.paint.get("hillshade-highlight-color"),ce=j.paint.get("hillshade-accent-color");let W=j.paint.get("hillshade-illumination-direction")*(Math.PI/180);j.paint.get("hillshade-illumination-anchor")==="viewport"&&(W-=R.transform.angle);const pe=!R.options.moving;return{u_matrix:$?$.posMatrix:R.transform.calculatePosMatrix(q.tileID.toUnwrapped(),pe),u_image:0,u_latrange:ka(0,q.tileID),u_light:[j.paint.get("hillshade-exaggeration"),W],u_shadow:ee,u_highlight:re,u_accent:ce}})(h,s,c,D?t:null),D,c.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}function Nc(h,t,s,c,p,g){const v=h.context,S=v.gl,E=t.dem;if(E&&E.data){const C=E.dim,P=E.stride,D=E.getPixels();if(v.activeTexture.set(S.TEXTURE1),v.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(P),t.demTexture){const q=t.demTexture;q.update(D,{premultiply:!1}),q.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else t.demTexture=new be(v,D,S.RGBA,{premultiply:!1}),t.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);v.activeTexture.set(S.TEXTURE0);let R=t.fbo;if(!R){const q=new be(v,{width:C,height:C,data:null},S.RGBA);q.bind(S.LINEAR,S.CLAMP_TO_EDGE),R=t.fbo=v.createFramebuffer(C,C,!0),R.colorAttachment.set(q.texture)}v.bindFramebuffer.set(R.framebuffer),v.viewport.set([0,0,C,C]),h.useProgram("hillshadePrepare").draw(v,S.TRIANGLES,c,p,g,Qt.disabled,((q,j)=>{const $=j.stride,ee=u.create();return u.ortho(ee,0,u.EXTENT,-u.EXTENT,0,0,1),u.translate(ee,ee,[0,-u.EXTENT,0]),{u_matrix:ee,u_image:1,u_dimension:[$,$],u_zoom:q.overscaledZ,u_unpack:j.getUnpackVector()}})(t.tileID,E),null,s.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Ba(h,t,s,c,p,g){const v=c.paint.get("raster-fade-duration");if(!g&&v>0){const S=u.exported.now(),E=(S-h.timeAdded)/v,C=t?(S-t.timeAdded)/v:-1,P=s.getSource(),D=p.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),R=!t||Math.abs(t.tileID.overscaledZ-D)>Math.abs(h.tileID.overscaledZ-D),q=R&&h.refreshedUponExpiration?1:u.clamp(R?E:1-C,0,1);return h.refreshedUponExpiration&&E>=1&&(h.refreshedUponExpiration=!1),t?{opacity:1,mix:1-q}:{opacity:q,mix:0}}return{opacity:1,mix:0}}const Fa=new u.Color(1,0,0,1),Wr=new u.Color(0,1,0,1),Uc=new u.Color(0,0,1,1),Jl=new u.Color(1,0,1,1),Vc=new u.Color(0,1,1,1);function po(h,t,s,c){Jo(h,0,t+s/2,h.transform.width,s,c)}function $s(h,t,s,c){Jo(h,t-s/2,0,s,h.transform.height,c)}function Jo(h,t,s,c,p,g){const v=h.context,S=v.gl;S.enable(S.SCISSOR_TEST),S.scissor(t*h.pixelRatio,s*h.pixelRatio,c*h.pixelRatio,p*h.pixelRatio),v.clear({color:g}),S.disable(S.SCISSOR_TEST)}function gp(h,t,s){const c=h.context,p=c.gl,g=s.posMatrix,v=h.useProgram("debug"),S=St.disabled,E=Gt.disabled,C=h.colorModeForRenderPass(),P="$debug",D=h.style.terrain&&h.style.terrain.getTerrainData(s);c.activeTexture.set(p.TEXTURE0),h.emptyTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE);const R=t.getTileByID(s.key).latestRawTileData,q=Math.floor((R&&R.byteLength||0)/1024),j=t.getTile(s).tileSize,$=512/Math.min(j,512)*(s.overscaledZ/h.transform.zoom)*.5;let ee=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(ee+=` => ${s.overscaledZ}`),function(re,ce){re.initDebugOverlayCanvas();const W=re.debugOverlayCanvas,pe=re.context.gl,he=re.debugOverlayCanvas.getContext("2d");he.clearRect(0,0,W.width,W.height),he.shadowColor="white",he.shadowBlur=2,he.lineWidth=1.5,he.strokeStyle="white",he.textBaseline="top",he.font="bold 36px Open Sans, sans-serif",he.fillText(ce,5,5),he.strokeText(ce,5,5),re.debugOverlayTexture.update(W),re.debugOverlayTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE)}(h,`${ee} ${q}kB`),v.draw(c,p.TRIANGLES,S,E,Wt.alphaBlended,Qt.disabled,Ls(g,u.Color.transparent,$),null,P,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments),v.draw(c,p.LINE_STRIP,S,E,C,Qt.disabled,Ls(g,u.Color.red),D,P,h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments)}function Oa(h,t,s){const c=h.context,p=c.gl,g=h.colorModeForRenderPass(),v=new St(p.LEQUAL,St.ReadWrite,h.depthRangeFor3D),S=h.useProgram("terrain"),E=t.getTerrainMesh(),C=t.getTerrainData(s.tileID);c.bindFramebuffer.set(null),c.viewport.set([0,0,h.width,h.height]),c.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,t.getRTTFramebuffer().colorAttachment.get());const P=h.transform.calculatePosMatrix(s.tileID.toUnwrapped());S.draw(c,p.TRIANGLES,v,Gt.disabled,g,Qt.backCCW,{u_matrix:P,u_texture:0},C,"terrain",E.vertexBuffer,E.indexBuffer,E.segments)}function jc(h,t,s,c){const p=h.context,g=s.tileSize*t.qualityFactor;s.textures[c]||(s.textures[c]=h.getTileTexture(g)||new be(p,{width:g,height:g,data:null},p.gl.RGBA),s.textures[c].bind(p.gl.LINEAR,p.gl.CLAMP_TO_EDGE),c===0&&t.sourceCache.renderHistory.unshift(s.tileID.key));const v=t.getRTTFramebuffer();v.colorAttachment.set(s.textures[c].texture),p.bindFramebuffer.set(v.framebuffer),p.viewport.set([0,0,g,g])}class $c{constructor(t){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=t,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=t.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const t=this.painter.style,s=t.terrain;for(const c in t.sourceCaches){this._coordsDescendingInv[c]={};const p=t.sourceCaches[c].getVisibleCoordinates();for(const g of p){const v=s.sourceCache.getTerrainCoords(g);for(const S in v)this._coordsDescendingInv[c][S]||(this._coordsDescendingInv[c][S]=[]),this._coordsDescendingInv[c][S].push(v[S])}}for(const c of t._order){const p=t._layers[c],g=p.source;if(this._renderToTexture[p.type]&&!this._coordsDescendingInvStr[g]){this._coordsDescendingInvStr[g]={};for(const v in this._coordsDescendingInv[g])this._coordsDescendingInvStr[g][v]=this._coordsDescendingInv[g][v].map(S=>S.key).sort().join()}}return this._renderableTiles.forEach(c=>{for(const p in this._coordsDescendingInvStr){const g=this._coordsDescendingInvStr[p][c.tileID.key];g&&g!==c.textureCoords[p]&&c.clearTextures(this.painter),s.needsRerender(p,c.tileID)&&c.clearTextures(this.painter)}this._rerender[c.tileID.key]=!c.textures.length}),s.clearRerenderCache(),s.sourceCache.removeOutdated(this.painter),this}renderLayer(t){const s=t.type,c=this.painter,p=c.style._order,g=c.currentLayer,v=g+1===p.length;if(this._renderToTexture[s]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(p[g]),!v))return!0;if(this._renderToTexture[this._prevType]||s==="hillshade"||this._renderToTexture[s]&&v){this._prevType=s;const S=this._stacks.length-1,E=this._stacks[S]||[];for(const C of this._renderableTiles){if(jc(c,c.style.terrain,C,S),this._rerender[C.tileID.key]){c.context.clear({color:u.Color.transparent});for(let P=0;P<E.length;P++){const D=c.style._layers[E[P]],R=D.source?this._coordsDescendingInv[D.source][C.tileID.key]:[C.tileID];c._renderTileClippingMasks(D,R),c.renderLayer(c,c.style.sourceCaches[D.source],D,R),D.source&&(C.textureCoords[D.source]=this._coordsDescendingInvStr[D.source][C.tileID.key])}}Oa(c,c.style.terrain,C)}if(s==="hillshade"){this._stacks.push([p[g]]);for(const C of this._renderableTiles){const P=this._coordsDescendingInv[t.source][C.tileID.key];jc(c,c.style.terrain,C,this._stacks.length-1),c.context.clear({color:u.Color.transparent}),c._renderTileClippingMasks(t,P),c.renderLayer(c,c.style.sourceCaches[t.source],t,P),Oa(c,c.style.terrain,C)}return!0}return this._renderToTexture[s]}return!1}}const Gs={symbol:function(h,t,s,c,p){if(h.renderPass!=="translucent")return;const g=Gt.disabled,v=h.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(S,E,C,P,D,R,q){const j=E.transform,$=D==="map",ee=R==="map";for(const re of S){const ce=P.getTile(re),W=ce.getBucket(C);if(!W||!W.text||!W.text.segments.get().length)continue;const pe=u.evaluateSizeForZoom(W.textSizeData,j.zoom),he=gn(ce,1,E.transform.zoom),xe=so(re.posMatrix,ee,$,E.transform,he),ve=C.layout.get("icon-text-fit")!=="none"&&W.hasIconData();if(pe){const Ie=Math.pow(2,j.zoom-ce.tileID.overscaledZ);Oc(W,$,ee,q,j,xe,re.posMatrix,Ie,pe,ve,E.style.terrain?(ye,$e)=>E.style.terrain.getElevation(re,ye,$e):null)}}}(c,h,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),p),s.paint.get("icon-opacity").constantOr(1)!==0&&Ra(h,t,s,c,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),g,v),s.paint.get("text-opacity").constantOr(1)!==0&&Ra(h,t,s,c,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),g,v),t.map.showCollisionBoxes&&(Ko(h,t,s,c,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),Ko(h,t,s,c,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(h,t,s,c){if(h.renderPass!=="translucent")return;const p=s.paint.get("circle-opacity"),g=s.paint.get("circle-stroke-width"),v=s.paint.get("circle-stroke-opacity"),S=!s.layout.get("circle-sort-key").isConstant();if(p.constantOr(1)===0&&(g.constantOr(1)===0||v.constantOr(1)===0))return;const E=h.context,C=E.gl,P=h.depthModeForSublayer(0,St.ReadOnly),D=Gt.disabled,R=h.colorModeForRenderPass(),q=[];for(let j=0;j<c.length;j++){const $=c[j],ee=t.getTile($),re=ee.getBucket(s);if(!re)continue;const ce=re.programConfigurations.get(s.id),W=h.useProgram("circle",ce),pe=re.layoutVertexBuffer,he=re.indexBuffer,xe=h.style.terrain&&h.style.terrain.getTerrainData($),ve={programConfiguration:ce,program:W,layoutVertexBuffer:pe,indexBuffer:he,uniformValues:kc(h,$,ee,s),terrainData:xe};if(S){const Ie=re.segments.get();for(const ye of Ie)q.push({segments:new u.SegmentVector([ye]),sortKey:ye.sortKey,state:ve})}else q.push({segments:re.segments,sortKey:0,state:ve})}S&&q.sort((j,$)=>j.sortKey-$.sortKey);for(const j of q){const{programConfiguration:$,program:ee,layoutVertexBuffer:re,indexBuffer:ce,uniformValues:W,terrainData:pe}=j.state;ee.draw(E,C.TRIANGLES,P,D,R,Qt.disabled,W,pe,s.id,re,ce,j.segments,s.paint,h.transform.zoom,$)}},heatmap:function(h,t,s,c){if(s.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const p=h.context,g=p.gl,v=Gt.disabled,S=new Wt([g.ONE,g.ONE],u.Color.transparent,[!0,!0,!0,!0]);(function(E,C,P){const D=E.gl;E.activeTexture.set(D.TEXTURE1),E.viewport.set([0,0,C.width/4,C.height/4]);let R=P.heatmapFbo;if(R)D.bindTexture(D.TEXTURE_2D,R.colorAttachment.get()),E.bindFramebuffer.set(R.framebuffer);else{const q=D.createTexture();D.bindTexture(D.TEXTURE_2D,q),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.LINEAR),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.LINEAR),R=P.heatmapFbo=E.createFramebuffer(C.width/4,C.height/4,!1),function(j,$,ee,re){const ce=j.gl;ce.texImage2D(ce.TEXTURE_2D,0,ce.RGBA,$.width/4,$.height/4,0,ce.RGBA,j.extRenderToTextureHalfFloat?j.extTextureHalfFloat.HALF_FLOAT_OES:ce.UNSIGNED_BYTE,null),re.colorAttachment.set(ee)}(E,C,q,R)}})(p,h,s),p.clear({color:u.Color.transparent});for(let E=0;E<c.length;E++){const C=c[E];if(t.hasRenderableParent(C))continue;const P=t.getTile(C),D=P.getBucket(s);if(!D)continue;const R=D.programConfigurations.get(s.id),q=h.useProgram("heatmap",R),{zoom:j}=h.transform;q.draw(p,g.TRIANGLES,St.disabled,v,S,Qt.disabled,Ta(C.posMatrix,P,j,s.paint.get("heatmap-intensity")),null,s.id,D.layoutVertexBuffer,D.indexBuffer,D.segments,s.paint,h.transform.zoom,R)}p.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(p,g){const v=p.context,S=v.gl,E=g.heatmapFbo;if(!E)return;v.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,E.colorAttachment.get()),v.activeTexture.set(S.TEXTURE1);let C=g.colorRampTexture;C||(C=g.colorRampTexture=new be(v,g.colorRamp,S.RGBA)),C.bind(S.LINEAR,S.CLAMP_TO_EDGE),p.useProgram("heatmapTexture").draw(v,S.TRIANGLES,St.disabled,Gt.disabled,p.colorModeForRenderPass(),Qt.disabled,((P,D,R,q)=>{const j=u.create();u.ortho(j,0,P.width,P.height,0,0,1);const $=P.context.gl;return{u_matrix:j,u_world:[$.drawingBufferWidth,$.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:D.paint.get("heatmap-opacity")}})(p,g),null,g.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,g.paint,p.transform.zoom)}(h,s))},line:function(h,t,s,c){if(h.renderPass!=="translucent")return;const p=s.paint.get("line-opacity"),g=s.paint.get("line-width");if(p.constantOr(1)===0||g.constantOr(1)===0)return;const v=h.depthModeForSublayer(0,St.ReadOnly),S=h.colorModeForRenderPass(),E=s.paint.get("line-dasharray"),C=s.paint.get("line-pattern"),P=C.constantOr(1),D=s.paint.get("line-gradient"),R=s.getCrossfadeParameters(),q=P?"linePattern":E?"lineSDF":D?"lineGradient":"line",j=h.context,$=j.gl;let ee=!0;for(const re of c){const ce=t.getTile(re);if(P&&!ce.patternsLoaded())continue;const W=ce.getBucket(s);if(!W)continue;const pe=W.programConfigurations.get(s.id),he=h.context.program.get(),xe=h.useProgram(q,pe),ve=ee||xe.program!==he,Ie=h.style.terrain&&h.style.terrain.getTerrainData(re),ye=C.constantOr(null);if(ye&&ce.imageAtlas){const Ge=ce.imageAtlas,ft=Ge.patternPositions[ye.to.toString()],_t=Ge.patternPositions[ye.from.toString()];ft&&_t&&pe.setConstantPatternPositions(ft,_t)}const $e=Ie?re:null,Le=P?Ca(h,ce,s,R,$e):E?Rs(h,ce,s,E,R,$e):D?Bl(h,ce,s,W.lineClipsArray.length,$e):Zo(h,ce,s,$e);if(P)j.activeTexture.set($.TEXTURE0),ce.imageAtlasTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),pe.updatePaintBuffers(R);else if(E&&(ve||h.lineAtlas.dirty))j.activeTexture.set($.TEXTURE0),h.lineAtlas.bind(j);else if(D){const Ge=W.gradients[s.id];let ft=Ge.texture;if(s.gradientVersion!==Ge.version){let _t=256;if(s.stepInterpolant){const rt=t.getSource().maxzoom,Lt=re.canonical.z===rt?Math.ceil(1<<h.transform.maxZoom-re.canonical.z):1;_t=u.clamp(u.nextPowerOfTwo(W.maxLineLength/u.EXTENT*1024*Lt),256,j.maxTextureSize)}Ge.gradient=u.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:_t,image:Ge.gradient||void 0,clips:W.lineClipsArray}),Ge.texture?Ge.texture.update(Ge.gradient):Ge.texture=new be(j,Ge.gradient,$.RGBA),Ge.version=s.gradientVersion,ft=Ge.texture}j.activeTexture.set($.TEXTURE0),ft.bind(s.stepInterpolant?$.NEAREST:$.LINEAR,$.CLAMP_TO_EDGE)}xe.draw(j,$.TRIANGLES,v,h.stencilModeForClipping(re),S,Qt.disabled,Le,Ie,s.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,s.paint,h.transform.zoom,pe,W.layoutVertexBuffer2),ee=!1}},fill:function(h,t,s,c){const p=s.paint.get("fill-color"),g=s.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const v=h.colorModeForRenderPass(),S=s.paint.get("fill-pattern"),E=h.opaquePassEnabledForLayer()&&!S.constantOr(1)&&p.constantOr(u.Color.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===E){const C=h.depthModeForSublayer(1,h.renderPass==="opaque"?St.ReadWrite:St.ReadOnly);Vs(h,t,s,c,C,v,!1)}if(h.renderPass==="translucent"&&s.paint.get("fill-antialias")){const C=h.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,St.ReadOnly);Vs(h,t,s,c,C,v,!0)}},"fill-extrusion":function(h,t,s,c){const p=s.paint.get("fill-extrusion-opacity");if(p!==0&&h.renderPass==="translucent"){const g=new St(h.context.gl.LEQUAL,St.ReadWrite,h.depthRangeFor3D);if(p!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))js(h,t,s,c,g,Gt.disabled,Wt.disabled),js(h,t,s,c,g,h.stencilModeFor3D(),h.colorModeForRenderPass());else{const v=h.colorModeForRenderPass();js(h,t,s,c,g,Gt.disabled,v)}}},hillshade:function(h,t,s,c){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const p=h.context,g=h.depthModeForSublayer(0,St.ReadOnly),v=h.colorModeForRenderPass(),[S,E]=h.renderPass==="translucent"?h.stencilConfigForOverlap(c):[{},c];for(const C of E){const P=t.getTile(C);P.needsHillshadePrepare!==void 0&&P.needsHillshadePrepare&&h.renderPass==="offscreen"?Nc(h,P,s,g,Gt.disabled,v):h.renderPass==="translucent"&&Kl(h,C,P,s,g,S[C.overscaledZ],v)}p.viewport.set([0,0,h.width,h.height])},raster:function(h,t,s,c){if(h.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!c.length)return;const p=h.context,g=p.gl,v=t.getSource(),S=h.useProgram("raster"),E=h.colorModeForRenderPass(),[C,P]=v instanceof lt?[{},c]:h.stencilConfigForOverlap(c),D=P[P.length-1].overscaledZ,R=!h.options.moving;for(const q of P){const j=h.depthModeForSublayer(q.overscaledZ-D,s.paint.get("raster-opacity")===1?St.ReadWrite:St.ReadOnly,g.LESS),$=t.getTile(q);$.registerFadeDuration(s.paint.get("raster-fade-duration"));const ee=t.findLoadedParent(q,0),re=Ba($,ee,t,s,h.transform,h.style.terrain);let ce,W;const pe=s.paint.get("raster-resampling")==="nearest"?g.NEAREST:g.LINEAR;p.activeTexture.set(g.TEXTURE0),$.texture.bind(pe,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST),p.activeTexture.set(g.TEXTURE1),ee?(ee.texture.bind(pe,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST),ce=Math.pow(2,ee.tileID.overscaledZ-$.tileID.overscaledZ),W=[$.tileID.canonical.x*ce%1,$.tileID.canonical.y*ce%1]):$.texture.bind(pe,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST);const he=h.style.terrain&&h.style.terrain.getTerrainData(q),xe=he?q:null,ve=xe?xe.posMatrix:h.transform.calculatePosMatrix(q.toUnwrapped(),R),Ie=Cc(ve,W||[0,0],ce||1,re,s);v instanceof lt?S.draw(p,g.TRIANGLES,j,Gt.disabled,E,Qt.disabled,Ie,he,s.id,v.boundsBuffer,h.quadTriangleIndexBuffer,v.boundsSegments):S.draw(p,g.TRIANGLES,j,C[q.overscaledZ],E,Qt.disabled,Ie,he,s.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}},background:function(h,t,s,c){const p=s.paint.get("background-color"),g=s.paint.get("background-opacity");if(g===0)return;const v=h.context,S=v.gl,E=h.transform,C=E.tileSize,P=s.paint.get("background-pattern");if(h.isPatternMissing(P))return;const D=!P&&p.a===1&&g===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==D)return;const R=Gt.disabled,q=h.depthModeForSublayer(0,D==="opaque"?St.ReadWrite:St.ReadOnly),j=h.colorModeForRenderPass(),$=h.useProgram(P?"backgroundPattern":"background"),ee=c||E.coveringTiles({tileSize:C,terrain:h.style.terrain});P&&(v.activeTexture.set(S.TEXTURE0),h.imageManager.bind(h.context));const re=s.getCrossfadeParameters();for(const ce of ee){const W=c?ce.posMatrix:h.transform.calculatePosMatrix(ce.toUnwrapped()),pe=P?op(W,g,h,P,{tileID:ce,tileSize:C},re):ip(W,g,p),he=h.style.terrain&&h.style.terrain.getTerrainData(ce);$.draw(v,S.TRIANGLES,q,R,j,Qt.disabled,pe,he,s.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}},debug:function(h,t,s){for(let c=0;c<s.length;c++)gp(h,t,s[c])},custom:function(h,t,s){const c=h.context,p=s.implementation;if(h.renderPass==="offscreen"){const g=p.prerender;g&&(h.setCustomLayerDefaults(),c.setColorMode(h.colorModeForRenderPass()),g.call(p,c.gl,h.transform.customLayerMatrix()),c.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),c.setColorMode(h.colorModeForRenderPass()),c.setStencilMode(Gt.disabled);const g=p.renderingMode==="3d"?new St(h.context.gl.LEQUAL,St.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,St.ReadOnly);c.setDepthMode(g),p.render(c.gl,h.transform.customLayerMatrix()),c.setDirty(),h.setBaseState(),c.bindFramebuffer.set(null)}}};class Yl{constructor(t,s){this.context=new Fc(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.create(),renderTime:0},this.setup(),this.numSublayers=ir.maxUnderzooming+ir.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ut,this.gpuTimers={}}resize(t,s,c){if(this.width=t*c,this.height=s*c,this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const t=this.context,s=new u.PosArray;s.emplaceBack(0,0),s.emplaceBack(u.EXTENT,0),s.emplaceBack(0,u.EXTENT),s.emplaceBack(u.EXTENT,u.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(s,Ct.members),this.tileExtentSegments=u.SegmentVector.simpleSegment(0,0,4,2);const c=new u.PosArray;c.emplaceBack(0,0),c.emplaceBack(u.EXTENT,0),c.emplaceBack(0,u.EXTENT),c.emplaceBack(u.EXTENT,u.EXTENT),this.debugBuffer=t.createVertexBuffer(c,Ct.members),this.debugSegments=u.SegmentVector.simpleSegment(0,0,4,5);const p=new u.RasterBoundsArray;p.emplaceBack(0,0,0,0),p.emplaceBack(u.EXTENT,0,u.EXTENT,0),p.emplaceBack(0,u.EXTENT,0,u.EXTENT),p.emplaceBack(u.EXTENT,u.EXTENT,u.EXTENT,u.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(p,Ze.members),this.rasterBoundsSegments=u.SegmentVector.simpleSegment(0,0,4,2);const g=new u.PosArray;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,Ct.members),this.viewportSegments=u.SegmentVector.simpleSegment(0,0,4,2);const v=new u.LineStripIndexArray;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(v);const S=new u.TriangleIndexArray;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(S),this.emptyTexture=new be(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);const E=this.context.gl;this.stencilClearMode=new Gt({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=u.create();u.ortho(c,0,this.width,this.height,0,0,1),u.scale(c,c,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,s.TRIANGLES,St.disabled,this.stencilClearMode,Wt.disabled,Qt.disabled,qo(c),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source;const c=this.context,p=c.gl;this.nextStencilID+s.length>256&&this.clearStencil(),c.setColorMode(Wt.disabled),c.setDepthMode(St.disabled);const g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of s){const S=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,E=this.style.terrain&&this.style.terrain.getTerrainData(v);g.draw(c,p.TRIANGLES,St.disabled,new Gt({func:p.ALWAYS,mask:0},S,255,p.KEEP,p.KEEP,p.REPLACE),Wt.disabled,Qt.disabled,qo(v.posMatrix),E,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new Gt({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new Gt({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,c=t.sort((v,S)=>S.overscaledZ-v.overscaledZ),p=c[c.length-1].overscaledZ,g=c[0].overscaledZ-p+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const v={};for(let S=0;S<g;S++)v[S+p]=new Gt({func:s.GEQUAL,mask:255},S+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=g,[v,c]}return[{[p]:Gt.disabled},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Wt([t.CONSTANT_COLOR,t.ONE],new u.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Wt.unblended:Wt.alphaBlended}depthModeForSublayer(t,s,c){if(!this.opaquePassEnabledForLayer())return St.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new St(c||this.context.gl.LEQUAL,s,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(u.exported.now()),this.imageManager.beginFrame();const c=this.style._order,p=this.style.sourceCaches,g=this.style.terrain&&new $c(this);for(const C in p){const P=p[C];P.used&&P.prepare(this.context)}const v={},S={},E={};for(const C in p){const P=p[C];v[C]=P.getVisibleCoordinates(),S[C]=v[C].slice().reverse(),E[C]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let C=0;C<c.length;C++)if(this.style._layers[c[C]].is3D()){this.opaquePassCutoff=C;break}if(g){this.opaquePassCutoff=0;const C=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!u.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||C.length)&&(u.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(P,D){const R=P.context,q=R.gl,j=Wt.unblended,$=new St(q.LEQUAL,St.ReadWrite,[0,1]),ee=D.getTerrainMesh(),re=D.sourceCache.getRenderableTiles(),ce=P.useProgram("terrainDepth");R.bindFramebuffer.set(D.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,P.width/devicePixelRatio,P.height/devicePixelRatio]),R.clear({color:u.Color.transparent,depth:1});for(const W of re){const pe=D.getTerrainData(W.tileID),he=P.transform.calculatePosMatrix(W.tileID.toUnwrapped());ce.draw(R,q.TRIANGLES,$,Gt.disabled,j,Qt.backCCW,{u_matrix:he},pe,"terrain",ee.vertexBuffer,ee.indexBuffer,ee.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,P.width,P.height])}(this,this.style.terrain),function(P,D){const R=P.context,q=R.gl,j=Wt.unblended,$=new St(q.LEQUAL,St.ReadWrite,[0,1]),ee=D.getTerrainMesh(),re=D.getCoordsTexture(),ce=D.sourceCache.getRenderableTiles(),W=P.useProgram("terrainCoords");R.bindFramebuffer.set(D.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,P.width/devicePixelRatio,P.height/devicePixelRatio]),R.clear({color:u.Color.transparent,depth:1}),D.coordsIndex=[];for(const pe of ce){const he=D.getTerrainData(pe.tileID);R.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,re.texture);const xe=P.transform.calculatePosMatrix(pe.tileID.toUnwrapped());W.draw(R,q.TRIANGLES,$,Gt.disabled,j,Qt.backCCW,{u_matrix:xe,u_terrain_coords_id:(255-D.coordsIndex.length)/255,u_texture:0},he,"terrain",ee.vertexBuffer,ee.indexBuffer,ee.segments),D.coordsIndex.push(pe.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,P.width,P.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const C of c){const P=this.style._layers[C];if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;const D=S[P.source];(P.type==="custom"||D.length)&&this.renderLayer(this,p[P.source],P,D)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?u.Color.black:u.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!g)for(this.renderPass="opaque",this.currentLayer=c.length-1;this.currentLayer>=0;this.currentLayer--){const C=this.style._layers[c[this.currentLayer]],P=p[C.source],D=v[C.source];this._renderTileClippingMasks(C,D),this.renderLayer(this,P,C,D)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<c.length;this.currentLayer++){const C=this.style._layers[c[this.currentLayer]],P=p[C.source];if(g&&g.renderLayer(C))continue;const D=(C.type==="symbol"?E:S)[C.source];this._renderTileClippingMasks(C,v[C.source]),this.renderLayer(this,P,C,D)}if(this.options.showTileBoundaries){let C,P;Object.values(this.style._layers).forEach(D=>{D.source&&!D.isHidden(this.transform.zoom)&&(D.source!==(P&&P.id)&&(P=this.style.sourceCaches[D.source]),(!C||C.getSource().maxzoom<P.getSource().maxzoom)&&(C=P))}),C&&Gs.debug(this,C,C.getVisibleCoordinates())}this.options.showPadding&&function(C){const P=C.transform.padding;po(C,C.transform.height-(P.top||0),3,Fa),po(C,P.bottom||0,3,Wr),$s(C,P.left||0,3,Uc),$s(C,C.transform.width-(P.right||0),3,Jl);const D=C.transform.centerPoint;(function(R,q,j,$){Jo(R,q-1,j-10,2,20,$),Jo(R,q-10,j-1,20,2,$)})(C,D.x,C.transform.height-D.y,Vc)}(this),this.context.setDefault()}renderLayer(t,s,c,p){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||(p||[]).length)&&(this.id=c.id,this.gpuTimingStart(c),Gs[c.type](t,s,c,p,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let c=this.gpuTimers[t.id];c||(c=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),c.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,c.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const s={};for(const c in t){const p=t[c],g=this.context.extTimerQuery,v=g.getQueryObjectEXT(p.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(p.query),s[c]=v}return s}translatePosMatrix(t,s,c,p,g){if(!c[0]&&!c[1])return t;const v=g?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(v){const C=Math.sin(v),P=Math.cos(v);c=[c[0]*P-c[1]*C,c[0]*C+c[1]*P]}const S=[g?c[0]:gn(s,c[0],this.transform.zoom),g?c[1]:gn(s,c[1],this.transform.zoom),0],E=new Float32Array(16);return u.translate(E,t,S),E}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),c=this.imageManager.getPattern(t.to.toString());return!s||!c}useProgram(t,s){this.cache=this.cache||{};const c=t+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[c]||(this.cache[c]=new bc(this.context,t,Ds[t],s,Ol[t],this._showOverdrawInspector,this.style.terrain)),this.cache[c]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new be(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class Na{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,c){const p=Math.pow(2,c),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const E=1/(S=u.transformMat4([],S,t))[3]/s*p;return u.mul$1(S,S,[E,E,1/S[3],E])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const E=u.sub([],g[S[0]],g[S[1]]),C=u.sub([],g[S[2]],g[S[1]]),P=u.normalize([],u.cross([],E,C)),D=-u.dot(P,g[S[1]]);return P.concat(D)});return new Na(g,v)}}class qs{constructor(t,s){this.min=t,this.max=s,this.center=u.scale$1([],u.add([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],c=u.clone$2(this.min),p=u.clone$2(this.max);for(let g=0;g<s.length;g++)c[g]=s[g]?this.min[g]:this.center[g],p[g]=s[g]?this.center[g]:this.max[g];return p[2]=this.max[2],new qs(c,p)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let c=!0;for(let p=0;p<t.planes.length;p++){const g=t.planes[p];let v=0;for(let S=0;S<s.length;S++)u.dot$1(g,s[S])>=0&&v++;if(v===0)return 0;v!==s.length&&(c=!1)}if(c)return 2;for(let p=0;p<3;p++){let g=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let S=0;S<t.points.length;S++){const E=t.points[S][p]-this.min[p];g=Math.min(g,E),v=Math.max(v,E)}if(v<0||g>this.max[p]-this.min[p])return 0}return 1}}class Yo{constructor(t=0,s=0,c=0,p=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(c)||c<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=c,this.right=p}interpolate(t,s,c){return s.top!=null&&t.top!=null&&(this.top=u.number(t.top,s.top,c)),s.bottom!=null&&t.bottom!=null&&(this.bottom=u.number(t.bottom,s.bottom,c)),s.left!=null&&t.left!=null&&(this.left=u.number(t.left,s.left,c)),s.right!=null&&t.right!=null&&(this.right=u.number(t.right,s.right,c)),this}getCenter(t,s){const c=u.clamp((this.left+t-this.right)/2,0,t),p=u.clamp((this.top+s-this.bottom)/2,0,s);return new u.pointGeometry(c,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Yo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Zs{constructor(t,s,c,p,g){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=g===void 0||!!g,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=c??0,this._maxPitch=p??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new u.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Yo,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const t=new Zs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t._elevation=this._elevation,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const s=-u.wrap(t,-180,180)*Math.PI/180;var c;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(c=new u.ARRAY_TYPE(4),u.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c),function(p,g,v){var S=g[0],E=g[1],C=g[2],P=g[3],D=Math.sin(v),R=Math.cos(v);p[0]=S*R+C*D,p[1]=E*R+P*D,p[2]=S*-D+C*R,p[3]=E*-D+P*R}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=u.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,c){this._unmodified=!1,this._edgeInsets.interpolate(t,s,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new u.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const c=this.pointCoordinate(new u.pointGeometry(0,0)),p=this.pointCoordinate(new u.pointGeometry(this.width,0)),g=this.pointCoordinate(new u.pointGeometry(this.width,this.height)),v=this.pointCoordinate(new u.pointGeometry(0,this.height)),S=Math.floor(Math.min(c.x,p.x,g.x,v.x)),E=Math.floor(Math.max(c.x,p.x,g.x,v.x)),C=1;for(let P=S-C;P<=E+C;P++)P!==0&&s.push(new u.UnwrappedTileID(P,t))}return s}coveringTiles(t){var s,c;let p=this.coveringZoomLevel(t);const g=p;if(t.minzoom!==void 0&&p<t.minzoom)return[];t.maxzoom!==void 0&&p>t.maxzoom&&(p=t.maxzoom);const v=this.pointCoordinate(this.getCameraPoint()),S=u.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,p),C=[E*v.x,E*v.y,0],P=[E*S.x,E*S.y,0],D=Na.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p);let R=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(R=p);const q=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,j=W=>({aabb:new qs([W*E,0,0],[(W+1)*E,E,0]),zoom:0,x:0,y:0,wrap:W,fullyVisible:!1}),$=[],ee=[],re=p,ce=t.reparseOverscaled?g:p;if(this._renderWorldCopies)for(let W=1;W<=3;W++)$.push(j(-W)),$.push(j(W));for($.push(j(0));$.length>0;){const W=$.pop(),pe=W.x,he=W.y;let xe=W.fullyVisible;if(!xe){const Ge=W.aabb.intersects(D);if(Ge===0)continue;xe=Ge===2}const ve=t.terrain?C:P,Ie=W.aabb.distanceX(ve),ye=W.aabb.distanceY(ve),$e=Math.max(Math.abs(Ie),Math.abs(ye)),Le=q+(1<<re-W.zoom)-2;if(W.zoom===re||$e>Le&&W.zoom>=R){const Ge=re-W.zoom,ft=C[0]-.5-(pe<<Ge),_t=C[1]-.5-(he<<Ge);ee.push({tileID:new u.OverscaledTileID(W.zoom===re?ce:W.zoom,W.wrap,W.zoom,pe,he),distanceSq:u.sqrLen([P[0]-.5-pe,P[1]-.5-he]),tileDistanceToCamera:Math.sqrt(ft*ft+_t*_t)})}else for(let Ge=0;Ge<4;Ge++){const ft=(pe<<1)+Ge%2,_t=(he<<1)+(Ge>>1),rt=W.zoom+1;let Lt=W.aabb.quadrant(Ge);if(t.terrain){const Rt=new u.OverscaledTileID(rt,W.wrap,rt,ft,_t),Et=t.terrain.getMinMaxElevation(Rt),At=(s=Et.minElevation)!==null&&s!==void 0?s:this.elevation,Nt=(c=Et.maxElevation)!==null&&c!==void 0?c:this.elevation;Lt=new qs([Lt.min[0],Lt.min[1],At],[Lt.max[0],Lt.max[1],Nt])}$.push({aabb:Lt,zoom:rt,x:ft,y:_t,wrap:W.wrap,fullyVisible:xe})}}return ee.sort((W,pe)=>W.distanceSq-pe.distanceSq).map(W=>W.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=u.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new u.pointGeometry(u.mercatorXfromLng(t.lng)*this.worldSize,u.mercatorYfromLat(s)*this.worldSize)}unproject(t){return new u.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(t){this.freezeElevation||(this.elevation=t?this.getElevation(this._center,t):0)}getElevation(t,s){const c=u.MercatorCoordinate.fromLngLat(t),p=(1<<this.tileZoom)*u.EXTENT,g=c.x*p,v=c.y*p,S=Math.floor(g/u.EXTENT),E=Math.floor(v/u.EXTENT),C=new u.OverscaledTileID(this.tileZoom,0,this.tileZoom,S,E);return s.getElevation(C,g%u.EXTENT,v%u.EXTENT,u.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const s=this.pointLocation(this.centerPoint,t),c=this.getElevation(s,t);if(!(this.elevation-c))return;const p=this.getCameraPosition(),g=u.MercatorCoordinate.fromLngLat(p.lngLat,p.altitude),v=u.MercatorCoordinate.fromLngLat(s,c),S=g.x-v.x,E=g.y-v.y,C=g.z-v.z,P=Math.sqrt(S*S+E*E+C*C),D=this.scaleZoom(this.cameraToCenterDistance/P/this.tileSize);this._elevation=c,this._center=s,this.zoom=D}setLocationAtPoint(t,s){const c=this.pointCoordinate(s),p=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(t),v=new u.MercatorCoordinate(g.x-(c.x-p.x),g.y-(c.y-p.y));this.center=this.coordinateLocation(v),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,s){return s?this.coordinatePoint(this.locationCoordinate(t),this.getElevation(t,s),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,s){return this.coordinateLocation(this.pointCoordinate(t,s))}locationCoordinate(t){return u.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,s){if(s){const R=s.pointCoordinate(t);if(R!=null)return R}const c=[t.x,t.y,0,1],p=[t.x,t.y,1,1];u.transformMat4(c,c,this.pixelMatrixInverse),u.transformMat4(p,p,this.pixelMatrixInverse);const g=c[3],v=p[3],S=c[1]/g,E=p[1]/v,C=c[2]/g,P=p[2]/v,D=C===P?0:(0-C)/(P-C);return new u.MercatorCoordinate(u.number(c[0]/g,p[0]/v,D)/this.worldSize,u.number(S,E,D)/this.worldSize)}coordinatePoint(t,s=0,c=this.pixelMatrix){const p=[t.x*this.worldSize,t.y*this.worldSize,s,1];return u.transformMat4(p,p,c),new u.pointGeometry(p[0]/p[3],p[1]/p[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new u.LngLatBounds().extend(this.pointLocation(new u.pointGeometry(0,t))).extend(this.pointLocation(new u.pointGeometry(this.width,t))).extend(this.pointLocation(new u.pointGeometry(this.width,this.height))).extend(this.pointLocation(new u.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new u.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,s=!1){const c=t.key,p=s?this._alignedPosMatrixCache:this._posMatrixCache;if(p[c])return p[c];const g=t.canonical,v=this.worldSize/this.zoomScale(g.z),S=g.x+Math.pow(2,g.z)*t.wrap,E=u.identity(new Float64Array(16));return u.translate(E,E,[S*v,g.y*v,0]),u.scale(E,E,[v/u.EXTENT,v/u.EXTENT,1]),u.multiply(E,s?this.alignedProjMatrix:this.projMatrix,E),p[c]=new Float32Array(E),p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,s,c,p,g=-90,v=90,S=-180,E=180;const C=this.size,P=this._unmodified;if(this.latRange){const q=this.latRange;g=u.mercatorYfromLat(q[1])*this.worldSize,v=u.mercatorYfromLat(q[0])*this.worldSize,t=v-g<C.y?C.y/(v-g):0}if(this.lngRange){const q=this.lngRange;S=u.wrap(u.mercatorXfromLng(q[0])*this.worldSize,0,this.worldSize),E=u.wrap(u.mercatorXfromLng(q[1])*this.worldSize,0,this.worldSize),E<S&&(E+=this.worldSize),s=E-S<C.x?C.x/(E-S):0}const D=this.point,R=Math.max(s||0,t||0);if(R)return this.center=this.unproject(new u.pointGeometry(s?(E+S)/2:D.x,t?(v+g)/2:D.y)),this.zoom+=this.scaleZoom(R),this._unmodified=P,void(this._constraining=!1);if(this.latRange){const q=D.y,j=C.y/2;q-j<g&&(p=g+j),q+j>v&&(p=v-j)}if(this.lngRange){const q=(S+E)/2,j=u.wrap(D.x,q-this.worldSize/2,q+this.worldSize/2),$=C.x/2;j-$<S&&(c=S+$),j+$>E&&(c=E-$)}c===void 0&&p===void 0||(this.center=this.unproject(new u.pointGeometry(c!==void 0?c:D.x,p!==void 0?p:D.y)).wrap()),this._unmodified=P,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.point.x,c=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=u.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let p=u.identity(new Float64Array(16));u.scale(p,p,[this.width/2,-this.height/2,1]),u.translate(p,p,[1,-1,0]),this.labelPlaneMatrix=p,p=u.identity(new Float64Array(16)),u.scale(p,p,[1,-1,1]),u.translate(p,p,[-1,-1,0]),u.scale(p,p,[2/this.width,2/this.height,1]),this.glCoordMatrix=p,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const g=Math.PI/2+this._pitch,v=this._fov*(.5+t.y/this.height),S=Math.sin(v)*this.cameraToSeaLevelDistance/Math.sin(u.clamp(Math.PI-g-v,.01,Math.PI-.01)),E=this.getHorizon(),C=2*Math.atan(E/this.cameraToCenterDistance)*(.5+t.y/(2*E)),P=Math.sin(C)*this.cameraToSeaLevelDistance/Math.sin(u.clamp(Math.PI-g-C,.01,Math.PI-.01)),D=Math.cos(Math.PI/2-this._pitch)*S+this.cameraToSeaLevelDistance,R=Math.cos(Math.PI/2-this._pitch)*P+this.cameraToSeaLevelDistance,q=1.01*Math.min(D,R),j=this.height/50;p=new Float64Array(16),u.perspective(p,this._fov,this.width/this.height,j,q),p[8]=2*-t.x/this.width,p[9]=2*t.y/this.height,u.scale(p,p,[1,-1,1]),u.translate(p,p,[0,0,-this.cameraToCenterDistance]),u.rotateX(p,p,this._pitch),u.rotateZ(p,p,this.angle),u.translate(p,p,[-s,-c,0]),this.mercatorMatrix=u.scale([],p,[this.worldSize,this.worldSize,this.worldSize]),u.scale(p,p,[1,1,this._pixelPerMeter]),this.pixelMatrix=u.multiply(new Float64Array(16),this.labelPlaneMatrix,p),u.translate(p,p,[0,0,-this.elevation]),this.projMatrix=p,this.invProjMatrix=u.invert([],p),this.pixelMatrix3D=u.multiply(new Float64Array(16),this.labelPlaneMatrix,p);const $=this.width%2/2,ee=this.height%2/2,re=Math.cos(this.angle),ce=Math.sin(this.angle),W=s-Math.round(s)+re*$+ce*ee,pe=c-Math.round(c)+re*ee+ce*$,he=new Float64Array(p);if(u.translate(he,he,[W>.5?W-1:W,pe>.5?pe-1:pe,0]),this.alignedProjMatrix=he,p=u.invert(new Float64Array(16),this.pixelMatrix),!p)throw new Error("failed to invert matrix");this.pixelMatrixInverse=p,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new u.pointGeometry(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return u.transformMat4(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.pointGeometry(0,t))}getCameraQueryGeometry(t){const s=this.getCameraPoint();if(t.length===1)return[t[0],s];{let c=s.x,p=s.y,g=s.x,v=s.y;for(const S of t)c=Math.min(c,S.x),p=Math.min(p,S.y),g=Math.max(g,S.x),v=Math.max(v,S.y);return[new u.pointGeometry(c,p),new u.pointGeometry(g,p),new u.pointGeometry(g,v),new u.pointGeometry(c,v),new u.pointGeometry(c,p)]}}}class Gc{constructor(t){this._hashName=t&&encodeURIComponent(t),u.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(s,c){let p=!1,g=null;const v=()=>{g=null,p&&(s(),g=setTimeout(v,300),p=!1)};return()=>(p=!0,g||v(),g)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const s=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,p=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,p),v=Math.round(s.lng*g)/g,S=Math.round(s.lat*g)/g,E=this._map.getBearing(),C=this._map.getPitch();let P="";if(P+=t?`/${v}/${S}/${c}`:`${c}/${S}/${v}`,(E||C)&&(P+="/"+Math.round(10*E)/10),C&&(P+=`/${Math.round(C)}`),this._hashName){const D=this._hashName;let R=!1;const q=window.location.hash.slice(1).split("&").map(j=>{const $=j.split("=")[0];return $===D?(R=!0,`${$}=${P}`):j}).filter(j=>j);return R||q.push(`${D}=${P}`),`#${q.join("&")}`}return`#${P}`}_getCurrentHash(){const t=window.location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(s=c)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(s=>isNaN(s))){const s=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:s,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch{}}}const Ws={linearity:.3,easing:u.bezier(0,0,.3,1)},qc=u.extend({deceleration:2500,maxSpeed:1400},Ws),Zc=u.extend({deceleration:20,maxSpeed:1400},Ws),Wc=u.extend({deceleration:1e3,maxSpeed:360},Ws),Qo=u.extend({deceleration:1e3,maxSpeed:90},Ws);class Hc{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:u.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=u.exported.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new u.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)s.zoom+=g.zoomDelta||0,s.bearing+=g.bearingDelta||0,s.pitch+=g.pitchDelta||0,g.panDelta&&s.pan._add(g.panDelta),g.around&&(s.around=g.around),g.pinchAround&&(s.pinchAround=g.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(s.pan.mag()){const g=Xs(s.pan.mag(),c,u.extend({},qc,t||{}));p.offset=s.pan.mult(g.amount/s.pan.mag()),p.center=this._map.transform.center,Hs(p,g)}if(s.zoom){const g=Xs(s.zoom,c,Zc);p.zoom=this._map.transform.zoom+g.amount,Hs(p,g)}if(s.bearing){const g=Xs(s.bearing,c,Wc);p.bearing=this._map.transform.bearing+u.clamp(g.amount,-179,179),Hs(p,g)}if(s.pitch){const g=Xs(s.pitch,c,Qo);p.pitch=this._map.transform.pitch+g.amount,Hs(p,g)}if(p.zoom||p.bearing){const g=s.pinchAround===void 0?s.around:s.pinchAround;p.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),u.extend(p,{noMoveStart:!0})}}function Hs(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function Xs(h,t,s){const{maxSpeed:c,linearity:p,deceleration:g}=s,v=u.clamp(h*p/(t/1e3),-c,c),S=Math.abs(v)/(g*p);return{easing:s.easing,duration:1e3*S,amount:v*(S/2)}}class wr extends u.Event{constructor(t,s,c,p={}){const g=G.mousePos(s.getCanvasContainer(),c),v=s.unproject(g);super(t,u.extend({point:g,lngLat:v,originalEvent:c},p)),this._defaultPrevented=!1,this.target=s}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Ks extends u.Event{constructor(t,s,c){const p=t==="touchend"?c.changedTouches:c.touches,g=G.touchPos(s.getCanvasContainer(),p),v=g.map(E=>s.unproject(E)),S=g.reduce((E,C,P,D)=>E.add(C.div(D.length)),new u.pointGeometry(0,0));super(t,{points:g,point:S,lngLats:v,lngLat:s.unproject(S),originalEvent:c}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class br extends u.Event{constructor(t,s,c){super(t,{originalEvent:c}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class yp{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new br(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new wr(t.type,this._map,t))}mouseup(t){this._map.fire(new wr(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new wr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new wr(t.type,this._map,t))}mouseover(t){this._map.fire(new wr(t.type,this._map,t))}mouseout(t){this._map.fire(new wr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ks(t.type,this._map,t))}touchmove(t){this._map.fire(new Ks(t.type,this._map,t))}touchend(t){this._map.fire(new Ks(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ks(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qi{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new wr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new wr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new wr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xc{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(G.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const c=s;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=c,this._box||(this._box=G.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const g=Math.min(p.x,c.x),v=Math.max(p.x,c.x),S=Math.min(p.y,c.y),E=Math.max(p.y,c.y);G.setTransform(this._box,`translate(${g}px,${S}px)`),this._box.style.width=v-g+"px",this._box.style.height=E-S+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const c=this._startPos,p=s;if(this.reset(),G.suppressClick(),c.x!==p.x||c.y!==p.y)return this._map.fire(new u.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(c,p,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(G.remove(this._box),this._box=null),G.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new u.Event(t,{originalEvent:s}))}}function Ti(h,t){if(h.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${h.length}, points ${t.length}`);const s={};for(let c=0;c<h.length;c++)s[h[c].identifier]=t[c];return s}class Js{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=function(p){const g=new u.pointGeometry(0,0);for(const v of p)g._add(v);return g.div(p.length)}(s),this.touches=Ti(c,s)))}touchmove(t,s,c){if(this.aborted||!this.centroid)return;const p=Ti(c,s);for(const g in this.touches){const v=this.touches[g],S=p[g];(!S||S.dist(v)>30)&&(this.aborted=!0)}}touchend(t,s,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Ql{constructor(t){this.singleTap=new Js(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,c){this.singleTap.touchstart(t,s,c)}touchmove(t,s,c){this.singleTap.touchmove(t,s,c)}touchend(t,s,c){const p=this.singleTap.touchend(t,s,c);if(p){const g=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(p)<30;if(g&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class _p{constructor(){this._zoomIn=new Ql({numTouches:1,numTaps:2}),this._zoomOut=new Ql({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,c){this._zoomIn.touchstart(t,s,c),this._zoomOut.touchstart(t,s,c)}touchmove(t,s,c){this._zoomIn.touchmove(t,s,c),this._zoomOut.touchmove(t,s,c)}touchend(t,s,c){const p=this._zoomIn.touchend(t,s,c),g=this._zoomOut.touchend(t,s,c);return p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()+1,around:v.unproject(p)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()-1,around:v.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const xp={0:1,2:2};class Ua{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const c=G.mouseButton(t);this._correctButton(t,c)&&(this._lastPoint=s,this._eventButton=c)}mousemoveWindow(t,s){const c=this._lastPoint;if(c){if(t.preventDefault(),function(p,g){const v=xp[g];return p.buttons===void 0||(p.buttons&v)!==v}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(c,s)}}mouseupWindow(t){this._lastPoint&&G.mouseButton(t)===this._eventButton&&(this._moved&&G.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ys extends Ua{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class ki extends Ua{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const c=.8*(s.x-t.x);if(c)return this._active=!0,{bearingDelta:c}}contextmenu(t){t.preventDefault()}}class We extends Ua{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const c=-.5*(s.y-t.y);if(c)return this._active=!0,{pitchDelta:c}}contextmenu(t){t.preventDefault()}}class Kc{constructor(t,s){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,s,c){return this._calculateTransform(t,s,c)}touchmove(t,s,c){if(this._map._cooperativeGestures&&(this._minTouches===2&&c.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,c.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(c.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,s,c)}touchend(t,s,c){this._calculateTransform(t,s,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,c){c.length>0&&(this._active=!0);const p=Ti(c,s),g=new u.pointGeometry(0,0),v=new u.pointGeometry(0,0);let S=0;for(const C in p){const P=p[C],D=this._touches[C];D&&(g._add(P),v._add(P.sub(D)),S++,p[C]=P)}if(this._touches=p,S<this._minTouches||!v.mag())return;const E=v.div(S);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(S),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,s,c){return{}}touchstart(t,s,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,c){if(!this._firstTwoTouches)return;t.preventDefault();const[p,g]=this._firstTwoTouches,v=Zi(c,s,p),S=Zi(c,s,g);if(!v||!S)return;const E=this._aroundCenter?null:v.add(S).div(2);return this._move([v,S],E,t)}touchend(t,s,c){if(!this._firstTwoTouches)return;const[p,g]=this._firstTwoTouches,v=Zi(c,s,p),S=Zi(c,s,g);v&&S||(this._active&&G.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Zi(h,t,s){for(let c=0;c<h.length;c++)if(h[c].identifier===s)return t[c]}function eu(h,t){return Math.log(h/t)/Math.LN2}class Ne extends fo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(eu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:eu(this._distance,c),pinchAround:s}}}function Va(h,t){return 180*h.angleWith(t)/Math.PI}class vp extends fo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const c=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Va(this._vector,c),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,c=Va(t,this._startVector);return Math.abs(c)<s}}function tu(h){return Math.abs(h.y)>Math.abs(h.x)}class nu extends fo{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,c){super.touchstart(t,s,c),this._currentTouchCount=c.length}_start(t){this._lastPoints=t,tu(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,c){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const p=t[0].sub(this._lastPoints[0]),g=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,g,c.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(p.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,c){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,g=s.mag()>=2;if(!p&&!g)return;if(!p||!g)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const v=t.y>0==s.y>0;return tu(t)&&tu(s)&&v}}const Jc={panStep:100,bearingStep:15,pitchStep:10};class Yc{constructor(){const t=Jc;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,c=0,p=0,g=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(c=0,p=0),{cameraAnimation:S=>{const E=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:wp,zoom:s?Math.round(E)+s*(t.shiftKey?2:1):E,bearing:S.getBearing()+c*this._bearingStep,pitch:S.getPitch()+p*this._pitchStep,offset:[-g*this._panStep,-v*this._panStep],center:S.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function wp(h){return h*(2-h)}const Qc=4.000244140625;class ru{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,u.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;t.preventDefault()}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=u.exported.now(),p=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,s!==0&&s%Qc==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=G.mousePos(this._el,t);this._around=u.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(s)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>Qc?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&E!==0&&(E=1/E);const C=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(C*E))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,c=this._startZoom,p=this._easing;let g,v=!1;if(this._type==="wheel"&&c&&p){const S=Math.min((u.exported.now()-this._lastWheelEventTime)/200,1),E=p(S);g=u.number(c,s,E),S<1?this._frameId||(this._frameId=!0):v=!0}else g=s,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!v,zoomDelta:g-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=u.ease;if(this._prevEase){const c=this._prevEase,p=(u.exported.now()-c.start)/c.duration,g=c.easing(p+.01)-c.easing(p),v=.27/Math.sqrt(g*g+1e-4)*.01,S=Math.sqrt(.0729-v*v);s=u.bezier(v,S,.25,1)}return this._prevEase={start:u.exported.now(),duration:t,easing:s},s}reset(){this._active=!1}}class iu{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ou{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:c.getZoom()+(t.shiftKey?-1:1),around:c.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class su{constructor(){this._tap=new Ql({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,s,c){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=s[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(t,s,c))}touchmove(t,s,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const p=s[0],g=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,s,c)}touchend(t,s,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(t,s,c)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class or{constructor(t,s,c){this._el=t,this._mousePan=s,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Wi{constructor(t,s,c){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class eh{constructor(t,s,c,p){this._el=t,this._touchZoom=s,this._touchRotate=c,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const es=h=>h.zoom||h.drag||h.pitch||h.rotate;class au extends u.Event{}function Qs(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class th{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Hc(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s),u.bindAll(["handleEvent","handleWindowEvent"],this);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,g,v]of this._listeners)G.addEventListener(p,g,p===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[t,s,c]of this._listeners)G.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(t){const s=this._map,c=s.getCanvasContainer();this._add("mapEvent",new yp(s,t));const p=s.boxZoom=new Xc(s,t);this._add("boxZoom",p);const g=new _p,v=new ou;s.doubleClickZoom=new iu(v,g),this._add("tapZoom",g),this._add("clickZoom",v);const S=new su;this._add("tapDragZoom",S);const E=s.touchPitch=new nu(s);this._add("touchPitch",E);const C=new ki(t),P=new We(t);s.dragRotate=new Wi(t,C,P),this._add("mouseRotate",C,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);const D=new Ys(t),R=new Kc(t,s);s.dragPan=new or(c,D,R),this._add("mousePan",D),this._add("touchPan",R,["touchZoom","touchRotate"]);const q=new vp,j=new Ne;s.touchZoomRotate=new eh(c,j,q,S),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]);const $=s.scrollZoom=new ru(s,this);this._add("scrollZoom",$,["mousePan"]);const ee=s.keyboard=new Yc;this._add("keyboard",ee),this._add("blockableMapEvent",new qi(s));for(const re of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[re]&&s[re].enable(t[re])}_add(t,s,c){this._handlers.push({handlerName:t,handler:s,allowed:c}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(es(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,s,c){for(const p in t)if(p!==c&&(!s||s.indexOf(p)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const c of t)this._el.contains(c.target)&&s.push(c);return s}handleEvent(t,s){if(t.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const c=t.type==="renderFrame"?void 0:t,p={needsRenderFrame:!1},g={},v={},S=t.touches,E=S?this._getMapTouches(S):void 0,C=E?G.touchPos(this._el,E):G.mousePos(this._el,t);for(const{handlerName:R,handler:q,allowed:j}of this._handlers){if(!q.isEnabled())continue;let $;this._blockedByActive(v,j,R)?q.reset():q[s||t.type]&&($=q[s||t.type](t,C,E),this.mergeHandlerResult(p,g,$,R,c),$&&$.needsRenderFrame&&this._triggerRenderFrame()),($||q.isActive())&&(v[R]=q)}const P={};for(const R in this._previousActiveHandlers)v[R]||(P[R]=c);this._previousActiveHandlers=v,(Object.keys(P).length||Qs(p))&&(this._changes.push([p,g,P]),this._triggerRenderFrame()),(Object.keys(v).length||Qs(p))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:D}=p;D&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],D(this._map))}mergeHandlerResult(t,s,c,p,g){if(!c)return;u.extend(t,c);const v={handlerName:p,originalEvent:c.originalEvent||g};c.zoomDelta!==void 0&&(s.zoom=v),c.panDelta!==void 0&&(s.drag=v),c.pitchDelta!==void 0&&(s.pitch=v),c.bearingDelta!==void 0&&(s.rotate=v)}_applyChanges(){const t={},s={},c={};for(const[p,g,v]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new u.pointGeometry(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(t.around=p.around),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),u.extend(s,g),u.extend(c,v);this._updateMapTransform(t,s,c),this._changes=[]}_updateMapTransform(t,s,c){const p=this._map,g=p.transform,v=p.style&&p.style.terrain;if(!(Qs(t)||v&&this._drag))return this._fireEvents(s,c,!0);let{panDelta:S,zoomDelta:E,bearingDelta:C,pitchDelta:P,around:D,pinchAround:R}=t;R!==void 0&&(D=R),p._stop(!0),D=D||p.transform.centerPoint;const q=g.pointLocation(S?D.sub(S):D);C&&(g.bearing+=C),P&&(g.pitch+=P),E&&(g.zoom+=E),v?s.drag&&!this._drag?(this._drag={center:g.centerPoint,lngLat:g.pointLocation(D),point:D,handlerName:s.drag.handlerName},p.fire(new u.Event("freezeElevation",{freeze:!0}))):this._drag&&c[this._drag.handlerName]?(p.fire(new u.Event("freezeElevation",{freeze:!1})),this._drag=null):s.drag&&this._drag&&(g.center=g.pointLocation(g.centerPoint.sub(S))):g.setLocationAtPoint(q,D),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,c,!0)}_fireEvents(t,s,c){const p=es(this._eventsInProgress),g=es(t),v={};for(const P in t){const{originalEvent:D}=t[P];this._eventsInProgress[P]||(v[`${P}start`]=D),this._eventsInProgress[P]=t[P]}!p&&g&&this._fireEvent("movestart",g.originalEvent);for(const P in v)this._fireEvent(P,v[P]);g&&this._fireEvent("move",g.originalEvent);for(const P in t){const{originalEvent:D}=t[P];this._fireEvent(P,D)}const S={};let E;for(const P in this._eventsInProgress){const{handlerName:D,originalEvent:R}=this._eventsInProgress[P];this._handlersById[D].isActive()||(delete this._eventsInProgress[P],E=s[D]||R,S[`${P}end`]=E)}for(const P in S)this._fireEvent(P,S[P]);const C=es(this._eventsInProgress);if(c&&(p||g)&&!C){this._updatingCamera=!0;const P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),D=R=>R!==0&&-this._bearingSnap<R&&R<this._bearingSnap;P?(D(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:E})):(this._map.fire(new u.Event("moveend",{originalEvent:E})),D(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new u.Event(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new au("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Lr={extend:(h,...t)=>u.extend(h,...t),run(h){h()},logToElement(h,t=!1,s="log"){const c=window.document.getElementById(s);c&&(t&&(c.innerHTML=""),c.innerHTML+=`<br>${h}`)}};class en extends u.Evented{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,u.bindAll(["_renderFrameCallback"],this)}getCenter(){return new u.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,c){return t=u.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,u.extend({offset:t},s),c)}panTo(t,s,c){return this.easeTo(u.extend({center:t},s),c)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,c){return this.easeTo(u.extend({zoom:t},s),c)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,c){return this.easeTo(u.extend({bearing:t},s),c)}resetNorth(t,s){return this.rotateTo(0,u.extend({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(u.extend({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=u.LngLatBounds.convert(t);const c=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),c,s)}_cameraForBoxAndBearing(t,s,c,p){const g={top:0,bottom:0,right:0,left:0};if(typeof(p=u.extend({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const he=p.padding;p.padding={top:he,bottom:he,right:he,left:he}}p.padding=u.extend(g,p.padding);const v=this.transform,S=v.padding,E=v.project(u.LngLat.convert(t)),C=v.project(u.LngLat.convert(s)),P=E.rotate(-c*Math.PI/180),D=C.rotate(-c*Math.PI/180),R=new u.pointGeometry(Math.max(P.x,D.x),Math.max(P.y,D.y)),q=new u.pointGeometry(Math.min(P.x,D.x),Math.min(P.y,D.y)),j=R.sub(q),$=(v.width-(S.left+S.right+p.padding.left+p.padding.right))/j.x,ee=(v.height-(S.top+S.bottom+p.padding.top+p.padding.bottom))/j.y;if(ee<0||$<0)return void u.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const re=Math.min(v.scaleZoom(v.scale*Math.min($,ee)),p.maxZoom),ce=u.pointGeometry.convert(p.offset),W=new u.pointGeometry((p.padding.left-p.padding.right)/2,(p.padding.top-p.padding.bottom)/2).rotate(c*Math.PI/180),pe=ce.add(W).mult(v.scale/v.zoomScale(re));return{center:v.unproject(E.add(C).div(2).sub(pe)),zoom:re,bearing:c}}fitBounds(t,s,c){return this._fitInternal(this.cameraForBounds(t,s),s,c)}fitScreenCoordinates(t,s,c,p,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(u.pointGeometry.convert(t)),this.transform.pointLocation(u.pointGeometry.convert(s)),c,p),p,g)}_fitInternal(t,s,c){return t?(delete(s=u.extend(t,s)).padding,s.linear?this.easeTo(s,c):this.flyTo(s,c)):this}jumpTo(t,s){this.stop();const c=this.transform;let p=!1,g=!1,v=!1;return"zoom"in t&&c.zoom!==+t.zoom&&(p=!0,c.zoom=+t.zoom),t.center!==void 0&&(c.center=u.LngLat.convert(t.center)),"bearing"in t&&c.bearing!==+t.bearing&&(g=!0,c.bearing=+t.bearing),"pitch"in t&&c.pitch!==+t.pitch&&(v=!0,c.pitch=+t.pitch),t.padding==null||c.isPaddingEqual(t.padding)||(c.padding=t.padding),this.fire(new u.Event("movestart",s)).fire(new u.Event("move",s)),p&&this.fire(new u.Event("zoomstart",s)).fire(new u.Event("zoom",s)).fire(new u.Event("zoomend",s)),g&&this.fire(new u.Event("rotatestart",s)).fire(new u.Event("rotate",s)).fire(new u.Event("rotateend",s)),v&&this.fire(new u.Event("pitchstart",s)).fire(new u.Event("pitch",s)).fire(new u.Event("pitchend",s)),this.fire(new u.Event("moveend",s))}calculateCameraOptionsFromTo(t,s,c,p=0){const g=u.MercatorCoordinate.fromLngLat(t,s),v=u.MercatorCoordinate.fromLngLat(c,p),S=v.x-g.x,E=v.y-g.y,C=v.z-g.z,P=Math.hypot(S,E,C);if(P===0)throw new Error("Can't calculate camera options with same From and To");const D=Math.hypot(S,E),R=this.transform.scaleZoom(this.transform.cameraToCenterDistance/P/this.transform.tileSize),q=180*Math.atan2(S,-E)/Math.PI;let j=180*Math.acos(D/P)/Math.PI;return j=C<0?90-j:90+j,{center:v.toLngLat(),zoom:R,pitch:j,bearing:q}}easeTo(t,s){this._stop(!1,t.easeId),((t=u.extend({offset:[0,0],duration:500,easing:u.ease},t)).animate===!1||!t.essential&&u.exported.prefersReducedMotion)&&(t.duration=0);const c=this.transform,p=this.getZoom(),g=this.getBearing(),v=this.getPitch(),S=this.getPadding(),E="zoom"in t?+t.zoom:p,C="bearing"in t?this._normalizeBearing(t.bearing,g):g,P="pitch"in t?+t.pitch:v,D="padding"in t?t.padding:c.padding,R=u.pointGeometry.convert(t.offset);let q=c.centerPoint.add(R);const j=c.pointLocation(q),$=u.LngLat.convert(t.center||j);this._normalizeCenter($);const ee=c.project(j),re=c.project($).sub(ee),ce=c.zoomScale(E-p);let W,pe;t.around&&(W=u.LngLat.convert(t.around),pe=c.locationPoint(W));const he={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||E!==p,this._rotating=this._rotating||g!==C,this._pitching=this._pitching||P!==v,this._padding=!c.isPaddingEqual(D),this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,he),this._ease(xe=>{if(this._zooming&&(c.zoom=u.number(p,E,xe)),this._rotating&&(c.bearing=u.number(g,C,xe)),this._pitching&&(c.pitch=u.number(v,P,xe)),this._padding&&(c.interpolatePadding(S,D,xe),q=c.centerPoint.add(R)),W)c.setLocationAtPoint(W,pe);else{const ve=c.zoomScale(c.zoom-p),Ie=E>p?Math.min(2,ce):Math.max(.5,ce),ye=Math.pow(Ie,1-xe),$e=c.unproject(ee.add(re.mult(xe*ye)).mult(ve));c.setLocationAtPoint(c.renderWorldCopies?$e.wrap():$e,q)}this._fireMoveEvents(s)},xe=>{this._afterEase(s,xe)},t),this}_prepareEase(t,s,c={}){this._moving=!0,this.fire(new u.Event("freezeElevation",{freeze:!0})),s||c.moving||this.fire(new u.Event("movestart",t)),this._zooming&&!c.zooming&&this.fire(new u.Event("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new u.Event("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new u.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new u.Event("move",t)),this._zooming&&this.fire(new u.Event("zoom",t)),this._rotating&&this.fire(new u.Event("rotate",t)),this._pitching&&this.fire(new u.Event("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId,this.fire(new u.Event("freezeElevation",{freeze:!1}));const c=this._zooming,p=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new u.Event("zoomend",t)),p&&this.fire(new u.Event("rotateend",t)),g&&this.fire(new u.Event("pitchend",t)),this.fire(new u.Event("moveend",t))}flyTo(t,s){if(!t.essential&&u.exported.prefersReducedMotion){const rt=u.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(rt,s)}this.stop(),t=u.extend({offset:[0,0],speed:1.2,curve:1.42,easing:u.ease},t);const c=this.transform,p=this.getZoom(),g=this.getBearing(),v=this.getPitch(),S=this.getPadding(),E="zoom"in t?u.clamp(+t.zoom,c.minZoom,c.maxZoom):p,C="bearing"in t?this._normalizeBearing(t.bearing,g):g,P="pitch"in t?+t.pitch:v,D="padding"in t?t.padding:c.padding,R=c.zoomScale(E-p),q=u.pointGeometry.convert(t.offset);let j=c.centerPoint.add(q);const $=c.pointLocation(j),ee=u.LngLat.convert(t.center||$);this._normalizeCenter(ee);const re=c.project($),ce=c.project(ee).sub(re);let W=t.curve;const pe=Math.max(c.width,c.height),he=pe/R,xe=ce.mag();if("minZoom"in t){const rt=u.clamp(Math.min(t.minZoom,p,E),c.minZoom,c.maxZoom),Lt=pe/c.zoomScale(rt-p);W=Math.sqrt(Lt/xe*2)}const ve=W*W;function Ie(rt){const Lt=(he*he-pe*pe+(rt?-1:1)*ve*ve*xe*xe)/(2*(rt?he:pe)*ve*xe);return Math.log(Math.sqrt(Lt*Lt+1)-Lt)}function ye(rt){return(Math.exp(rt)-Math.exp(-rt))/2}function $e(rt){return(Math.exp(rt)+Math.exp(-rt))/2}const Le=Ie(0);let Ge=function(rt){return $e(Le)/$e(Le+W*rt)},ft=function(rt){return pe*(($e(Le)*(ye(Lt=Le+W*rt)/$e(Lt))-ye(Le))/ve)/xe;var Lt},_t=(Ie(1)-Le)/W;if(Math.abs(xe)<1e-6||!isFinite(_t)){if(Math.abs(pe-he)<1e-6)return this.easeTo(t,s);const rt=he<pe?-1:1;_t=Math.abs(Math.log(he/pe))/W,ft=function(){return 0},Ge=function(Lt){return Math.exp(rt*W*Lt)}}return t.duration="duration"in t?+t.duration:1e3*_t/("screenSpeed"in t?+t.screenSpeed/W:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=g!==C,this._pitching=P!==v,this._padding=!c.isPaddingEqual(D),this._prepareEase(s,!1),this._ease(rt=>{const Lt=rt*_t,Rt=1/Ge(Lt);c.zoom=rt===1?E:p+c.scaleZoom(Rt),this._rotating&&(c.bearing=u.number(g,C,rt)),this._pitching&&(c.pitch=u.number(v,P,rt)),this._padding&&(c.interpolatePadding(S,D,rt),j=c.centerPoint.add(q));const Et=rt===1?ee:c.unproject(re.add(ce.mult(ft(Lt))).mult(Rt));c.setLocationAtPoint(c.renderWorldCopies?Et.wrap():Et,j),this._fireMoveEvents(s)},()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,s)}if(!t){const c=this.handlers;c&&c.stop(!1)}return this}_ease(t,s,c){c.animate===!1||c.duration===0?(t(1),s()):(this._easeStart=u.exported.now(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((u.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=u.wrap(t,-180,180);const c=Math.abs(t-s);return Math.abs(t-360-s)<c&&(t-=360),Math.abs(t+360-s)<c&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const c=t.lng-s.center.lng;t.lng+=c>180?-360:c<-180?360:0}}class ea{constructor(t={}){this.options=t,u.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=G.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=G.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=G.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){G.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const c=this._map._getUIString(`AttributionControl.${s}`);t.title=c,t.setAttribute("aria-label",c)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"&&t.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(p=>typeof p!="string"?"":p)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const s=this._map.style.sourceCaches;for(const p in s){const g=s[p];if(g.used||g.usedForTerrain){const v=g.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t=t.filter(p=>String(p).trim()),t.sort((p,g)=>p.length-g.length),t=t.filter((p,g)=>{for(let v=g+1;v<t.length;v++)if(t[v].indexOf(p)>=0)return!1;return!0});const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class ja{constructor(t={}){this.options=t,u.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=G.create("div","maplibregl-ctrl mapboxgl-ctrl");const s=G.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){G.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&s.classList.add("maplibregl-compact","mapboxgl-compact"):s.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class nh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,c=s?this._queue.concat(s):this._queue;for(const p of c)if(p.id===t)return void(p.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const c of s)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const rh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},ih={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},bp={showCompass:!0,showZoom:!0,visualizePitch:!1};class li{constructor(t,s,c=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new ki({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,c&&(this.mousePitch=new We({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),u.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),G.addEventListener(s,"mousedown",this.mousedown),G.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),G.addEventListener(s,"touchmove",this.touchmove),G.addEventListener(s,"touchend",this.touchend),G.addEventListener(s,"touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),G.disableDrag()}move(t,s){const c=this.map,p=this.mouseRotate.mousemoveWindow(t,s);if(p&&p.bearingDelta&&c.setBearing(c.getBearing()+p.bearingDelta),this.mousePitch){const g=this.mousePitch.mousemoveWindow(t,s);g&&g.pitchDelta&&c.setPitch(c.getPitch()+g.pitchDelta)}}off(){const t=this.element;G.removeEventListener(t,"mousedown",this.mousedown),G.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),G.removeEventListener(t,"touchmove",this.touchmove),G.removeEventListener(t,"touchend",this.touchend),G.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){G.enableDrag(),G.removeEventListener(window,"mousemove",this.mousemove),G.removeEventListener(window,"mouseup",this.mouseup)}mousedown(t){this.down(u.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),G.mousePos(this.element,t)),G.addEventListener(window,"mousemove",this.mousemove),G.addEventListener(window,"mouseup",this.mouseup)}mousemove(t){this.move(t,G.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=G.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=G.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function ta(h,t,s){if(h=new u.LngLat(h.lng,h.lat),t){const c=new u.LngLat(h.lng-360,h.lat),p=new u.LngLat(h.lng+360,h.lat),g=s.locationPoint(h).distSqr(t);s.locationPoint(c).distSqr(t)<g?h=c:s.locationPoint(p).distSqr(t)<g&&(h=p)}for(;Math.abs(h.lng-s.center.lng)>180;){const c=s.locationPoint(h);if(c.x>=0&&c.y>=0&&c.x<=s.width&&c.y<=s.height)break;h.lng>s.center.lng?h.lng-=360:h.lng+=360}return h}const Ye={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function st(h,t,s){const c=h.classList;for(const p in Ye)c.remove(`maplibregl-${s}-anchor-${p}`,`mapboxgl-${s}-anchor-${p}`);c.add(`maplibregl-${s}-anchor-${t}`,`mapboxgl-${s}-anchor-${t}`)}class ts extends u.Evented{constructor(t,s){if(super(),(t instanceof HTMLElement||s)&&(t=u.extend({element:t},s)),u.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=u.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=G.create("div"),this._element.setAttribute("aria-label","Map marker");const c=G.createNS("http://www.w3.org/2000/svg","svg"),p=41,g=27;c.setAttributeNS(null,"display","block"),c.setAttributeNS(null,"height",`${p}px`),c.setAttributeNS(null,"width",`${g}px`),c.setAttributeNS(null,"viewBox",`0 0 ${g} ${p}`);const v=G.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"stroke","none"),v.setAttributeNS(null,"stroke-width","1"),v.setAttributeNS(null,"fill","none"),v.setAttributeNS(null,"fill-rule","evenodd");const S=G.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const E=G.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"transform","translate(3.0, 29.0)"),E.setAttributeNS(null,"fill","#000000");const C=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ce of C){const W=G.createNS("http://www.w3.org/2000/svg","ellipse");W.setAttributeNS(null,"opacity","0.04"),W.setAttributeNS(null,"cx","10.5"),W.setAttributeNS(null,"cy","5.80029008"),W.setAttributeNS(null,"rx",ce.rx),W.setAttributeNS(null,"ry",ce.ry),E.appendChild(W)}const P=G.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill",this._color);const D=G.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),P.appendChild(D);const R=G.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const q=G.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(q);const j=G.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(6.0, 7.0)"),j.setAttributeNS(null,"fill","#FFFFFF");const $=G.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ee=G.createNS("http://www.w3.org/2000/svg","circle");ee.setAttributeNS(null,"fill","#000000"),ee.setAttributeNS(null,"opacity","0.25"),ee.setAttributeNS(null,"cx","5.5"),ee.setAttributeNS(null,"cy","5.5"),ee.setAttributeNS(null,"r","5.4999962");const re=G.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#FFFFFF"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962"),$.appendChild(ee),$.appendChild(re),S.appendChild(E),S.appendChild(P),S.appendChild(R),S.appendChild(j),S.appendChild($),c.appendChild(S),c.setAttributeNS(null,"height",p*this._scale+"px"),c.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(c),this._offset=u.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",c=>{c.preventDefault()}),this._element.addEventListener("mousedown",c=>{c.preventDefault()}),st(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),G.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=u.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const s=t.code,c=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&c!==32&&c!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,c=this._element;this._popup&&(s===c||c.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=ta(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let s="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?s=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(s=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let c="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?c="rotateX(0deg)":this._pitchAlignment==="map"&&(c=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),G.setTransform(this._element,`${Ye[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${c} ${s}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const p=this._map.unproject(this._pos),g=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=p.distanceTo(this._lngLat)>20*g?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(t){return this._offset=u.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const s=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.Event("dragstart"))),this.fire(new u.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const lu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Hi,Rn=0,Xi=!1;const ui={maxWidth:100,unit:"metric"};function oh(h,t,s){const c=s&&s.maxWidth||100,p=h._container.clientHeight/2,g=h.unproject([0,p]),v=h.unproject([c,p]),S=g.distanceTo(v);if(s&&s.unit==="imperial"){const E=3.2808*S;E>5280?Ki(t,c,E/5280,h._getUIString("ScaleControl.Miles")):Ki(t,c,E,h._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?Ki(t,c,S/1852,h._getUIString("ScaleControl.NauticalMiles")):S>=1e3?Ki(t,c,S/1e3,h._getUIString("ScaleControl.Kilometers")):Ki(t,c,S,h._getUIString("ScaleControl.Meters"))}function Ki(h,t,s,c){const p=function(g){const v=Math.pow(10,`${Math.floor(g)}`.length-1);let S=g/v;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(E){const C=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*C)/C}(S),v*S}(s);h.style.width=t*(p/s)+"px",h.innerHTML=`${p}&nbsp;${c}`}const ln={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},yn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function uu(h){if(h){if(typeof h=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(h,2)));return{center:new u.pointGeometry(0,0),top:new u.pointGeometry(0,h),"top-left":new u.pointGeometry(t,t),"top-right":new u.pointGeometry(-t,t),bottom:new u.pointGeometry(0,-h),"bottom-left":new u.pointGeometry(t,-t),"bottom-right":new u.pointGeometry(-t,-t),left:new u.pointGeometry(h,0),right:new u.pointGeometry(-h,0)}}if(h instanceof u.pointGeometry||Array.isArray(h)){const t=u.pointGeometry.convert(h);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:u.pointGeometry.convert(h.center||[0,0]),top:u.pointGeometry.convert(h.top||[0,0]),"top-left":u.pointGeometry.convert(h["top-left"]||[0,0]),"top-right":u.pointGeometry.convert(h["top-right"]||[0,0]),bottom:u.pointGeometry.convert(h.bottom||[0,0]),"bottom-left":u.pointGeometry.convert(h["bottom-left"]||[0,0]),"bottom-right":u.pointGeometry.convert(h["bottom-right"]||[0,0]),left:u.pointGeometry.convert(h.left||[0,0]),right:u.pointGeometry.convert(h.right||[0,0])}}return uu(new u.pointGeometry(0,0))}const mo={supported:N,setRTLTextPlugin:u.setRTLTextPlugin,getRTLTextPluginStatus:u.getRTLTextPluginStatus,Map:class extends en{constructor(h){var t;if(u.PerformanceUtils.mark(u.PerformanceMarkers.create),(h=u.extend({},ih,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Zs(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),{bearingSnap:h.bearingSnap}),this._interactive=h.interactive,this._cooperativeGestures=h.cooperativeGestures,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new nh,this._controls=[],this._mapId=u.uniqueId(),this._locale=u.extend({},rh,h.locale),this._clickTolerance=h.clickTolerance,this._pixelRatio=(t=h.pixelRatio)!==null&&t!==void 0?t:devicePixelRatio,this._requestManager=new Te(h.transformRequest),typeof h.container=="string"){if(this._container=document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),u.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new th(this,h),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=h.hash&&new Gc(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,u.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new ea({customAttribution:h.customAttribution})),h.maplibreLogo&&this.addControl(new ja,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new u.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new u.Event(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new u.Event("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=h.onAdd(this);this._controls.push(h);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(s,c.firstChild):c.appendChild(s),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}calculateCameraOptionsFromTo(h,t,s,c){return c==null&&this.style.terrain&&(c=this.transform.getElevation(s,this.style.terrain)),super.calculateCameraOptionsFromTo(h,t,s,c)}resize(h){const t=this._containerDimensions(),s=t[0],c=t[1];this._resizeCanvas(s,c,this.getPixelRatio()),this.transform.resize(s,c),this.painter.resize(s,c,this.getPixelRatio());const p=!this._moving;return p&&(this.stop(),this.fire(new u.Event("movestart",h)).fire(new u.Event("move",h))),this.fire(new u.Event("resize",h)),p&&this.fire(new u.Event("moveend",h)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(h){const[t,s]=this._containerDimensions();this._pixelRatio=h,this._resizeCanvas(t,s,h),this.painter.resize(t,s,h)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(h){return this.transform.setMaxBounds(u.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this._update()}project(h){return this.transform.locationPoint(u.LngLat.convert(h),this.style&&this.style.terrain)}unproject(h){return this.transform.pointLocation(u.pointGeometry.convert(h),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(h,t,s){if(h==="mouseenter"||h==="mouseover"){let c=!1;return{layer:t,listener:s,delegates:{mousemove:g=>{const v=this.getLayer(t)?this.queryRenderedFeatures(g.point,{layers:[t]}):[];v.length?c||(c=!0,s.call(this,new wr(h,this,g.originalEvent,{features:v}))):c=!1},mouseout:()=>{c=!1}}}}if(h==="mouseleave"||h==="mouseout"){let c=!1;return{layer:t,listener:s,delegates:{mousemove:v=>{(this.getLayer(t)?this.queryRenderedFeatures(v.point,{layers:[t]}):[]).length?c=!0:c&&(c=!1,s.call(this,new wr(h,this,v.originalEvent)))},mouseout:v=>{c&&(c=!1,s.call(this,new wr(h,this,v.originalEvent)))}}}}{const c=p=>{const g=this.getLayer(t)?this.queryRenderedFeatures(p.point,{layers:[t]}):[];g.length&&(p.features=g,s.call(this,p),delete p.features)};return{layer:t,listener:s,delegates:{[h]:c}}}}on(h,t,s){if(s===void 0)return super.on(h,t);const c=this._createDelegatedListener(h,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(c);for(const p in c.delegates)this.on(p,c.delegates[p]);return this}once(h,t,s){if(s===void 0)return super.once(h,t);const c=this._createDelegatedListener(h,t,s);for(const p in c.delegates)this.once(p,c.delegates[p]);return this}off(h,t,s){return s===void 0?super.off(h,t):(this._delegatedListeners&&this._delegatedListeners[h]&&(c=>{const p=this._delegatedListeners[h];for(let g=0;g<p.length;g++){const v=p[g];if(v.layer===t&&v.listener===s){for(const S in v.delegates)this.off(S,v.delegates[S]);return p.splice(g,1),this}}})(),this)}queryRenderedFeatures(h,t){if(!this.style)return[];let s;if(t!==void 0||h===void 0||h instanceof u.pointGeometry||Array.isArray(h)||(t=h,h=void 0),t=t||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof u.pointGeometry||typeof h[0]=="number")s=[u.pointGeometry.convert(h)];else{const c=u.pointGeometry.convert(h[0]),p=u.pointGeometry.convert(h[1]);s=[c,new u.pointGeometry(p.x,c.y),p,new u.pointGeometry(c.x,p.y),c]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(h,t){return this.style.querySourceFeatures(h,t)}setStyle(h,t){return(t=u.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(h,t))}setTransformRequest(h){return this._requestManager.setTransformRequest(h),this}_getUIString(h){const t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new Vn(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Vn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,t){if(typeof h=="string"){const s=this._requestManager.transformRequest(h,u.ResourceType.Style);u.getJSON(s,(c,p)=>{c?this.fire(new u.ErrorEvent(c)):p&&this._updateDiff(p,t)})}else typeof h=="object"&&this._updateDiff(h,t)}_updateDiff(h,t){try{this.style.setState(h)&&this._update(!0)}catch(s){u.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(h,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.warnOnce("There is no style added to the map.")}addSource(h,t){return this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)}isSourceLoaded(h){const t=this.style&&this.style.sourceCaches[h];if(t!==void 0)return t.loaded();this.fire(new u.ErrorEvent(new Error(`There is no source with ID '${h}'`)))}setTerrain(h){return this.style.setTerrain(h),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const h=this.style&&this.style.sourceCaches;for(const t in h){const s=h[t]._tiles;for(const c in s){const p=s[c];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}addSourceType(h,t,s){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,s)}removeSource(h){return this.style.removeSource(h),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,t,{pixelRatio:s=1,sdf:c=!1,stretchX:p,stretchY:g,content:v}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||u.isImageBitmap(t)){const{width:S,height:E,data:C}=u.exported.getImageData(t);this.style.addImage(h,{data:new u.RGBAImage({width:S,height:E},C),pixelRatio:s,stretchX:p,stretchY:g,content:v,sdf:c,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:S,height:E,data:C}=t,P=t;this.style.addImage(h,{data:new u.RGBAImage({width:S,height:E},new Uint8Array(C)),pixelRatio:s,stretchX:p,stretchY:g,content:v,sdf:c,version:0,userImage:P}),P.onAdd&&P.onAdd(this,h)}}}updateImage(h,t){const s=this.style.getImage(h);if(!s)return this.fire(new u.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=t instanceof HTMLImageElement||u.isImageBitmap(t)?u.exported.getImageData(t):t,{width:p,height:g,data:v}=c;if(p===void 0||g===void 0)return this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==s.data.width||g!==s.data.height)return this.fire(new u.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(t instanceof HTMLImageElement||u.isImageBitmap(t));s.data.replace(v,S),this.style.updateImage(h,s)}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new u.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,t){u.getImage(this._requestManager.transformRequest(h,u.ResourceType.Image),t)}listImages(){return this.style.listImages()}addLayer(h,t){return this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)}moveLayer(h,t){return this.style.moveLayer(h,t),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,t,s){return this.style.setLayerZoomRange(h,t,s),this._update(!0)}setFilter(h,t,s={}){return this.style.setFilter(h,t,s),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,t,s,c={}){return this.style.setPaintProperty(h,t,s,c),this._update(!0)}getPaintProperty(h,t){return this.style.getPaintProperty(h,t)}setLayoutProperty(h,t,s,c={}){return this.style.setLayoutProperty(h,t,s,c),this._update(!0)}getLayoutProperty(h,t){return this.style.getLayoutProperty(h,t)}setLight(h,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(h,t){return this.style.setFeatureState(h,t),this._update()}removeFeatureState(h,t){return this.style.removeFeatureState(h,t),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let h=0,t=0;return this._container&&(h=this._container.clientWidth||400,t=this._container.clientHeight||300),[h,t]}_setupContainer(){const h=this._container;h.classList.add("maplibregl-map","mapboxgl-map");const t=this._canvasContainer=G.create("div","maplibregl-canvas-container mapboxgl-canvas-container",h);this._interactive&&t.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=G.create("canvas","maplibregl-canvas mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions();this._resizeCanvas(s[0],s[1],this.getPixelRatio());const c=this._controlContainer=G.create("div","maplibregl-control-container mapboxgl-control-container",h),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{p[g]=G.create("div",`maplibregl-ctrl-${g} mapboxgl-ctrl-${g}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const h=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=G.create("div","maplibregl-cooperative-gesture-screen",h);let t="Control",s=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(s=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map",t="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${s}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",c=>{c.key===t&&(this._metaPress=!0)}),document.addEventListener("keyup",c=>{c.key===t&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",c=>{this._onCooperativeGesture(c,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(h,t,s){this._canvas.width=s*h,this._canvas.height=s*t,this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const h=u.extend({},N.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);t?(this.painter=new Yl(t,this.transform),u.exported$1.testSupport(t)):this.fire(new u.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new u.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new u.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(h,t,s){return!t&&s<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_render(h){let t,s=0;const c=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(t=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,t),s=u.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._removed)return;let p=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const v=this.transform.zoom,S=u.exported.now();this.style.zoomHistory.update(v,S);const E=new u.EvaluationParameters(v,{now:S,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),C=E.crossFadingFactor();C===1&&C===this._crossFadingFactor||(p=!0,this._crossFadingFactor=C),this.style.update(E)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new u.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.PerformanceUtils.mark(u.PerformanceMarkers.load),this.fire(new u.Event("load"))),this.style&&(this.style.hasTransitions()||p)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const v=u.exported.now()-s;c.endQueryEXT(c.TIME_ELAPSED_EXT,t),setTimeout(()=>{const S=c.getQueryObjectEXT(t,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(t),this.fire(new u.Event("gpu-timing-frame",{cpuTime:v,gpuTime:S}))},50)}if(this.listens("gpu-timing-layer")){const v=this.painter.collectGpuTimers();setTimeout(()=>{const S=this.painter.queryGpuTimers(v);this.fire(new u.Event("gpu-timing-layer",{layerTimes:S}))},50)}const g=this._sourcesDirty||this._styleDirty||this._placementDirty;return g||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.Event("idle")),!this._loaded||this._fullyLoaded||g||(this._fullyLoaded=!0,u.PerformanceUtils.mark(u.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),G.remove(this._canvasContainer),G.remove(this._controlContainer),this._cooperativeGestures&&G.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),u.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new u.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=u.exported.frame(h=>{u.PerformanceUtils.frame(h),this._frame=null,this._render(h)}))}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}_setCacheLimits(h,t){u.setCacheLimits(h,t)}get version(){return"2.4.0"}},NavigationControl:class{constructor(h){this.options=u.extend({},bp,h),this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(u.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),G.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),G.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(u.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=G.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map.getZoom(),t=h===this._map.getMaxZoom(),s=h===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())}_rotateCompassArrow(){const h=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=h}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new li(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){G.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,t){const s=G.create("button",h,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(h,t){const s=this._map._getUIString(`NavigationControl.${t}`);h.title=s,h.setAttribute("aria-label",s)}},GeolocateControl:class extends u.Evented{constructor(h){super(),this.options=u.extend({},lu,h),u.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(h){var t;return this._map=h,this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,Hi!==void 0?t(Hi):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(s=>{Hi=s.state!=="denied",t(Hi)}):(Hi=!!window.navigator.geolocation,t(Hi)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),G.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Rn=0,Xi=!1}_isOutOfMapMaxBounds(h){const t=this._map.getMaxBounds(),s=h.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new u.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new u.Event("geolocate",h)),this._finish()}}_updateCamera(h){const t=new u.LngLat(h.coords.longitude,h.coords.latitude),s=h.coords.accuracy,c=this._map.getBearing(),p=u.extend({bearing:c},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),p,{geolocateSource:!0})}_updateMarker(h){if(h){const t=new u.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map._container.clientHeight/2,t=this._map.unproject([0,h]),s=this._map.unproject([1,h]),c=t.distanceTo(s),p=Math.ceil(2*this._accuracy/c);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&Xi)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new u.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=G.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),G.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){u.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=G.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new ts(this._dotElement),this._circleElement=G.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ts({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new u.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return u.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Rn--,Xi=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new u.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Rn++,Rn>1?(h={maximumAge:6e5,timeout:0},Xi=!0):(h=this.options.positionOptions,Xi=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ea,LogoControl:ja,ScaleControl:class{constructor(h){this.options=u.extend({},ui,h),u.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){oh(this._map,this._container,this.options)}onAdd(h){return this._map=h,this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){G.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(h){this.options.unit=h,oh(this._map,this._container,this.options)}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:u.warnOnce("Full screen control 'container' must be a DOM element.")),u.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=G.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",u.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){G.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=G.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);G.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(h){this.options=h,u.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(h){return this._map=h,this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=G.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),G.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){G.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends u.Evented{constructor(h){super(),this.options=u.extend(Object.create(ln),h),u.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new u.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&G.remove(this._content),this._container&&(G.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new u.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=u.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const t=document.createDocumentFragment(),s=document.createElement("body");let c;for(s.innerHTML=h;c=s.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=G.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){this._container&&this._container.classList.add(h)}removeClassName(h){this._container&&this._container.classList.remove(h)}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){if(this._container)return this._container.classList.toggle(h)}_createCloseButton(){this.options.closeButton&&(this._closeButton=G.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(h){this._update(h.point)}_onMouseMove(h){this._update(h.point)}_onDrag(h){this._update(h.point)}_update(h){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=G.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=G.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(g=>this._container.classList.add(g)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ta(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!h))return;const t=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat);let s=this.options.anchor;const c=uu(this.options.offset);if(!s){const g=this._container.offsetWidth,v=this._container.offsetHeight;let S;S=t.y+c.bottom.y<v?["top"]:t.y>this._map.transform.height-v?["bottom"]:[],t.x<g/2?S.push("left"):t.x>this._map.transform.width-g/2&&S.push("right"),s=S.length===0?"bottom":S.join("-")}const p=t.add(c[s]).round();G.setTransform(this._container,`${Ye[s]} translate(${p.x}px,${p.y}px)`),st(this._container,s,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(yn);h&&h.focus()}_onClose(){this.remove()}},Marker:ts,Style:Vn,LngLat:u.LngLat,LngLatBounds:u.LngLatBounds,Point:u.pointGeometry,MercatorCoordinate:u.MercatorCoordinate,Evented:u.Evented,AJAXError:u.AJAXError,config:u.config,CanvasSource:Ut,GeoJSONSource:mr,ImageSource:lt,RasterDEMTileSource:at,RasterTileSource:Gr,VectorTileSource:Mr,VideoSource:ct,prewarm:function(){Oo().acquire(vi)},clearPrewarmedResources:function(){const h=Ui;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(vi),Ui=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return yr.workerCount},set workerCount(h){yr.workerCount=h},get maxParallelImageRequests(){return u.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){u.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){u.clearTileCache(h)},workerUrl:"",addProtocol(h,t){u.config.REGISTERED_PROTOCOLS[h]=t},removeProtocol(h){delete u.config.REGISTERED_PROTOCOLS[h]}};return Lr.extend(mo,{isSafari:u.isSafari,getPerformanceMetrics:u.PerformanceUtils.getPerformanceMetrics}),mo});var T=_;return T})})(pT);const zx=Bm;function fT({bestGasStations:n,otherGasStations:i,getGasStations:a}){const f=dr.useRef(null),_=dr.useRef(null),[x,T]=dr.useState(-66.5),[u,N]=dr.useState(18.33),[Z,ue]=dr.useState(9),[oe]=dr.useState("get_your_own_OpIi9ZULNHzrESv6T2vL"),G=4;return dr.useEffect(()=>{_.current&&_.current.flyTo({center:[x,u],zoom:Z})},[x,u]),dr.useEffect(()=>{!_.current||!n||!i||(vx(_.current,n,!0),vx(_.current,i))},[n,i]),dr.useEffect(()=>{_.current||(Hv.on("view-station-event",Te=>{console.log(Te),T(Te.lng),N(Te.lat)}),_.current=new zx.Map({container:f.current,style:`https://api.maptiler.com/maps/streets-v2/style.json?key=${oe}`,center:[-65.15,17],zoom:4,maxBounds:[[-70.3503,16.8637],[-63.27647,19.49178]]}),_.current.on("click",function(Te){const[_e,be]=Te.lngLat.toArray();console.log(_e,be),a(_e,be,G),JS(_.current,_e,be,G)}),_.current.addControl(new zx.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0})),ue(17))},[]),cn("div",{className:"map-wrap",children:cn("div",{ref:f,className:"map"})})}function mT(){return pa("div",{children:[cn("input",{type:"checkbox",id:"my-modal",className:"modal-toggle"}),cn("div",{className:"modal",children:pa("div",{className:"modal-box",children:[cn("h3",{className:"font-bold text-lg",children:"tips and known bugs"}),cn("p",{className:"py-4",children:"You can click anywhere on the map to get gas station's on a 4 mile radius from that point."}),cn("p",{className:"py-4",children:"When you click a gas station in the menu, the map will zoom into it."}),cn("p",{className:"py-4",children:"Sometimes you can't see the station; just manually zoom to see the station's icon show up in the map."}),cn("div",{className:"modal-action",children:cn("label",{htmlFor:"my-modal",className:"btn",children:"Yay!"})})]})}),cn("label",{htmlFor:"my-modal",className:"btn",children:"tips and known bugs"})]})}function gT(){const[n,i]=dr.useState(null),[a,f]=dr.useState(null),_=(x,T,u)=>{dT(x,T,u).then(N=>{const{bestGasStations:Z,otherGasStations:ue}=XS(N);KS(ue),i(Z),f(ue)})};return pa("div",{className:"container",children:[pa("div",{className:"flex-1 overflow-auto ",children:[pa("div",{className:"flex",children:[cn("div",{className:"flex-1 text-left ml-4",children:"station name"}),cn("div",{className:"flex-1 text-center",children:"price"}),cn("div",{className:"flex-1 text-end mr-4",children:"idk"})]}),n?n.features.map(x=>cn(yx,{highlight:!0,gasStation:x})):cn("div",{}),a?a.features.map(x=>cn(yx,{gasStation:x})):cn("div",{}),cn(mT,{})]}),cn(fT,{bestGasStations:n,otherGasStations:a,getGasStations:_})]})}Ff.createRoot(document.getElementById("root")).render(cn(Eb.StrictMode,{children:cn(gT,{})}));
